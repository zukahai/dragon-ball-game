/*! For license information please see game.js.LICENSE.txt */
(()=>{"use strict";var t={};function i(t,i,e){for(var h=0,n=0,a=e.length;n<a;n++)(h=e.charCodeAt(n))<128?t.setUint8(i++,h):h<2048?(t.setUint8(i++,192|h>>6),t.setUint8(i++,128|63&h)):h<55296||h>=57344?(t.setUint8(i++,224|h>>12),t.setUint8(i++,128|h>>6&63),t.setUint8(i++,128|63&h)):(n++,h=65536+((1023&h)<<10|1023&e.charCodeAt(n)),t.setUint8(i++,240|h>>18),t.setUint8(i++,128|h>>12&63),t.setUint8(i++,128|h>>6&63),t.setUint8(i++,128|63&h))}function e(t,i,h){var n=typeof h,a=0,o=0,s=0,d=0,l=0,r=0;if("string"===n){if(l=function(t){for(var i=0,e=0,h=0,n=t.length;h<n;h++)(i=t.charCodeAt(h))<128?e+=1:i<2048?e+=2:i<55296||i>=57344?e+=3:(h++,e+=4);return e}(h),l<32)t.push(160|l),r=1;else if(l<256)t.push(217,l),r=2;else if(l<65536)t.push(218,l>>8,l),r=3;else{if(!(l<4294967296))throw new Error("String too long");t.push(219,l>>24,l>>16,l>>8,l),r=5}return i.push({_str:h,_length:l,_offset:t.length}),r+l}if("number"===n)return Math.floor(h)===h&&isFinite(h)?h>=0?h<128?(t.push(h),1):h<256?(t.push(204,h),2):h<65536?(t.push(205,h>>8,h),3):h<4294967296?(t.push(206,h>>24,h>>16,h>>8,h),5):(s=h/Math.pow(2,32)>>0,d=h>>>0,t.push(207,s>>24,s>>16,s>>8,s,d>>24,d>>16,d>>8,d),9):h>=-32?(t.push(h),1):h>=-128?(t.push(208,h),2):h>=-32768?(t.push(209,h>>8,h),3):h>=-2147483648?(t.push(210,h>>24,h>>16,h>>8,h),5):(s=Math.floor(h/Math.pow(2,32)),d=h>>>0,t.push(211,s>>24,s>>16,s>>8,s,d>>24,d>>16,d>>8,d),9):(t.push(203),i.push({_float:h,_length:8,_offset:t.length}),9);if("object"===n){if(null===h)return t.push(192),1;if(Array.isArray(h)){if((l=h.length)<16)t.push(144|l),r=1;else if(l<65536)t.push(220,l>>8,l),r=3;else{if(!(l<4294967296))throw new Error("Array too large");t.push(221,l>>24,l>>16,l>>8,l),r=5}for(a=0;a<l;a++)r+=e(t,i,h[a]);return r}if(h instanceof Date){var g=h.getTime();return s=Math.floor(g/Math.pow(2,32)),d=g>>>0,t.push(215,0,s>>24,s>>16,s>>8,s,d>>24,d>>16,d>>8,d),10}if(h instanceof ArrayBuffer){if((l=h.byteLength)<256)t.push(196,l),r=2;else if(l<65536)t.push(197,l>>8,l),r=3;else{if(!(l<4294967296))throw new Error("Buffer too large");t.push(198,l>>24,l>>16,l>>8,l),r=5}return i.push({_bin:h,_length:l,_offset:t.length}),r+l}if("function"==typeof h.toJSON)return e(t,i,h.toJSON());var c=[],m="",u=Object.keys(h);for(a=0,o=u.length;a<o;a++)"function"!=typeof h[m=u[a]]&&c.push(m);if((l=c.length)<16)t.push(128|l),r=1;else if(l<65536)t.push(222,l>>8,l),r=3;else{if(!(l<4294967296))throw new Error("Object too large");t.push(223,l>>24,l>>16,l>>8,l),r=5}for(a=0;a<l;a++)r+=e(t,i,m=c[a]),r+=e(t,i,h[m]);return r}if("boolean"===n)return t.push(h?195:194),1;if("undefined"===n)return t.push(212,0,0),3;throw new Error("Could not encode")}function h(t){if(this._offset=0,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}h.prototype._array=function(t){for(var i=new Array(t),e=0;e<t;e++)i[e]=this._parse();return i},h.prototype._map=function(t){for(var i={},e=0;e<t;e++)i[this._parse()]=this._parse();return i},h.prototype._str=function(t){var i=function(t,i,e){for(var h="",n=0,a=i,o=i+e;a<o;a++){var s=t.getUint8(a);if(0!=(128&s))if(192!=(224&s))if(224!=(240&s)){if(240!=(248&s))throw new Error("Invalid byte "+s.toString(16));(n=(7&s)<<18|(63&t.getUint8(++a))<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0)>=65536?(n-=65536,h+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):h+=String.fromCharCode(n)}else h+=String.fromCharCode((15&s)<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0);else h+=String.fromCharCode((31&s)<<6|63&t.getUint8(++a));else h+=String.fromCharCode(s)}return h}(this._view,this._offset,t);return this._offset+=t,i},h.prototype._bin=function(t){var i=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,i},h.prototype._parse=function(){var t,i=this._view.getUint8(this._offset++),e=0,h=0,n=0,a=0;if(i<192)return i<128?i:i<144?this._map(15&i):i<160?this._array(15&i):this._str(31&i);if(i>223)return-1*(255-i+1);switch(i){case 192:return null;case 194:return!1;case 195:return!0;case 196:return e=this._view.getUint8(this._offset),this._offset+=1,this._bin(e);case 197:return e=this._view.getUint16(this._offset),this._offset+=2,this._bin(e);case 198:return e=this._view.getUint32(this._offset),this._offset+=4,this._bin(e);case 199:return e=this._view.getUint8(this._offset),h=this._view.getInt8(this._offset+1),this._offset+=2,[h,this._bin(e)];case 200:return e=this._view.getUint16(this._offset),h=this._view.getInt8(this._offset+2),this._offset+=3,[h,this._bin(e)];case 201:return e=this._view.getUint32(this._offset),h=this._view.getInt8(this._offset+4),this._offset+=5,[h,this._bin(e)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return n=this._view.getUint32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,n+a;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return n=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,n+a;case 212:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?void(this._offset+=1):[h,this._bin(1)];case 213:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(2)];case 214:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(4)];case 215:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?(n=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(n+a)):[h,this._bin(8)];case 216:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(16)];case 217:return e=this._view.getUint8(this._offset),this._offset+=1,this._str(e);case 218:return e=this._view.getUint16(this._offset),this._offset+=2,this._str(e);case 219:return e=this._view.getUint32(this._offset),this._offset+=4,this._str(e);case 220:return e=this._view.getUint16(this._offset),this._offset+=2,this._array(e);case 221:return e=this._view.getUint32(this._offset),this._offset+=4,this._array(e);case 222:return e=this._view.getUint16(this._offset),this._offset+=2,this._map(e);case 223:return e=this._view.getUint32(this._offset),this._offset+=4,this._map(e)}throw new Error("Could not parse")},t.encode=function(t){var h=[],n=[],a=e(h,n,t),o=new ArrayBuffer(a),s=new DataView(o),d=0,l=0,r=-1;n.length>0&&(r=n[0]._offset);for(var g,c=0,m=0,u=0,y=h.length;u<y;u++)if(s.setUint8(l+u,h[u]),u+1===r){if(c=(g=n[d])._length,m=l+r,g._bin)for(var w=new Uint8Array(g._bin),f=0;f<c;f++)s.setUint8(m+f,w[f]);else g._str?i(s,m,g._str):void 0!==g._float&&s.setFloat64(m,g._float);l+=c,n[++d]&&(r=n[d]._offset)}return o},t.decode=function(t){var i=new h(t),e=i._parse();if(i._offset!==t.byteLength)throw new Error(t.byteLength-i._offset+" trailing bytes");return e};var n={exports:{}};!function(t){function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}n.exports=i,i.prototype.on=i.prototype.addEventListener=function(t,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i),this},i.prototype.once=function(t,i){function e(){this.off(t,e),i.apply(this,arguments)}return e.fn=i,this.on(t,e),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,i){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e,h=this._callbacks["$"+t];if(!h)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<h.length;n++)if((e=h[n])===i||e.fn===i){h.splice(n,1);break}return 0===h.length&&delete this._callbacks["$"+t],this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),e=this._callbacks["$"+t],h=1;h<arguments.length;h++)i[h-1]=arguments[h];if(e){h=0;for(var n=(e=e.slice(0)).length;h<n;++h)e[h].apply(this,i)}return this},i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}}();var a=n.exports,o={},s=t,d=a,l=(o.protocol=5,o.PacketType={CONNECT:0,DISCONNECT:1,EVENT:2,ACK:3,CONNECT_ERROR:4}),r=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},g=function(t){return"string"==typeof t},c=function(t){return"[object Object]"===Object.prototype.toString.call(t)};function m(){}function u(){}m.prototype.encode=function(t){return[s.encode(t)]},d(u.prototype),u.prototype.add=function(t){var i=s.decode(t);this.checkPacket(i),this.emit("decoded",i)},u.prototype.checkPacket=function(t){if(!(r(t.type)&&t.type>=l.CONNECT&&t.type<=l.CONNECT_ERROR))throw new Error("invalid packet type");if(!g(t.nsp))throw new Error("invalid namespace");if(!function(t){switch(t.type){case l.CONNECT:return void 0===t.data||c(t.data);case l.DISCONNECT:return void 0===t.data;case l.CONNECT_ERROR:return g(t.data)||c(t.data);default:return Array.isArray(t.data)}}(t))throw new Error("invalid payload");if(void 0!==t.id&&!r(t.id))throw new Error("invalid packet id")},u.prototype.destroy=function(){},o.Encoder=m,o.Decoder=u;const y=class{constructor(){this.gameInfo={version:"0.0.1 Beta",name:"SnowlyVN",gameName:"Dragon Ball",timeloadWelcome:500,font:["PatrickHandSCRegular","PottaOne-Regular","fontchinh","chelthm","staccato"]},this.logChipi=["Trò chơi dành cho người trên 12 tuổi. Chơi quá 180 phút mỗi ngày sẽ có hại cho sức khỏe."],this.logNhiemVu=[],this.listMap=[],this.username="",this.password="",this.cacheAction=[],this.dataSkill=[],this.logNotice=[],this.logDanger=[],this.logChat=[],this.cacheMap=[],this.keysPressed={},this.timeRoiTuDo=0,this.actionOld=null,this.SkillDataOnScreen={background:[],skill:[],time:[],texture:[]},this.my={id:0,info:{},skill:{},pos:{},skin:{},eff:{},token:{},act:{},name:{}},this.Charset=[],this.ws=null,this.methodWebsocket(),this.setting={camdi:0,mouse:0,type:null,blockcanvas:!1,oskill:-1,setting:{eff:!0},sprite:{width:48,height:20}},this.CreatedCookie()}getCookie=t=>{let i=t+"=",e=decodeURIComponent(document.cookie).split(";");for(let t=0;t<e.length;t++){let h=e[t];for(;" "==h.charAt(0);)h=h.substring(1);if(0==h.indexOf(i))return h.substring(i.length,h.length)}return""};setCookie=(t,i,e)=>{let h=new Date;h.setTime(h.getTime()+24*e*60*60*1e3);let n="expires="+h.toUTCString();document.cookie=t+"="+i+";"+n+";path=/"};CreatedCookie(){let t=this.getCookie("username"),i=this.getCookie("password");this.username=t,this.password=i}addAction(t=null){let i={},e=this.Charset,h=this.cacheAction,n=this.my;null==t&&(t={id:n.id,action:n.info.act}),null==t.action&&(console.log("set phu",t),t.action="move");let a=t.id==n.id?n:e.find((i=>i.id==t.id));if(!a||!a.info||!a.info.act)return;a.info.act=t.action;let o=h.find((i=>i.id===t.id));o?o.action=t.action:(i.action=t.action,i.id=t.id,h.push(i))}delAction=function(t){let i=this.cacheAction,e=i.findIndex((i=>i.id===t.id));-1!==e&&i.splice(e,1)};danger=function(t){this.logDanger.find((i=>i===t))||this.logDanger.push(t)};methodWebsocket(){this.send=function(t,i){if(0==this.isConnect)return 1==this.loadGame.visible&&(this.loadGame.visible=!1),this.deleteNotice(),this.notice(this._("Máy chủ đang bảo trì, vui lòng thử lại sau ít phút."));i?this.ws.emit(t,i):this.ws.emit(t)},this.to=function(t,i){i?this.send(t,i):this.send(t)}}lang=t=>t;_=t=>this.lang(t);CallWebsocket(){this.ws=io(this.gameInfo.server,{transports:["websocket"],parser:o})}};class w extends y{constructor(){super()}Graphics=()=>{let t=new PIXI.Graphics;return t.mau=(i=0,e=1)=>(t.beginFill(i,e),t),t.vien=(i=0,e=1,h=1)=>(t.lineStyle(e,i,h),t),t.size=(i=100,e=100)=>(t.drawRect(0,0,i,e),t),t.botron=(i=0)=>{let e=t.width,h=t.height;return t.drawRoundedRect(0,0,e,h,i),t},t.endFill(),t};Text=t=>{let i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:16777215});return i.font=(t="Arial")=>(i.style.fontFamily=t,i),i.size=(t="14")=>(i.style.fontSize=t,i),i.mau=t=>(i.style.fill=t,i),i.dam=(t="bold")=>(i.style.fontWeight=t,i),i.vitri=t=>(i.style.align=t,i),i.vien=(t=0,e=1)=>(i.style.stroke=t,i.style.strokeThickness=e,i),i.xuongdong=(t=!0,e=100)=>(i.style.wordWrap=t,i.style.wordWrapWidth=e,i),i}}class f extends w{constructor(){super(),this.publicListSheet=[],this.insertSheet(),this.srcSheet=["dam"],this.srcSheetPixi=[],this.listSheet=[],this.listBigSheet=[],this.loadBigSite=!0,this.listSheetEmpty=[]}checkSheet(t){let i=this.publicListSheet.find((i=>i.name==t));return i||!1}coverSheet(t){let i=t+".png",e=PIXI.utils.TextureCache[i];if(e)return console.log("lấy sheet này"),e;if(this.loadBigSite&&-1==this.listSheetEmpty.findIndex((i=>i==t))){let i=this.listSheet.find((i=>i.n==t));if(i||(i=this.listBigSheet.find((i=>i.n==t)),i&&this.listSheet.push(i)),i){let t=PIXI.Texture.from("./assets/sheet/"+i.t,{resourceOptions:{createBitmap:!1}}),e=new PIXI.Sprite(t);return i.rotated&&(e.rotation=-Math.PI/2),new PIXI.Texture(e.texture,new PIXI.Rectangle(i.x,i.y,i.w,i.h))}this.listSheetEmpty.push(t)}let h=this.checkSheet(t);if(h){let t=PIXI.Texture.from("./assets/char/"+h.sheet+".png",{resourceOptions:{createBitmap:!1}}),i=new PIXI.Sprite(t);return new PIXI.Texture(i.texture,new PIXI.Rectangle(h.x,h.y,h.w,h.h))}return!1}insertSheet=()=>{this.publicListSheet.push({name:"514",sheet:"big3",x:475,y:-2,w:128,h:112.00000000000001},{name:"515",sheet:"big3",x:601,y:-3,w:128,h:112.00000000000001},{name:"chipi_1",sheet:"big3",x:396,y:265,w:87,h:87},{name:"chipi_2",sheet:"big3",x:396,y:177,w:87,h:87},{name:"chipi_1_1",sheet:"big3",x:1,y:769,w:107,h:104},{name:"chipi_1_2",sheet:"big3",x:0,y:876,w:130,h:103},{name:"rungu1",sheet:"rungu",x:0,y:0,w:24,h:27},{name:"rungu2",sheet:"rungu",x:0,y:27,w:24,h:27},{name:"rungu3",sheet:"rungu",x:0,y:54,w:24,h:27},{name:"rungu4",sheet:"rungu",x:0,y:81,w:24,h:27},{name:"q_nhiemvu_1",sheet:"big1",x:972,y:218,w:41,h:65},{name:"q_nhiemvu_2",sheet:"big1",x:972,y:284,w:41,h:65},{name:"q_nhiemvu_3",sheet:"big3",x:849,y:0,w:41,h:64},{name:"now_chay_1",sheet:"chay_eff",x:0,y:0,w:46,h:48},{name:"now_chay_2",sheet:"chay_eff",x:48,y:0,w:44,h:47},{name:"now_chay_3",sheet:"chay_eff",x:93,y:16,w:24,h:27})}}class p extends f{constructor(){super(),this.images=[],this.assets=[],this.PC=0,this.skill_active=[],this.item=[],this.skill=[],this.base_co=[],this.spriteComBo=[],this.base_combo=[],this.createObjectItem()}danhHieu=t=>"Tân binh";nhapPath(t){for(let i=0;i<t.length;i++)this.images.push(t[i])}getSkin(t){let i=this.images.find((i=>i.name==t));return i||this.images[0]}coverImgMap=t=>{let i=this.coverSheet(t);if(i)return i;let e=this.assets.find((i=>i.name==t));return PIXI.Texture.from(e.url,{resourceOptions:{createBitmap:!1}})};load(t){return PIXI.Assets.load(t)}getUrlImg(t,i="char"){let e=this.checkSheet(t);return e?"./assets/char/"+e.sheet+".png":("number"==typeof t&&(t=t.toString()),"./assets/"+i+"/"+t+".png")}coverImg(t,i="char"){return this.coverSheet(t)||("number"==typeof t&&(t=t.toString()),PIXI.Texture.from("./assets/"+i+"/"+t+".png",{resourceOptions:{createBitmap:!1}}))}number_format=function(t){return t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")};usedSkill=function(t){let i=this.skill_active.find((i=>i.id==t));return i||!1};getImg=function(t){return this.images.find((i=>i.name==t))};getFarm=function(t,i,e){let h=this.getSkin(t);if(!h)return!1;h=h.farm[0];let n=h;if(h=h[e],!h)for(let t in n){h=n[t],console.log(h);break}return i>h.farme.length&&(i=0),h.farme[i]};checkSkill=function(t,i){const e=this.skill.find((i=>i.name===t));if(e){const t=e.src.find((t=>t.level===i));if(t)return t}};deleteSkill=function(t){let i=this.dataSkill.find((i=>i.id===t));i&&(i.type="delete")};rand=function(t,i){return Math.floor(Math.random()*(i-t+1)+t)};createObjectItem=function(){this.itemTypeName={hp:{name:"HP",type:"+"},giap:{name:"Giáp",type:"+"},chimang:{name:"Chí mạng",type:"%"},sucdanh:{name:"Sức đánh",type:"+"},ki:{name:"Ki",type:"+"},hutmau:{name:"% HP từ đòn đánh",type:"%"},hoimau:{name:"% HP sau 30s",type:"%"},hoiki:{name:"% KI sau 30s",type:"%"},hutki:{name:"% KI từ đòn đánh",type:"%"},hoiki30s:{name:" KI sau 30s",type:"%"},hoihp30s:{name:" HP sau 30s",type:"%"},phandon:{name:"% Phản đòn",type:"%"},hoichieu:{name:"% Hồi chiêu",type:"%"},gocgiap:{name:"% Giáp",type:"%"},gochp:{name:"% HP",type:"%"},gocki:{name:"% Ki",type:"%"},gocsucdanh:{name:"% Sức đánh",type:"%"}}}}const x=class extends p{constructor(){super(),this.PixiGame(),this.createObject()}loadCanvas(){console.log("run game")}applyBorderToCanvas(){return!1}resizeCanvas(){return!1}checkSize(t,i){const e=window.innerWidth,h=window.innerHeight;return t<e||i<h}PixiGame(){this.gameWidth=window.innerWidth,this.gameHeight=window.innerHeight,this.mobi=!1,/Mobi/.test(navigator.userAgent)&&"onorientationchange"in window?this.mobi=!0:(this.gameWidth=window.innerWidth>1025?1025:window.innerWidth,this.gameHeight=window.innerHeight>635?635:window.innerHeight);let t=document.getElementById("game");if(1==this.mobi&&this.gameHeight>1025&&(this.gameHeight=1025,this.mobi=!1),this.checkSize(this.gameWidth,this.gameHeight)&&(this.gameWidth=t.offsetWidth,this.gameHeight=t.offsetHeight),this.app=new PIXI.Application({width:this.gameWidth-0,height:this.gameHeight-0,backgroundColor:1683704,transparent:!1,powerPreference:"high-performance",resolution:window.devicePixelRatio,autoDensity:!0,sharedTicker:!0,roundPixels:!0,legacy:!1,preserveDrawingBuffer:!0,sharedTicker:!0,antialias:!0}),this.app.stage.name="Dragon Boy H5 with Since04",globalThis.__PIXI_APP__=this.app,this.app.renderer.plugins.accessibility.destroy(),this.mobi){let t=document.getElementById("desktop");t&&(t.style.display="none"),document.body.appendChild(this.app.view)}else t.appendChild(this.app.view)}createObject(){this.container=new PIXI.Container,this.container.name="Lớp chứa nhân vật, phụ kiện, các lớp bản đồ, hiệu ứng",this.nen=new PIXI.Sprite(PIXI.Texture.WHITE),this.nen.name="Lớp nền",this.nen.tint=0,this.lopCanhNen=new PIXI.Container,this.lopCanhNen.name="Lớp cảnh nền",this.lopCanhNen.addChild(this.nen),this.inGame=new PIXI.Container,this.inGame.name="Lớp trong game",this.loadGame=new PIXI.Container,this.loadGame.name="Lớp chờ load game",this.container.blendMode=PIXI.BLEND_MODES.SCREEN,this.container.resolution=2,this.bando=new PIXI.Container,this.bando.name="Lớp bản đồ",this.bando_che=new PIXI.Container,this.bando_che.name="Lớp bản đồ nhân vật",this.bando_nuida=new PIXI.Container,this.bando_nuida.name="lớp bản đồ núi ",this.bando_nuixa=new PIXI.Container,this.bando_nuixa.name="lớp thung lũng",this.bando_nuixanua=new PIXI.Container,this.bando_nuixanua.name="lớp chân trời",this.bando_bautroi=new PIXI.Container,this.bando_bautroi.name="Lớp bầu trời",this.bando_chantroi=new PIXI.Sprite(PIXI.Texture.WHITE),this.bando_chantroi.name="Lớp màu chân trời",this.bando_chantroi.tint=4830299,this.bando_channuixa=new PIXI.Sprite(PIXI.Texture.WHITE),this.bando_channuixa.name="Lớp màu núi xa",this.bando_channuixa.tint=4830299,this.SCnhapnhay=new PIXI.Container,this.SCwhite=new PIXI.Container,this.SCwhite.name="lớp trắng màn hình",this.gameMap={setting:{maxY:0,minY:0,maxX:0,minX:0},size:{idMaxX:0,idMaxY:0,idMinX:0,idMinY:0},more:{}},this.nguoichoi=new PIXI.Container,this.nguoichoi.name="Lớp nhân vật trên bản đồ",this.nguoichoi.zIndex=2,this.nguoichoi_phukien=new PIXI.Container,this.nguoichoi_phukien.name="Lớp phụ kiện của player",this.kiNang=new PIXI.Container,this.kiNang.name="Lớp hiệu ứng kĩ năng",this.Chat=new PIXI.Container,this.Chat.name="Lớp hiệu ứng chát",this.luoiBlock=new PIXI.Container,this.lopCanhNen.addChild(this.bando_chantroi),this.lopCanhNen.addChild(this.bando_channuixa),this.lopCanhNen.addChild(this.bando_bautroi),this.lopCanhNen.addChild(this.bando_nuixanua),this.lopCanhNen.addChild(this.bando_nuixa),this.lopCanhNen.addChild(this.bando_nuida),this.container.addChild(this.bando),this.bando_hieuung=new PIXI.Container,this.bando_hieuung.name="Lớp hiệu ứng bản đồ",this.container.addChild(this.bando_hieuung),this.container.addChild(this.nguoichoi_phukien,this.nguoichoi),this.NhanVatGoc=new PIXI.Container,this.name="Lớp nhân vật gốc",this.NhanVat=new PIXI.Container,this.NhanVat.name="Lớp nhân vật",this.NhanVat_phukien=new PIXI.Container,this.NhanVat_phukien.name="Lớp nhân vật phụ kiện",this.container.addChild(this.NhanVatGoc),this.container.addChild(this.NhanVat_phukien),this.container.addChild(this.NhanVat),this.container.addChild(this.kiNang),this.container.addChild(this.bando_che),this.bando_suongmu=new PIXI.Container,this.bando_suongmu.name="Lớp sương mù",this.bando_suongmu.zIndex=1,this.container.addChild(this.bando_suongmu),this.container.addChild(this.Chat),this.postionChar=new PIXI.Text("X,Y:",{fill:"white",fontSize:13}),this.postionChar.position.set(0,.5*this.gameHeight);let t=this.postionChar;t.style.stroke="#000000",t.style.strokeThickness=4,this.showFPS=new PIXI.Text("Mouse position: 0, 0",{fill:"white",fontSize:14});let i=this.showFPS;i.style.stroke="#000000",i.style.strokeThickness=4,this.box=new PIXI.Container,this.box.name="Các lớp như Hành trang, ...",this.box.visible=!1,this.screen=new PIXI.Container,this.screen.name="Lớp màn hình",this.inGame=new PIXI.Container,this.khungGiaoTiep=new PIXI.Container,this.khungGiaoTiep.name="Lớp khung giao tiếp",this.khungGiaoTiep.visible=!1,this.bodyChat=new PIXI.Container,this.bodyChat.name="Lớp khung chat",this.bodyChat.visible=!1,this.inGame.addChild(this.lopCanhNen,this.container),this.inGame.addChild(this.SCwhite),this.screen.addChild(this.inGame),this.inGame.addChild(this.postionChar,this.showFPS),this.listPlayerInMap=new PIXI.Container,this.listPlayerInMap.name="Danh sách thông tin nhân vật trên bản đồ",this.inGame.addChild(this.listPlayerInMap),this.screen.addChild(this.box),this.screen.addChild(this.khungGiaoTiep),this.screen.addChild(this.bodyChat);let e=new PIXI.Graphics;e.beginFill(16777215,1),e.drawRect(0,0,this.gameWidth,this.gameHeight),e.endFill(),e.alpha=1,e.visible=!1,this.GrapSCwhite=e,this.SCwhite.addChild(e),this.NutOnScreen=new PIXI.Container,this.NutOnScreen.name="Các lớp nút trên màn hình",this.NutOnScreenAction=new PIXI.Container,this.NutOnScreenAction.name="Các lớp nút trên màn hình thực hiện",this.NutDaChet=new PIXI.Container,this.NutDaChet.name="Các lớp nút đã chết",this.NutDaChet.visible=!1,this.inGame.addChild(this.NutOnScreenAction,this.NutOnScreen,this.NutDaChet),this.guestContainer=new PIXI.Container,this.guestContainer.name="Lớp khách",this.screen.addChild(this.guestContainer),this.boxPreviewItem=new PIXI.Container,this.boxPreviewItem.name="Thông tin vật phẩm, kĩ năng",this.screen.addChild(this.boxPreviewItem),this.boxError=new PIXI.Container,this.boxError.name="Box thông báo",this.screen.addChild(this.boxError),this.boxError.visible=!1,this.dangerUser=new PIXI.Container,this.dangerUser.name="Box cảnh báo",this.screen.addChild(this.dangerUser),this.chipiBox=new PIXI.Container,this.chipiBox.name="Lớp thông báo chim chipi",this.screen.addChild(this.chipiBox),this.screen.addChild(this.loadGame),this.app.stage.addChild(this.screen),this.screen.interactive=!0,this.screen.on("pointerdown",(t=>{this.boxPreviewItem.removeChildren()}))}fps(){return Math.round(this.app.ticker.FPS/60)<=0?2:2*Math.round(this.app.ticker.FPS/60)}findBag(t){let i=this.my.ruong.item.find((i=>i.id==t));return i}findItem=t=>{let i=this.item.find((i=>i.id==t));return i};deleteNguoiChoi=(t=0)=>{if(t){let i=this.Charset.find((i=>i.id==t));if(i)this.Charset=this.Charset.filter((i=>i.id!=t));else{let i=this.nguoichoi.children.find((i=>i.id==t));i&&this.nguoichoi.removeChild(i);let e=this.nguoichoi_phukien.children.find((i=>i.id==t));e&&this.nguoichoi_phukien.removeChild(e)}this.Charset=this.Charset.filter((i=>i.id!=t))}else this.nguoichoi.removeChildren(),this.nguoichoi_phukien.removeChildren();this.resetNone()};thapPhan=(t,i)=>{try{return parseFloat(t.toFixed(i))}catch(i){return t}}};let b,I=[];const C=class extends x{constructor(){super(),this.timeVoice=0,this.autoVoice=0,this.voiceCheck(),this.TimeClose=0,this.listSound=[]}deleteSound=(t,i=!1)=>{let e=this.listSound.findIndex((i=>i.id==t));if(-1!=e)if(0==i)this.listSound[e].sound.stop(),this.listSound.splice(e,1);else{let t=this.listSound[e].sound;t.playing()&&t.on("end",(()=>{t.stop(),this.listSound.splice(e,1)})),t.on("end",(()=>{t.stop(),this.listSound.splice(e,1)}))}return t};stopMusic=()=>{this.listSound.forEach((t=>{let i=t.sound;t.type&&"music"==t.type&&i.pause()}))};resumeMusic=()=>{this.listSound.forEach((t=>{let i=t.sound;t.type&&"music"==t.type&&(i.playing()&&(this.offMusic.backgroundMusic&&this.stopMusic(),i.volume(this.offMusic.valueSound)),0==i.playing()&&t.name==this.mapMore.music&&i.play())}))};playMusic=(t,i=!1)=>{let e=t+"_since04_music_map",h=this.listSound.findIndex((t=>t.id==e));if(this.offMusic.backgroundMusic)return!1;if(-1!=h){let t=this.listSound[h].sound;return t.playing()||0==t.playing()&&t.play(),e}const n=new Howl({src:["assets/sound/"+t+".mp3"],format:["mp3"],volume:this.offMusic.valueSound,spatial:!0});i&&n.loop(!0),n.pos(0,0,0),n.play(),this.listSound.push({id:e,sound:n,type:"music",name:t})};playSound=(t,i=!1,e=null,h=null)=>{h=null==h?this.randomAZ(10):h;let n=this.listSound.findIndex((t=>t.id==h));if(this.offMusic[t]||this.offMusic.hieuung)return-1!=n&&(this.listSound[n].sound.stop(),this.listSound.splice(n,1)),!1;if(-1!=n){let t=this.listSound[n].sound;if(null!=e&&this.my.id>=1){t.pos(0,0,0);let i=this.NhanVat,n=this.gameWidth/2;if(e+n<=this.NhanVat.x||e-n>=this.NhanVat.x)return this.deleteSound(h);if(Math.abs(e-i.x)<=50)t.pos(0,0,0);else if(e<i.x){t.pos(-1,0,0);let h=e/i.x;t.volume(h)}else if(e>i.x){t.pos(1,0,0);let h=i.x/e;t.volume(h)}}return h}const a=new Howl({src:["assets/sound/"+t+".mp3"],format:["mp3"],volume:this.offMusic.valueSound,spatial:!0});if(i&&a.loop(!0),a.pos(0,0,0),null!=e&&this.my.id>=1){let t=this.NhanVat,i=this.gameWidth/2;if(e+i<=this.NhanVat.x||e-i>=this.NhanVat.x)return h;if(Math.abs(e-t.x)<=50)a.pos(0,0,0);else if(e<t.x){a.pos(-1,0,0);let i=e/t.x;a.volume(i)}else if(e>t.x){a.pos(1,0,0);let i=t.x/e;a.volume(i)}a.play()}else a.play();this.listSound.push({id:h,sound:a}),a.on("end",(()=>{0==i&&this.deleteSound(h)}))};voiceOn=()=>{this.startRecording(),this.danger(this._("Đã bật mic, vui lòng phát ngôn lịch sự.")),this.TimeClose=Date.now()+3e4};voiceOff=()=>{this.autoVoice=!1,this.danger(this._("Đã tắt mic. Người xung quanh sẽ không nghe thấy bạn nói.")),this.stopRecording()};voiceCheck=()=>{this.TimeClose<Date.now()&&this.autoVoice&&(this.voiceOff(),this.CreateDisplayOnScreen()),this.timeVoice<Date.now()&&this.autoVoice&&(this.timeVoice=0,this.stopRecording()),setTimeout((()=>{this.voiceCheck()}),500)};startRecording=()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{const i=(new(window.AudioContext||window.webkitAudioContext)).createMediaStreamSource(t);b=new Recorder(i),this.autoVoice=!0,b.record()})).catch((t=>{console.error("Error accessing microphone:",t)}))};stopRecording=()=>{b&&(b.stop(),b.exportWAV((t=>{const i=new FileReader;i.onload=()=>{const t=i.result;1==this.autoVoice&&this.startRecording(),this.to("audioData",t)},i.readAsArrayBuffer(t)})),b.clear())};coverAudio=t=>{const i=new Blob([t],{type:"audio/webm"}),e=new FileReader;e.onload=()=>{const t=e.result;this.to("audioData",t)},e.readAsArrayBuffer(i)};playAudio=t=>{console.log(t);let i=t._2,e=this.my.id==i?NhanVat:this.nguoichoi.getChildByName(i);e&&(e.sound=!0),t=t._1;const h=new Blob([t],{type:"audio/webm"}),n=URL.createObjectURL(h),a=new Howl({src:[n],format:["webm"]});a.play(),a.on("end",(()=>{let t=this.my.id==i?NhanVat:this.nguoichoi.getChildByName(i);t&&(t.sound=!1)}))};stopRecording_atMy=()=>{b.addEventListener("stop",(()=>{const t=new Blob(I),i=URL.createObjectURL(t);new Audio(i).play()})),b.stop()}};class v extends C{constructor(){super()}hoanThanhNhiemVu=()=>{this.notice(this._("Xin chờ...")),this.to(-30,1)};nhiemvuView=(t=0)=>{let i=this.my;if(!i.nhiemvu.data.id)return this.chipi("tạm thời chưa có nhiệm vụ");if("talk"!=i.nhiemvu.data.type)return this.chipi("Hãy lên đường làm nhiệm vụ đi nào.");let e=this.logNhiemVu.find((t=>t.id==this.my.nhiemvu.id&&(t.class==this.my.info.coban.type||"all"==t.class)));if(!e)return this.chipi("Không đọc được dữ liệu nhiệm vụ.");let h=e.list[i.nhiemvu.now];if(!h)return this.chipi("Không đọc được dữ liệu nhiệm vụ nội dung.");let n=h.data[t];if(!n)return this.chipi("Đã hết nội dung.");let a=this.Charset.find((t=>t.id==this.my.nhiemvu.data.id));if(!a)return this.chipi("Hãy tới map có NPC để nói chuyện");this.NutOnScreen.visible=!1,this.closeBox(),this.khungGiaoTiep.removeChildren(),this.khungGiaoTiep.visible=!0;let o=.8*this.gameWidth,s=.4*this.gameHeight;o=o>600?600:o;let d=this.snowlyGraphics(o,s,1467140,0,1e-4,10,0);this.khungGiaoTiep.addChild(d),d.x=(this.gameWidth-o)/2,d.y=1.1*this.gameHeight-d.height;let l=.4*s,r="";r+=n+"";let g=this.snowlyGraphics(o,l,16711422,0,2,10);d.addChild(g),r=r.replace(/\$/g,i.name);let c=new PIXI.Text(r,{fontSize:15,fill:0,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:o-20,fontWeight:"bold",align:"center"});c.x=g.width/2-c.width/2,c.y=g.height/2-c.height/2,g.addChild(c);let m=this.snowlyGraphics(100,50,14127410,0,2,10);d.addChild(m),m.y=g.height-m.height/4,m.x=g.width/2-m.width/2;let u=new PIXI.Text(t+1<h.data.length?"Tiếp tục":"Xong",{fontSize:15,fill:0,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:o-20,fontWeight:"bold",align:"center"});if(u.x=m.width/2-u.width/2,u.y=m.height/2-u.height/2,m.addChild(u),m.interactive=!0,m.buttonMode=!0,m.on("pointerdown",(()=>{t+1<h.data.length?this.nhiemvuView(t+1):(this.khungGiaoTiep.removeChildren(),this.hoanThanhNhiemVu(),this.NutOnScreen.visible=!0)})),a.source.script.avatar.length>=1){let t=new PIXI.Sprite(this.coverImg(""+a.source.script.avatar)),i=1*d.width;i=i>100?100:i,t.height=i,t.width=i,t.x=0,t.y=0-t.height,d.addChild(t)}}}class P extends v{constructor(){super()}PVPView=(t,i)=>{let e=this.getMy(t);t&&this.msgBox(" "+e.name+" muốn thách đấu với bạn với mức cược "+this.number_format(i)+" vàng",(()=>{this.PVP_Yes(t)}),(()=>{this.PVP_No(t)}))};PVP_Yes=t=>{this.to("pvp",{id:t,type:"yes"}),this.deleteNotice()};PVP_No=t=>{this.deleteNotice(),this.to("pvp",{id:t,type:"no"})};sendPVP=(t,i)=>{if(!t||!i)return;if(i<1e3||i>2e9)return this.chipi("Số tiền cược không hợp lệ");let e=this.getMy(t);return e?e.id==this.myId?this.chipi("Không thể tự thách đấu"):(this.bodyChat.removeChildren(),this.closeBox(),void this.to("pvp",{id:t,vang:i,type:"send"})):this.chipi("Người chơi đã rời khỏi bản đồ")};formInputPkView=t=>{if(!this.getMy(t))return;this.bodyChat.visible=!0,this.bodyChat.removeChildren();let i=.9*this.gameWidth,e=.5*this.gameHeight;i=i>500?500:i,e=e>150?150:e;let h=new PIXI.Graphics;h.beginFill(16704710,1),h.lineStyle(3,7096832,1),h.drawRoundedRect(0,0,i,e,10),h.endFill(),h.x=0,h.y=0,this.bodyChat.addChild(h);let n=new PIXI.Text("Nhập số tiền cược muốn thách đấu (1k - 2B vàng):",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});n.x=10,n.y=10,h.addChild(n);let a=new PIXI.TextInput({input:{fontSize:"15px",padding:"12px",color:"#7a1125",width:.9*i,height:.3*h.height},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});a.x=(i-.9*i)/2,a.y=.7*h.height-a.height/2,a.htmlInput.type="number",a.htmlInput.min=1e3,a.htmlInput.max=2e9,a.htmlInput.value=1e3,h.addChild(a),setTimeout((()=>{a.focus()}),100);let o=new PIXI.Container,s=new PIXI.Graphics;s.beginFill(15040059,1),s.lineStyle(3,6953766,1),s.drawRoundedRect(0,0,.2*i,.3*e,10),s.endFill(),s.x=0,s.y=0,o.addChild(s);let d=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});d.x=s.width/2-d.width/2,d.y=s.height/2-d.height/2,s.addChild(d),s.interactive=!0,s.buttonMode=!0,s.on("pointerdown",(()=>{this.sendPVP(t,a.text),a.blur(),a.text=""})),a.on("keydown",(i=>{13==i&&(this.sendPVP(t,a.text),a.blur(),a.text="")}));let l=new PIXI.Graphics;l.beginFill(15040059,1),l.lineStyle(3,6953766,1),l.drawRoundedRect(0,0,.2*i,.3*e,10),l.endFill(),l.x=d.x+d.width+l.width/2,l.y=0,o.addChild(l);let r=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});r.x=l.width/2-r.width/2,r.y=l.height/2-r.height/2,l.addChild(r),l.interactive=!0,l.buttonMode=!0,l.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),h.addChild(o),o.x=i/2-o.width/2,o.y=.95*h.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=.9*this.gameHeight-this.bodyChat.height}}class k extends P{constructor(){super()}talkAction(t,i){return"goto"==t&&"object"==typeof i?this.baynhanh(i.x,i.y):("shop_buma"==t&&this.to(-21,"a2"),"shop_popo"==t&&this.to(-21,"awrtyf"),"shop_buma_vo"==t&&this.to(-21,"a3"),"shop_saiyan"==t&&this.to(-21,"cvb"),"nangcap"==t&&(this.danhSachItem=[],this.luaChonNangCap=0,this.boxNangCapLv("ba")),"duclo"==t&&(this.danhSachItem=[],this.luaChonNangCap=1,this.boxNangCapLv("ba")),"epsao"==t&&(this.danhSachItem=[],this.luaChonNangCap=2,this.boxNangCapLv("ba")),"caythan"==t&&this.to(-32,{type:"thucan"}),"ruongdo"==t&&this.openRuongDo(),"nhiemvu"==t?this.nhiemvuView(0):void 0)}}const S=class extends k{constructor(){super()}talkWith(t){let i=this.Charset.find((i=>i.id==t));if(!i)return!1;let e=i.source;return e.onclick?this.talkAction(e.onclick):i.id==this.my.nhiemvu.data.id?this.nhiemvuView(0):(i.pos.x<this.NhanVat.x&&(i.info.move="right"),i.pos.x>this.NhanVat.x&&(i.info.move="left"),this.talkWithButton(e.giaotiep,e.action,e.script.avatar,t))}talkWithButton(t,i=[],e="",h=null){this.closeBox(),this.khungGiaoTiep.removeChildren(),this.khungGiaoTiep.visible=!0;let n=.8*this.gameWidth,a=.4*this.gameHeight;n=n>600?600:n;let o=this.snowlyGraphics(n,a,1467140,0,1e-4,10,0);this.khungGiaoTiep.addChild(o),o.x=(this.gameWidth-n)/2,o.y=this.gameHeight-o.height-.1*o.height;let s=.4*a,d="";d+=t+"";let l=this.snowlyGraphics(n,s,16711422,0,2,10);o.addChild(l);let r=new PIXI.Text(d,{fontSize:15,whiteSpace:"normal",align:"center",fill:0,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:n-20,fontWeight:"bold"});r.x=l.width/2-r.width/2,r.y=l.height/2-r.height/2,l.addChild(r);let g=new PIXI.Container,c=new PIXI.Graphics;c.beginFill(0,0),c.drawRect(0,0,.99*o.width,o.height),c.endFill(),c.x=0,c.y=0;let m=[];i.forEach((t=>{m.push({name:t._1,a:t._2,x:t.x,y:t.y})})),m.push({name:"Đóng",a:"close"}),m.forEach(((t,i)=>{let e=new PIXI.Container,h=1*o.width,n=1*a;h=h>100?100:h,n=n>100?100:n;let s=this.snowlyGraphics(h,n,14127410,0,2,10);e.addChild(s),s.x=5+(h+5)*i;let d=new PIXI.Text(t.name,{fontSize:16,fill:5449989,whiteSpace:"normal",align:"center",fontFamily:"Arial",wordWrap:!0,wordWrapWidth:s.width-20,fontWeight:"bold"});d.position.set((s.width-d.width)/2,(s.height-d.height)/2),s.addChild(d),s.name="since04",g.addChild(s),s.interactive=!0,s.cursor="pointer",s.on("pointerover",(()=>{s.clear(),s.lineStyle(2,"#FFFFFF",1),s.beginFill(4767072,.5),s.drawRoundedRect(0,0,h,n,10),s.endFill()})),s.on("pointerout",(()=>{s.clear(),s.lineStyle(2,0,1),s.beginFill(14127410,1),s.drawRoundedRect(0,0,h,n,10),s.endFill()}));let l=0,r=0;s.on("pointerdown",(function(t){l=Date.now()}));let c=this;s.on("pointerup",(function(t){r=Date.now(),r-l<200&&("close"==m[i].a?(c.khungGiaoTiep.visible=!1,c.khungGiaoTiep.removeChildren()):(c.talkAction(m[i].a,m[i]),c.khungGiaoTiep.visible=!1,c.khungGiaoTiep.removeChildren()))}))})),g.name="Lớp con";let u=this.snowlyGraphics(.99*o.width,.6*o.height,0,0,0,10,0);u.y=.4*o.height,o.addChild(u);let y=new pixi_viewport.Viewport({screenWidth:o.width,screenHeight:g.height,passiveWheel:!0});if(y.name="Lớp cuộn",y.addChild(g),u.addChild(y),y.drag({direction:"x",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),y.bounce({top:!0,bottom:!0,friction:.5,time:0,ease:"easeInOutSine"}),e.length>=1){let t=new PIXI.Sprite(this.coverImg(""+e)),i=1*o.width;i=i>100?100:i,t.height=i,t.width=i,t.x=0,t.y=0-t.height,o.addChild(t)}let w=-1,f=this;this.pcKey="",f.pcKey="",clearInterval(f.pcSettimeEntactive),(()=>{this.pcSettimeEntactive=setInterval((function(){let t=f.pcKey;if(0==f.khungGiaoTiep.visible)return clearInterval(f.pcSettimeEntactive),!1;let i=g.children.filter((t=>"since04"==t.name));if("Enter"===t&&-1!=w){let t=i[w],e=f.getAllInteractiveChildren(t);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"))}else"ArrowLeft"===t?(w-=1,w<0&&(w=i.length-1)):"ArrowRight"===t&&(w+=1,w>=i.length&&(w=0));if(i[w]&&f.pcKey.length>=1){for(let t=0;t<i.length;t++)i[t].removeChild(i[t].getChildByName("xanhle"));y.moveCenter(i[w].x,i[w].y);let t=i[w].width,e=i[w].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,t,e,0),h.endFill(),h.name="xanhle",i[w].addChild(h);let n=i[w],a=f.findInteractiveObjects(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown")})),h.on("pointerup",(()=>{a[0].emit("pointerup")})))}f.pcKey=""}),this.app.ticker.deltaMS)})()}},B=class extends S{constructor(){super(),this.item=this.item||{},this.TimeNhatDo=0}submitVutItem=t=>{this.to(-12,t),this.notice(this._("Xin chờ..."),!1)};IoNhatItem=t=>{this.to(-13,t)};ItemNhat=t=>{this.TimeNhatDo<Date.now()&&(this.IoNhatItem(t),this.TimeNhatDo=Date.now()+1e3)};comfirmVutItem=t=>{if(this.my.id<=0)return;let i=this.findBag(t);i||this.notice(this._("Có lỗi xẩy ra.")),"trangbi"==i.active&&this.notice(this._("Vui lòng tháo món đồ ra trước khi vứt."));let e=this.findItem(i.item);return e?e&&e.camvut&&1==e.camvut||i&&i.khoa&&1==i.khoa?this.notice(this._("Không thể vứt vật phẩm này.")):void("caitrang"==e.type2?this.menuComfirmVut(t):this.submitVutItem(t)):this.notice(this._("Có lỗi xẩy ra."))};menuComfirmVut=t=>{this.boxError.removeChildren(),this.boxError.visible=!0,this.boxError.interactive=!0;let i=.6*this.gameWidth,e=.3*this.gameHeight,h=new PIXI.Graphics;h.beginFill(15721922,1),h.lineStyle(3,9274459,1),h.drawRoundedRect(0,0,i,e,10),h.endFill(),h.x=0,h.y=0,this.boxError.addChild(h);let n=new PIXI.Text(this._("Bạn có muốn vứt vật phẩm này không ? (sẽ bị mất luôn.)"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});n.x=i/2-n.width/2,n.y=e/2-n.height/2,this.boxError.addChild(n);let a=new PIXI.Graphics,o=new PIXI.Graphics;o.beginFill(14842938,1),o.lineStyle(3,7019816,1),o.drawRoundedRect(0,0,100,30,10),o.endFill(),o.x=0,o.y=0;let s=new PIXI.Text(this._("OK"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});s.x=o.width/2-s.width/2,s.y=o.height/2-s.height/2,o.addChild(s),o.interactive=!0,o.buttonMode=!0,o.on("pointerdown",(()=>{this.boxError.removeChildren(),this.submitVutItem(t)}));let d=new PIXI.Graphics;d.beginFill(14842938,1),d.lineStyle(3,7019816,1),d.drawRoundedRect(0,0,100,30,10),d.endFill(),d.x=o.width+10,d.y=0;let l=new PIXI.Text(this._("Hủy"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",(()=>{this.boxError.removeChildren()})),a.addChild(o,d),a.x=i/2-a.width/2,a.y=e-a.height/2,this.boxError.addChild(a),this.boxError.x=this.gameWidth/2-i/2,this.boxError.y=.5*this.gameHeight}};class _ extends B{constructor(){super()}submitsellItem=t=>{this.notice(this._("Xin chờ...")),this.to(-23,t)};comfirmSell=t=>{if(!t)return!1;let i=this.my;if(i.id<=0)return;let e=i.ruong.item.find((i=>i.id==t));if(!e)return this.notice(this._("Có lỗi xẩy ra."));let h=this.findItem(e.item);if(!h)return this.notice(this._("Có lỗi xẩy ra."));let n=this.shopList.find((t=>t.idvp==h.id));if(!n)return this.chipi(this._("Vật phẩm này không thể bán."));if("hanhtrang"!=e.active)return this.chipi(this._("Vui lòng tháo vật phẩm ra hàng trang trước."));if(-1==n.sell)return this.chipi(this._("Vật phẩm này không thể bán."));let a=n.sell||1;a=a<1?1:a,console.log("bán");let o=.6*this.gameWidth,s=.3*this.gameHeight,d=new PIXI.Graphics;d.beginFill(15721922,1),d.lineStyle(3,9274459,1),d.drawRoundedRect(0,0,o,s,10),d.endFill(),d.x=0,d.y=0,this.boxError.visible=!0,this.boxError.addChild(d);let l=new PIXI.Text(this._("Bạn có muốn bán x"+e.soluong+" "+h.name+" với giá "+a*e.soluong+" vàng không ? "),{fontSize:16,fill:5449989,fontFamily:"Arial",fontWeight:"bold",align:"center",wordWrap:!0,wordWrapWidth:o-20});l.x=o/2-l.width/2,l.y=s/2-l.height/2,this.boxError.addChild(l);let r=new PIXI.Graphics,g=new PIXI.Graphics;g.beginFill(14842938,1),g.lineStyle(3,7019816,1),g.drawRoundedRect(0,0,100,30,10),g.endFill(),g.x=0,g.y=0;let c=new PIXI.Text(this._("OK"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o-20});c.x=g.width/2-c.width/2,c.y=g.height/2-c.height/2,g.addChild(c),g.interactive=!0,g.buttonMode=!0,g.on("pointerdown",(()=>{this.boxError.removeChildren(),this.submitsellItem(t)}));let m=new PIXI.Graphics;m.beginFill(14842938,1),m.lineStyle(3,7019816,1),m.drawRoundedRect(0,0,100,30,10),m.endFill(),m.x=g.width+10,m.y=0;let u=new PIXI.Text(this._("Hủy"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o-20});u.x=m.width/2-u.width/2,u.y=m.height/2-u.height/2,m.addChild(u),m.interactive=!0,m.buttonMode=!0,m.on("pointerdown",(()=>{this.boxError.removeChildren()})),r.addChild(g,m),r.x=o/2-r.width/2,r.y=s-r.height/2,this.boxError.addChild(r),this.boxError.x=this.gameWidth/2-o/2,this.boxError.y=.5*this.gameHeight}}class T extends _{constructor(){super()}useBuy=t=>{let i=this.shopList.find((i=>i.idvp==t));return!!i&&(1*i.buy>this.my.tien[i.type]?(this.notice(this._("Bạn không có đủ tiền, hãy chăm chỉ kiếm tiền nhé!")),!1):(this.notice(this._("Xin chờ"),0),void this.to(-22,t)))};open_PreviewItemShop(t,i=null){let e=0,h=t.getBounds(),n=t.item;if(!n)return!1;let a=this.item.find((t=>t.id==n));if(!a)return!1;let o=a.id,s=this.findItem(o),d=(this.my,this.shopList.find((i=>i.idvp==t.item)));if(!d)return!1;this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let l=new PIXI.Graphics;this.boxPreviewItem.addChild(l);let r=.4*this.gameWidth;r<350&&(r=350),r>this.gameWidth&&(r=1*this.gameWidth);let g=.15*this.gameHeight;g<85&&(g=85),l.mwidth=r,l.mheight=g,l.beginFill(16711422,1),l.drawRoundedRect(0,0,l.mwidth,l.mheight,5),l.endFill(),l.x=10;let c=new PIXI.Sprite(this.coverImg(s.avatar));c.width=25,c.height=25,c.x=l.width-c.width-10,c.y=0,l.addChild(c);let m=new PIXI.Text(s.name+(a.level&&a.level>=1?" [+"+a.level+"]":""),{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});m.style.fontWeight="bold",m.style.fontSize=.4*h.height,m.height=m.style.fontSize,m.x=.05*l.getBounds().width,m.y=0,m.resolution=2,l.addChild(m);let u=m.y,y=m.height;if(m.x,m.width,"trangbi"==s.type){let t=a.info;for(let i in t){if(0==t[i])continue;let n="";n="%"==this.itemTypeName[i].type?(t[i]>0?"+":"-")+t[i]+this.itemTypeName[i].name:this.itemTypeName[i].name+""+(t[i]>0?"+":"-")+t[i];let a=new PIXI.Text(n,{fontFamily:"Arial",fontSize:16,fill:51968});a.x=.05*l.getBounds().width,a.style.fontWeight="bold",a.y=u+y,a.style.fontSize=.25*h.height,a.height=a.style.fontSize,a.resolution=2,l.addChild(a),u=a.y,y=a.height,e+=a.height}}if(a.khoa&&1==a.khoa){let t="Không thể giao dịch",i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=l.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=u+y,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,l.addChild(i),u=i.y,y=i.height,e+=i.height}let w=new PIXI.Graphics;w.lineStyle(1,0,1),w.moveTo(0,u+y+20),w.lineTo(.8*l.mwidth,u+y+20),w.x=(l.mwidth-w.width)/2,l.addChild(w);let f=new PIXI.Text(s.motadai,{fontFamily:"Arial",fontSize:14,fill:0,align:"center",wordWrap:!0,wordWrapWidth:.8*l.mwidth});f.style.fontWeight="bold",f.style.fontSize=.25*h.height,f.resolution=2,f.x=(l.mwidth-f.width)/2,f.y=u+y+20,l.addChild(f),e+=f.height+5,u=f.y,y=f.height+5;let p=a.sao,x=new PIXI.Container;if(p){let t=0;for(let i=0;i<6;i++)if(p[i]){let e=new PIXI.Sprite(this.coverImg(p[i]>=1?"saoxanh":"saoden"));e.width=.1*h.width,e.height=.4*h.height,x.addChild(e),e.x=t%3*e.width,e.y=Math.floor(t/3)*e.height,t++}x.x=(l.mwidth-x.width)/2,x.y=u+y,l.addChild(x),e+=x.height+x.height/100*10}e+=m.height+c.height,l.mwidth=l.mwidth<r?r:l.mwidth,e=e<g?g:e,l.clear(),l.lineStyle(1,0,1),l.beginFill(16777215,1),l.drawRoundedRect(0,0,l.mwidth,e,10),l.endFill();let b=new PIXI.Container;this.boxPreviewItem.addChild(b);let I=new PIXI.Graphics;I.name="since04",I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),I.endFill(),I.interactive=!0,I.buttonMode=!0;let C=this;I.on("pointerdown",(()=>{C.useBuy(a.id)})),I.on("pointerover",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(4832866,1),I.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),I.endFill()})),I.on("pointerout",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),I.endFill()}));let v=new PIXI.Text("Mua",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:I.getBounds().width,WrapHeight:I.getBounds().height});v.style.fontWeight="bold",v.style.fontSize=.25*h.height,v.resolution=2,v.x=(I.getBounds().width-v.getBounds().width)/2,v.y=(I.getBounds().height-v.getBounds().height)/2,I.addChild(v);let P=new PIXI.Graphics;P.lineStyle(1,0,1),P.name="since04",P.beginFill(14061362,1),P.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),P.endFill(),P.x=I.getBounds().width+10,P.interactive=!0,P.cursor="pointer",P.on("pointerdown",(function(t){})),P.on("pointerover",(()=>{P.clear(),P.lineStyle(1,0,1),P.beginFill(4832866,1),P.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),P.endFill()})),P.on("pointerout",(()=>{P.clear(),P.lineStyle(1,0,1),P.beginFill(14061362,1),P.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),P.endFill()}));let k=new PIXI.Text("Đóng",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:I.getBounds().width});k.style.fontWeight="bold",k.style.fontSize=.25*h.height,k.resolution=2,k.x=(P.getBounds().width-k.getBounds().width)/2,k.y=(P.getBounds().height-k.getBounds().height)/2,P.addChild(k),b.addChild(I,P),l.y=h.y-l.getBounds().height+h.height,l.y+l.getBounds().height+b.getBounds().height>this.gameHeight&&(l.y=this.gameHeight-l.getBounds().height-10-b.getBounds().height),l.y<0&&(l.y=10),b.x=(l.getBounds().width-b.getBounds().width)/2,b.y=l.getBounds().height+l.getBounds().y;let S=0;"Enter"==this.pcKey&&(this.pcKey="1");let B=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(B),!1;let t=b.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(S-=1,S<0&&(S=t.length-1)):"ArrowRight"===i&&(S+=1,S>=t.length&&(S=0)),("ArrowUp"===i||"ArrowDown"===i)&&C.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[S],e=C.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[S]&&C.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[S].width,e=t[S].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[S].addChild(h);let n=t[S],a=C.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class X extends T{constructor(){super()}boxBaseMenuPlayer=(t,i,e,h)=>{let n=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return n.addChild(((t,i,e)=>{let n=new PIXI.Container;return e.forEach(((a,o)=>{let s=.98*t.width;s-=2*(e.length-1);let d=.2*s,l=s/e.length;d>l&&(d=l);let r=this.snowlyGraphics(d,.85*t.height,a.onclick==i?12118449:16770760,7096832,2,10);r.x=o*r.width+2*o;let g=this.snowlyText(a.name,16,"fontchinh",5592405,!0,r.width,r.height);r.addChild(g),this.snowlyEvent(r,(()=>{this.viewInfoPlayer(h,a.onclick)})),n.addChild(r)})),n.y=t.height/2-n.height/2,n})(n,i,e)),n.x=t.width/2-n.width/2,n.y=t.height,n};viewInfoPlayerTrangbi=(t,i)=>{this.closeBox();let e=this.Charset.find((i=>i.id==t));if(!e)return this.notice(this._("Người chơi này đã rời khỏi bản đồ"));let h=this.boxBaseBackground();this.box.addChild(h);let n=this.boxBaseHead(h),a=this.snowlyImg(e.info.coban.avatar);a.width=.25*n.width,a.height=.99*n.height>a.width?a.width:.99*n.height,a.x=.01*n.width,a.y=.99*n.height-a.height,n.addChild(a);let o=new PIXI.Container,s=this.snowlyText("HP: "+e.info.chiso.hp+" / "+e.info.chiso.hpFull,16,"fontchinh",16711168,!1,n.width,n.height);s.y=0,o.addChild(s);let d=this.snowlyText("KI: "+e.info.chiso.ki+" / "+e.info.chiso.kiFull,16,"fontchinh",16711168,!1,n.width,n.height);d.y=s.y+s.height,o.addChild(d);let l=this.snowlyText("Sức đánh: "+e.info.chiso.sucdanh,16,"fontchinh",16711168,!1,n.width,n.height);l.y=d.y+d.height,o.addChild(l);let r=this.snowlyText("Giáp: "+e.info.chiso.giap+", Chí mạng: "+e.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,n.width,n.height);r.y=l.y+l.height,o.addChild(r),n.addChild(o),o.x=a.x+a.width+.05*a.width,o.y=n.height/2-o.height/2;let g=this.boxBaseMenuPlayer(n,1,i,t),c=this.boxBaseBody(h,n,g);h.addChild(c);let m=this.boxBaseMask(c,h),u=this,y=t=>{t.interactive=!0,t.cursor="pointer";let i=0,h=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(n){h=Date.now(),h-i<300&&u.playerPreviewItem(t,e.ruong.item)}))},w=c.width,f=.15*n.width;f=f>50?50:f;let p=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<6;t++){let i=new PIXI.Container;m.addChild(i),i.maxWight=w,i.maxHeight=f,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=f*t+0;let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(0,.5),h.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),h.endFill();let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(9927509,1),n.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),n.endFill(),n.x=0,n.y=0;let a=new PIXI.Graphics;if(a.lineStyle(1,14272691,1),a.beginFill(15130321,1),a.drawRoundedRect(n.x+n.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),a.endFill(),e.trangbi[p[t]]&&0!=e.trangbi[p[t]]){let i=e.trangbi[p[t]],h=e.ruong.item.find((t=>t.id==i));if(h){let t=this.findItem(h.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=25,i.height=25,i.x=(n.width-i.width)/2,i.y=(n.height-i.height)/2,n.addChild(i);let e=this.snowlyText(t.name,16,"fontchinh",21285,!1,a.width,a.height);e.resolution=2,e.x=a.getBounds().x+.04*a.getBounds().width,e.height=.38*a.height,e.y=0+.1*a.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,a.width,a.height);o.resolution=2,o.x=a.getBounds().x+.04*a.getBounds().width,o.height=.38*a.height,o.y=e.y+e.height,a.addChild(e,o),a.item=h.id}}}h.addChild(n,a),i.addChild(h),i.item=a.item,y(a)}this.snowlySroll(c,m);let x=this.boxBaseFoot(n,h);h.addChild(n,g,x)};viewInfoPlayer=(t,i=0)=>{let e=[{name:"Hành động",onclick:0},{name:"Thông tin",onclick:1}];if(1==i)return this.viewInfoPlayerTrangbi(t,e);this.closeBox();let h=this.Charset.find((i=>i.id==t));if(!h)return this.notice(this._("Người chơi này đã rời khỏi bản đồ"));let n=this.boxBaseBackground();this.box.addChild(n);let a=this.boxBaseHead(n),o=this.snowlyImg(h.info.coban.avatar);o.width=.25*a.width,o.height=.99*a.height>o.width?o.width:.99*a.height,o.x=.01*a.width,o.y=.99*a.height-o.height,a.addChild(o);let s=new PIXI.Container,d=this.snowlyText(h.name,20,"fontchinh",16777215,!1,a.width,a.height);s.addChild(d);let l=this.snowlyText("Sức khỏe: "+h.info.chiso.suckhoe/h.info.chiso.suckhoe_max*100+"%",16,"fontchinh",16776960,!1,a.width,a.height);s.addChild(l),l.y=d.height;let r=this.snowlyText(this.danhHieu(h.info.coban.sucmanh),16,"fontchinh",16776960,!1,a.width,a.height);r.y=l.height+d.height,s.addChild(r);let g=this.snowlyText("Sức mạnh: "+this.number_format(h.info.coban.sucmanh),16,"fontchinh",16776960,!1,a.width,a.height);g.y=r.y+r.height,s.addChild(g),a.addChild(s),s.x=o.x+o.width+.05*o.width,s.y=a.height/2-s.height/2;let c=this.boxBaseMenuPlayer(a,i,e,t),m=this.boxBaseBody(n,a,c);n.addChild(m);let u=this.boxBaseMask(m,n),y=m.width,w=.15*a.width;w=w>50?50:w;let f=[{name:"Kết bạn",action:"detu"},{name:"Thách đấu",action:"thachdau"},{name:"Giao dịch",action:"giaodich"},{name:"Mời vào bang",action:"moipt"}];for(let i=0;i<f.length;i++){if("moipt"==f[i].action){let t=this.my;if(t.skin.bangID<=0)continue;if(h.skin.bangID>=1)continue;let i=this.banghoi.menber.find((i=>i.id==t.id)).right;if(i<1)continue}let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(15130321,1),e.drawRoundedRect(0,0,y,w,0),e.endFill(),e.y=i*w*1.09,u.addChild(e);let n=new PIXI.Text(f[i].name,{fontSize:14,fill:6832931,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:y,fontWeight:"900",strokeThickness:0});n.resolution=2,n.style.align="center",n.position.set((y-n.width*n.scale.x)/2,(w-n.height*n.scale.y)/2),e.addChild(n),e.interactive=!0,e.buttonMode=!0;let a=0,o=0;e.on("pointerdown",(function(t){a=Date.now()}));let s=this;e.on("pointerup",(function(e){o=Date.now(),o-a<200&&("giaodich"==f[i].action&&s.sendGiaodich(t),"moipt"==f[i].action&&s.PT_Moi_Vao_Bang(t),"thachdau"==f[i].action&&s.formInputPkView(t))}))}this.snowlySroll(m,u);let p=this.boxBaseFoot(a,n);n.addChild(a,c,p)};playerPreviewItem=(t,i)=>{let e=0,h=t.getBounds(),n=t.item;if(!n)return!1;let a=i.find((t=>t.id==n));if(!a)return!1;let o=a.item,s=this.findItem(o);this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let d=new PIXI.Graphics;this.boxPreviewItem.addChild(d);let l=.4*this.gameWidth;l<350&&(l=350),l>this.gameWidth&&(l=1*this.gameWidth);let r=.15*this.gameHeight;r<85&&(r=85),d.mwidth=l,d.mheight=r,d.beginFill(16711422,1),d.drawRoundedRect(0,0,d.mwidth,d.mheight,5),d.endFill(),d.x=10;let g=new PIXI.Sprite(this.coverImg(s.avatar));g.width=25,g.height=25,g.x=d.width-g.width-10,g.y=0,d.addChild(g);let c=new PIXI.Text(s.name+(a.level&&a.level>=1?" [+"+a.level+"]":""),{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});c.style.fontWeight="bold",c.style.fontSize=.4*h.height,c.height=c.style.fontSize,c.x=.05*d.getBounds().width,c.y=0,c.resolution=2,d.addChild(c);let m=c.y,u=c.height,y=c.x+c.width;if(console.log(y),"trangbi"==s.type){let t=a.info;for(let i in t){if(0==t[i])continue;let n="";n="%"==this.itemTypeName[i].type?(t[i]>0?"+":"-")+t[i]+this.itemTypeName[i].name:this.itemTypeName[i].name+""+(t[i]>0?"+":"-")+t[i];let a=new PIXI.Text(n,{fontFamily:"Arial",fontSize:16,fill:51968});a.x=.05*d.getBounds().width,a.style.fontWeight="bold",a.y=m+u,a.style.fontSize=.25*h.height,a.height=a.style.fontSize,a.resolution=2,d.addChild(a),m=a.y,u=a.height,e+=a.height}}if(a.khoa&&1==a.khoa){let t="Không thể giao dịch",i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=d.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=m+u,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,d.addChild(i),m=i.y,u=i.height,e+=i.height}let w=new PIXI.Graphics;w.lineStyle(1,0,1),w.moveTo(0,m+u+20),w.lineTo(.8*d.mwidth,m+u+20),w.x=(d.mwidth-w.width)/2,d.addChild(w);let f=new PIXI.Text(s.motadai,{fontFamily:"Arial",fontSize:14,fill:0,align:"center",wordWrap:!0,wordWrapWidth:.8*d.mwidth});f.style.fontWeight="bold",f.style.fontSize=.25*h.height,f.resolution=2,f.x=(d.mwidth-f.width)/2,f.y=m+u+20,d.addChild(f),e+=f.height+5,m=f.y,u=f.height+5;let p=a.sao,x=new PIXI.Container;if(p){let t=0;for(let i=0;i<7;i++)if(p[i]&&p[i]>=1||-1==p[i]){let e=new PIXI.Sprite(this.coverImg(p[i]>=1?"saoxanh":"saoden"));e.width=.1*h.width,e.height=.4*h.height,x.addChild(e),e.x=t%3*e.width,e.y=Math.floor(t/3)*e.height,t++}x.x=(d.mwidth-x.width)/2,x.y=m+u,d.addChild(x),e+=x.height+x.height/100*10}e+=c.height+g.height,d.mwidth=d.mwidth<l?l:d.mwidth,e=e<r?r:e,d.clear(),d.lineStyle(1,0,1),d.beginFill(16777215,1),d.drawRoundedRect(0,0,d.mwidth,e,10),d.endFill();let b=new PIXI.Container;this.boxPreviewItem.addChild(b);let I=new PIXI.Graphics;I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill(),I.interactive=!0,I.buttonMode=!0,I.on("pointerover",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(4832866,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill()})),I.on("pointerout",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill()}));let C=new PIXI.Text(this._("Đóng"),{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:I.getBounds().width});C.style.fontWeight="bold",C.style.fontSize=.25*h.height,C.resolution=2,C.x=(I.getBounds().width-C.getBounds().width)/2,C.y=(I.getBounds().height-C.getBounds().height)/2,I.addChild(C),b.addChild(I),"right"=={}.display&&(d.x=this.gameWidth-d.width),d.y=h.y-d.getBounds().height+h.height,d.y+d.getBounds().height+b.getBounds().height>this.gameHeight&&(d.y=this.gameHeight-d.getBounds().height-10-b.getBounds().height),d.y<0&&(d.y=10),b.x=d.getBounds().x+(d.getBounds().width-b.getBounds().width)/2,b.y=d.getBounds().height+d.getBounds().y}}class F extends X{constructor(){super()}userTang=(t,i)=>{let e={hpGoc:0,kiGoc:1,sucdanhGoc:2,chimangGoc:3,giapGoc:4};if(null==e[t])return this.chipi("Có sự cố xẩy ra");let h=e[t];if(this.my.id<=0)return!1;let n=this.my,a=["hpGoc","kiGoc","sucdanhGoc","chimangGoc","giapGoc"][h],o=[20,200,2e3];if(o="hpGoc"==a?[20,200,2e3,2e4]:o,o="kiGoc"==a?[20,200,2e3,2e4]:o,o="sucdanhGoc"==a?[1,10,100,1e3]:o,o="chimangGoc"==a?[1]:o,o="giapGoc"==a?[1,10,100]:o,-1==o.findIndex((t=>t==i)))return this.chipi("Có lỗi xẩy ra");let s=0;if(s="hpGoc"==a?this.tangHP(n.info.chiso[a],i):s,s="kiGoc"==a?this.tangHP(n.info.chiso[a],i):s,s="sucdanhGoc"==a?this.tangSucDanh(n.info.chiso[a],i):s,s="chimangGoc"==a?this.tangchiMang(n.info.chiso[a],i):s,s="giapGoc"==a?this.tangGiap(n.info.chiso[a],i):s,n.info.coban.tiemnang<s)return this.chipi("Chưa đủ tiềm năng để cộng.");this.to(-31,{_1:h,_2:i}),this.notice(this._("Xin chờ"),!1),console.log(t,i)};userSkill(t,i){if(this.my.id<=0)return!1;for(let i=0;i<this.my.oskill.length;i++)this.my.oskill[i]==t&&(this.my.oskill[i]=0);this.my.oskill[i]=t,this.createSkillOnDisplay(),this.to(-9,this.my.oskill)}Open_preSkill=function(t,i=null){let e=this.my,h=0,n=t.getBounds(),a=t.skill;if(!a)return!1;let o=e.skill.find((t=>t.id==a)),s=this.skill_active.find((t=>t.id==a&&("all"==t.class||t.class==e.info.coban.type)));if(!s)return!1;if(!o)return this.notice(this._("Bạn chưa có kĩ năng này."));if(s.id>=1&&o.level<1)return this.notice(this._("Bạn chưa học kĩ năng này. Hãy tới sưu phụ để học (Miễn phí) hoặc mua sách võ công tại URON."));this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let d=new PIXI.Graphics;this.boxPreviewItem.addChild(d);let l=.4*this.gameWidth;l<350&&(l=350),l>this.gameWidth&&(l=1*this.gameWidth);let r=.15*this.gameHeight;if(r<85&&(r=85),d.mwidth=l,d.mheight=r,d.beginFill(16711422,1),d.drawRoundedRect(0,0,d.mwidth,d.mheight,5),d.endFill(),d.x=10,"bidong"==s.type){let t="";"hpGoc"==s.object?t="Sử dụng "+this.number_format(this.tangHP(e.info.chiso[s.object],20))+" tiềm năng để tăng 20 HP gốc.":"kiGoc"==s.object?t="Sử dụng "+this.number_format(this.tangHP(e.info.chiso[s.object],20))+" tiềm năng để tăng 20 KI gốc.":"sucdanhGoc"==s.object?t="Sử dụng "+this.number_format(this.tangSucDanh(e.info.chiso[s.object],1))+" tiềm năng để tăng 1 Sức đánh gốc.":"giapGoc"==s.object?t="Sử dụng "+this.number_format(this.tangGiap(e.info.chiso[s.object],1))+" tiềm năng để tăng 1 giáp gốc.":"chimangGoc"==s.object&&(t="Sử dụng "+this.number_format(this.tangchiMang(e.info.chiso[s.object],1))+" tiềm năng để tăng 1 chí mạng gốc."),console.log(s);let i=new PIXI.Text(t,{fontSize:13,fill:33022,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});i.y=5,i.x=d.mwidth/2-i.width/2,i.resolution=2,h+=i.height+10,d.addChild(i)}else{let t=e.skill.find((t=>t.id==s.id));if(t&&e.skill.level<=0){let t=new PIXI.Text("Bạn chưa học kĩ năng này, hãy tới Quy Lão Kame để học miễn phí hoặc mua sách võ công để học",{fontSize:13,fill:33022,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});t.y=5,t.x=d.mwidth/2-t.width/2,t.resolution=2,h+=t.height+10,d.addChild(t)}else{let i=new PIXI.Text(s.name,{fontSize:13,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});i.y=5,i.x=d.mwidth/2-i.width/2,i.resolution=2,h+=i.height+10,d.addChild(i);let e=new PIXI.Text(s.mota,{fontSize:13,fill:13034909,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/1.3});e.y=i.y+i.height,e.x=d.mwidth/2-e.width/2,e.resolution=2,h+=e.height,d.addChild(e);let n=new PIXI.Graphics;n.lineStyle(1,0,1),n.moveTo(0,e.y+e.height+10),n.lineTo(.8*d.mwidth,e.y+e.height+10),n.x=(d.mwidth-n.width)/2,d.addChild(n);let a=new PIXI.Text("Cấp độ: "+t.level,{fontSize:13,fill:6520318,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});a.y=e.y+e.height+15,a.x=d.mwidth/2-a.width/2,a.resolution=2,h+=a.height+15,d.addChild(a);let o="";o="attack"==s.type?"Gây sát thương "+s.dame[t.level]+"%":"Thời gian tác dụng "+s.dame[t.level]+" giây ",s.desc&&(o=s.desc.replace("$",s.dame[t.level]));let l=new PIXI.Text(o,{fontSize:13,fill:33022,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});l.y=a.y+a.height,l.x=d.mwidth/2-l.width/2,l.resolution=2,h+=l.height,d.addChild(l);let r=new PIXI.Text("KI tiêu hao: "+s.ki[t.level]+(2==s.kit?"%":""),{fontSize:13,fill:33022,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});r.y=l.y+l.height,r.x=d.mwidth/2-r.width/2,r.resolution=2,h+=r.height,d.addChild(r);let g=new PIXI.Text("Thời gian hồi: "+1e3*s.time[t.level]+" mili giây",{fontSize:13,fill:33022,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});g.y=r.y+r.height,g.x=d.mwidth/2-g.width/2,g.resolution=2,h+=g.height,d.addChild(g);let c=new PIXI.Graphics;c.lineStyle(1,0,1),c.moveTo(0,g.y+g.height+10),c.lineTo(.8*d.mwidth,g.y+g.height+10),c.x=(d.mwidth-c.width)/2,d.addChild(c);let m=new PIXI.Text(t.level<7?"Để lên cấp "+(t.level+1)+", hãy đến Quy Lão Kame để học miễn phí hoặc mua sách võ công.":"Đã đạt cấp độ tối đa.",{fontSize:13,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:d.mwidth/2});m.y=g.y+g.height+15,m.x=d.mwidth/2-m.width/2,m.resolution=2,h+=m.height+15,d.addChild(m)}}d.mwidth=d.mwidth<l?l:d.mwidth,d.clear(),d.lineStyle(1,0,1),d.beginFill(16777215,1),d.drawRoundedRect(0,0,d.mwidth,h,10),d.endFill();let g=new PIXI.Container;if(this.boxPreviewItem.addChild(g),"bidong"==s.type){let t=[20,200,2e3];t="hpGoc"==s.object?[20,200,2e3,2e4]:t,t="kiGoc"==s.object?[20,200,2e3,2e4]:t,t="sucdanhGoc"==s.object?[1,10,100,1e3]:t,t="chimangGoc"==s.object?[1]:t,t="giapGoc"==s.object?[1,10,100]:t;let i=this;t.forEach((t=>{let h=new PIXI.Graphics;h.lineStyle(1,6232624,1),h.beginFill(14061362,1),h.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,5),h.endFill(),h.x=g.children.length*(h.getBounds().width+10),h.y=0,h.name="since04",g.addChild(h),h.interactive=!0,h.buttonMode=!0,h.on("pointerdown",(function(){i.userTang(s.object,t)})),h.on("pointerover",(function(){h.tint=4832866})),h.on("pointerout",(function(){h.tint=16777215}));let n="";n="hpGoc"==s.object?"tăng "+t+" HP -"+this.intToM(this.tangHP(e.info.chiso[s.object],t))+" ":n,n="kiGoc"==s.object?"tăng "+t+" KI -"+this.intToM(this.tangHP(e.info.chiso[s.object],t))+" ":n,n="sucdanhGoc"==s.object?"tăng "+t+" Sức đánh -"+this.intToM(this.tangSucDanh(e.info.chiso[s.object],t))+" ":n,n="chimangGoc"==s.object?"tăng "+t+" Chí mạng -"+this.intToM(this.tangchiMang(e.info.chiso[s.object],t))+" ":n,n="giapGoc"==s.object?"tăng "+t+" Giáp -"+this.intToM(this.tangGiap(e.info.chiso[s.object],t))+" ":n;let a=0;a="hpGoc"==s.object?this.tangHP(e.info.chiso[s.object],t):a,a="kiGoc"==s.object?this.tangHP(e.info.chiso[s.object],t):a,a="sucdanhGoc"==s.object?this.tangSucDanh(e.info.chiso[s.object],t):a,a="chimangGoc"==s.object?this.tangchiMang(e.info.chiso[s.object],t):a,a="giapGoc"==s.object?this.tangGiap(e.info.chiso[s.object],t):a,e.info.coban.tiemnang<a&&(h.visible=!1);let o=new PIXI.Text(n,{fontSize:13,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:h.getBounds().width/1.3});o.resolution=2,o.y=h.getBounds().height/2-o.height/2,o.x=h.getBounds().width/2-o.width/2,h.addChild(o),g.addChild(h)}))}else{let t=e.skill.find((t=>t.id==s.id));t&&t.level>=1&&[0,1,2,3,4].forEach((t=>{let i=new PIXI.Graphics;i.lineStyle(1,6232624,1),i.beginFill(14061362,1),i.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,5),i.endFill(),i.x=g.children.length*(i.getBounds().width+10),i.y=0,g.addChild(i),i.interactive=!0,i.buttonMode=!0;let e=this;i.on("pointerdown",(function(){e.userSkill(s.id,t)})),i.name="since04",i.on("pointerover",(function(){i.tint=4832866})),i.on("pointerout",(function(){i.tint=16777215}));let h=new PIXI.Text("Gán phím "+(t+1)+" ",{fontSize:13,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",fontWrap:!0,wordWrap:!0,wordWrapWidth:i.getBounds().width/1.3});h.resolution=2,h.y=i.getBounds().height/2-h.height/2,h.x=i.getBounds().width/2-h.width/2,i.addChild(h)}))}d.y=n.y-d.getBounds().height+n.height,d.y+d.getBounds().height+g.getBounds().height>this.gameHeight&&(d.y=this.gameHeight-d.getBounds().height-10-g.getBounds().height),d.y<0&&(d.y=10),g.x=(d.getBounds().width-g.getBounds().width)/2,g.x<0&&(g.x=d.getBounds().x),g.y=d.getBounds().height+d.getBounds().y;let c=0;"Enter"==this.pcKey&&(this.pcKey="1");let m=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(m),!1;let t=g.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(c-=1,c<0&&(c=t.length-1)):"ArrowRight"===i&&(c+=1,c>=t.length&&(c=0)),("ArrowUp"===i||"ArrowDown"===i)&&this.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[c],e=this.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[c]&&this.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[c].width,e=t[c].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[c].addChild(h);let n=t[c],a=this.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class W extends F{constructor(){super()}useItem(t){let i=this.my;if(i.id<=0&&this.notice("Có lỗi xảy ra."),null==i.ruong.item.find((i=>i.id==t)))return this.notice("Có lỗi xảy ra. code:1.");this.notice("xin chờ...",!1),this.to(-10,t)}useItemDetu(t){let i=this.my;if(i.id<=0&&this.notice("Có lỗi xảy ra."),null==i.ruong.item.find((i=>i.id==t)))return this.notice("Có lỗi xảy ra. code:1.");this.notice("xin chờ...",!1),this.to(-16,t)}open_PreviewItem(t,i={}){let e=0,h=t.getBounds(),n=t.item;if(!n)return!1;let a=this.findBag(n);if(!a)return!1;let o=a.item,s=this.findItem(o),d=this.my;this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0,this.playSound("click");let l=new PIXI.Graphics;this.boxPreviewItem.addChild(l);let r=.4*this.gameWidth;r<350&&(r=350),r>this.gameWidth&&(r=1*this.gameWidth);let g=.15*this.gameHeight;g<85&&(g=85),l.mwidth=r,l.mheight=g,l.beginFill(16711422,1),l.drawRoundedRect(0,0,l.mwidth,l.mheight,5),l.endFill(),l.x=10;let c=new PIXI.Sprite(this.coverImg(s.avatar));c.width=25,c.height=25,c.x=l.width-c.width-10,c.y=0,l.addChild(c);let m=new PIXI.Text(s.name+(a.level&&a.level>=1?" [+"+a.level+"]":""),{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});m.style.fontWeight="bold",m.style.fontSize=.4*h.height,m.height=m.style.fontSize,m.x=.05*l.getBounds().width,m.y=0,m.resolution=2,l.addChild(m);let u=m.y,y=m.height,w=m.x+m.width;if(console.log(w),"trangbi"==s.type){let t=a.info;for(let i in t){if(0==t[i])continue;let n="";n="%"==this.itemTypeName[i].type?(t[i]>0?"+":"-")+t[i]+this.itemTypeName[i].name:this.itemTypeName[i].name+""+(t[i]>0?"+":"-")+t[i];let a=new PIXI.Text(n,{fontFamily:"Arial",fontSize:16,fill:51968});a.x=.05*l.getBounds().width,a.style.fontWeight="bold",a.y=u+y,a.style.fontSize=.25*h.height,a.height=a.style.fontSize,a.resolution=2,l.addChild(a),u=a.y,y=a.height,e+=a.height}}if(a.khoa&&1==a.khoa){let t="Không thể giao dịch",i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=l.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=u+y,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,l.addChild(i),u=i.y,y=i.height,e+=i.height}if(a.hsd&&a.hsd>=1){let t="HSD: "+this.thoigiancon(a.hsd),i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=l.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=u+y,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,l.addChild(i),u=i.y,y=i.height,e+=i.height}if(a.hsd&&a.hsd>=1){let t="("+this.coverTime(a.hsd)+")",i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=l.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=u+y,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,l.addChild(i),u=i.y,y=i.height,e+=i.height}let f=new PIXI.Graphics;f.lineStyle(1,0,1),f.moveTo(0,u+y+20),f.lineTo(.8*l.mwidth,u+y+20),f.x=(l.mwidth-f.width)/2,l.addChild(f);let p=new PIXI.Text(s.motadai,{fontFamily:"Arial",fontSize:14,fill:0,align:"center",wordWrap:!0,wordWrapWidth:.8*l.mwidth});p.style.fontWeight="bold",p.style.fontSize=.25*h.height,p.resolution=2,p.x=(l.mwidth-p.width)/2,p.y=u+y+20,l.addChild(p),e+=p.height+5,u=p.y,y=p.height+5;let x=a.sao,b=new PIXI.Container;if(x){let t=0;for(let i=0;i<7;i++)if(x[i]&&x[i]>=1||-1==x[i]){let e=new PIXI.Sprite(this.coverImg(x[i]>=1?"saoxanh":"saoden"));e.width=.1*h.width,e.height=.4*h.height,b.addChild(e),e.x=t%3*e.width,e.y=Math.floor(t/3)*e.height,t++}b.x=(l.mwidth-b.width)/2,b.y=u+y,l.addChild(b),e+=b.height+b.height/100*10}e+=m.height+c.height,l.mwidth=l.mwidth<r?r:l.mwidth,e=e<g?g:e,l.clear(),l.lineStyle(1,0,1),l.beginFill(16777215,1),l.drawRoundedRect(0,0,l.mwidth,e,10),l.endFill();let I=0;1==i.sell&&(I=1);let C=0;i.nangcap&&(C=1);let v=0;i.layra&&(v=1);let P=0;i.layragiaodich&&(P=1);let k=0;i.giaodich&&(k=1);let S=new PIXI.Container;this.boxPreviewItem.addChild(S);let B=new PIXI.Graphics;B.name="since04",B.lineStyle(1,0,1),B.beginFill(14061362,1),B.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),B.endFill(),B.interactive=!0,B.buttonMode=!0;let _=this;B.on("pointerdown",(()=>"hanhtrang"==a.active&&"ruong"==s.type?this.previewItemBox(s.id):"ruong"==a.active?this.ruongBoRa(a.id):1==P||1==k?this.notice(this._("Không thể thực hiện khi đang giao dịch")):void("detu"==a.active?_.useItemDetu(a.id):_.useItem(a.id)))),B.on("pointerover",(()=>{B.clear(),B.lineStyle(1,0,1),B.beginFill(4832866,1),B.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),B.endFill()})),B.on("pointerout",(()=>{B.clear(),B.lineStyle(1,0,1),B.beginFill(14061362,1),B.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),B.endFill()}));let T=new PIXI.Text("ruong"==a.active?"Lấy ra":"hanhtrang"==a.active?"Sử dụng":"Tháo ra",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:B.getBounds().width});T.style.fontWeight="bold",T.style.fontSize=.25*h.height,T.resolution=2,T.x=(B.getBounds().width-T.getBounds().width)/2,T.y=(B.getBounds().height-T.getBounds().height)/2,B.addChild(T);let X=0;i.catvao&&(X=1);let F=0;i.bora&&(F=1);let W=new PIXI.Graphics;W.lineStyle(1,0,1),W.name="since04",W.beginFill(14061362,1),W.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),W.endFill(),W.x=B.getBounds().width+10,W.interactive=!0,W.cursor="pointer",W.on("pointerdown",(function(t){1==X?_.ruongCatVao(a.id):1==F?_.ruongBoRa(a.id):1==P?_.chonGiaoDichRemove(a.id):1==k?_.chonGiaoDich(a.id):1==v?_.RemoveChonNangCap(a.id):1==C?_.ChooseInNangCap(a):1==I?_.comfirmSell(a.id):_.comfirmVutItem(a.id)})),W.on("pointerover",(()=>{W.clear(),W.lineStyle(1,0,1),W.beginFill(4832866,1),W.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),W.endFill()})),W.on("pointerout",(()=>{W.clear(),W.lineStyle(1,0,1),W.beginFill(14061362,1),W.drawRoundedRect(0,0,.2*l.getBounds().width,.2*l.getBounds().width,10),W.endFill()}));let M=new PIXI.Text(1==F?"Lấy ra":1==X?"Cất vào":1==P?"Bỏ ra":1==k?"Chọn":1==v?"Lấy ra":1==C?"Chọn":0==I?"Vứt":"Bán",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:B.getBounds().width});if(M.style.fontWeight="bold",M.style.fontSize=.25*h.height,M.resolution=2,M.x=(W.getBounds().width-M.getBounds().width)/2,M.y=(W.getBounds().height-M.getBounds().height)/2,W.addChild(M),S.addChild(B,W),"trangbi"==s.type&&"hanhtrang"==a.active&&d.detu&&d.detu.id){let t=new PIXI.Graphics;t.name="since04",t.lineStyle(1,0,1),t.beginFill(14061362,1),t.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),t.endFill(),t.interactive=!0,t.buttonMode=!0;let i=this;t.on("pointerdown",(()=>{if(1==P||1==k)return this.notice(this._("Không thể thực hiện khi đang giao dịch"));i.useItemDetu(a.id)})),t.on("pointerover",(()=>{t.clear(),t.lineStyle(1,0,1),t.beginFill(4832866,1),t.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),t.endFill()})),t.on("pointerout",(()=>{t.clear(),t.lineStyle(1,0,1),t.beginFill(14061362,1),t.drawRoundedRect(0,0,.2*l.mwidth,.2*l.mwidth,10),t.endFill()}));let e=new PIXI.Text("Đệ tử",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:t.getBounds().width,WrapHeight:t.getBounds().height});e.name="since04",e.style.fontWeight="bold",e.style.fontSize=.25*h.height,e.resolution=2,e.x=(t.getBounds().width-e.getBounds().width)/2,e.y=(t.getBounds().height-e.getBounds().height)/2,t.addChild(e),S.addChild(t),t.x=W.getBounds().x+W.getBounds().width+10,t.y=0}"right"==i.display&&(l.x=this.gameWidth-l.width),l.y=h.y-l.getBounds().height+h.height,l.y+l.getBounds().height+S.getBounds().height>this.gameHeight&&(l.y=this.gameHeight-l.getBounds().height-10-S.getBounds().height),l.y<0&&(l.y=10),S.x=l.getBounds().x+(l.getBounds().width-S.getBounds().width)/2,S.y=l.getBounds().height+l.getBounds().y;let N=0;"Enter"==this.pcKey&&(this.pcKey="1");let G=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(G),!1;let t=S.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(N-=1,N<0&&(N=t.length-1)):"ArrowRight"===i&&(N+=1,N>=t.length&&(N=0)),("ArrowUp"===i||"ArrowDown"===i)&&_.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[N],e=_.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[N]&&_.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[N].width,e=t[N].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[N].addChild(h);let n=t[N],a=_.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class M extends W{constructor(){super(),this.timeCheckGiaoDich=0}cancelGiaoDich=()=>{this.to(-25,{_1:6})};statusGiaoDich=()=>!(this.my.id<=0)&&(this.timeCheckGiaoDich>Date.now()||(this.timeCheckGiaoDich=Date.now()+1e3,void(this.giaodich.doiphuong.id>=1&&1!=this.giaodich.xong&&this.to(-25,{_1:9}))));sendGiaodich=t=>{let i=this.Charset.find((i=>i.id==t));if(!i)return this.notice(this._("Người chơi này không có trên bản đồ"));this.to(-25,{_1:1,_2:t}),this.closeBox()};giaodichHuyChapNhan=()=>{this.to(-25,{_1:2})};submitChapNhanLoiMoi=()=>{this.to(-25,{_1:3})};duocmoiGiaoDich=t=>{let i=this.Charset.find((i=>i.id==t));if(!i)return;this.boxError.removeChildren(),this.boxError.visible=!0,this.boxError.interactive=!0;let e=.6*this.gameWidth,h=.3*this.gameHeight,n=new PIXI.Graphics;n.beginFill(15721922,1),n.lineStyle(3,9274459,1),n.drawRoundedRect(0,0,e,h,10),n.endFill(),n.x=0,n.y=0,this.boxError.addChild(n);let a=new PIXI.Text(i.name+this._(" gửi cho bạn một mời bạn giao dịch, bạn có đồng ý không ?"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:e-20});a.x=e/2-a.width/2,a.y=h/2-a.height/2,this.boxError.addChild(a);let o=new PIXI.Graphics,s=new PIXI.Graphics;s.beginFill(14842938,1),s.lineStyle(3,7019816,1),s.drawRoundedRect(0,0,100,30,10),s.endFill(),s.x=0,s.y=0;let d=new PIXI.Text(this._("OK"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:e-20});d.x=s.width/2-d.width/2,d.y=s.height/2-d.height/2,s.addChild(d),s.interactive=!0,s.buttonMode=!0,s.on("pointerdown",(()=>{this.boxError.removeChildren(),this.submitChapNhanLoiMoi()}));let l=new PIXI.Graphics;l.beginFill(14842938,1),l.lineStyle(3,7019816,1),l.drawRoundedRect(0,0,100,30,10),l.endFill(),l.x=s.width+10,l.y=0;let r=new PIXI.Text(this._("Hủy"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:e-20});r.x=l.width/2-r.width/2,r.y=l.height/2-r.height/2,l.addChild(r),l.interactive=!0,l.buttonMode=!0,l.on("pointerdown",(()=>{this.boxError.removeChildren(),this.giaodichHuyChapNhan()})),o.addChild(s,l),o.x=e/2-o.width/2,o.y=h-o.height/2,this.boxError.addChild(o),this.boxError.x=this.gameWidth/2-e/2,this.boxError.y=.5*this.gameHeight};submitGiaoDich=()=>{0==this.giaodich.khoa?(this.to(-25,{_1:4,_2:this.giaodich.vang,_3:this.danhSachItem}),this.notice(this._("Xin chờ..."),!1)):1==this.giaodich.khoa&&1==this.giaodich.doiphuong.khoa?(this.giaodich.xong=1,this.to(-25,{_1:5}),this.notice(this._("Xin chờ..."),!1)):this.notice(this._("Vui lòng chờ đối phương khóa giao dịch."))};chonGiaoDich=t=>{if(1==this.giaodich.khoa)return this.notice(this._("Đã khóa giao dịch, không thể thay đổi."));if(1==this.giaodich.xong)return this.notice(this._("Xin vui lòng chờ đối phương đồng ý."));if(this.danhSachItem.find((i=>i.id==t)))return this.notice(this._("Đã có vật phẩm này"));let i=this.my.ruong.item.find((i=>i.id==t));if(!i)return;let e=this.item.find((t=>t.id==i.item));return e?"hanhtrang"!=i.active?this.notice(this._("Vui lòng tháo vật phẩm ra trước")):"trangbi"==e.type?(this.danhSachItem.push(i),this.boxGiaoDichHanhTrang()):e.khoa>=1||e.giaodich&&1==e.giaodich?this.notice(this._("Vật phẩm này không thể giao dịch")):this.giaoDichInputValue(t):void 0};chonGiaoDichRemove=t=>1==this.giaodich.khoa?this.notice(this._("Đã khóa giao dịch, không thể thay đổi.")):1==this.giaodich.xong?this.notice(this._("Xin vui lòng chờ đối phương đồng ý.")):(this.danhSachItem=this.danhSachItem.filter((i=>i.id!=t)),void this.boxGiaoDichHanhTrang());giaoDichSubmitSoluong=(t,i)=>{if(1==this.giaodich.khoa)return this.notice(this._("Đã khóa giao dịch, không thể thay đổi."));if(1==this.giaodich.xong)return this.notice(this._("Xin vui lòng chờ đối phương đồng ý."));if(!i||i<=0)return this.notice(this._("Số lượng không hợp lệ"));let e=this.my.ruong.item.find((i=>i.id==t));if(!e)return;let h=this.item.find((t=>t.id==e.item));if(h){if("trangbi"==h.type)return this.notice(this._("Vật phẩm này không thể giao dịch"));if(i>e.soluong)return this.notice(this._("Số lượng nhập nhiều hơn số lượng có trong hành trang"));if(this.danhSachItem.find((i=>i.id==t))){let e=this.danhSachItem.findIndex((i=>i.id==t));this.danhSachItem[e].soluong=i}else{let t=Object.assign({},e);t.soluong=i,this.danhSachItem.push(t),this.boxGiaoDichHanhTrang()}}};giaoDichSubmitSoluongVang=t=>1==this.giaodich.khoa?this.notice(this._("Đã khóa giao dịch, không thể thay đổi.")):1==this.giaodich.xong?this.notice(this._("Xin vui lòng chờ đối phương đồng ý.")):!t||t<=0?this.notice(this._("Vàng nhập không hợp lệ")):t>this.my.tien.vang?this.notice(this._("Bạn không có đủ vàng để giao dịch")):t>5e8?this.notice(this._("Giao dịch tối đa 500.000.000 vàng")):(this.giaodich.vang=t,void this.boxGiaoDichHanhTrang());giaoDichInputValueVang=()=>{this.bodyChat.visible=!0,this.bodyChat.removeChildren();let t=.9*this.gameWidth,i=.5*this.gameHeight;t=t>500?500:t,i=i>150?150:i;let e=new PIXI.Graphics;e.beginFill(16704710,1),e.lineStyle(3,7096832,1),e.drawRoundedRect(0,0,t,i,10),e.endFill(),e.x=0,e.y=0,this.bodyChat.addChild(e);let h=new PIXI.Text("Nhập vàng muốn giao dịch:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});h.x=10,h.y=.3*e.height-h.height,e.addChild(h);let n=new PIXI.TextInput({input:{fontSize:"9px",padding:"12px",color:"#7a1125"},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});n.width=.9*t,n.height=.4*i,n.x=(t-.9*t)/2,n.y=.7*e.height-n.height/2,e.addChild(n),setTimeout((()=>{n.focus()}),100),n.restrict="0123456789",n.htmlInput.setAttribute("type","number");let a=new PIXI.Container,o=new PIXI.Graphics;o.beginFill(15040059,1),o.lineStyle(3,6953766,1),o.drawRoundedRect(0,0,.2*t,.3*i,10),o.endFill(),o.x=0,o.y=0,a.addChild(o);let s=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});s.x=o.width/2-s.width/2,s.y=o.height/2-s.height/2,o.addChild(s),o.interactive=!0,o.buttonMode=!0,o.on("pointerdown",(()=>{this.giaoDichSubmitSoluongVang(n.text),n.blur(),n.text="",this.bodyChat.visible=!1,this.bodyChat.removeChildren()}));let d=new PIXI.Graphics;d.beginFill(15040059,1),d.lineStyle(3,6953766,1),d.drawRoundedRect(0,0,.2*t,.3*i,10),d.endFill(),d.x=s.x+s.width+d.width/2,d.y=0,a.addChild(d);let l=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),e.addChild(a),a.x=t/2-a.width/2,a.y=.95*e.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=.9*this.gameHeight-this.bodyChat.height};giaoDichInputValue=t=>{this.bodyChat.visible=!0,this.bodyChat.removeChildren();let i=.9*this.gameWidth,e=.5*this.gameHeight;i=i>500?500:i,e=e>150?150:e;let h=new PIXI.Graphics;h.beginFill(16704710,1),h.lineStyle(3,7096832,1),h.drawRoundedRect(0,0,i,e,10),h.endFill(),h.x=0,h.y=0,this.bodyChat.addChild(h);let n=new PIXI.Text("Nhập số lượng:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});n.x=10,n.y=.3*h.height-n.height,h.addChild(n);let a=new PIXI.TextInput({input:{fontSize:"9px",padding:"12px",color:"#7a1125"},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});a.width=.9*i,a.height=.4*e,a.x=(i-.9*i)/2,a.y=.7*h.height-a.height/2,h.addChild(a),setTimeout((()=>{a.focus()}),100),a.restrict="0123456789",a.htmlInput.setAttribute("type","number");let o=new PIXI.Container,s=new PIXI.Graphics;s.beginFill(15040059,1),s.lineStyle(3,6953766,1),s.drawRoundedRect(0,0,.2*i,.3*e,10),s.endFill(),s.x=0,s.y=0,o.addChild(s);let d=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});d.x=s.width/2-d.width/2,d.y=s.height/2-d.height/2,s.addChild(d),s.interactive=!0,s.buttonMode=!0,s.on("pointerdown",(()=>{this.giaoDichSubmitSoluong(t,a.text),a.blur(),a.text="",this.bodyChat.visible=!1,this.bodyChat.removeChildren()}));let l=new PIXI.Graphics;l.beginFill(15040059,1),l.lineStyle(3,6953766,1),l.drawRoundedRect(0,0,.2*i,.3*e,10),l.endFill(),l.x=d.x+d.width+l.width/2,l.y=0,o.addChild(l);let r=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:i-20});r.x=l.width/2-r.width/2,r.y=l.height/2-r.height/2,l.addChild(r),l.interactive=!0,l.buttonMode=!0,l.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),h.addChild(o),o.x=i/2-o.width/2,o.y=.95*h.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=.9*this.gameHeight-this.bodyChat.height};open_previewGiaoDich(t,i={}){let e=0,h=t.getBounds(),n=t.item;if(!n)return!1;let a=this.giaodich.doiphuong.data.find((t=>t.id==n));if(!a)return!1;let o=a.item,s=this.findItem(o);this.my,this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let d=new PIXI.Graphics;this.boxPreviewItem.addChild(d);let l=.4*this.gameWidth;l<350&&(l=350),l>this.gameWidth&&(l=1*this.gameWidth);let r=.15*this.gameHeight;r<85&&(r=85),d.mwidth=l,d.mheight=r,d.beginFill(16711422,1),d.drawRoundedRect(0,0,d.mwidth,d.mheight,5),d.endFill(),d.x=10;let g=new PIXI.Sprite(this.coverImg(s.avatar));g.width=25,g.height=25,g.x=d.width-g.width-10,g.y=0,d.addChild(g);let c=new PIXI.Text(s.name+(a.level&&a.level>=1?" [+"+a.level+"]":""),{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});c.style.fontWeight="bold",c.style.fontSize=.4*h.height,c.height=c.style.fontSize,c.x=.05*d.getBounds().width,c.y=0,c.resolution=2,d.addChild(c);let m=c.y,u=c.height,y=c.x+c.width;if(console.log(y),"trangbi"==s.type){let t=a.info;for(let i in t){if(0==t[i])continue;let n="";n="%"==this.itemTypeName[i].type?(t[i]>0?"+":"-")+t[i]+this.itemTypeName[i].name:this.itemTypeName[i].name+""+(t[i]>0?"+":"-")+t[i];let a=new PIXI.Text(n,{fontFamily:"Arial",fontSize:16,fill:51968});a.x=.05*d.getBounds().width,a.style.fontWeight="bold",a.y=m+u,a.style.fontSize=.25*h.height,a.height=a.style.fontSize,a.resolution=2,d.addChild(a),m=a.y,u=a.height,e+=a.height}}if(a.khoa&&1==a.khoa){let t="Không thể giao dịch",i=new PIXI.Text(t,{fontFamily:"Arial",fontSize:16,fill:51968});i.x=d.getBounds().width-i.getBounds().width,i.style.fontWeight="bold",i.y=m+u,i.style.fontSize=.27*h.height,i.height=i.style.fontSize,i.resolution=2,d.addChild(i),m=i.y,u=i.height,e+=i.height}let w=new PIXI.Graphics;w.lineStyle(1,0,1),w.moveTo(0,m+u+20),w.lineTo(.8*d.mwidth,m+u+20),w.x=(d.mwidth-w.width)/2,d.addChild(w);let f=new PIXI.Text(s.motadai,{fontFamily:"Arial",fontSize:14,fill:0,align:"center",wordWrap:!0,wordWrapWidth:.8*d.mwidth});f.style.fontWeight="bold",f.style.fontSize=.25*h.height,f.resolution=2,f.x=(d.mwidth-f.width)/2,f.y=m+u+20,d.addChild(f),e+=f.height+5,m=f.y,u=f.height+5;let p=a.sao,x=new PIXI.Container;if(p){let t=0;for(let i=0;i<7;i++)if(p[i]&&p[i]>=1||-1==p[i]){let e=new PIXI.Sprite(this.coverImg(p[i]>=1?"saoxanh":"saoden"));e.width=.1*h.width,e.height=.4*h.height,x.addChild(e),e.x=t%3*e.width,e.y=Math.floor(t/3)*e.height,t++}x.x=(d.mwidth-x.width)/2,x.y=m+u,d.addChild(x),e+=x.height+x.height/100*10}e+=c.height+g.height,d.mwidth=d.mwidth<l?l:d.mwidth,e=e<r?r:e,d.clear(),d.lineStyle(1,0,1),d.beginFill(16777215,1),d.drawRoundedRect(0,0,d.mwidth,e,10),d.endFill();let b=new PIXI.Container;this.boxPreviewItem.addChild(b);let I=new PIXI.Graphics;I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill(),I.interactive=!0,I.buttonMode=!0,I.on("pointerover",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(4832866,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill()})),I.on("pointerout",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*d.mwidth,.2*d.mwidth,10),I.endFill()}));let C=new PIXI.Text(this._("Đóng"),{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:I.getBounds().width});C.style.fontWeight="bold",C.style.fontSize=.25*h.height,C.resolution=2,C.x=(I.getBounds().width-C.getBounds().width)/2,C.y=(I.getBounds().height-C.getBounds().height)/2,I.addChild(C),b.addChild(I),"right"==i.display&&(d.x=this.gameWidth-d.width),d.y=h.y-d.getBounds().height+h.height,d.y+d.getBounds().height+b.getBounds().height>this.gameHeight&&(d.y=this.gameHeight-d.getBounds().height-10-b.getBounds().height),d.y<0&&(d.y=10),b.x=d.getBounds().x+(d.getBounds().width-b.getBounds().width)/2,b.y=d.getBounds().height+d.getBounds().y}}class N extends M{constructor(){super()}noticeNangCap=()=>{let t=this.danhSachItem;if(!t)return;let i=null,e=null,h=null,n=null,a=null,o=null;for(let s=0;s<t.length;s++){let d=t[s],l=this.item.find((t=>t.id==d.item));if(!l)return this.notice(this._("Có lỗi xẩy ra."));if("trangbi"==l.type){if(null!=i)return this.notice(this._("Chỉ nâng cấp được 1 trang bị một lần."));i=d.id,e=l.type2,a=d,o=l}if("item"==l.type){if(null!=h)return this.notice(this._("Chỉ chọn loại đá phù hợp với trang bị thôi.."));h=d.id,n=l.type3}}return null==i?this.notice(this._("Bạn chưa chọn trang bị để nâng cấp.")):null==h?this.notice(this._("Bạn chưa chọn đá để nâng cấp.")):n!=e?this.notice(this._("Loại đá không phù hợp để có thể nâng cấp.")):a.level&&a.level>=7?this.notice(this._("Trang bị đã đạt cấp tối đa.")):(this.to(-24,{_1:"1",_2:i,_3:h}),void this.notice(this._("Xin chờ...")))};CuongHoaXemTruoc=t=>{let i=this.danhSachItem;if(!i)return;let e=null,h=null,n=null,a=null,o=null,s=null;for(let d=0;d<i.length;d++){let l=i[d],r=this.item.find((t=>t.id==l.item));if(!r)return t;if("trangbi"==r.type){if(null!=e)return t;e=l.id,h=r.type2,o=l,s=r}if("item"==r.type){if(null!=n)return t;n=l.id,a=r.type3}}if(null==e)return t;if(null==n)return t;if(a!=h)return t;if(o.level&&o.level>=7)return t;let d={ao:[10,12,13,14,15,16,17],quan:[10,15,20,25,30,35,40],gang:[5,10,15,18,20,33,35],giay:[10,12,13,14,15,16,17],rada:[5,5,5,5,5,5,5]},l=new PIXI.Container,r=0,g=new PIXI.Text(s.name+"["+o.level+"] => ["+(o.level+1)+"] ",{fontFamily:"Arial",fontSize:20,fill:6520318,align:"center"});g.style.fontWeight="bold",l.addChild(g);for(let t in s.info){if(0==s.info[t])continue;let i="",e=0;e=Math.ceil(o.info[t]+o.info[t]/100*d[h][o.level]),i=this.itemTypeName[t].name+""+(o.info[t]>0?"+":"-")+o.info[t]+" => "+e;let n=new PIXI.Text(i,{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});n.style.fontWeight="bold",n.y=r+g.height,l.addChild(n),r+=n.height}let c=new PIXI.Text(this._("Tỉ lệ thành công: ")+{ao:[90,80,70,50,30,10,5],quan:[95,80,72,61,33,10,3],gang:[70,50,40,20,15,2,1],giay:[99,90,80,50,30,10,5],rada:[70,60,50,40,30,20,10]}[h][o.level]+"%",{fontFamily:"Arial",fontSize:16,fill:6520318,align:"center"});c.style.fontWeight="bold",c.y=r+g.height,l.addChild(c);let m=new PIXI.Text(this._("Số lượng đá cần: ")+{ao:[10,20,35,42,51,60,78],quan:[15,30,50,65,75,85,90],gang:[10,20,30,40,50,60,70],giay:[10,20,35,42,51,60,78],rada:[10,20,35,42,51,60,78]}[h][o.level],{fontFamily:"Arial",fontSize:16,fill:16646144,align:"center"});m.style.fontWeight="bold",m.y=r+g.height+c.height,l.addChild(m);let u=new PIXI.Text(this._("Số lượng vàng cần: ")+{ao:[1e4,6e4,15e4,356e3,925e3,125e4,2104e3],quan:[1e4,6e4,15e4,356e3,925e3,125e4,2104e3],gang:[2e4,9e4,55e4,1356e3,1925e3,3125e4,4125e4],giay:[1e4,6e4,15e4,256e3,725e3,125e4,2104e3],rada:[1e4,6e4,15e4,356e3,925e3,125e4,2104e3]}[h][o.level],{fontFamily:"Arial",fontSize:16,fill:51968,align:"center"});return u.style.fontWeight="bold",u.y=r+g.height+c.height+m.height,l.addChild(u),l.y=t.y+t.height,l.x=t.width/2-l.width/2,t.themmoi=l.height,t.addChild(l),t};noticeDucLo=()=>{let t=this.danhSachItem;if(!t)return;let i=null,e=null,h=null,n=null;for(let a=0;a<t.length;a++){let o=t[a],s=this.item.find((t=>t.id==o.item));if(!s)return this.notice(this._("Có lỗi xẩy ra."));if("trangbi"==s.type){if(null!=i)return this.notice(this._("Chỉ có thể đục lỗ 1 trang bị một lần."));i=o.id,e=s.type2,h=o,n=s}}if(null==i)return this.notice(this._("Không có vật phẩm nào được chọn."));let a=h.sao;a="object"==typeof a?a:[0,0,0,0,0,0,0];let o=0;if(a.forEach((t=>{0!=t&&o++})),o>=7)return this.notice(this._("Trang bị đã có tối đa lỗ."));this.to(-24,{_1:"2",_2:i})};DucLoXemTruoc=t=>{let i=this.danhSachItem;if(!i)return;let e=null,h=null,n=null,a=null;for(let o=0;o<i.length;o++){let s=i[o],d=this.item.find((t=>t.id==s.item));if(!d)return t;if("trangbi"==d.type){if(null!=e)return t;e=s.id,h=d.type2,n=s,a=d}}if(null==e)return t;let o=n.sao;o="object"==typeof o?o:[0,0,0,0,0,0,0];let s=0;o.forEach((t=>{0!=t&&s++}));let d=new PIXI.Container,l=new PIXI.Text(a.name+"["+n.level+"]  ",{fontFamily:"Arial",fontSize:20,fill:6520318,align:"center"});l.style.fontWeight="bold",d.addChild(l);let r=new PIXI.Text(this._("Số sao hiện tại: ")+s+(s>=7?" (tối đa)":""),{fontFamily:"Arial",fontSize:16,fill:16646144,align:"center"});r.style.fontWeight="bold",r.y=0+l.height,d.addChild(r);let g=[5,10,20,40,80,90,120],c=[50,40,30,20,10,5,2];if(s<7){let t=new PIXI.Text(this._("Để lên: ")+(s+1)+" sao cần:",{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});t.style.fontWeight="bold",t.y=0+l.height+r.height,d.addChild(t);let i=new PIXI.Text(this._("Vàng cần: ")+this.number_format(1e6*g[s]),{fontFamily:"Arial",fontSize:16,fill:51968,align:"center"});i.style.fontWeight="bold",i.y=0+l.height+r.height+t.height,d.addChild(i);let e=new PIXI.Text(this._("Tỉ lệ thành công: ")+c[s]+"%",{fontFamily:"Arial",fontSize:16,fill:16646144,align:"center"});e.style.fontWeight="bold",e.y=0+l.height+r.height+t.height+i.height,d.addChild(e)}return d.y=t.y+t.height,d.x=t.width/2-d.width/2,t.themmoi=d.height,t.addChild(d),t};noticeEpSao=()=>{let t=this.danhSachItem,i=null,e=null;for(let h=0;h<t.length;h++){let n=t[h],a=this.item.find((t=>t.id==n.item));if("trangbi"==a.type){if(null!=i)return this.notice(this._("Chỉ có thể ép sao cho 1 trang bị một lần."));i=n}if("item"==a.type){if(null!=e)return this.notice(this._("Chỉ được chọn 1 sao pha lê một lần."));e=n}}if(!i||!e)return this.notice(this._("Hãy chọn món đồ và sao pha lê để nâng cấp."));let h=this.item.find((t=>t.id==e.item));return this.item.find((t=>t.id==i.item)),h.thuoctinh&&1*h.value>=0?(i.sao="object"==typeof i.sao?i.sao:[0,0,0,0,0,0,0],i.sao.filter((t=>-1==t)).length<=0?this.notice(this._("Trang bị không còn lỗ trống để ép.")):this.my.zeni<10?this.notice(this._("Không đủ ngọc xanh để thực hiện.")):void this.to(-24,{_1:3,_2:i.id,_3:e.id})):this.notice(this._("Sao pha lê không có thuộc tính."))};epSaoPhaLeXemTruoc=t=>{let i=this.danhSachItem,e=null,h=null;for(let n=0;n<i.length;n++){let a=i[n],o=this.item.find((t=>t.id==a.item));if("trangbi"==o.type){if(null!=e)return t;e=a}if("item"==o.type){if(null!=h)return t;h=a}}if(!e||!h)return t;let n=this.item.find((t=>t.id==h.item)),a=this.item.find((t=>t.id==e.item));if(n.thuoctinh&&1*n.value>=0){let i=new PIXI.Container,h=0;e.sao="object"==typeof e.sao?e.sao:[0,0,0,0,0,0,0];let o=new PIXI.Text(a.name+"["+e.level+"]  ",{fontFamily:"Arial",fontSize:20,fill:6520318,align:"center"});o.style.fontWeight="bold",i.addChild(o);let s=new PIXI.Text(e.sao.filter((t=>-0!=t)).length+" "+this._("Sao"),{fontFamily:"Arial",fontSize:16,fill:16646144,align:"center"});s.style.fontWeight="bold",s.y=h+o.height,i.addChild(s);let d=new PIXI.Text(this._("Số sao có thể ép: ")+e.sao.filter((t=>-1==t)).length+"",{fontFamily:"Arial",fontSize:16,fill:51968,align:"center"});d.style.fontWeight="bold",d.y=h+o.height+s.height,i.addChild(d);let l=new PIXI.Text(this._("Thuộc tính sau ép: "),{fontFamily:"Arial",fontSize:16,fill:5449989,align:"center"});l.style.fontWeight="bold",l.y=h+o.height+s.height+d.height,i.addChild(l);let r=e.info[n.thuoctinh]||0,g=new PIXI.Text(this.itemTypeName[n.thuoctinh].name+" "+r+" => "+(r+1*n.value),{fontFamily:"Arial",fontSize:16,fill:16646144,align:"center"});g.style.fontWeight="bold",g.y=h+o.height+s.height+d.height+l.height,i.addChild(g);let c=new PIXI.Text(this._("Cần 10 ngọc xanh."),{fontFamily:"Arial",fontSize:16,fill:9248036,align:"center"});c.style.fontWeight="bold",c.y=h+o.height+s.height+d.height+l.height+g.height,i.addChild(c),i.y=t.y+t.height,i.x=t.width/2-i.width/2,t.themmoi=i.height,t.addChild(i)}return t};nangCapXemtruoc=t=>0==this.luaChonNangCap?this.CuongHoaXemTruoc(t):1==this.luaChonNangCap?this.DucLoXemTruoc(t):2==this.luaChonNangCap?this.epSaoPhaLeXemTruoc(t):void 0;sanLocNangCap=()=>{0==this.luaChonNangCap&&this.noticeNangCap(),1==this.luaChonNangCap&&this.noticeDucLo(),2==this.luaChonNangCap&&this.noticeEpSao()}}class G extends N{constructor(){super(),this.luaChonNangCap=0,this.danhSachItem=[]}boxBaseMenuNangCap=(t,i,e)=>{let h=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return h.addChild(((t,i,e)=>{let h=new PIXI.Container;return e.forEach(((n,a)=>{let o=.98*t.width;o-=2*(e.length-1);let s=.2*o,d=o/e.length;s>d&&(s=d);let l=this.snowlyGraphics(s,.85*t.height,n.onclick==i?12118449:16770760,7096832,2,10);l.x=a*l.width+2*a;let r=this.snowlyText(n.name,16,"fontchinh",5592405,!0,l.width,l.height);l.addChild(r),this.snowlyEvent(l,(()=>{this.shopChoose=n.onclick,this.boxNangCapLv()})),h.addChild(l)})),h.y=t.height/2-h.height/2,h})(h,i,e)),h.x=t.width/2-h.width/2,h.y=t.height,h};boxNangCapLv=(t="ba")=>{let i=[{name:"Nâng cấp",onclick:1}];if(i.push({name:"Hành trang",onclick:999}),1!=this.shopChoose&&999!=this.shopChoose&&(this.shopChoose=1),999==this.shopChoose)return this.boxShopHanhTrang(i,{nangcap:!0},2),!1;this.closeBox();let e=this.boxBaseBackground();this.box.addChild(e);let h=this.boxBaseHead(e);if(t=this.Charset.find((i=>i.id==t)),!t)return this.closeBox(),this.notice(this._("Không tìm thấy người bán hàng.")),!1;let n=this.snowlyImg(t.source.script.avatar);n.width=.25*h.width,n.height=.99*h.height>n.width?n.width:.99*h.height,n.x=.01*h.width,n.y=.99*h.height-n.height,h.addChild(n);let a=new PIXI.Container,o=this.snowlyText("Xin chào !",16,"Arial",16777215,!1,.7*h.width,.5*h.height),s=this.snowlyText("Ta sẽ phù phép cho trang bị của ngươi trở nên mạnh mẽ hơn ",16,"Arial",16777215,!0,.7*h.width,.5*h.height);s.y=o.height+o.y,a.addChild(o,s),h.addChild(a),a.x=n.x+n.width+.05*n.width,a.y=h.height/2-a.height/2;let d=this.boxBaseMenuNangCap(h,this.shopChoose,i),l=this.boxBaseBody(e,h,d);e.addChild(l);let r=this.boxBaseMask(l,e),g=this,c=l.width,m=.15*h.width;m=m>50?50:m,this.my;let u=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&g.open_PreviewItem(t,{layra:!0})}))},y=0;for(let t=0;t<this.danhSachItem.length;t++){let i=new PIXI.Container;r.addChild(i),i.name="since04KEY",i.maxWight=c,i.maxHeight=m,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=m*t+0,y=i.y+i.height;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(11771523,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill();let a=this.danhSachItem[t];if(a){let t=this.findItem(a.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));if(i.width=25,i.height=25,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i),a.soluong>1){let t=new PIXI.Text(a.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:h.width});t.height=.38*h.height,t.x=h.width-i.width,t.y=h.height-i.height,h.addChild(t)}let e=new PIXI.Text(t.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});e.resolution=2,e.x=n.getBounds().x+.04*n.getBounds().width,e.height=.38*n.height,e.y=0+.1*n.height;let o=new PIXI.Text(t.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=e.y+e.height,n.addChild(e,o)}}e.addChild(h,n),i.addChild(e),i.item=this.danhSachItem[t].id,u(i)}if(0==this.danhSachItem.length){let t="";0==this.luaChonNangCap&&(t="Bạn chưa chọn vật phẩm nào cả!\n Để nâng cấp đồ vui lòng vào hành trang chọn món đồ và loại đá phù hợp để nâng cấp."),1==this.luaChonNangCap&&(t="Bạn chưa chọn vật phẩm nào cả !\n Để đục lỗ trang bị vui lòng chọn vật phẩm trang bị muốn đục lỗ, sau đó bấm Tiến Hành để đục."),2==this.luaChonNangCap&&(t="Bạn chưa chọn vật phẩm nào cả !\n Để ép sao pha lê cho trang bị, bạn hãy chọn món đồ và sao pha lê cần ép.");let i=this.snowlyText(this._(t),16,"chelthm",5449989,!1,l.width,l.height);i.style.fontWeight="bold",r.addChild(i)}else{r=this.nangCapXemtruoc(r);let t=this.snowlyGraphics(.3*l.width,.1*l.height,14645562,5835812,2,10);t.x=l.width/2-t.width/2,t.y=r.y+r.themmoi+t.height+60;let i=this.snowlyText("Tiến hành",16,"fontchinh",5449989,!0,t.width,t.height);t.addChild(i),t.interactive=!0,t.cursor="pointer",t.name="since04KEY",t.on("pointerdown",(()=>{this.sanLocNangCap()})),r.addChild(t)}this.snowlySroll(l,r);let w=this.boxBaseFoot(h,e);e.addChild(h,d,w),2*e.width<=this.gameWidth&&this.boxBaseShopRight("nangcap")};ChooseInNangCap=t=>"hanhtrang"!=t.active?this.notice(this._("Vui lòng tháo vật phẩm ra trước.")):this.danhSachItem.find((i=>i.id==t.id))?this.notice(this._("Đã chọn vật phẩm này rồi.")):(this.danhSachItem.push(t),void this.boxNangCapLv());RemoveChonNangCap=t=>{this.danhSachItem=this.danhSachItem.filter((i=>i.id!=t)),this.boxNangCapLv()}}class R extends G{constructor(){super()}boxBaseMenuShopRuong=(t,i,e)=>{let h=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return h.addChild(((t,i,e)=>{let h=new PIXI.Container;return e.forEach(((n,a)=>{let o=.98*t.width;o-=2*(e.length-1);let s=.2*o,d=o/e.length;s>d&&(s=d);let l=this.snowlyGraphics(s,.85*t.height,n.onclick==i?12118449:16770760,7096832,2,10);l.x=a*l.width+2*a;let r=this.snowlyText(n.name,16,"fontchinh",5592405,!0,l.width,l.height);l.addChild(r),this.snowlyEvent(l,(()=>{this.openRuongDo(n.onclick)})),h.addChild(l)})),h.y=t.height/2-h.height/2,h})(h,i,e)),h.x=t.width/2-h.width/2,h.y=t.height,h};ruongCatVao=t=>{this.notice(this._("Xin chờ"),!1),this.to(-26,{_1:1,_2:t})};ruongBoRa=t=>{this.notice(this._("Xin chờ"),!1),this.to(-26,{_1:2,_2:t})};openRuongDo(t=0){this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("HP: "+this.my.info.chiso.hp+" / "+this.my.info.chiso.hpFull,16,"fontchinh",16711168,!1,e.width,e.height);a.y=0,n.addChild(a);let o=this.snowlyText("KI: "+this.my.info.chiso.ki+" / "+this.my.info.chiso.kiFull,16,"fontchinh",16711168,!1,e.width,e.height);o.y=a.y+a.height,n.addChild(o);let s=this.snowlyText("Sức đánh: "+this.my.info.chiso.sucdanh,16,"fontchinh",16711168,!1,e.width,e.height);s.y=o.y+o.height,n.addChild(s);let d=this.snowlyText("Giáp: "+this.my.info.chiso.giap+", Chí mạng: "+this.my.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,e.width,e.height);d.y=s.y+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenuShopRuong(e,t,[{name:"Rương đồ",onclick:0},{name:"Hành trang",onclick:1}]),r=this.boxBaseBody(i,e,l);i.addChild(r);let g=this.boxBaseMask(r,i),c=this,m=i=>{i.interactive=!0,i.cursor="pointer";let e=0,h=0;i.on("pointerdown",(function(t){e=Date.now()})),i.on("pointerup",(function(n){h=Date.now(),h-e<300&&c.open_PreviewItem(i,{catvao:1==t?1:0,bora:0==t?1:0})}))},u=r.width,y=.15*e.width;y=y>50?50:y;let w=this.my,f=6;0==t&&(f=0);let p=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<f;t++){let i=new PIXI.Container;i.name="since04KEY",g.addChild(i),i.maxWight=u,i.maxHeight=y,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=y*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(9927509,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15130321,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill(),w.trangbi[p[t]]&&0!=w.trangbi[p[t]]){let i=w.trangbi[p[t]],e=this.findBag(i);if(e){let t=this.findItem(e.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=25,i.height=25,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i);let a=this.snowlyText(t.name,16,"fontchinh",21285,!1,n.width,n.height);a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,n.width,n.height);o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o),n.item=e.id}}}e.addChild(h,n),i.addChild(e),i.item=n.item,m(n)}let x=0==t?w.ruong.ruong:w.ruong.slot,b=0,I=w.ruong.item.filter((i=>i.active===(1==t?"hanhtrang":"ruong")));I.forEach((t=>{t.lastTime=t.lastTime||Date.now()})),I.sort((function(t,i){return t.lastTime-i.lastTime}));for(let t=f;t<x+f;t++){let i=new PIXI.Container;i.name="since04KEY",g.addChild(i),i.maxWight=u,i.maxHeight=y,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=y*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(11771523,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill(),I[b]){let t=I[b];if(t){let i=this.findItem(t.item);if(i){let e=new PIXI.Sprite(this.coverImg(i.avatar));if(e.width=25,e.height=25,e.x=(h.width-e.width)/2,e.y=(h.height-e.height)/2,h.addChild(e),t.soluong>1){let i=new PIXI.Text(t.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:h.width});i.height=.38*h.height,i.x=h.width-e.width,i.y=h.height-e.height,h.addChild(i)}let a=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o)}}}e.addChild(h,n),i.addChild(e),i.item=I[b]?I[b].id:null,m(i),b++}this.snowlySroll(r,g);let C=this.boxBaseFoot(e,i);i.addChild(e,l,C),2*i.width<=this.gameWidth&&this.boxBaseShopRight("ruong")}}class D extends R{constructor(){super(),this.giaoDichChoose=1,this.giaodich={khoa:0,xong:0,vang:0,doiphuong:{id:0,khoa:0,xong:0,vang:1e5,data:[{id:"0VtDISCxcs",active:"hanhtrang",info:{hp:0,giap:678,chimang:0,sucdanh:0,ki:0,hutmau:0,hoimau:0,hoiki30s:0,hoihp30s:0,hoiki:0,hutki:0,phandon:0,hoichieu:0,gocgiap:0,gochp:0,gocki:0,gocsucdanh:0},item:12,soluong:1,khoa:0,level:0,sao:[-1,-1,-1,0,0,0,0],lastTime:1686482372648,saotrong:0},{id:"1nGGNDWtEo",active:"hanhtrang",item:"166",soluong:2,khoa:0,level:0,sao:0,saotrong:0},{id:"VbpZGYEGYl",active:"hanhtrang",item:"164",soluong:50,lastTime:1686481708668,khoa:0}]}}}boxBaseMenuGiaoDich=(t,i,e)=>{let h=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return h.addChild(((t,i,e)=>{let h=new PIXI.Container;return e.forEach(((n,a)=>{let o=.98*t.width;o-=2*(e.length-1);let s=.2*o,d=o/e.length;s>d&&(s=d);let l=this.snowlyGraphics(s,.85*t.height,n.onclick==i?12118449:16770760,7096832,2,10);l.x=a*l.width+2*a;let r=this.snowlyText(n.name,16,"fontchinh",5592405,!0,l.width,l.height);l.addChild(r),this.snowlyEvent(l,(()=>{this.giaoDichChoose=n.onclick,this.boxGiaoDichHanhTrang()})),h.addChild(l)})),h.y=t.height/2-h.height/2,h})(h,i,e)),h.x=t.width/2-h.width/2,h.y=t.height,h};giaodichDoiPhuong=t=>{let i=this.giaodich.doiphuong.id,e=this.Charset.find((t=>t.id==i));if(!e)return this.notice(this._("Người chơi này không có trên bản đồ"));this.closeBox();let h=this.boxBaseBackground();this.box.addChild(h);let n=this.boxBaseHead(h),a=this.snowlyImg(e.info.coban.avatar);a.width=.25*n.width,a.height=.99*n.height>a.width?a.width:.99*n.height,a.x=.01*n.width,a.y=.99*n.height-a.height,n.addChild(a);let o=new PIXI.Container,s=this.snowlyText(e.name,16,"fontchinh",16777215,!1,n.width,n.height);s.y=0,o.addChild(s);let d=this.snowlyText("Sức mạnh: "+this.number_format(e.info.coban.sucmanh),16,"fontchinh",16711168,!1,n.width,n.height);d.y=s.y+s.height,o.addChild(d),n.addChild(o),o.x=a.x+a.width+.05*a.width,o.y=n.height/2-o.height/2;let l=this.boxBaseMenuGiaoDich(n,this.giaoDichChoose,t),r=this.boxBaseBody(h,n,l);h.addChild(r);let g=this.boxBaseMask(r,h),c=this,m=r.width,u=.15*n.width;if(u=u>50?50:u,this.my,999==this.giaoDichChoose){let t=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&c.open_previewGiaoDich(t,{layragiaodich:!0})}))},i=0,e=new PIXI.Container;g.addChild(e),e.maxWight=m,e.maxHeight=u,e.width=e.maxWight,e.height=e.maxHeight,e.x=0,e.y=-1*u+0,i=e.y+e.height;let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(0,.5),h.drawRoundedRect(0,0,e.maxWight,e.maxHeight,0),h.endFill();let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(0,0,1*e.maxWight,e.maxHeight,0),n.endFill(),n.x=0,n.y=0;let a=this.snowlyText(this.number_format(this.giaodich.doiphuong.vang)+" vàng",16,"fontchinh",16689408,!1,n.width,n.height);a.x=n.getBounds().x+a.width/2,a.y=n.getBounds().height/2-a.height/2,n.addChild(a);let o="";1==this.giaodich.doiphuong.khoa&&(o="Đối phương đã khóa giao dịch, dưới đây là danh sách vật phẩm của đối phương."),1==this.giaodich.doiphuong.xong&&(o='Đối phương đã xác nhận giao dịch, bạn hãy ấn nút "xong" để giao dịch hoàn tất.');let s=this.snowlyText(o,16,"fontchinh",16711680,!1,n.width,n.height);s.x=n.getBounds().width/2-s.width/2,s.y=n.y-s.height,n.addChild(s),0==this.giaodich.doiphuong.khoa&&(s.visible=!1),0==this.giaodich.doiphuong.xong&&(s.visible=!1),1==this.giaodich.doiphuong.khoa&&(s.visible=!0),1==this.giaodich.doiphuong.xong&&(s.visible=!0),h.addChild(n),e.addChild(h);for(let e=0;e<this.giaodich.doiphuong.data.length;e++){let h=new PIXI.Container;g.addChild(h),h.maxWight=m,h.maxHeight=u,h.width=h.maxWight,h.height=h.maxHeight,h.x=0,h.y=u*e+0,i=h.y+h.height;let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(0,.5),n.drawRoundedRect(0,0,h.maxWight,h.maxHeight,0),n.endFill();let a=new PIXI.Graphics;a.lineStyle(1,14272691,1),a.beginFill(11771523,1),a.drawRoundedRect(0,0,.2*h.maxWight,h.maxHeight,0),a.endFill(),a.x=0,a.y=0;let o=new PIXI.Graphics;o.lineStyle(1,14272691,1),o.beginFill(15657958,1),o.drawRoundedRect(a.x+a.getBounds().width,0,.8*h.maxWight,h.maxHeight,0),o.endFill();let s=this.giaodich.doiphuong.data[e];if(s){let t=this.findItem(s.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));if(i.width=25,i.height=25,i.x=(a.width-i.width)/2,i.y=(a.height-i.height)/2,a.addChild(i),s.soluong>1){let t=new PIXI.Text(s.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});t.height=.38*a.height,t.x=a.width-i.width,t.y=a.height-i.height,a.addChild(t)}let e=new PIXI.Text(t.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});e.resolution=2,e.x=o.getBounds().x+.04*o.getBounds().width,e.height=.38*o.height,e.y=0+.1*o.height;let h=new PIXI.Text(t.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});h.resolution=2,h.x=o.getBounds().x+.04*o.getBounds().width,h.height=.38*o.height,h.y=e.y+e.height,o.addChild(e,h)}}n.addChild(a,o),h.addChild(n),h.item=this.giaodich.doiphuong.data[e].id,t(h)}}this.snowlySroll(r,g);let y=this.boxBaseFoot(n,h);h.addChild(n,l,y)};giaodichDoiPhuongright=()=>{let t=this.giaodich.doiphuong.id,i=this.Charset.find((i=>i.id==t));if(!i)return this.notice(this._("Người chơi này không có trên bản đồ"));let e=this.boxBaseBackground();this.box.addChild(e);let h=this.boxBaseHead(e),n=this.snowlyImg(i.info.coban.avatar);n.width=.25*h.width,n.height=.99*h.height>n.width?n.width:.99*h.height,n.x=.01*h.width,n.y=.99*h.height-n.height,h.addChild(n);let a=new PIXI.Container,o=this.snowlyText(i.name,16,"fontchinh",16777215,!1,h.width,h.height);o.y=0,a.addChild(o);let s=this.snowlyText("Sức mạnh: "+this.number_format(i.info.coban.sucmanh),16,"fontchinh",16711168,!1,h.width,h.height);s.y=o.y+o.height,a.addChild(s),h.addChild(a),a.x=n.x+n.width+.05*n.width,a.y=h.height/2-a.height/2;let d=this.boxBaseMenuTXT(h,"Giao dịch"),l=this.boxBaseBody(e,h,d);e.addChild(l);let r=new PIXI.Container,g=this,c=l.width,m=.15*h.width;if(m=m>50?50:m,this.my,this.giaoDichChoose){let t=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&g.open_previewGiaoDich(t,{layragiaodich:!0,display:"right"})}))},i=0,e=new PIXI.Container;r.addChild(e),e.maxWight=c,e.maxHeight=m,e.width=e.maxWight,e.height=e.maxHeight,e.x=0,e.y=-1*m+0,i=e.y+e.height;let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(0,.5),h.drawRoundedRect(0,0,e.maxWight,e.maxHeight,0),h.endFill();let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(0,0,1*e.maxWight,e.maxHeight,0),n.endFill(),n.x=0,n.y=0;let a=this.snowlyText(this.number_format(this.giaodich.doiphuong.vang)+" vàng",16,"fontchinh",16689408,!1,n.width,n.height);a.x=n.getBounds().x+a.width/2,a.y=n.getBounds().height/2-a.height/2,n.addChild(a);let o="";1==this.giaodich.doiphuong.khoa&&(o="Đối phương đã khóa giao dịch, dưới đây là danh sách vật phẩm của đối phương."),1==this.giaodich.doiphuong.xong&&(o='Đối phương đã xác nhận giao dịch, bạn hãy ấn nút "xong" để giao dịch hoàn tất.');let s=this.snowlyText(o,16,"fontchinh",16711680,!1,n.width,n.height);s.x=n.getBounds().width/2-s.width/2,s.y=n.y-s.height,n.addChild(s),0==this.giaodich.doiphuong.khoa&&(s.visible=!1),0==this.giaodich.doiphuong.xong&&(s.visible=!1),1==this.giaodich.doiphuong.khoa&&(s.visible=!0),1==this.giaodich.doiphuong.xong&&(s.visible=!0),h.addChild(n),e.addChild(h);for(let e=0;e<this.giaodich.doiphuong.data.length;e++){let h=new PIXI.Container;r.addChild(h),h.maxWight=c,h.maxHeight=m,h.width=h.maxWight,h.height=h.maxHeight,h.x=0,h.y=m*e+0,i=h.y+h.height;let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(0,.5),n.drawRoundedRect(0,0,h.maxWight,h.maxHeight,0),n.endFill();let a=new PIXI.Graphics;a.lineStyle(1,14272691,1),a.beginFill(11771523,1),a.drawRoundedRect(0,0,.2*h.maxWight,h.maxHeight,0),a.endFill(),a.x=0,a.y=0;let o=new PIXI.Graphics;o.lineStyle(1,14272691,1),o.beginFill(15657958,1),o.drawRoundedRect(a.x+a.getBounds().width,0,.8*h.maxWight,h.maxHeight,0),o.endFill();let s=this.giaodich.doiphuong.data[e];if(s){let t=this.findItem(s.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));if(i.width=25,i.height=25,i.x=(a.width-i.width)/2,i.y=(a.height-i.height)/2,a.addChild(i),s.soluong>1){let t=new PIXI.Text(s.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});t.height=.38*a.height,t.x=a.width-i.width,t.y=a.height-i.height,a.addChild(t)}let e=new PIXI.Text(t.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});e.resolution=2,e.x=o.getBounds().x+.04*o.getBounds().width,e.height=.38*o.height,e.y=0+.1*o.height;let h=new PIXI.Text(t.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});h.resolution=2,h.x=o.getBounds().x+.04*o.getBounds().width,h.height=.38*o.height,h.y=e.y+e.height,o.addChild(e,h)}}n.addChild(a,o),h.addChild(n),h.item=this.giaodich.doiphuong.data[e].id,t(h)}}let u=l.height/100*150,y=new pixi_viewport.Viewport({screenWidth:l.width,screenHeight:l.height+u,worldWidth:r.width,worldHeight:r.height+u,passiveWheel:!0});y.name="Lớp cuộn",y.addChild(r),y.width=.99*l.width,l.addChild(y),y.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),y.bounce({top:!0,bottom:!0,friction:.5,time:0,ease:"easeInOutSine"}),e.addChild(l);let w=this.boxBaseFoot(h,e);e.addChild(h,d,w),w.y=this.gameHeight-w.height,e.x=this.gameWidth-e.width};boxGiaoDichHanhTrang=()=>{let t=[{name:"Hành trang",onclick:1},{name:"Đã chọn",onclick:2}];if(t.push({name:"Đối phương",onclick:999}),999==this.giaoDichChoose)return this.giaodichDoiPhuong(t);this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("HP: "+this.my.info.chiso.hp+" / "+this.my.info.chiso.hpFull,16,"fontchinh",16711168,!1,e.width,e.height);a.y=0,n.addChild(a);let o=this.snowlyText("KI: "+this.my.info.chiso.ki+" / "+this.my.info.chiso.kiFull,16,"fontchinh",16711168,!1,e.width,e.height);o.y=a.y+a.height,n.addChild(o);let s=this.snowlyText("Sức đánh: "+this.my.info.chiso.sucdanh,16,"fontchinh",16711168,!1,e.width,e.height);s.y=o.y+o.height,n.addChild(s);let d=this.snowlyText("Giáp: "+this.my.info.chiso.giap+", Chí mạng: "+this.my.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,e.width,e.height);d.y=s.y+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenuGiaoDich(e,this.giaoDichChoose,t),r=this.boxBaseBody(i,e,l);i.addChild(r);let g=this.boxBaseMask(r,i),c=this,m=r.width,u=.15*e.width;if(u=u>50?50:u,this.my,1==this.giaoDichChoose){let t=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&c.open_PreviewItem(t,{giaodich:!0})}))},i=r.width,h=.15*e.width;h=h>50?50:h;let n=this.my,a=6,o=["ao","quan","gang","giay","rada","caitrang"];for(let e=0;e<a;e++){let a=new PIXI.Container;g.addChild(a),a.maxWight=i,a.maxHeight=h,a.width=a.maxWight,a.height=a.maxHeight,a.x=0,a.y=h*e+0;let s=new PIXI.Graphics;s.lineStyle(1,14272691,1),s.beginFill(0,.5),s.drawRoundedRect(0,0,a.maxWight,a.maxHeight,0),s.endFill();let d=new PIXI.Graphics;d.lineStyle(1,14272691,1),d.beginFill(9927509,1),d.drawRoundedRect(0,0,.2*a.maxWight,a.maxHeight,0),d.endFill(),d.x=0,d.y=0;let l=new PIXI.Graphics;if(l.lineStyle(1,14272691,1),l.beginFill(15130321,1),l.drawRoundedRect(d.x+d.getBounds().width,0,.8*a.maxWight,a.maxHeight,0),l.endFill(),n.trangbi[o[e]]&&0!=n.trangbi[o[e]]){let t=n.trangbi[o[e]],i=this.findBag(t);if(i){let t=this.findItem(i.item);if(t){let e=new PIXI.Sprite(this.coverImg(t.avatar));e.width=25,e.height=25,e.x=(d.width-e.width)/2,e.y=(d.height-e.height)/2,d.addChild(e);let h=this.snowlyText(t.name,16,"fontchinh",21285,!1,l.width,l.height);h.resolution=2,h.x=l.getBounds().x+.04*l.getBounds().width,h.height=.38*l.height,h.y=0+.1*l.height;let n=this.snowlyText(t.mota,14,"fontchinh",427005,!1,l.width,l.height);n.resolution=2,n.x=l.getBounds().x+.04*l.getBounds().width,n.height=.38*l.height,n.y=h.y+h.height,l.addChild(h,n),l.item=i.id}}}s.addChild(d,l),a.addChild(s),a.item=l.item,t(l)}let s=0,d=n.ruong.item.filter((t=>"hanhtrang"===t.active));d.forEach((t=>{t.lastTime=t.lastTime||Date.now()})),d.sort((function(t,i){return t.lastTime-i.lastTime}));for(let e=a;e<n.ruong.slot+a;e++){let n=new PIXI.Container;g.addChild(n),n.maxWight=i,n.maxHeight=h,n.width=n.maxWight,n.height=n.maxHeight,n.x=0,n.y=h*e+0;let a=new PIXI.Graphics;a.lineStyle(1,14272691,1),a.beginFill(0,.5),a.drawRoundedRect(0,0,n.maxWight,n.maxHeight,0),a.endFill();let o=new PIXI.Graphics;o.lineStyle(1,14272691,1),o.beginFill(11771523,1),o.drawRoundedRect(0,0,.2*n.maxWight,n.maxHeight,0),o.endFill(),o.x=0,o.y=0;let l=15657958;if(d[s]){let t=d[s];this.danhSachItem.find((i=>i.id==t.id))&&(l=5449989)}let r=new PIXI.Graphics;if(r.lineStyle(1,14272691,1),r.beginFill(l,1),r.drawRoundedRect(o.x+o.getBounds().width,0,.8*n.maxWight,n.maxHeight,0),r.endFill(),d[s]){let t=d[s];if(t){let i=this.findItem(t.item);if(i){let e=new PIXI.Sprite(this.coverImg(i.avatar));if(e.width=25,e.height=25,e.x=(o.width-e.width)/2,e.y=(o.height-e.height)/2,o.addChild(e),t.soluong>1){let i=new PIXI.Text(t.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});i.height=.38*o.height,i.x=o.width-e.width,i.y=o.height-e.height,o.addChild(i)}let h=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:r.width});h.resolution=2,h.x=r.getBounds().x+.04*r.getBounds().width,h.height=.38*r.height,h.y=0+.1*r.height;let n=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:r.width});n.resolution=2,n.x=r.getBounds().x+.04*r.getBounds().width,n.height=.38*r.height,n.y=h.y+h.height,r.addChild(h,n)}}}a.addChild(o,r),n.addChild(a),n.item=d[s]?d[s].id:null,t(n),s++}}else if(2==this.giaoDichChoose){let t=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&c.open_PreviewItem(t,{layragiaodich:!0})}))},i=0,e=new PIXI.Container;g.addChild(e),e.maxWight=m,e.maxHeight=u,e.width=e.maxWight,e.height=e.maxHeight,e.x=0,e.y=-1*u+0,i=e.y+e.height;let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(0,.5),h.drawRoundedRect(0,0,e.maxWight,e.maxHeight,0),h.endFill();let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(0,0,.8*e.maxWight,e.maxHeight,0),n.endFill(),n.x=0,n.y=0;let a=this.snowlyText(this.number_format(this.giaodich.vang)+" vàng",16,"fontchinh",16689408,!1,n.width,n.height);a.x=n.getBounds().x+a.width/2,a.y=n.getBounds().height/2-a.height/2,n.addChild(a);let o=new PIXI.Graphics;o.lineStyle(1,14272691,1),o.beginFill(11771523,1),o.drawRoundedRect(n.x+n.getBounds().width,0,.2*e.maxWight,e.maxHeight,0),o.endFill();let s=this.snowlyText("Nhập",16,"fontchinh",21285,!1,o.width,o.height);s.x=o.getBounds().x+s.width/2,s.y=o.getBounds().height/2-s.height/2,o.addChild(s),o.interactive=!0,o.coursor="pointer",o.on("pointerdown",(()=>{this.giaoDichInputValueVang()})),h.addChild(n,o),e.addChild(h);for(let e=0;e<this.danhSachItem.length;e++){let h=new PIXI.Container;g.addChild(h),h.maxWight=m,h.maxHeight=u,h.width=h.maxWight,h.height=h.maxHeight,h.x=0,h.y=u*e+0,i=h.y+h.height;let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(0,.5),n.drawRoundedRect(0,0,h.maxWight,h.maxHeight,0),n.endFill();let a=new PIXI.Graphics;a.lineStyle(1,14272691,1),a.beginFill(11771523,1),a.drawRoundedRect(0,0,.2*h.maxWight,h.maxHeight,0),a.endFill(),a.x=0,a.y=0;let o=new PIXI.Graphics;o.lineStyle(1,14272691,1),o.beginFill(15657958,1),o.drawRoundedRect(a.x+a.getBounds().width,0,.8*h.maxWight,h.maxHeight,0),o.endFill();let s=this.danhSachItem[e];if(s){let t=this.findItem(s.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));if(i.width=25,i.height=25,i.x=(a.width-i.width)/2,i.y=(a.height-i.height)/2,a.addChild(i),s.soluong>1){let t=new PIXI.Text(s.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});t.height=.38*a.height,t.x=a.width-i.width,t.y=a.height-i.height,a.addChild(t)}let e=new PIXI.Text(t.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});e.resolution=2,e.x=o.getBounds().x+.04*o.getBounds().width,e.height=.38*o.height,e.y=0+.1*o.height;let h=new PIXI.Text(t.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:o.width});h.resolution=2,h.x=o.getBounds().x+.04*o.getBounds().width,h.height=.38*o.height,h.y=e.y+e.height,o.addChild(e,h)}}n.addChild(a,o),h.addChild(n),h.item=this.danhSachItem[e].id,t(h)}let d=this.snowlyGraphics(.3*r.width,.1*r.height,14645562,5835812,2,10);d.y=g.y+d.height+60;let l=0,y="";0==this.giaodich.khoa?(y="Khóa",l=1):1==this.giaodich.khoa&&1==this.giaodich.doiphuong.khoa&&0==this.giaodich.xong&&(y="Xong",l=1);let w=this.snowlyText(y,16,"fontchinh",5449989,!0,d.width,d.height);d.addChild(w),d.interactive=!0,d.cursor="pointer",d.on("pointerdown",(()=>{this.submitGiaoDich()})),d.visible=l,g.addChild(d)}this.snowlySroll(r,g);let y=this.boxBaseFoot(e,i);i.addChild(e,l,y),2*i.width<=this.gameWidth&&this.giaodichDoiPhuongright()}}class E extends D{constructor(){super()}ioBoxShopSuccess(t){this.my.ruong=t._1,this.my.tien=t._2,t._3?this.danger("Bạn nhận được "+t._3+" vàng. "):this.danger("Mua thành công."),this.boxBaseShop(),this.deleteNotice()}ioBoxShop(t){let i=this.my;if(i.id<=0)return!1;i.ruong=t._4,i.tien=t._3,this.shopData=t._1,this.shopList=t._2,this.shopChoose=0,this.shopData.id=t.npc,this.boxBaseShop()}boxBaseMenuShop=(t,i,e)=>{let h=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return h.addChild(((t,i,e)=>{let h=new PIXI.Container;return e.forEach(((n,a)=>{let o=.98*t.width;o-=2*(e.length-1);let s=.2*o,d=o/e.length;s>d&&(s=d);let l=this.snowlyGraphics(s,.85*t.height,n.onclick==i?12118449:16770760,7096832,2,10);l.x=a*l.width+2*a;let r=this.snowlyText(n.name,16,"fontchinh",5592405,!0,l.width,l.height);l.addChild(r),this.snowlyEvent(l,(()=>{this.shopChoose=n.onclick,this.boxBaseShop()})),h.addChild(l)})),h.y=t.height/2-h.height/2,h})(h,i,e)),h.x=t.width/2-h.width/2,h.y=t.height,h};boxShopHanhTrang(t,i={sell:!0},e=1){this.closeBox();let h=this.boxBaseBackground();this.box.addChild(h);let n=this.boxBaseHead(h),a=this.snowlyImg(this.my.info.coban.avatar);a.width=.25*n.width,a.height=.99*n.height>a.width?a.width:.99*n.height,a.x=.01*n.width,a.y=.99*n.height-a.height,n.addChild(a);let o=new PIXI.Container,s=this.snowlyText("HP: "+this.my.info.chiso.hp+" / "+this.my.info.chiso.hpFull,16,"fontchinh",16711168,!1,n.width,n.height);s.y=0,o.addChild(s);let d=this.snowlyText("KI: "+this.my.info.chiso.ki+" / "+this.my.info.chiso.kiFull,16,"fontchinh",16711168,!1,n.width,n.height);d.y=s.y+s.height,o.addChild(d);let l=this.snowlyText("Sức đánh: "+this.my.info.chiso.sucdanh,16,"fontchinh",16711168,!1,n.width,n.height);l.y=d.y+d.height,o.addChild(l);let r,g=this.snowlyText("Giáp: "+this.my.info.chiso.giap+", Chí mạng: "+this.my.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,n.width,n.height);g.y=l.y+l.height,o.addChild(g),n.addChild(o),o.x=a.x+a.width+.05*a.width,o.y=n.height/2-o.height/2,1==e?r=this.boxBaseMenuShop(n,999,t):2==e&&(r=this.boxBaseMenuNangCap(n,999,t));let c=this.boxBaseBody(h,n,r);h.addChild(c);let m=this.boxBaseMask(c,h),u=this,y=t=>{t.interactive=!0,t.cursor="pointer";let e=0,h=0;t.on("pointerdown",(function(t){e=Date.now()})),t.on("pointerup",(function(n){h=Date.now(),h-e<300&&u.open_PreviewItem(t,i)}))},w=c.width,f=.15*n.width;f=f>50?50:f;let p=this.my,x=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<6;t++){let i=new PIXI.Container;i.name="since04KEY",m.addChild(i),i.maxWight=w,i.maxHeight=f,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=f*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(9927509,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15130321,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill(),p.trangbi[x[t]]&&0!=p.trangbi[x[t]]){let i=p.trangbi[x[t]],e=this.findBag(i);if(e){let t=this.findItem(e.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=25,i.height=25,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i);let a=this.snowlyText(t.name,16,"fontchinh",21285,!1,n.width,n.height);a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,n.width,n.height);o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o),n.item=e.id}}}e.addChild(h,n),i.addChild(e),i.item=n.item,y(n)}let b=0,I=p.ruong.item.filter((t=>"hanhtrang"===t.active));I.forEach((t=>{t.lastTime=t.lastTime||Date.now()})),I.sort((function(t,i){return t.lastTime-i.lastTime}));for(let t=6;t<p.ruong.slot+6;t++){let i=new PIXI.Container;i.name="since04KEY",m.addChild(i),i.maxWight=w,i.maxHeight=f,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=f*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(11771523,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=15657958;if(I[b]){let t=I[b];this.danhSachItem.find((i=>i.id==t.id))&&(n=5449989)}let a=new PIXI.Graphics;if(a.lineStyle(1,14272691,1),a.beginFill(n,1),a.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),a.endFill(),I[b]){let t=I[b];if(t){let i=this.findItem(t.item);if(i){let e=new PIXI.Sprite(this.coverImg(i.avatar));if(e.width=25,e.height=25,e.x=(h.width-e.width)/2,e.y=(h.height-e.height)/2,h.addChild(e),t.soluong>1){let i=new PIXI.Text(t.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:h.width});i.height=.38*h.height,i.x=h.width-e.width,i.y=h.height-e.height,h.addChild(i)}let n=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});n.resolution=2,n.x=a.getBounds().x+.04*a.getBounds().width,n.height=.38*a.height,n.y=0+.1*a.height;let o=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});o.resolution=2,o.x=a.getBounds().x+.04*a.getBounds().width,o.height=.38*a.height,o.y=n.y+n.height,a.addChild(n,o)}}}e.addChild(h,a),i.addChild(e),i.item=I[b]?I[b].id:null,y(i),b++}this.snowlySroll(c,m);let C=this.boxBaseFoot(n,h);h.addChild(n,r,C)}boxBaseShop=()=>{let t=[];if(this.shopData.data.forEach(((i,e)=>{t.push({name:i.name,onclick:e})})),t.push({name:"Hành trang",onclick:999}),999==this.shopChoose)return this.boxShopHanhTrang(t),!1;this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.shopData.id;if(h=this.Charset.find((t=>t.id==h)),!h)return this.closeBox(),this.notice(this._("Không tìm thấy người bán hàng.")),!1;let n=this.snowlyImg(h.source.script.avatar);n.width=.25*e.width,n.height=.99*e.height>n.width?n.width:.99*e.height,n.x=.01*e.width,n.y=.99*e.height-n.height,e.addChild(n);let a=new PIXI.Container,o="Xin chào !",s="Cậu cần gì nào ?",d=this.snowlyText(o,16,"fontchinh",16777215,!1,.7*e.width,.5*e.height),l=this.snowlyText(s,16,"fontchinh",2734680,!1,.7*e.width,.5*e.height);l.y=d.height+d.y,a.addChild(d,l),e.addChild(a),a.x=n.x+n.width+.05*n.width,a.y=e.height/2-a.height/2;let r=this.boxBaseMenuShop(e,this.shopChoose,t),g=this.boxBaseBody(i,e,r);i.addChild(g);let c=this.boxBaseMask(g,i),m=this,u=g.width,y=.15*e.width;y=y>50?50:y;let w=this.my,f=this.shopData.data[this.shopChoose].list,p=-1;w.ruong.item.filter((t=>"hanhtrang"===t.active));for(let t=0;t<f.length;t++){let i=this.findItem(f[t]);if(!i)continue;if("item"==i.type&&"sachvo"==i.type2&&i.class!=w.info.coban.type&&"all"!=i.class)continue;p++;let e=new PIXI.Container;e.name="since04KEY",c.addChild(e),e.maxWight=u,e.maxHeight=y,e.width=e.maxWight,e.height=e.maxHeight,e.x=0,e.y=y*p+0;let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(0,.5),h.drawRoundedRect(0,0,e.maxWight,e.maxHeight,0),h.endFill();let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(11771523,1),n.drawRoundedRect(0,0,.2*e.maxWight,e.maxHeight,0),n.endFill(),n.x=0,n.y=0;let a=new PIXI.Graphics;if(a.lineStyle(1,14272691,1),a.beginFill(15657958,1),a.drawRoundedRect(n.x+n.getBounds().width,0,.8*e.maxWight,e.maxHeight,0),a.endFill(),i){let t=new PIXI.Sprite(this.coverImg(i.avatar));t.width=25,t.height=25,t.x=(n.width-t.width)/2,t.y=(n.height-t.height)/2,n.addChild(t);let e=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});e.resolution=2,e.x=a.getBounds().x+.04*a.getBounds().width,e.height=.38*a.height,e.y=0+.1*a.height;let h=this.shopList.find((t=>t.idvp==i.id)),o=new PIXI.Sprite(this.coverImg("vang"==h.type?"930":"932"));o.width=.4*y,o.height=.4*y,o.y=.1*a.height,o.x=g.width-o.width-.5*o.width;let s=new PIXI.Text(this.intToM(h.buy),{fontSize:16,fill:16689408,fontFamily:"fontchinh",fontWeight:"bold",wordWrap:!0});s.y=o.y+o.height/2-s.height/2,s.x=o.x-s.width-.3*o.width;let d=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});d.resolution=2,d.x=a.getBounds().x+.04*a.getBounds().width,d.height=.38*a.height,d.y=e.y+e.height,a.addChild(e,d),a.addChild(o,s)}h.addChild(n,a),e.addChild(h),e.item=f[t],e.interactive=!0,e.cursor="pointer";let r=0,x=0;e.on("pointerdown",(function(t){r=Date.now()})),e.on("pointerup",(function(t){if(x=Date.now(),x-r<200){m.open_PreviewItemShop(e),d.text="yêu cầu "+m.intToM(i.sucmanh)+" Sức mạnh ";let t=m.shopList.find((t=>t.idvp==i.id));l.text=m.intToM(t.buy)+" "+("vang"==t.type?"Vàng":"Ngọc")}else d.text=o,l.text=s}))}this.snowlySroll(g,c);let x=this.boxBaseFoot(e,i);i.addChild(e,r,x),2*i.width<=this.gameWidth&&this.boxBaseShopRight()};boxBaseShopRight=(t="shop")=>{let i=this.boxBaseBackground(!1);this.box.addChild(i);let e=this.boxBaseHead(i);e.x=i.width/2-e.width/2;let h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("HP: "+this.my.info.chiso.hp+" / "+this.my.info.chiso.hpFull,16,"fontchinh",16711168,!1,e.width,e.height);a.y=0,n.addChild(a);let o=this.snowlyText("KI: "+this.my.info.chiso.ki+" / "+this.my.info.chiso.kiFull,16,"fontchinh",16711168,!1,e.width,e.height);o.y=a.y+a.height,n.addChild(o);let s=this.snowlyText("Sức đánh: "+this.my.info.chiso.sucdanh,16,"fontchinh",16711168,!1,e.width,e.height);s.y=o.y+o.height,n.addChild(s);let d=this.snowlyText("Giáp: "+this.my.info.chiso.giap+", Chí mạng: "+this.my.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,e.width,e.height);d.y=s.y+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenuTXT(e,"Hành trang"),r=this.boxBaseBody(i,e,l),g=new PIXI.Container;g.name="tabname";let c=this,m=i=>{i.interactive=!0,i.cursor="pointer";let e=0,h=0;i.on("pointerdown",(function(t){e=Date.now()})),i.on("pointerup",(function(n){h=Date.now(),h-e<300&&("ruong"==t?c.open_PreviewItem(i,{display:"right",catvao:!0}):"shop"==t?c.open_PreviewItem(i,{display:"right",sell:!0}):c.open_PreviewItem(i,{display:"right",nangcap:!0}))}))},u=r.width,y=.15*e.width;y=y>50?50:y;let w=this.my,f=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<6;t++){let i=new PIXI.Container;i.name="since04KEY",g.addChild(i),i.maxWight=u,i.maxHeight=y,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=y*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(9927509,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15130321,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill(),w.trangbi[f[t]]&&0!=w.trangbi[f[t]]){let i=w.trangbi[f[t]],e=this.findBag(i);if(e){let t=this.findItem(e.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=25,i.height=25,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i);let a=this.snowlyText(t.name,16,"fontchinh",21285,!1,n.width,n.height);a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,n.width,n.height);o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o),n.item=e.id}}}e.addChild(h,n),i.addChild(e),i.item=n.item,m(n)}let p=0,x=w.ruong.item.filter((t=>"hanhtrang"===t.active));x.forEach((t=>{t.lastTime=t.lastTime||Date.now()})),x.sort((function(t,i){return t.lastTime-i.lastTime}));for(let t=6;t<w.ruong.slot+6;t++){let i=new PIXI.Container;g.addChild(i),i.name="since04KEY",i.maxWight=u,i.maxHeight=y,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=y*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(11771523,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=15657958;if(x[p]){let t=x[p];this.danhSachItem.find((i=>i.id==t.id))&&(n=5449989)}let a=new PIXI.Graphics;if(a.lineStyle(1,14272691,1),a.beginFill(n,1),a.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),a.endFill(),x[p]){let t=x[p];if(t){let i=this.findItem(t.item);if(i){let e=new PIXI.Sprite(this.coverImg(i.avatar));if(e.width=25,e.height=25,e.x=(h.width-e.width)/2,e.y=(h.height-e.height)/2,h.addChild(e),t.soluong>1){let i=new PIXI.Text(t.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:h.width});i.height=.38*h.height,i.x=h.width-e.width,i.y=h.height-e.height,h.addChild(i)}let n=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});n.resolution=2,n.x=a.getBounds().x+.04*a.getBounds().width,n.height=.38*a.height,n.y=0+.1*a.height;let o=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:a.width});o.resolution=2,o.x=a.getBounds().x+.04*a.getBounds().width,o.height=.38*a.height,o.y=n.y+n.height,a.addChild(n,o)}}}e.addChild(h,a),i.addChild(e),i.item=x[p]?x[p].id:null,m(i),p++}let b=r.height/100*150;b=0;let I=new pixi_viewport.Viewport({screenWidth:r.width,screenHeight:r.height+0,worldWidth:g.width,worldHeight:g.height+0,passiveWheel:!0});I.name="Lớp cuộn",I.addChild(g),I.width=.99*r.width,r.addChild(I),I.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),I.bounce({top:!0,bottom:!0,friction:.5,time:0,ease:"easeInOutSine"});let C=-1,v=()=>{c.pcSettimeEntactive2=setInterval((function(){let t=c.pcKey;if(0==c.box.visible)return clearInterval(c.pcSettimeEntactive2),!1;if(1!=c.conTro)return!1;let i=g.children.filter((t=>"since04KEY"==t.name));if("ArrowUp"===t?(c.boxPreviewItem.removeChildren(),C-=1,C<0&&(C=i.length-1)):"ArrowDown"===t&&(c.boxPreviewItem.removeChildren(),C+=1,C>=i.length&&(C=-1)),"Enter"===t){let t=i[C],e=c.getAllInteractiveChildren(t);e.length>0&&0==c.boxPreviewItem.children.length&&(e[0].emit("pointerdown"),e[0].emit("pointerup"))}if(i[C]&&c.pcKey.length>=1){for(let t=0;t<i.length;t++)i[t].removeChild(i[t].getChildByName("xanhle"));I.moveCenter(i[C].x,i[C].y);let t=i[C].width,e=i[C].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,t,e,0),h.endFill(),h.name="xanhle",i[C].addChild(h);let n=i[C],a=c.findInteractiveObjects(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown")})),h.on("pointerup",(()=>{a[0].emit("pointerup")})))}c.boxPreviewItem.children.length<=0&&(c.pcKey="")}),this.app.ticker.deltaMS)};v();let P=0,k=0;I.on("pointerdown",(t=>{P=Date.now(),this.conTro=1})),I.on("pointerup",(function(t){if(k=Date.now(),k-P<200){let i=t.data.global.x,e=t.data.global.y,h=g.toLocal(new PIXI.Point(i,e));h.x=Math.round(h.x),h.y=Math.round(h.y);let n=g.children.filter((t=>"since04KEY"==t.name));for(let t=0;t<n.length;t++)n[t].removeChild(n[t].getChildByName("xanhle"));for(let t=0;t<n.length;t++)if(n[t].x<=h.x&&h.x<=n[t].x+n[t].width&&n[t].y<=h.y&&h.y<=n[t].y+n[t].height){C=t;let i=n[t].width,e=n[t].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",n[t].addChild(h);let a=n[t],o=c.getAllInteractiveChildren(a);o.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{o[0].emit("pointerdown")})),h.on("pointerup",(()=>{o[0].emit("pointerup")})))}}else clearInterval(c.pcSettimeEntactive2),setTimeout((function(){clearInterval(c.pcSettimeEntactive2),v()}),200)})),i.addChild(r);let S=this.boxBaseFoot(e,i);i.addChild(e,l,S),S.y=this.gameHeight-S.height,i.x=this.gameWidth-i.width}}const H=class extends E{constructor(){super(),this.profileMenu=[{name:"Nhiệm vụ",onclick:"nhiemvu"},{name:"Hành trang",onclick:"hanhtrang"},{name:"Kỹ năng",onclick:"kynang"},{name:"Bang hội",onclick:"banghoi"},{name:"Chức năng",onclick:"chucnang"}]}snowlyGraphics=(t,i,e,h,n,a=0,o=1)=>{let s=new PIXI.Graphics;return s.beginFill(e,o),s.lineStyle(n,h,1),s.drawRoundedRect(0,0,t,i,a),s.endFill(),s};snowlyImg=(t,i="char")=>new PIXI.Sprite(this.coverImg(t));snowlyEvent=(t,i)=>{t.interactive=!0,t.cursor="pointer",t.on("pointerdown",(()=>{i()}))};snowlyText=(t,i,e="fontchinh",h,n=!1,a=0,o=0)=>{let s=new PIXI.Text(t,{fontSize:i,fill:h,fontFamily:e,align:"center",wordWrap:!0,wordWrapWidth:a});return n&&(0==a&&(s.x=s.width/2),0==o&&(s.y=s.height/2),0!=a&&(s.x=a/2-s.width/2),0!=o&&(s.y=o/2-s.height/2)),s};boxBaseBackground=(t=!0)=>{let i=1*this.gameHeight,e=.4*this.gameWidth;e<350&&(e=350),e>this.gameWidth&&(e=1*this.gameWidth);let h=this.snowlyGraphics(e,i,14272691,6702080,3);if(h.name="Lớp BOX",this.box.visible=!0,t&&1==this.boxFirst){this.playSound("openMenu"),this.boxFirst=!1,h.x-=h.width;let t=setInterval((()=>{h.x+=10,h.x>=0&&(h.x=0,clearInterval(t))}),1)}return h};boxBaseClose=()=>{this.boxFirst=!0,this.closeBox(),this.giaodich.doiphuong.id>=1&&0==this.giaodich.xong&&this.cancelGiaoDich(),this.playSound("close"),this.danhSachItem=[]};boxBaseHead=t=>{let i=.15*t.height;i<85&&(i=85);let e=this.snowlyGraphics(.98*t.width,i,9927509,9274459,0);e.name="Lớp BOX head";let h=this.snowlyImg("myTexture2dbtX-resources.assets-1494");return h.width=.1*e.width,h.height=.4*e.height,h.x=e.width-h.width,e.addChild(h),this.snowlyEvent(h,(()=>{this.boxBaseClose()})),e};boxCreateMenu=(t,i,e)=>{let h=new PIXI.Container;return e.forEach(((n,a)=>{let o=.98*t.width;o-=2*(e.length-1);let s=.2*o,d=o/e.length;s>d&&(s=d);let l=this.snowlyGraphics(s,.85*t.height,n.onclick==i?12118449:16770760,7096832,2,10);l.x=a*l.width+2*a;let r=this.snowlyText(n.name,16,"fontchinh",5592405,!0,l.width,l.height);l.addChild(r),this.snowlyEvent(l,(()=>{this.OpenBox(n.onclick)})),h.addChild(l)})),h.y=t.height/2-h.height/2,h};boxBaseMenuTXT=(t,i)=>{let e=this.snowlyGraphics(t.width,.5*t.height,14272691,13458956,1),h=this.snowlyText(i,16,"fontchinh",5449989,!0,e.width,e.height);return e.addChild(h),e.x=t.width/2-e.width/2,e.y=t.height,e};boxBaseMenu=(t,i,e)=>{let h=this.snowlyGraphics(t.width,.5*t.height,14272691,9274459,0);return h.addChild(this.boxCreateMenu(h,i,e)),h.x=t.width/2-h.width/2,h.y=t.height,h};boxBaseFoot=(t,i)=>{let e=this.snowlyGraphics(.985*i.width,.2*t.height,11771523,6702080,2);e.name="1235",e.y=.995*i.height-e.height;let h=this.snowlyGraphics(.5*e.width,.8*e.height,11771523,9274459,0),n=new PIXI.Container,a=this.snowlyImg("930");a.width=.8*e.height,a.height=.8*e.height;let o=this.snowlyText(this.number_format(this.my.tien.vang),16,"Arial",16711168,!1,h.width,h.height);o.x=a.width+.2*a.width,n.addChild(a,o),n.x=h.width/2-n.width/2,h.addChild(n),h.y=e.height/2-h.height/2;let s=this.snowlyGraphics(.5*e.width,.8*e.height,11771523,9274459,0),d=new PIXI.Container,l=this.snowlyImg("932");l.width=.8*e.height,l.height=.8*e.height;let r=this.snowlyText(this.number_format(this.my.tien.zeni),16,"Arial",16711168,!1,s.width,s.height);return r.x=l.width+.2*l.width,d.addChild(l,r),d.x=s.width/2-d.width/2,s.addChild(d),s.y=e.height/2-s.height/2,s.x=e.width-s.width,e.addChild(h,s),e};boxBaseBody=(t,i,e)=>{let h=0;h=.99*t.height-i.height-e.height,h-=.2*i.height;let n=this.snowlyGraphics(i.width,h,14272691,13458956,1);return n.y=e.y+e.height,n};boxBaseMask=(t,i)=>{let e=new PIXI.Container,h=new PIXI.Graphics;return h.beginFill(0,.5),h.drawRect(0,0,.99*t.width,i.height),h.endFill(),e.name="tabname",e.mask=h,e};OpenBox=t=>{this.clickButton(t)};boxNewNhiemVu=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.my,e=this.boxBaseHead(t),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText(i.name,20,"fontchinh",16777215,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText("Sức khỏe: "+i.info.chiso.suckhoe/i.info.chiso.suckhoe_max*100+"%",16,"fontchinh",16776960,!1,e.width,e.height);n.addChild(o),o.y=a.height;let s=this.snowlyText(this.danhHieu(i.info.coban.sucmanh),16,"fontchinh",16776960,!1,e.width,e.height);s.y=o.height+a.height,n.addChild(s);let d=this.snowlyText("Sức mạnh: "+this.number_format(i.info.coban.sucmanh),16,"fontchinh",16776960,!1,e.width,e.height);d.y=s.y+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenu(e,"nhiemvu",this.profileMenu),r=this.boxBaseBody(t,e,l);t.addChild(r);let g=this.boxBaseMask(r,t),c="\n",m=this.logNhiemVu.find((t=>t.id==this.my.nhiemvu.id&&(t.class==this.my.info.coban.type||"all"==t.class)));m?(c+='<center><font color="black"><b><big style="font-size:23px">'+m.name+"</big></b></font></center><br><br><br>",c+='<b style="font-size:18px;">',m.list.forEach(((t,i)=>{let e="";this.my.nhiemvu.data.have>=this.my.nhiemvu.data.need&&"talk"!=this.my.nhiemvu.data.type&&(this.my.nhiemvu.now+=1),i<this.my.nhiemvu.now&&(e="#ffff"),i==this.my.nhiemvu.now&&(e="blue"),i>this.my.nhiemvu.now?c+="<br><b>- ...</b>":c+='<br><b><font color="'+e+'">- '+t.name+("talk"!=t.type?"("+this.my.nhiemvu.data.have+"/"+this.my.nhiemvu.data.need+")":"")+"</font></b>"})),c+="</b>",c+='<br><br><br> <b style="font-size:17px">'+m.desc+"</b> <br> "):(c+="<center><b>Trái đất đã hoà bình</b></center> <br>",c+="<b>- Sau những ngày tháng gian nan vất vả, cuối cùng trái đất của chúng ta cũng được hoà bình.</b>",c+="<br><b>- Hãy tận hưởng cuộc sống hoà bình của thế giới Ngọc Rồng, tham gia sự kiện, hoạt động cùng bạn bè.</b>",c+="<br><b>- Không nên chủ quan khi đang hoà bình, hãy tích cực luyện tập để tương lai có thể đương đầu với những kẻ thù mạnh hơn.</b>",c+="<br> <b> - Cám ơn bạn đã tham gia cuộc hành trình bảo vệ trái đất.</b>");let u=new PIXI.HTMLText(c,{fontSize:16,fontWeight:"900",align:"left",fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:r.width-1});g.addChild(u),this.snowlySroll(r,g);let y=this.boxBaseFoot(e,t);t.addChild(e,l,y)};boxNewChucNang=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText(this.gameInfo.gameName+" "+this.gameInfo.version,18,"fontchinh",16777215,!1,i.width,i.height);h.addChild(n);let a=this.snowlyText("Nhân vật: "+this.my.name,16,"fontchinh",16776960,!1,i.width,i.height);a.y=n.height,h.addChild(a);let o=this.snowlyText("Tài khoản máy chủ: "+this.my.server+" sao",16,"fontchinh",16776960,!1,i.width,i.height);o.y=n.height+a.height,h.addChild(o);let s=this.snowlyText(""+this.my.username,16,"fontchinh",16776960,!1,i.width,i.height);s.y=n.height+a.height+o.height,h.addChild(s),i.addChild(h),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2;let d=this.boxBaseMenu(i,"chucnang",this.profileMenu),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=l.width,c=.15*i.width;c=c>50?50:c,this.my;let m=[{name:"Đệ tử",action:"detuBoxInfo"},{name:"Đổi khu",action:"boxNewDoiKhu"},{name:"Đổi cờ",action:"coPKView"},{name:"Chức năng",action:"runBoxSetting"},{name:"Thoát",action:"outGame,closeBox"},{name:"Liên kết tài khoản",action:"pageActiveAccount"}];for(let t=0;t<m.length;t++){let i=new PIXI.Graphics;i.lineStyle(1,14272691,1),i.name="since04KEY",i.beginFill(15130321,1),i.drawRoundedRect(0,0,g,c,0),i.endFill(),i.y=t*c*1.09,r.addChild(i);let e=new PIXI.Text(m[t].name,{fontSize:14,fill:6832931,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:g,fontWeight:"900",strokeThickness:0});e.resolution=2,e.style.align="center",e.position.set((g-e.width*e.scale.x)/2,(c-e.height*e.scale.y)/2),i.addChild(e),i.interactive=!0,i.buttonMode=!0,"pageActiveAccount"==m[t].action&&1==this.my.veri&&(i.visible=!1);let h=0,n=0;i.on("pointerdown",(function(t){h=Date.now()}));let a=this;i.on("pointerup",(function(i){n=Date.now(),a.playSound("click"),n-h<200&&m[t].action.split(",").forEach((i=>{"pageActiveAccount"==m[t].action&&1==a.my.veri||a[i]()}))}))}this.snowlySroll(l,r);let u=this.boxBaseFoot(i,t);t.addChild(i,d,u)};boxNewKyNang=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText("Điểm tiềm năng: ",16,"fontchinh",16776960,!1,i.width,i.height);h.addChild(n);let a=this.snowlyText(this.number_format(this.my.info.coban.tiemnang),16,"fontchinh",16776960,!1,i.width,i.height);a.y=n.y+n.height,h.addChild(a);let o=this.snowlyText("Điểm hoạt động: 0",16,"fontchinh",16776960,!1,i.width,i.height);o.y=a.y+a.height,h.addChild(o);let s=this.snowlyText("TOP: 0",16,"fontchinh",16776960,!1,i.width,i.height);s.y=o.y+o.height,h.addChild(s),i.addChild(h),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2;let d=this.boxBaseMenu(i,"kynang",this.profileMenu),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=l.width,c=.15*i.width;c=c>50?50:c;let m=this.my,u=this.skill_active.filter((t=>"bidong"==t.type));u.forEach((t=>{let i=m.skill.find((i=>i.id==t.id));i||m.skill.push({id:t.id,level:0,xep:t.xep})}));let y=m.skill;y.sort((function(t,i){return t.xep-i.xep}));let w=0;for(let t=0;t<y.length;t++){let i=this.skill_active.find((i=>i.id==y[t].id));if(!i)continue;let e=i;if(0==e.id)continue;let h=new PIXI.Container;r.addChild(h),h.name="since04KEY",h.x=0,h.y=w*c*1.1;let n=new PIXI.Graphics;n.lineStyle(1,14272691,1),n.beginFill(14272691,.5),n.drawRoundedRect(0,0,g,c,0),n.endFill(),h.addChild(n),n.skill=e.id,n.interactive=!0,n.cursor="pointer";let a=0,o=0;n.on("pointerdown",(function(t){a=Date.now()}));let s=this;n.on("pointerup",(function(t){o=Date.now(),o-a<200&&s.Open_preSkill(this)}));let d=new PIXI.Graphics;d.lineStyle(1,16749584,1),d.beginFill(14272691,.5),d.drawRoundedRect(0,0,.15*g,c,1),d.endFill(),n.addChild(d);let l=new PIXI.Sprite(this.coverImg(e.avatar));l.width=.9*d.getBounds().width,l.height=.9*d.getBounds().height,l.x=(d.getBounds().width-l.width)/2,l.y=(d.getBounds().height-l.height)/2,d.addChild(l);let u=new PIXI.Graphics;u.lineStyle(1,15130321,1),u.beginFill(15130321,.5),u.drawRoundedRect(.17*g,0,.83*g,c,0),u.endFill(),n.addChild(u);let f=e.name;"bidong"==e.type&&(f=e.name+": "+this.number_format(m.info.chiso[e.object]));let p=new PIXI.Text(f,{fontSize:14,fill:6520318,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:.9*u.getBounds().width});p.resolution=2,p.style.align="center",p.x=u.getBounds().x+u.getBounds().x/100*10,p.y=0,u.addChild(p);let x=e.mota;"bidong"==e.type&&("hpGoc"!=e.object&&"kiGoc"!=e.object||(x=this.number_format(this.tangHP(m.info.chiso[e.object],20))+" tiềm năng: tăng 20"),"sucdanhGoc"==e.object&&(x=this.number_format(this.tangSucDanh(m.info.chiso[e.object],1))+" tiềm năng: tăng 1"),"chimangGoc"==e.object&&(x=this.number_format(this.tangchiMang(m.info.chiso[e.object]))+" tiềm năng: tăng 1"),"giapGoc"==e.object&&(x=this.number_format(this.tangGiap(m.info.chiso[e.object],1))+" tiềm năng: tăng 1"));let b=new PIXI.Text(x,{fontSize:12,fill:21285,fontFamily:"fontchinh"});b.resolution=2,b.style.align="center",b.x=u.getBounds().x+u.getBounds().x/100*10,b.y=p.y+p.height+5,u.addChild(b),w++}this.snowlySroll(l,r);let f=this.boxBaseFoot(i,t);t.addChild(i,d,f)};boxNewBag=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText("HP: "+this.my.info.chiso.hp+" / "+this.my.info.chiso.hpFull,16,"fontchinh",16711168,!1,i.width,i.height);n.y=0,h.addChild(n);let a=this.snowlyText("KI: "+this.my.info.chiso.ki+" / "+this.my.info.chiso.kiFull,16,"fontchinh",16711168,!1,i.width,i.height);a.y=n.y+n.height,h.addChild(a);let o=this.snowlyText("Sức đánh: "+this.my.info.chiso.sucdanh,16,"fontchinh",16711168,!1,i.width,i.height);o.y=a.y+a.height,h.addChild(o);let s=this.snowlyText("Giáp: "+this.my.info.chiso.giap+", Chí mạng: "+this.my.info.chiso.chimang+"%",16,"fontchinh",16711168,!1,i.width,i.height);s.y=o.y+o.height,h.addChild(s),i.addChild(h),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2;let d=this.boxBaseMenu(i,"hanhtrang",this.profileMenu),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=this,c=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&g.open_PreviewItem(t)}))},m=l.width,u=.15*i.width;u=u>50?50:u;let y=this.my,w=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<6;t++){let i=new PIXI.Container;i.name="since04KEY",r.addChild(i),i.maxWight=m,i.maxHeight=u,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=u*t+3;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(14272691,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(9927509,1),h.drawRoundedRect(0,0,.15*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15130321,1),n.drawRoundedRect(.16*m,0,.84*i.maxWight,i.maxHeight,0),n.endFill(),y.trangbi[w[t]]&&0!=y.trangbi[w[t]]){let i=y.trangbi[w[t]],e=this.findBag(i);if(e){let t=this.findItem(e.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=.6*u,i.height=.6*u,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i);let a=this.snowlyText(t.name,16,"fontchinh",21285,!1,n.width,n.height);a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,n.width,n.height);o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o),n.item=e.id}}}e.addChild(h,n),i.addChild(e),i.item=n.item,c(n)}let f=0,p=y.ruong.item.filter((t=>"hanhtrang"===t.active));p.forEach((t=>{t.lastTime=t.lastTime||Date.now()})),p.sort((function(t,i){return t.lastTime-i.lastTime}));for(let t=6;t<y.ruong.slot+6;t++){let i=new PIXI.Container;i.name="since04KEY",r.addChild(i),i.maxWight=m,i.maxHeight=u,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=u*t+3;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(14272691,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(11771523,1),h.drawRoundedRect(0,0,.15*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15657958,1),n.drawRoundedRect(.16*m,0,.84*i.maxWight,i.maxHeight,0),n.endFill(),p[f]){let t=p[f];if(t){let i=this.findItem(t.item);if(i){let e=new PIXI.Sprite(this.coverImg(i.avatar));if(e.width=.6*u,e.height=.6*u,e.x=(h.width-e.width)/2,e.y=(h.height-e.height)/2,h.addChild(e),t.soluong>1){let i=new PIXI.Text(t.soluong,{fontSize:16,fill:16711168,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:h.width});i.height=.38*h.height,i.x=h.width-e.width,i.y=h.height-e.height,h.addChild(i)}let a=new PIXI.Text(i.name,{fontSize:16,fill:21285,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=new PIXI.Text(i.mota,{fontSize:14,fill:427005,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:n.width});o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o)}}}e.addChild(h,n),i.addChild(e),i.item=p[f]?p[f].id:null,c(i),f++}this.snowlySroll(l,r);let x=this.boxBaseFoot(i,t);t.addChild(i,d,x)}};class A extends H{constructor(){super()}actionDoiCo=t=>{if(t<0||t>9)return!1;this.await(),this.to("flags",t)};coPKView=()=>{let t=this.my;if(t.id<=0)return!1;this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(561);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height;let n=this.snowlyText(t.pos.zone,16,"Arial",16777215,!1,h.width,h.height);e.addChild(h,n),n.x=h.width/2-n.width/2,n.y=h.y+h.height/2-n.height/2;let a=new PIXI.Container,o="",s=this.listMap.find((i=>i.id==t.pos.map));o=s?s.name:"";let d=this.snowlyText("Khu vực "+t.pos.zone+" ",16,"Arial",16777215,!1,e.width,e.height),l=this.snowlyText(o,16,"Arial",16711168,!1,e.width,e.height);l.y=d.height,a.addChild(d,l),e.addChild(a),a.x=h.x+h.width+.05*h.width,a.y=e.height/2-a.height/2;let r=this.boxBaseMenuTXT(e,"Đổi cờ"),g=this.boxBaseBody(i,e,r);i.addChild(g);let c=this.boxBaseMask(g,i),m=g.width,u=.15*e.width;u=u>50?50:u;let y={0:{name:"Tháo cờ",desc:"",img:"2761"},1:{name:"Cờ đỏ",desc:"Tăng 5% exp khi đánh quái",img:"2323"},2:{name:"Cờ xanh lá cây",desc:"Tăng 5% exp khi đánh quái",img:"2324"},3:{name:"Cờ xanh da trời",desc:"Tăng 5% exp khi đánh quái",img:"2325"},4:{name:"Cờ vàng",desc:"Tăng 5% exp khi đánh quái",img:"2326"},5:{name:"Cờ tìm",desc:"Tăng 5% exp khi đánh quái",img:"2327"},6:{name:"Cờ cam",desc:"Tăng 5% exp khi đánh quái",img:"2328"},7:{name:"Cờ hông",desc:"Tăng 5% exp khi đánh quái",img:"2329"},8:{name:"Cờ xanh dương",desc:"Tăng 5% exp khi đánh quái",img:"2330"},9:{name:"Cờ đen",desc:"Tăng 10% exp khi đánh quái",img:"2331"}},w=0;for(let t in y){let i=y[t],e=new PIXI.Graphics;e.interactive=!0,e.cursor="pointer";let h=0;e.on("pointerdown",(()=>{h=Date.now()})),e.on("pointerup",(()=>{Date.now()-h<=150&&this.previewCoPK(e,t)})),e.beginFill(14272691,1),e.drawRect(0,0,m,u),e.endFill(),e.x=0,e.y=w*u+3*w,c.addChild(e),e.name="since04KEY",w++;let n=new PIXI.Graphics;n.beginFill(9927509,1),n.drawRect(0,0,.15*m,.99*u),n.endFill(),n.x=0,e.addChild(n);let a=this.snowlyImg(i.img);a.width=.4*n.width,a.height=.4*n.height,a.x=n.width/2-a.width/2,a.y=n.height/2-a.height/2,n.addChild(a);let o=new PIXI.Graphics;o.beginFill(15130321,1),o.drawRect(0,0,.84*m,.99*u),o.endFill(),o.x=.16*m,e.addChild(o);let s=new PIXI.Container,d=new PIXI.Text(i.name,{fontSize:16,fill:2583106,fontFamily:"Arial",fontWeight:"bold"});s.addChild(d);let l=new PIXI.Text(i.desc,{fontSize:14,fill:33022,fontFamily:"Arial",fontWeight:"bold"});s.addChild(l),l.y=d.height+.1*d.height,o.addChild(s),s.x=0,s.y=o.height/2-s.height/2}this.snowlySroll(g,c);let f=this.boxBaseFoot(e,i);i.addChild(e,r,f)};previewCoPK=(t,i)=>{let e=0,h=t.getBounds();this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let n=new PIXI.Graphics;this.boxPreviewItem.addChild(n);let a=.4*this.gameWidth;a<350&&(a=350),a>this.gameWidth&&(a=1*this.gameWidth);let o=.15*this.gameHeight;o<85&&(o=85),n.mwidth=a,n.mheight=o,n.beginFill(16711422,1),n.drawRoundedRect(0,0,n.mwidth,n.mheight,5),n.endFill(),n.x=10,n.mwidth=n.mwidth<a?a:n.mwidth,e=e<o?o:e,n.clear(),n.lineStyle(1,0,1),n.beginFill(16777215,1),n.drawRoundedRect(0,0,n.mwidth,e,10),n.endFill(),n.visible=!1;let s=new PIXI.Container;this.boxPreviewItem.addChild(s);let d=new PIXI.Graphics;d.name="since04",d.lineStyle(1,0,1),d.beginFill(14061362,1),d.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),d.endFill(),d.interactive=!0,d.buttonMode=!0;let l=this;d.on("pointerdown",(()=>{this.actionDoiCo(i)})),d.on("pointerover",(()=>{d.clear(),d.lineStyle(1,0,1),d.beginFill(4832866,1),d.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),d.endFill()})),d.on("pointerout",(()=>{d.clear(),d.lineStyle(1,0,1),d.beginFill(14061362,1),d.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),d.endFill()}));let r=new PIXI.Text("Đổi cờ",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:d.getBounds().width,WrapHeight:d.getBounds().height});r.style.fontWeight="bold",r.style.fontSize=.25*h.height,r.resolution=2,r.x=(d.getBounds().width-r.getBounds().width)/2,r.y=(d.getBounds().height-r.getBounds().height)/2,d.addChild(r);let g=new PIXI.Graphics;g.name="since04",g.lineStyle(1,0,1),g.beginFill(14061362,1),g.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),g.endFill(),g.x=d.getBounds().width+10,g.interactive=!0,g.cursor="pointer",g.on("pointerdown",(()=>{this.boxPreviewItem.removeChildren()})),g.on("pointerover",(()=>{g.clear(),g.lineStyle(1,0,1),g.beginFill(4832866,1),g.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),g.endFill()})),g.on("pointerout",(()=>{g.clear(),g.lineStyle(1,0,1),g.beginFill(14061362,1),g.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),g.endFill()}));let c=new PIXI.Text("Đóng",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:g.getBounds().width,WrapHeight:g.getBounds().height});c.style.fontWeight="bold",c.style.fontSize=.25*h.height,c.resolution=2,c.x=(g.getBounds().width-c.getBounds().width)/2,c.y=(g.getBounds().height-c.getBounds().height)/2,g.addChild(c),s.addChild(g),s.addChild(d),n.y=h.y-n.getBounds().height+h.height,n.y+n.getBounds().height+s.getBounds().height>this.gameHeight&&(n.y=this.gameHeight-n.getBounds().height-10-s.getBounds().height),n.y<0&&(n.y=10),s.x=(n.getBounds().width-s.getBounds().width)/2,s.y=n.getBounds().height+n.getBounds().y;let m=0;"Enter"==this.pcKey&&(this.pcKey="1");let u=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(u),!1;let t=s.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(m-=1,m<0&&(m=t.length-1)):"ArrowRight"===i&&(m+=1,m>=t.length&&(m=0)),("ArrowUp"===i||"ArrowDown"===i)&&l.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[m],e=l.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[m]&&l.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[m].width,e=t[m].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[m].addChild(h);let n=t[m],a=l.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class V extends A{constructor(){super()}hoiSinhTaiCho=()=>{this.to(-32,{type:"hoisinh"})};boxMenuHoiSinh=()=>{this.closeBox(),this.khungGiaoTiep.removeChildren(),this.khungGiaoTiep.visible=!0;let t=.8*this.gameWidth,i=.4*this.gameHeight;t=t>600?600:t;let e=this.snowlyGraphics(t,i,1467140,0,1e-4,10,0);this.khungGiaoTiep.addChild(e),e.x=(this.gameWidth-t)/2;let h=.4*i,n=this.snowlyGraphics(t,h,16711422,0,2,10);e.addChild(n);let a=new PIXI.Text("",{fontSize:15,fill:0,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:t-20,fontWeight:"bold",align:"center"});a.x=n.width/2-a.width/2,a.y=n.height/2-a.height/2,n.addChild(a),n.visible=!1,e.y=this.gameHeight-e.height;let o=new PIXI.Container,s=new PIXI.Graphics;s.beginFill(0,0),s.drawRect(0,0,.99*e.width,e.height),s.endFill(),s.x=0,s.y=0;let d=[];d.push({name:"Chờ",a:"close"},{name:"Về nhà",a:"home"},{name:"Hồi sinh (1 ngọc)",a:"hs"}),d.forEach(((t,h)=>{let n=new PIXI.Container,a=1*e.width,s=1*i;a=a>100?100:a,s=s>100?100:s;let l=this.snowlyGraphics(a,s,14127410,0,2,10);n.addChild(l),l.x=5+(a+5)*h;let r=new PIXI.Text(t.name,{fontSize:16,fill:5449989,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:l.width-20,fontWeight:"bold"});r.position.set((l.width-r.width)/2,(l.height-r.height)/2),l.addChild(r),l.name="since04",o.addChild(l),l.interactive=!0,l.cursor="pointer",l.on("pointerover",(()=>{l.clear(),l.lineStyle(2,"#FFFFFF",1),l.beginFill(4767072,.5),l.drawRoundedRect(0,0,a,s,10),l.endFill()})),l.on("pointerout",(()=>{l.clear(),l.lineStyle(2,0,1),l.beginFill(14127410,1),l.drawRoundedRect(0,0,a,s,10),l.endFill()}));let g=0,c=0;l.on("pointerdown",(function(t){g=Date.now()}));let m=this;l.on("pointerup",(function(t){c=Date.now(),c-g<200&&("home"==d[h].a?(m.khungGiaoTiep.visible=!1,m.khungGiaoTiep.removeChildren(),m.veNha()):"close"==d[h].a?(m.khungGiaoTiep.visible=!1,m.khungGiaoTiep.removeChildren()):(m.hoiSinhTaiCho(),m.khungGiaoTiep.visible=!1,m.khungGiaoTiep.removeChildren()))}))})),o.name="Lớp con";let l=this.snowlyGraphics(.99*e.width,.6*e.height,0,0,0,10,0);l.y=.4*e.height,e.addChild(l);let r=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:o.height,passiveWheel:!0});r.name="Lớp cuộn",r.addChild(o),l.addChild(r),r.drag({direction:"x",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),r.bounce({top:!0,bottom:!0,friction:.5,time:0,ease:"easeInOutSine"});let g=-1,c=this;this.pcKey="",c.pcKey="",clearInterval(c.pcSettimeEntactive),(()=>{this.pcSettimeEntactive=setInterval((function(){let t=c.pcKey;if(0==c.khungGiaoTiep.visible)return clearInterval(c.pcSettimeEntactive),!1;let i=o.children.filter((t=>"since04"==t.name));if("Enter"===t&&-1!=g){let t=i[g],e=c.getAllInteractiveChildren(t);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"))}else"ArrowLeft"===t?(g-=1,g<0&&(g=i.length-1)):"ArrowRight"===t&&(g+=1,g>=i.length&&(g=0));if(i[g]&&c.pcKey.length>=1){for(let t=0;t<i.length;t++)i[t].removeChild(i[t].getChildByName("xanhle"));r.moveCenter(i[g].x,i[g].y);let t=i[g].width,e=i[g].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,t,e,0),h.endFill(),h.name="xanhle",i[g].addChild(h);let n=i[g],a=c.findInteractiveObjects(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown")})),h.on("pointerup",(()=>{a[0].emit("pointerup")})))}c.pcKey=""}),this.app.ticker.deltaMS)})()}}class z extends V{constructor(){super(),this.offMusic={},this.offMusic.valueSound=1,localStorage.getItem("offMusic")&&(this.offMusic=JSON.parse(localStorage.getItem("offMusic"))),this.offMusic.valueSound||(this.offMusic.valueSound=1)}checkedMusic=t=>!this.offMusic[t];updatedMusic=t=>{if("valueSound"==t){let t=this.offMusic.valueSound+.1;t>1&&(t=0),this.offMusic.valueSound=t}else this.offMusic[t]?this.offMusic[t]=!1:this.offMusic[t]=!0;localStorage.setItem("offMusic",JSON.stringify(this.offMusic)),this.runBoxSettingMusic(),this.chipi("Cài đặt thành công. Một số chức năng sẽ được áp dụng khi bạn di chuyển qua khu vực khác."),this.resumeMusic()};runBoxSettingMusic=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText(this.gameInfo.gameName+" "+this.gameInfo.version,18,"fontchinh",16777215,!1,i.width,i.height);h.addChild(n);let a=this.snowlyText("Nhân vật: "+this.my.name,16,"fontchinh",16776960,!1,i.width,i.height);a.y=n.height,h.addChild(a);let o=this.snowlyText("Tài khoản máy chủ: "+this.my.server+" sao",16,"fontchinh",16776960,!1,i.width,i.height);o.y=n.height+a.height,h.addChild(o);let s=this.snowlyText(""+this.my.username,16,"fontchinh",16776960,!1,i.width,i.height);s.y=n.height+a.height+o.height,h.addChild(s),i.addChild(h),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2;let d=this.boxBaseMenuTXT(i,"Cài đặt âm thanh"),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=l.width,c=.15*i.width;c=c>50?50:c,this.my;let m=[{name:"Toàn bộ âm thanh",action:"hieuung"},{name:"+ Âm thanh chạy",action:"chay"},{name:"+ Âm thanh bay",action:"bayKI"},{name:"+ Nhạc nền",action:"backgroundMusic"},{name:"Âm lượng nhạc nền:"+Math.round(100*this.offMusic.valueSound)+"%",action:"valueSound"}];for(let t=0;t<m.length;t++){let i=new PIXI.Graphics;i.lineStyle(1,14272691,1),i.name="since04KEY",i.beginFill(15130321,1),i.drawRoundedRect(0,0,g,c,0),i.endFill(),i.y=t*c*1.09,r.addChild(i);let e="";e=m[t].name+("valueSound"==m[t].action?"":this.checkedMusic(m[t].action)?" [Đang bật]":" [Đang tắt]");let h=new PIXI.Text(e,{fontSize:14,fill:6832931,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:g,fontWeight:"900",strokeThickness:0});h.resolution=2,h.style.align="center",h.position.set((g-h.width*h.scale.x)/2,(c-h.height*h.scale.y)/2),i.addChild(h),i.interactive=!0,i.buttonMode=!0;let n=0,a=0;i.on("pointerdown",(function(t){n=Date.now()}));let o=this;i.on("pointerup",(function(i){a=Date.now(),o.playSound("click"),a-n<200&&o.updatedMusic(m[t].action)}))}this.snowlySroll(l,r);let u=this.boxBaseFoot(i,t);t.addChild(i,d,u)}}class K extends z{constructor(){super()}runBoxSetting=()=>{this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText(this.gameInfo.gameName+" "+this.gameInfo.version,18,"fontchinh",16777215,!1,i.width,i.height);h.addChild(n);let a=this.snowlyText("Nhân vật: "+this.my.name,16,"fontchinh",16776960,!1,i.width,i.height);a.y=n.height,h.addChild(a);let o=this.snowlyText("Tài khoản máy chủ: "+this.my.server+" sao",16,"fontchinh",16776960,!1,i.width,i.height);o.y=n.height+a.height,h.addChild(o);let s=this.snowlyText(""+this.my.username,16,"fontchinh",16776960,!1,i.width,i.height);s.y=n.height+a.height+o.height,h.addChild(s),i.addChild(h),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2;let d=this.boxBaseMenuTXT(i,"Chức năng"),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=l.width,c=.15*i.width;c=c>50?50:c,this.my;let m=[{name:"Cài đặt âm thanh",action:"runBoxSettingMusic"}];for(let t=0;t<m.length;t++){let i=new PIXI.Graphics;i.lineStyle(1,14272691,1),i.name="since04KEY",i.beginFill(15130321,1),i.drawRoundedRect(0,0,g,c,0),i.endFill(),i.y=t*c*1.09,r.addChild(i);let e=new PIXI.Text(m[t].name,{fontSize:14,fill:6832931,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:g,fontWeight:"900",strokeThickness:0});e.resolution=2,e.style.align="center",e.position.set((g-e.width*e.scale.x)/2,(c-e.height*e.scale.y)/2),i.addChild(e),i.interactive=!0,i.buttonMode=!0;let h=0,n=0;i.on("pointerdown",(function(t){h=Date.now()}));let a=this;i.on("pointerup",(function(i){n=Date.now(),a.playSound("click"),n-h<200&&m[t].action.split(",").forEach((t=>{a[t]()}))}))}this.snowlySroll(l,r);let u=this.boxBaseFoot(i,t);t.addChild(i,d,u)}}class O extends K{constructor(){super(),this.dangmoruong=!1}chonRuong=t=>{this.dangmoruong};getContentBox=()=>{let t=this.box.getChildByName("Lớp BOX");if(!t)return!1;let i=t.getChildByName("lớp body");if(!i)return!1;let e=i.getChildByName("data");return e&&e.getChildByName("body")||!1};startOpenRuong=t=>{let i=this.my.ruong.item.find((i=>i.item==t&&"hanhtrang"==i.active));if(!i)return this.chipi("Bạn đã hết rương này rồi.");if(i.soluong<=0)return this.chipi("Bạn đã hết rương này rồi.");let e=this.item.find((i=>i.id==t));if(!e)return this.chipi("Không thể mở rương này.");if("ruong"!=e.type)return this.chipi("Không thể mở rương này.!");let h=this.getContentBox();if(!h)return this.chipi("Có lỗi xẩy ra, vui lòng thử lại.");h.getChildByName("ButonOpenRuong").visible=!1;let n=0,a=0;for(let t in e.list){let i=this.item.find((i=>i.id==t));i&&(setTimeout((()=>{let t=h.getChildByName("item_"+n);t.getChildByName("avatar_"+n).texture=this.coverImg(e.avatar);let i=t.getChildByName("descInfo_"+n);i.getChildByName("name_"+n).text="????",i.getChildByName("desc_"+n).text="Chạm để mở rương",i.getChildByName("tile_"+n).visible=!1,n++,n==a&&(this.dangmoruong=!0)}),100*a),a++)}};xulyRuong=(t,i,e)=>{let h=this.item.find((i=>i.id==t));if(!h)return this.chipi("Không thể mở rương này.");if("ruong"!=h.type)return this.chipi("Không thể mở rương này.!");let n=[],a=0,o=[];for(let t in h.list)e!=a&&o.push(t),h.list[t].idvp=t,n.push(h.list[t]),a++;let s=this.getContentBox();if(!s)return this.chipi("Có lỗi xẩy ra, vui lòng thử lại.");let d=s.getChildByName("ButonOpenRuong");d.visible=!1;let l=n[e];if(!l)return this.chipi("Có lỗi xẩy ra, vui lòng thử lại.");let r=this.item.find((t=>t.id==l.idvp)),g=s.getChildByName("item_"+i);g.idItem=r,g.getChildByName("avatar_"+i).texture=this.coverImg(r.avatar);let c=g.getChildByName("descInfo_"+i),m=c.getChildByName("name_"+i);m.text=r.name,m.style.color=65280;let u=c.getChildByName("desc_"+i),y="";y=0==l.date?"Vĩnh viễn":l.date+" ngày",u.text=y;let w=c.getChildByName("tile_"+i);w.visible=!0,w.text=l.tile+"%";for(let t=0;t<o.length;t++){let i=Math.floor(Math.random()*o.length),e=o[t];o[t]=o[i],o[i]=e}console.log(o);let f=[];for(let t=0;t<n.length;t++)t!=i&&f.push(t);let p=0;setTimeout((()=>{for(let t=0;t<f.length;t++)s.getChildByName("item_"+f[t]).getChildByName("descInfo_"+f[t]).getChildByName("name_"+f[t]).text="Đang mở...",setTimeout((()=>{let t=o[p],i=h.list[t],e=this.item.find((i=>i.id==t)),n=s.getChildByName("item_"+f[p]);n.idItem=e,n.getChildByName("avatar_"+f[p]).texture=this.coverImg(e.avatar);let a=n.getChildByName("descInfo_"+f[p]),l=a.getChildByName("name_"+f[p]);l.text=e.name,l.style.color=1860666;let r=a.getChildByName("desc_"+f[p]),g="";g=0==i.date?"Vĩnh viễn":i.date+" ngày",r.text=g;let c=a.getChildByName("tile_"+f[p]);c.visible=!0,c.text=i.tile+"%",p++,p==f.length&&(d.visible=!0)}),300*t)}),500)};openBoxRuong=(t,i)=>{let e=this.my.ruong.item.find((t=>t.item==i&&"hanhtrang"==t.active));if(!e)return this.chipi("Bạn đã hết rương này rồi.");if(e.soluong<=0)return this.chipi("Bạn đã hết rương này rồi.");let h=this.my.ruong.item.filter((t=>"hanhtrang"==t.active));if(this.my.ruong.slot-h.length<=0)return this.chipi("Hành trang của bạn đã đầy.");this.dangmoruong=!1,this.await(),this.to(-34,{id:i,i:t})};thoigiancon=t=>{let i=t-Date.now();if(i<=0)return"Đã hết hạn";let e=Math.floor(i/6e4);if(e<=60)return e+" phút";let h=Math.floor(e/60);return h<=24?h+" giờ":Math.floor(h/24)+" ngày"}}class L extends O{constructor(){super()}previewItemBoxRuong(t,i){if(1==this.dangmoruong)return!1;let e=0,h=t.getBounds();this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let n=new PIXI.Graphics;this.boxPreviewItem.addChild(n);let a=.4*this.gameWidth;a<350&&(a=350),a>this.gameWidth&&(a=1*this.gameWidth);let o=.15*this.gameHeight;o<85&&(o=85),n.mwidth=a,n.mheight=o,n.beginFill(16711422,1),n.drawRoundedRect(0,0,n.mwidth,n.mheight,5),n.endFill(),n.x=10;let s=this.snowlyImg(i.avatar);s.width=30,s.height=30,s.x=10,s.y=.1*n.mheight,n.addChild(s),e+=s.height;let d=new PIXI.HTMLText(i.name,{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"right",WrapWidth:n.mwidth-s.width-20,WrapHeight:n.mheight});d.style.fontWeight="bold",d.x=n.width-d.width-10,d.y=s.y+s.height/2-d.height/2,n.addChild(d),e+=d.height;let l=d.y+d.height;if("trangbi"==i.type){let t=i.info;for(let i in t){if(0==t[i])continue;let h="";h="%"==this.itemTypeName[i].type?(t[i]>0?"+":"-")+t[i]+this.itemTypeName[i].name:this.itemTypeName[i].name+""+(t[i]>0?"+":"-")+t[i];let a=new PIXI.HTMLText(h,{fontFamily:"Arial",fontSize:16,fill:51968,fontWrap:!0,align:"right",WrapWidth:n.mwidth-s.width-20,WrapHeight:n.mheight});a.style.fontWeight="bold",a.x=n.width-a.width-10,a.y=l,n.addChild(a),e+=a.height,l=a.y+a.height}}let r=new PIXI.Graphics;r.beginFill(0,.5),r.drawRect(0,0,.8*n.mwidth,1),r.endFill(),r.y=l+15,r.x=n.mwidth/2-r.width/2,n.addChild(r),e+=r.height+30;let g=new PIXI.Text(i.motadai,{fontFamily:"Arial",fontSize:14,fill:0,fontWrap:!0,WrapWidth:.8*r.width});g.style.fontWeight="bold",g.resolution=2,g.style.fontWrap=!0,g.style.wordWrap=!0,g.style.wordWrapWidth=.8*r.width,g.style.wordWrapHeight=.8*r.height,g.x=r.x+r.width/2-g.width/2,g.y=r.y+r.height+10,n.addChild(g),e+=g.height,n.mwidth=n.mwidth<a?a:n.mwidth,e=e<o?o:e,n.clear(),n.lineStyle(1,0,1),n.beginFill(16777215,1),n.drawRoundedRect(0,0,n.mwidth,e,10),n.endFill();let c=new PIXI.Container;this.boxPreviewItem.addChild(c);let m=new PIXI.Graphics;m.name="since04",m.lineStyle(1,0,1),m.beginFill(14061362,1),m.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),m.endFill(),m.interactive=!0,m.buttonMode=!0;let u=this;m.on("pointerdown",(()=>{})),m.on("pointerover",(()=>{m.clear(),m.lineStyle(1,0,1),m.beginFill(4832866,1),m.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),m.endFill()})),m.on("pointerout",(()=>{m.clear(),m.lineStyle(1,0,1),m.beginFill(14061362,1),m.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),m.endFill()}));let y=new PIXI.Text("Đóng",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:m.getBounds().width,WrapHeight:m.getBounds().height});y.style.fontWeight="bold",y.style.fontSize=.25*h.height,y.resolution=2,y.x=(m.getBounds().width-y.getBounds().width)/2,y.y=(m.getBounds().height-y.getBounds().height)/2,m.addChild(y),c.addChild(m),n.y=h.y-n.getBounds().height+h.height,n.y+n.getBounds().height+c.getBounds().height>this.gameHeight&&(n.y=this.gameHeight-n.getBounds().height-10-c.getBounds().height),n.y<0&&(n.y=10),c.x=(n.getBounds().width-c.getBounds().width)/2,c.y=n.getBounds().height+n.getBounds().y;let w=0;"Enter"==this.pcKey&&(this.pcKey="1");let f=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(f),!1;let t=c.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(w-=1,w<0&&(w=t.length-1)):"ArrowRight"===i&&(w+=1,w>=t.length&&(w=0)),("ArrowUp"===i||"ArrowDown"===i)&&u.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[w],e=u.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[w]&&u.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[w].width,e=t[w].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[w].addChild(h);let n=t[w],a=u.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class Y extends L{constructor(){super()}previewItemBox=t=>{let i=this.item.find((i=>i.id==t));if(!i)return this.chipi("có lỗi xẩy ra");if("ruong"!=i.type)return this.chipi("có lỗi xẩy ra");this.closeBox();let e=this.boxBaseBackground();this.box.addChild(e);let h=this.boxBaseHead(e),n=this.snowlyImg(i.avatar);n.width=.2*h.width,n.height=.5*h.height>n.width?n.width:.5*h.height,n.x=.01*h.width,n.y=.99*h.height-n.height,h.addChild(n);let a=new PIXI.Container,o=new PIXI.HTMLText(i.name,{fontSize:16,fill:16184298,fontFamily:"Arial",fontWeight:"900"});a.addChild(o);let s=new PIXI.HTMLText(i.mota,{fontSize:14,fill:16184298,fontFamily:"Arial",fontWeight:"900"});a.addChild(s),s.y=o.height+.1*o.height,h.addChild(a),a.x=n.x+n.width+.05*n.width,a.y=h.height/2-a.height/2;let d=this.boxBaseMenuTXT(h,i.name),l=this.boxBaseBody(e,h,d);e.addChild(l);let r=this.boxBaseMask(l,e),g=l.width,c=.15*h.width;c=c>50?50:c,this.my;let m=0;for(let t in i.list){let e=i.list[t],h=this.item.find((i=>i.id==t));if(h){let t=new PIXI.Graphics;t.beginFill(14272691,1),t.drawRect(0,0,g,c),t.endFill(),t.x=0,t.y=m*c+2*m,r.addChild(t),t.name="item_"+m,t.bienphu=m,t.idItem=h,t.interactive=!0,t.cursor="pointer";let n=0;t.on("pointerdown",(()=>{n=Date.now()})),t.on("pointerup",(()=>{if(Date.now()-n<200){if(this.dangmoruong)return this.openBoxRuong(t.bienphu,i.id),!1;this.previewItemBoxRuong(t,t.idItem)}}));let a=new PIXI.Graphics;a.beginFill(9927509,1),a.drawRect(0,0,.25*g,c),a.endFill(),a.x=0,t.addChild(a);let o=this.snowlyImg(h.avatar);o.width=.8*c,o.height=.8*c,o.x=a.width/2-o.width/2,o.y=a.height/2-o.height/2,o.name="avatar_"+m,t.addChild(o);let s=new PIXI.Graphics;s.name="descInfo_"+m,s.beginFill(15130321,1),s.drawRect(0,0,.74*g,c),s.endFill(),s.x=.26*g,t.addChild(s);let d=new PIXI.HTMLText(h.name,{fontSize:14,fill:1860666,fontFamily:"Arial",fontWeight:"900"});d.x=.01*s.width,d.y=.01*s.height,d.name="name_"+m,s.addChild(d);let l="";l=0==e.date?"Vĩnh viễn":e.date+" ngày";let u=new PIXI.HTMLText(l,{fontSize:12,fill:33022,fontFamily:"Arial",fontWeight:"900"});u.x=.01*s.width,u.y=d.height+.1*d.height,u.name="desc_"+m,s.addChild(u);let y=new PIXI.HTMLText(e.tile+"%",{fontSize:12,fill:33022,fontFamily:"Arial",fontWeight:"900"});y.x=s.width-y.width-y.width/2,y.y=s.height/2-y.height/2,y.name="tile_"+m,s.addChild(y),m++}}let u=new PIXI.Graphics;u.name="ButonOpenRuong",u.beginFill(9927509,1),u.drawRoundedRect(0,0,.3*g,c,10),u.endFill(),u.x=g/2-u.width/2,u.y=m*c+2*m+10,r.addChild(u);let y=new PIXI.HTMLText("Mở nào !",{fontSize:14,fill:16184298,fontFamily:"Arial",fontWeight:"900"});y.x=u.width/2-y.width/2,y.y=u.height/2-y.height/2,u.addChild(y),u.interactive=!0,u.cursor="pointer";let w=0;u.on("pointerdown",(()=>{w=Date.now()})),u.on("pointerup",(()=>{Date.now()-w<200&&this.startOpenRuong(i.id)})),this.snowlySroll(l,r);let f=this.boxBaseFoot(h,e);e.addChild(h,d,f)}}class j extends Y{constructor(){super()}boxNewDoiKhu=()=>{let t=this.my,i=this.listMap.find((i=>i.id==t.pos.map));return i?i&&i.max>0?this.notice(this._("Không đổi khu vực tại bản đồ này được.")):void this.to(-19):this.notice(this._("Không thể đổi khu vực."))};doiKhu=t=>{let i=this.my,e=this.listMap.find((t=>t.id==i.pos.map));return e?e&&e.max>0?this.notice(this._("Không đổi khu vực tại bản đồ này được.")):(this.closeBox(),this.to(-20,t),void this.notice(this._("Xin chờ..."),!1)):this.notice(this._("Không thể đổi khu vực."))};changeZoneSucess=t=>{let i=this.my;if(i.id<=0)return!1;this.deleteNotice(),i.pos.zone=t._1,this.Charset=[],this.resetNone(),this.sendMyMove(),this.ioGetElementOnMap()};ioXuListKhu=t=>{console.log(t);let i=this.my;if(i.id<=0)return!1;this.closeBox();let e=this.boxBaseBackground();this.box.addChild(e);let h=this.boxBaseHead(e),n=this.snowlyImg(561);n.width=.25*h.width,n.height=.99*h.height>n.width?n.width:.99*h.height,n.x=.01*h.width,n.y=.99*h.height-n.height;let a=this.snowlyText(i.pos.zone,16,"Arial",16777215,!1,n.width,n.height);h.addChild(n,a),a.x=n.width/2-a.width/2,a.y=n.y+n.height/2-a.height/2;let o=new PIXI.Container,s="",d=this.listMap.find((t=>t.id==i.pos.map));s=d?d.name:"";let l=this.snowlyText("Khu vực "+i.pos.zone+" ",16,"Arial",16777215,!1,h.width,h.height),r=this.snowlyText(s,16,"Arial",16711168,!1,h.width,h.height);r.y=l.height,o.addChild(l,r),h.addChild(o),o.x=n.x+n.width+.05*n.width,o.y=h.height/2-o.height/2;let g=this.boxBaseMenuTXT(h,"Chọn khu vực"),c=this.boxBaseBody(e,h,g);e.addChild(c);let m=this.boxBaseMask(c,e),u=c.width,y=.15*h.width;y=y>50?50:y,t._1.forEach(((i,e)=>{let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(15130321,1),h.drawRoundedRect(0,0,u,y,0),h.endFill(),h.y=e*y*1.09,m.addChild(h);let n=0;n=i._2<5?43264:i._2<9?16776960:16711680;let a=new PIXI.Graphics;a.lineStyle(1,14272691,1),a.beginFill(n,1),a.drawRoundedRect(0,0,.3*u,y,0),a.endFill(),h.addChild(a);let o=this.snowlyText(i._1,16,"Arial",16711168,!0,a.width,a.height);o.style.fontWeight="bold",a.addChild(o);let s=new PIXI.Graphics;s.lineStyle(1,14272691,1),s.beginFill(15130321,1),s.drawRoundedRect(0,0,.7*u,y,0),s.endFill(),s.x=a.width,h.addChild(s);let d=this.snowlyText(i._2+"/"+t._2,16,"Arial",21285,!0,s.width,s.height);d.style.fontWeight="bold",d.x=.05*s.width,s.addChild(d),h.interactive=!0,h.cursor="pointer",h.name="since04KEY";let l=0,r=0;h.on("pointerdown",(()=>{l=Date.now()})),h.on("pointerup",(()=>{r=Date.now(),r-l<200&&this.doiKhu(i._1)}))})),this.snowlySroll(c,m);let w=this.boxBaseFoot(h,e);e.addChild(h,g,w)}}const U=class extends j{constructor(){super(),this.profileDetu=[{name:"Đệ tử",onclick:"detu"},{name:"Trạng thái",onclick:"trangthai"}]}coverTrangThai=t=>{let i="";return"baove"==t&&(i="Bảo vệ"),"ditheo"==t&&(i="Đi theo"),"venha"==t&&(i="Về nhà"),"tancong"==t&&(i="Tấn công"),i};detuSatus=()=>{if(!this.my.detu||!this.my.detu.id)return this.closeBox();this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.my.detu,e=this.boxBaseHead(t),h=this.snowlyImg(i.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("HP: "+this.number_format(i.info.chiso.hp)+"/"+this.number_format(i.info.chiso.hpFull),16,"fontchinh",16777215,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText("KI: "+this.number_format(i.info.chiso.ki)+"/"+this.number_format(i.info.chiso.kiFull),16,"fontchinh",16777215,!1,e.width,e.height);o.y=a.y+a.height,n.addChild(o);let s=this.snowlyText("Chí mạng: "+this.number_format(i.info.chiso.chimang)+" Giáp:"+i.info.chiso.giap,16,"fontchinh",16776960,!1,e.width,e.height);s.y=o.y+o.height,n.addChild(s);let d=this.snowlyText("Trạng thái: "+this.coverTrangThai(i.info.trangthai),16,"fontchinh",16777215,!1,e.width,e.height);d.y=s.y+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenu(e,"trangthai",this.profileDetu),r=this.boxBaseBody(t,e,l);t.addChild(r);let g=this.boxBaseMask(r,t);[{name:"Đi theo",act:"di theo"},{name:"Bảo vệ",act:"bao ve"},{name:"Tấn công",act:"tan cong"},{name:"Về nhà",act:"ve nha"}].forEach(((t,i)=>{let e=this.snowlyGraphics(r.width,.1*r.height,15130321,14272691,1);g.addChild(e),e.y=i*e.height;let h=this.snowlyText(t.name,16,"fontchinh",5449989,!1,e.width,e.height);e.addChild(h),h.x=e.width/2-h.width/2,h.y=e.height/2-h.height/2,e.interactive=!0,e.cursor="pointer",e.name="since04KEY",e.on("pointerdown",(()=>{this.send(-8,t.act),this.closeBox()}))})),this.snowlySroll(r,g);let c=this.boxBaseFoot(e,t);t.addChild(e,l,c)};detuBoxInfo=()=>{if(!this.my.detu||!this.my.detu.id)return this.closeBox();this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.my.detu,e=this.boxBaseHead(t),h=this.snowlyImg(i.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("Sức mạnh: "+this.number_format(i.info.coban.sucmanh),16,"fontchinh",16776960,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText(this.danhHieu(i.info.coban.sucmanh),16,"fontchinh",16776960,!1,e.width,e.height);n.addChild(o),o.y=a.y+a.height;let s=this.snowlyText("Sức đánh: "+this.number_format(i.info.chiso.sucdanh),16,"fontchinh",16776960,!1,e.width,e.height);n.addChild(s),s.y=o.y+o.height;let d=this.snowlyText("Sức khỏe: "+i.info.chiso.suckhoe/i.info.chiso.suckhoe_max*100+"%",16,"fontchinh",16776960,!1,e.width,e.height);n.addChild(d),d.y=s.y+s.height,e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenu(e,"detu",this.profileDetu),r=this.boxBaseBody(t,e,l);t.addChild(r);let g=this.boxBaseMask(r,t),c=this,m=t=>{t.interactive=!0,t.cursor="pointer";let i=0,e=0;t.on("pointerdown",(function(t){i=Date.now()})),t.on("pointerup",(function(h){e=Date.now(),e-i<300&&c.open_PreviewItem(t)}))},u=r.width,y=.15*e.width;y=y>50?50:y;let w=i,f=["ao","quan","gang","giay","rada","caitrang"];for(let t=0;t<6;t++){let i=new PIXI.Container;i.name="since04KEY",g.addChild(i),i.maxWight=u,i.maxHeight=y,i.width=i.maxWight,i.height=i.maxHeight,i.x=0,i.y=y*t+0;let e=new PIXI.Graphics;e.lineStyle(1,14272691,1),e.beginFill(0,.5),e.drawRoundedRect(0,0,i.maxWight,i.maxHeight,0),e.endFill();let h=new PIXI.Graphics;h.lineStyle(1,14272691,1),h.beginFill(9927509,1),h.drawRoundedRect(0,0,.2*i.maxWight,i.maxHeight,0),h.endFill(),h.x=0,h.y=0;let n=new PIXI.Graphics;if(n.lineStyle(1,14272691,1),n.beginFill(15130321,1),n.drawRoundedRect(h.x+h.getBounds().width,0,.8*i.maxWight,i.maxHeight,0),n.endFill(),w.trangbi[f[t]]&&0!=w.trangbi[f[t]]){let i=w.trangbi[f[t]],e=this.findBag(i);if(e){let t=this.findItem(e.item);if(t){let i=new PIXI.Sprite(this.coverImg(t.avatar));i.width=.35*h.width,i.height=.35*h.height,i.x=(h.width-i.width)/2,i.y=(h.height-i.height)/2,h.addChild(i);let a=this.snowlyText(t.name,16,"fontchinh",21285,!1,n.width,n.height);a.resolution=2,a.x=n.getBounds().x+.04*n.getBounds().width,a.height=.38*n.height,a.y=0+.1*n.height;let o=this.snowlyText(t.mota,14,"fontchinh",427005,!1,n.width,n.height);o.resolution=2,o.x=n.getBounds().x+.04*n.getBounds().width,o.height=.38*n.height,o.y=a.y+a.height,n.addChild(a,o),n.item=e.id}}}e.addChild(h,n),i.addChild(e),i.item=n.item,m(n)}let p=6;[0,15e7,15e7,4e9].forEach(((t,e)=>{let h=new PIXI.Container;h.name="since04KEY",g.addChild(h),h.x=0,h.y=p*y+5;let n=this.snowlyGraphics(u,y,14272691,14272691,.5,1);h.addChild(n);let a=this.snowlyGraphics(.15*u,y,14272691,16749584,.5,1);n.addChild(a);let o,s=null!=i.skill[e];if(s&&(o=this.usedSkill(i.skill[e].id),o||(s=!1)),s){let t=this.snowlyImg(o.avatar);t.width=.9*a.getBounds().width,t.height=.9*a.getBounds().height,t.x=(a.getBounds().width-t.width)/2,t.y=(a.getBounds().height-t.height)/2,a.addChild(t)}else{let t=this.snowlyImg(5223);t.width=.9*a.getBounds().width,t.height=.9*a.getBounds().height,t.x=(a.getBounds().width-t.width)/2,t.y=(a.getBounds().height-t.height)/2,a.addChild(t)}let d=new PIXI.Graphics;d.lineStyle(1,15130321,1),d.beginFill(15130321,.5),d.drawRoundedRect(.17*u,0,.83*u,y,0),d.endFill(),n.addChild(d);let l="xin chào";l=s?o.name:"Cần "+this.number_format(t)+" sức mạnh. ";let r=new PIXI.Text(l,{fontSize:14,fill:6520318,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:.9*d.getBounds().width});r.resolution=2,r.style.align="center",r.x=d.getBounds().x+d.getBounds().x/100*10,r.y=0,d.addChild(r);let c="xxx";c=s?"Cấp độ "+i.skill[e].level:"Hãy cùng đệ tử luyện tập để mở kĩ năng này.";let m=new PIXI.Text(c,{fontSize:12,fill:21285,fontFamily:"fontchinh"});m.resolution=2,m.style.align="center",m.x=d.getBounds().x+d.getBounds().x/100*10,m.y=r.y+r.height+5,d.addChild(m),p++})),this.snowlySroll(r,g);let x=this.boxBaseFoot(e,t);t.addChild(e,l,x)}},q=class extends U{constructor(){super(),this.lastmenuOpen="",this.boxFirst=!0,this.AddNewEvent=0,this.pcKey=0,this.pcSettimeEntactive=null,this.pcSettimeEntactive2=null,document.addEventListener("keyup",this.taoDiChuyenBangPhim),this.conTro=0}closeBox(){this.box.visible=!1,this.box.removeChildren(),this.pcSettimeEntactive&&clearInterval(this.pcSettimeEntactive),this.pcSettimeEntactive2&&clearInterval(this.pcSettimeEntactive2)}taoDiChuyenBangPhim=t=>{this.pcKey=t.key};clickButton(t){this.box.removeChildren(),this.lastmenuOpen=t,"detu"!=t&&"thongtindetu"!=t||(this.lastmenuOpen="hanhtrang"),"hanhtrang"==t&&this.boxNewBag(),"nhiemvu"==t&&this.boxNewNhiemVu(),"kynang"==t&&this.boxNewKyNang(),"banghoi"==t&&this.boxNewBangHoi(),"chucnang"==t&&this.boxNewChucNang(),"detu"==t&&this.detuBoxInfo(),"trangthai"==t&&this.detuSatus(),this.danhSachItem=[],this.playSound("click")}openLastMenu(){if(""==this.lastmenuOpen)return this.clickButton("hanhtrang");this.clickButton(this.lastmenuOpen)}findInteractiveObjects=t=>{if("object"!=typeof t)return!1;let i=t,e=[],h=t=>{if(null==t)return!1;if("object"!=typeof t)return!!t.interactive&&(t=>{t.interactive&&e.push(t)})(t);for(let i=0;i<t.length;i++)t[i].interactive&&e.push(t[i]),t[i].children.length>0&&h(t[i].children)};return i.interactive&&e.push(i),h(i.children),e};getAllInteractiveChildren=t=>{let i=[];return null!=t&&(t.interactive&&i.push(t),t.children&&t.children.length>0&&t.children.forEach((t=>{if(t instanceof PIXI.Container){const e=this.getAllInteractiveChildren(t);i=i.concat(e)}})),i)};snowlySroll=(t,i)=>{if(i.height<t.height){let e=t.height-i.height,h=new PIXI.Graphics;h.beginFill(0,1e-5),h.drawRect(0,0,t.width,e),h.endFill(),h.y=i.height,i.addChild(h)}i.y=5,i.name="body";let e=t.height/100*150;e=0;let h=new pixi_viewport.Viewport({screenWidth:t.width,screenHeight:t.height+0,worldWidth:i.width,worldHeight:i.height+0,passiveWheel:!0});h.addChild(i),h.name="data",h.interactive=!0,h.cursor="pointer";let n=this,a=-1,o=()=>{this.pcSettimeEntactive=setInterval((function(){let t=n.pcKey;if(0==n.box.visible)return clearInterval(n.pcSettimeEntactive),!1;if(0!=n.conTro)return!1;let e=i.children.filter((t=>"since04KEY"==t.name));if("ArrowUp"===t?(n.boxPreviewItem.removeChildren(),a-=1,a<0&&(a=e.length-1)):"ArrowDown"===t&&(n.boxPreviewItem.removeChildren(),a+=1,a>=e.length&&(a=0)),"Enter"===t){let t=e[a],i=n.getAllInteractiveChildren(t);i.length>0&&0==n.boxPreviewItem.children.length&&(i[0].emit("pointerdown"),i[0].emit("pointerup"))}if(e[a]&&n.pcKey.length>=1){for(let t=0;t<e.length;t++)e[t].removeChild(e[t].getChildByName("xanhle"));h.moveCenter(e[a].x,e[a].y);let t=e[a].width,i=e[a].height,o=new PIXI.Graphics;o.lineStyle(0,0,1),o.beginFill(16318026,.5),o.drawRoundedRect(0,0,t,i,0),o.endFill(),o.name="xanhle",e[a].addChild(o);let s=e[a],d=n.findInteractiveObjects(s);d.length>0&&(o.interactive=!0,o.cursor="pointer",o.on("pointerdown",(()=>{d[0].emit("pointerdown")})),o.on("pointerup",(()=>{d[0].emit("pointerup")})))}n.boxPreviewItem.children.length<=0&&(n.pcKey="")}),this.app.ticker.deltaMS)};o();let s=0,d=0;return h.on("pointerdown",(t=>{s=Date.now(),this.conTro=0})),h.on("pointerup",(function(t){if(d=Date.now(),d-s<200){let e=t.data.global.x,h=t.data.global.y,o=i.toLocal(new PIXI.Point(e,h));o.x=Math.round(o.x),o.y=Math.round(o.y);let s=i.children.filter((t=>"since04KEY"==t.name));for(let t=0;t<s.length;t++)s[t].removeChild(s[t].getChildByName("xanhle"));for(let t=0;t<s.length;t++)if(s[t].x<=o.x&&o.x<=s[t].x+s[t].width&&s[t].y<=o.y&&o.y<=s[t].y+s[t].height){a=t;let i=s[t].width,e=s[t].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",s[t].addChild(h);let o=s[t],d=n.getAllInteractiveChildren(o);d.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{d[0].emit("pointerdown")})),h.on("pointerup",(()=>{d[0].emit("pointerup")})))}}else clearInterval(n.pcSettimeEntactive),setTimeout((function(){clearInterval(n.pcSettimeEntactive),o()}),200)})),t.addChild(h),t.name="lớp body",h.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),h.bounce({top:!0,bottom:!0,friction:.5,time:0,ease:"easeInOutSine"}),h.setZoom(1),h}};class $ extends q{constructor(){super()}createSprite=(t,i,e)=>{let h=new PIXI.Container,n=this.getSkin(i),a=this.getSkin(t),o=this.getSkin(e),s=new PIXI.Sprite(this.coverImg(n.farm[0].dungyen.farme[0]));s.scale.set(n.farm[0].dungyen.width,n.farm[0].dungyen.height),s.sprite=0,s.name="quan222";let d=new PIXI.Sprite(this.coverImg(a.farm[0].dungyen.farme[0]));d.sprite=0,d.name="ao222",d.scale.set(a.farm[0].dungyen.width,a.farm[0].dungyen.height);let l=new PIXI.Sprite(this.coverImg(o.farm[0].dungyen.farme[0]));return l.scale.set(o.farm[0].dungyen.width,o.farm[0].dungyen.height),l.sprite=0,l.name="dau222",l.x=o.farm[0].dungyen.x,s.x=n.farm[0].dungyen.x,d.x=a.farm[0].dungyen.x,d.load=0,l.y=Math.abs(this.getImg(i).farm[0].dungyen.y),d.y=Math.abs(this.getImg(e).farm[0].dungyen.y)-Math.abs(this.getImg(t).farm[0].dungyen.y),s.y=Math.abs(this.getImg(e).farm[0].dungyen.y),h.addChild(s,l,d),h}}class J extends ${constructor(){super()}btShopBuyIcon=t=>{if(-1==t)return void this.notice("Bạn chưa chọn biểu tượng");let i=this.my,e=this.base_co.find((i=>i.id==t));i.tien[1==e.type?"vang":"zeni"]<e.cost?this.notice("Bạn không đủ "+(1==e.type?"vàng":"ngọc xanh")+" để tạo bang"):(this.await(),this.to(-33,{type:"shop_icon",iconID:t}))};boxPTShopBieuTuong=(t=-1)=>{this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText(this.gameInfo.gameName+" "+this.gameInfo.version,18,"fontchinh",16777215,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText("Nhân vật: "+this.my.name,16,"fontchinh",16776960,!1,e.width,e.height);o.y=a.height,n.addChild(o);let s=this.snowlyText("Tài khoản máy chủ: "+this.my.server+" sao",16,"fontchinh",16776960,!1,e.width,e.height);s.y=a.height+o.height,n.addChild(s);let d=this.snowlyText(""+this.my.username,16,"fontchinh",16776960,!1,e.width,e.height);d.y=a.height+o.height+s.height,n.addChild(d),e.addChild(n),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2;let l=this.boxBaseMenuTXT(e,"Thay đổi biểu tượng"),r=this.boxBaseBody(i,e,l);i.addChild(r);let g=this.boxBaseMask(r,i),c=r.width,m=.15*e.width;m=m>50?50:m,this.my;let u=this.html('\n\n            <center><font color="005325"><b>Biểu tượng:</b></font></center>\n        ');u.x=r.width/2-u.width/2,u.y=30,g.addChild(u),this.base_co.forEach(((i,e)=>{let h=new PIXI.Container;h.name="since04KEY";let n=new PIXI.Graphics;n.beginFill(i.id==t?7019816:0,.5),n.lineStyle(1,0,.5),n.drawRoundedRect(0,0,c,m,0),n.endFill(),h.addChild(n);let a=new PIXI.Graphics;a.beginFill(0,.5),a.lineStyle(1,0,.5),a.drawRoundedRect(0,0,m,m,0),a.endFill();let o=this.snowlyImg(i.src[0]);o.width=.9*m,o.height=.9*m,o.x=.05*m,o.y=.05*m,a.addChild(o),h.addChild(a);let s=this.html(`\n                <center><font color="blue"><b>${i.name}</b></font></center>\n            `);s.x=a.x+a.width+5,s.y=.2*m,h.addChild(s);let d=this.html(`\n                <center><font color="eec385"><b>${this.number_format(i.cost)}</b></font> ${1==i.type?'<font color="yellow">Vàng</font>':'<font color="005325">Ngọc xanh</font>'} </center>\n            `);d.x=s.x,d.y=m-d.height,h.addChild(d),h.y=u.y+u.height+5+m*e,h.interactive=!0;let l=0;h.on("pointerdown",(()=>{l=Date.now()})),h.on("pointerup",(()=>{Date.now()-l>200||(this.chipi("Đã chọn biểu tượng "+i.name),this.boxPTShopBieuTuong(i.id))})),g.addChild(h)}));let y=new PIXI.Graphics;y.beginFill(7019816,1),y.lineStyle(1,0,1),y.drawRoundedRect(0,0,.4*c,m,10),y.endFill(),y.x=r.width/2-y.width/2,y.y=u.y+u.height+5+m*this.base_co.length+5,g.addChild(y);let w=this.html('\n            <center><font color="ffffff"><b>Cập nhật</b></font></center>\n        ');w.x=y.x+y.width/2-w.width/2,w.y=y.y+y.height/2-w.height/2,g.addChild(w),y.interactive=!0,y.on("pointerdown",(()=>{this.btShopBuyIcon(t)})),this.snowlySroll(r,g);let f=this.boxBaseFoot(e,i);i.addChild(e,l,f)}}class Q extends J{constructor(){super()}ptMsgBox=(t,i,e=!1)=>this.msgBox(t,i,e);msgBox=(t,i,e=!1)=>{this.boxError.removeChildren(),this.boxError.visible=!0,this.boxError.interactive=!0;let h=.6*this.gameWidth,n=.3*this.gameHeight,a=new PIXI.Graphics;a.beginFill(15721922,1),a.lineStyle(3,9274459,1),a.drawRoundedRect(0,0,h,n,10),a.endFill(),a.x=0,a.y=0,this.boxError.addChild(a);let o=new PIXI.Text(this._(t),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:h-20});o.x=h/2-o.width/2,o.y=n/2-o.height/2,this.boxError.addChild(o);let s=new PIXI.Graphics,d=new PIXI.Graphics;d.beginFill(14842938,1),d.lineStyle(3,7019816,1),d.drawRoundedRect(0,0,100,30,10),d.endFill(),d.x=0,d.y=0;let l=new PIXI.Text(this._("OK"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:h-20});l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",(()=>{this.boxError.removeChildren(),i&&i()}));let r=new PIXI.Graphics;r.beginFill(14842938,1),r.lineStyle(3,7019816,1),r.drawRoundedRect(0,0,100,30,10),r.endFill(),r.x=d.width+10,r.y=0;let g=new PIXI.Text(this._("Hủy"),{fontSize:16,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:h-20});g.x=r.width/2-g.width/2,g.y=r.height/2-g.height/2,r.addChild(g),r.interactive=!0,r.buttonMode=!0,r.on("pointerdown",(()=>{this.boxError.removeChildren(),e&&e()})),s.addChild(d,r),s.x=h/2-s.width/2,s.y=n-s.height/2,this.boxError.addChild(s),this.boxError.x=this.gameWidth/2-h/2,this.boxError.y=.5*this.gameHeight}}class Z extends Q{constructor(){super()}xinVaoPT=t=>{if(this.my.skin.bangID>=1)return this.notice("Bạn đã có bang hội rồi");this.to(-33,{type:"xin",id:t}),this.await()};previewMenberPTGuest=(t,i)=>{let e=0,h=t.getBounds();this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let n=new PIXI.Graphics;this.boxPreviewItem.addChild(n);let a=.4*this.gameWidth;a<350&&(a=350),a>this.gameWidth&&(a=1*this.gameWidth);let o=.15*this.gameHeight;o<85&&(o=85),n.mwidth=a,n.mheight=o,n.beginFill(16711422,1),n.drawRoundedRect(0,0,n.mwidth,n.mheight,5),n.endFill(),n.x=10;let s=this.createSprite(i.skin.ao,i.skin.quan,i.skin.dau);s.x=.05*n.mwidth,s.y=.05*n.mheight,n.addChild(s),e+=s.height+s.y;let d,l=this.html('<font color="532905" style="align:right;">'+i.name+"</font>");l.x=n.mwidth-l.width-.05*n.mwidth,l.y=.05*n.mheight,n.addChild(l),e+=l.height,d=2==i.right?this.html('<font color="red">Bang chủ</font>'):1==i.right?this.html('<font color="green">Phó bang</font>'):this.html('<font color="black">Thành viên</font>'),d.x=n.mwidth-d.width-.05*n.mwidth,d.y=l.y+l.height,n.addChild(d),e+=d.height;let r=this.html('<font color="637dfe">Sức mạnh: '+this.intToM(i.sucmanh)+"</font>");r.x=n.mwidth-r.width-.05*n.mwidth,r.y=d.y+d.height,n.addChild(r),e+=r.height;let g=new PIXI.Graphics;g.beginFill(0,.5),g.drawRect(0,0,.8*n.mwidth,1),g.endFill(),g.y=s.height+.1*s.height,g.x=n.mwidth/2-g.width/2,n.addChild(g),e+=g.height;let c=this.html('<font color="83c629">Cho đậu: '+i.chodau+"</font>");c.x=n.mwidth/2-c.width/2,c.y=g.y+g.height+10,n.addChild(c),e+=c.height+10;let m=this.html('<font color="83c629">Nhận đậu: '+i.nhandau+"</font>");m.x=n.mwidth/2-m.width/2,m.y=c.y+c.height,n.addChild(m);let u=this.html('<font color="black">Ngày gia nhập: '+i.timeVI+"</font>");u.x=n.mwidth/2-u.width/2,u.y=m.y+m.height,n.addChild(u),n.mwidth=n.mwidth<a?a:n.mwidth,e=e<o?o:e,n.clear(),n.lineStyle(1,0,1),n.beginFill(16777215,1),n.drawRoundedRect(0,0,n.mwidth,e,10),n.endFill();let y=new PIXI.Container;this.boxPreviewItem.addChild(y);let w=new PIXI.Graphics;w.name="since04",w.lineStyle(1,0,1),w.beginFill(14061362,1),w.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),w.endFill(),w.interactive=!0,w.buttonMode=!0;let f=this;w.on("pointerdown",(()=>{})),w.on("pointerover",(()=>{w.clear(),w.lineStyle(1,0,1),w.beginFill(4832866,1),w.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),w.endFill()})),w.on("pointerout",(()=>{w.clear(),w.lineStyle(1,0,1),w.beginFill(14061362,1),w.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),w.endFill()}));let p=new PIXI.Text("Đóng",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:w.getBounds().width,WrapHeight:w.getBounds().height});p.style.fontWeight="bold",p.style.fontSize=.25*h.height,p.resolution=2,p.x=(w.getBounds().width-p.getBounds().width)/2,p.y=(w.getBounds().height-p.getBounds().height)/2,w.addChild(p),y.addChild(w),n.y=h.y-n.getBounds().height+h.height,n.y+n.getBounds().height+y.getBounds().height>this.gameHeight&&(n.y=this.gameHeight-n.getBounds().height-10-y.getBounds().height),n.y<0&&(n.y=10),y.x=(n.getBounds().width-y.getBounds().width)/2,y.y=n.getBounds().height+n.getBounds().y;let x=0;"Enter"==this.pcKey&&(this.pcKey="1");let b=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(b),!1;let t=y.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(x-=1,x<0&&(x=t.length-1)):"ArrowRight"===i&&(x+=1,x>=t.length&&(x=0)),("ArrowUp"===i||"ArrowDown"===i)&&f.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[x],e=f.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[x]&&f.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[x].width,e=t[x].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[x].addChild(h);let n=t[x],a=f.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)};previewPT=(t,i)=>{let e=0,h=t.getBounds(),n=this.banghoi.random.find((t=>t.id==i));if(!n)return!1;this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let a=new PIXI.Graphics;this.boxPreviewItem.addChild(a);let o=.4*this.gameWidth;o<350&&(o=350),o>this.gameWidth&&(o=1*this.gameWidth);let s=.15*this.gameHeight;s<85&&(s=85),a.mwidth=o,a.mheight=s,a.beginFill(16711422,1),a.drawRoundedRect(0,0,a.mwidth,a.mheight,5),a.endFill(),a.x=10;let d,l=this.base_co.find((t=>t.id==n.info.icon));if(l){let t=this.snowlyImg(l.src[0]);t.width=50,t.height=50,t.x=.05*a.mheight,t.y=.05*a.mheight,a.addChild(t),d=this.html('<font color="005325">'+n.name+"</font>"),d.x=a.mwidth/2-d.width/2,d.y=t.y+t.height/2-d.height/2,a.addChild(d),e+=t.height,e+=d.height}else d=this.html('<font color="005325">'+n.name+"</font>"),d.x=a.mwidth/2-d.width/2,d.y=10,a.addChild(d),e+=d.height;let r=new PIXI.Graphics;r.beginFill(0,.5),r.drawRect(0,0,.8*a.mwidth,1),r.endFill(),r.y=d.y+d.height,r.x=a.mwidth/2-r.width/2,a.addChild(r),e+=r.height+1;let g=n.menber.find((t=>2==t.right));if(!g)return!1;let c=this.html('<b><font color="red">Bang chủ: '+g.name+" </font></b>");c.x=a.mwidth/2-c.width/2,c.y=r.y+r.height+10,a.addChild(c),e+=c.height+10;let m=this.html('<b><font color="04cc04">Sức mạnh: '+this.intToM(n.info.sucmanh)+" </font></b>");m.x=a.mwidth/2-m.width/2,m.y=c.y+c.height,a.addChild(m),e+=m.height;let u=this.html('<font color="83c629">Thành viên: '+n.menber.length+"/"+n.info.max+" </font>");u.x=a.mwidth/2-u.width/2,u.y=m.y+m.height,a.addChild(u),e+=u.height;let y=this.html('<font color="83c629">Level: '+n.info.level+" </font>");y.x=a.mwidth/2-y.width/2,y.y=u.y+u.height,a.addChild(y),e+=y.height;let w=this.html('<font color="83c629">Ngày thành lập: '+n.info.timeVI+" </font>");w.x=a.mwidth/2-w.width/2,w.y=y.y+y.height,a.addChild(w),e+=w.height,a.mwidth=a.mwidth<o?o:a.mwidth,e=e<s?s:e,a.clear(),a.lineStyle(1,0,1),a.beginFill(16777215,1),a.drawRoundedRect(0,0,a.mwidth,e,10),a.endFill();let f=new PIXI.Container;this.boxPreviewItem.addChild(f);let p=new PIXI.Graphics;p.name="since04",p.lineStyle(1,0,1),p.beginFill(14061362,1),p.drawRoundedRect(0,0,.2*a.mwidth,.2*a.mwidth,10),p.endFill(),p.interactive=!0,p.buttonMode=!0;let x=this;p.on("pointerdown",(()=>{x.xinVaoPT(n.id)})),p.on("pointerover",(()=>{p.clear(),p.lineStyle(1,0,1),p.beginFill(4832866,1),p.drawRoundedRect(0,0,.2*a.mwidth,.2*a.mwidth,10),p.endFill()})),p.on("pointerout",(()=>{p.clear(),p.lineStyle(1,0,1),p.beginFill(14061362,1),p.drawRoundedRect(0,0,.2*a.mwidth,.2*a.mwidth,10),p.endFill()}));let b=new PIXI.Text("Xin vào",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:p.getBounds().width,WrapHeight:p.getBounds().height});b.style.fontWeight="bold",b.style.fontSize=.25*h.height,b.resolution=2,b.x=(p.getBounds().width-b.getBounds().width)/2,b.y=(p.getBounds().height-b.getBounds().height)/2,p.addChild(b);let I=new PIXI.Graphics;I.lineStyle(1,0,1),I.name="since04",I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*a.getBounds().width,.2*a.getBounds().width,10),I.endFill(),I.x=p.getBounds().width+10,I.interactive=!0,I.cursor="pointer",I.on("pointerdown",(function(t){x.viewMenberGuest(n)})),I.on("pointerover",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(4832866,1),I.drawRoundedRect(0,0,.2*a.getBounds().width,.2*a.getBounds().width,10),I.endFill()})),I.on("pointerout",(()=>{I.clear(),I.lineStyle(1,0,1),I.beginFill(14061362,1),I.drawRoundedRect(0,0,.2*a.getBounds().width,.2*a.getBounds().width,10),I.endFill()}));let C=new PIXI.Text("Xem Thành\nviên",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:p.getBounds().width});C.style.fontWeight="bold",C.style.fontSize=.25*h.height,C.resolution=2,C.x=(I.getBounds().width-C.getBounds().width)/2,C.y=(I.getBounds().height-C.getBounds().height)/2,I.addChild(C),f.addChild(p,I),a.y=h.y-a.getBounds().height+h.height,a.y+a.getBounds().height+f.getBounds().height>this.gameHeight&&(a.y=this.gameHeight-a.getBounds().height-10-f.getBounds().height),a.y<0&&(a.y=10),f.x=(a.getBounds().width-f.getBounds().width)/2,f.y=a.getBounds().height+a.getBounds().y;let v=0;"Enter"==this.pcKey&&(this.pcKey="1");let P=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(P),!1;let t=f.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(v-=1,v<0&&(v=t.length-1)):"ArrowRight"===i&&(v+=1,v>=t.length&&(v=0)),("ArrowUp"===i||"ArrowDown"===i)&&x.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[v],e=x.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[v]&&x.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[v].width,e=t[v].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[v].addChild(h);let n=t[v],a=x.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class tt extends Z{constructor(){super()}boxPTMenberXin=()=>{if(this.my.skin.bangID<=0)return this.indexNoJoinPT();this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText(this.banghoi.name,18,"Arial",16777215,!1,i.width,i.height);h.addChild(n);let a=this.snowlyText("Thành tích: "+this.intToM(this.banghoi.info.sucmanh),15,"Arial",16711168,!1,i.width,i.height);a.y=n.height,h.addChild(a);let o=this.snowlyText("Cấp độ: "+this.banghoi.info.level,15,"Arial",16711168,!1,i.width,i.height);o.y=n.height+a.height,h.addChild(o);let s=this.snowlyText("Thành viên: "+this.banghoi.menber.length+"/"+this.banghoi.info.max,15,"Arial",16711168,!1,i.width,i.height);s.y=n.height+a.height+o.height,h.addChild(s),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2,i.addChild(h);let d=this.boxBaseMenu(i,"banghoi",this.profileMenu),l=this.boxBaseBody(t,i,d);t.addChild(l);let r=this.boxBaseMask(l,t),g=l.width,c=.15*i.width;c=c>50?50:c;let m=[{name:"Chat\nBang",function:"boxNewBangHoi"},{name:"Thành\nviên",function:"boxPTMenber"},{name:"Xin vào"+(this.banghoi.xinvao.length>=1?"("+this.banghoi.xinvao.length+")":""),function:"boxPTMenberXin"}],u=new PIXI.Container;r.addChild(u),m.forEach(((t,i)=>{let e=new PIXI.Container;e.name="since04KEY";let h=.25*g,n=new PIXI.Graphics;n.beginFill(15657958,1),n.drawRect(0,0,h,c),n.endFill(),e.addChild(n),n.x=h*i+1*i;let a=this.html('<font color="555555">'+t.name+"</font>");a.x=n.width/2-a.width/2,a.y=c/2-a.height/2,n.addChild(a),u.addChild(e),e.interactive=!0,e.on("pointerdown",(()=>{this[t.function]()}))})),u.x=g/2-u.width/2;let y=new PIXI.Graphics;y.beginFill(0,.3),y.drawRect(0,0,g,1),y.endFill(),y.y=c+.1*c,r.addChild(y);let w=new PIXI.Graphics;w.beginFill(15130321,1),w.drawRect(0,0,g,c),w.endFill(),w.y=y.y+y.height+.1*c,r.addChild(w);let f=this.html('<font color="532905">Danh sách xin vào</font>');f.x=w.width/2-f.width/2,f.y=c/2-f.height/2,w.addChild(f);let p=this.banghoi;this.banghoi.xinvao.sort(((t,i)=>i.time-t.time)),p.xinvao.forEach(((t,i)=>{let e=new PIXI.Graphics;e.beginFill(15657958,1),e.drawRect(0,0,g,c),e.endFill(),e.y=w.y+w.height+c*i+.1*c*i;let h=new PIXI.Graphics;if(h.beginFill(9927509,1),h.drawRect(0,0,.15*g,.99*e.height),h.endFill(),e.addChild(h),t.avatar){let i=this.snowlyImg(t.avatar);i.width=.9*h.width,i.height=i.width,i.x=h.width/2-i.width/2,i.y=h.height/2-i.height/2,h.addChild(i)}let n=this.html('<font color="back">'+t.name+" ("+this.timeAgo(t.time)+") </font>");n.x=h.x+h.width+.05*h.width,n.y=.2*e.height,e.addChild(n);let a=this.html('<font color="0080fe">Sức mạnh: '+this.intToM(t.sucmanh)+"</font>");a.x=h.x+h.width+.05*h.width,a.y=e.height-a.height-.1*e.height,e.addChild(a);let o=new PIXI.Graphics;o.beginFill(15025680,1),o.drawRect(0,0,.15*g,.9*e.height),o.endFill(),o.x=e.width-o.width,e.addChild(o);let s=this.html('<font color="ffffff">Huỷ</font>');s.x=o.width/2-s.width/2,s.y=o.height/2-s.height/2,o.addChild(s);let d=new PIXI.Graphics;d.beginFill(12118449,1),d.drawRect(0,0,.15*g,.9*e.height),d.endFill(),d.x=e.width-2*d.width,e.addChild(d);let l=this.html('<font color="ffffff">OK</font>');l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),r.addChild(e),o.interactive=!0;let m=0;o.on("pointerdown",(()=>{m=Date.now()})),o.on("pointerup",(()=>{Date.now()-m<200&&this.boxPTMenberXinDontAgree(t.uid)})),d.interactive=!0,d.on("pointerdown",(()=>{m=Date.now()})),d.on("pointerup",(()=>{Date.now()-m<200&&this.boxPTMenberXinAgree(t.uid)}))})),this.snowlySroll(l,r);let x=this.boxBaseFoot(i,t);t.addChild(i,d,x)};boxPTMenberXinDontAgree=t=>{this.to(-33,{type:"duyet",id:t,agree:!1}),this.await()};boxPTMenberXinAgree=t=>{console.log(t),this.to(-33,{type:"duyet",id:t,agree:!0}),this.await()};outBangHoi=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));return i?i.right>=2?this.chipi("Chủ bang không thể rời bang hội"):void this.ptMsgBox("Bạn có muốn rời khỏi bang hội này không ?",(()=>{this.to(-33,{type:"out"}),this.await()})):this.indexNoJoinPT()};banghoiphongphoAction=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));return i?i.right<1?this.chipi("Bạn không có quyền thay đổi phòng phó"):t.right>=2?this.chipi("Bạn không thể phong cho chủ bang"):(this.to(-33,{type:"phongpho",id:t.id}),void this.await()):this.indexNoJoinPT()};PT_Ha_Chuc_Action=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));return i?i.right<2?this.chipi("Bạn không có quyền hạ chức"):t.right>=2?this.chipi("Bạn không thể hạ chức chủ bang"):0==t.right?this.chipi("Người này đã là thành viên rồi"):(this.to(-33,{type:"hachuc",id:t.id}),void this.await()):this.indexNoJoinPT()};PT_Nhuong_Bang=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));return i?i.right<2?this.chipi("Bạn không có quyền nhường bang"):t.right>=2?this.chipi("Bạn không thể nhường cho chủ bang"):void this.ptMsgBox("Bạn có chắc muốn nhường bang chủ cho người này không ?",(()=>{this.to(-33,{type:"nhuongbang",id:t.id}),this.await()})):this.indexNoJoinPT()};PT_Kick_action=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));return i?i.right<1?this.chipi("Bạn không có quyền kick"):i.right<=t.right?this.chipi("Bạn không có quyền kick người này"):t.id==this.my.id?this.chipi("Bạn không thể kick chính mình"):void this.ptMsgBox("Bạn có chắc chắn muốn đuổi "+t.name+" ra khỏi bang không ?",(()=>{this.to(-33,{type:"kick",id:t.id}),this.await()})):this.indexNoJoinPT()};PT_Moi_Vao_Bang=t=>{let i=this.banghoi.menber.find((t=>t.id==this.my.id));if(!i)return this.indexNoJoinPT();if(i.right<1)return this.chipi("Bạn không có quyền mời");if(this.banghoi.menber.length>=this.banghoi.info.max)return this.chipi("Bang hội đã đủ thành viên");let e=this.Charset.find((i=>i.id==t));return e?e.skin.bangID>0?this.chipi("Người chơi đã có bang hội rồi"):void this.to(-33,{type:"moi",id:t,action:"send"}):this.chipi("Người chơi đã rời khỏi bản đồ rồi")};PT_Loi_Moi_Vao_bang=(t,i)=>{this.ptMsgBox(t+" muốn mời bạn vào bang ?",(()=>{this.to(-33,{type:"moi",bang:i,action:"accept"}),this.await()}),(()=>{this.to(-33,{type:"moi",bang:i,action:"not_accept"}),this.await()}))}}class it extends tt{constructor(){super()}coverTime=t=>{let i=new Date(t),e=i.getDate(),h=i.getMonth()+1,n=i.getFullYear();return i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+" "+e+"/"+h+"/"+n};previewMenberOffcial=(t,i)=>{let e=0,h=t.getBounds();this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let n=new PIXI.Graphics;this.boxPreviewItem.addChild(n);let a=.4*this.gameWidth;a<350&&(a=350),a>this.gameWidth&&(a=1*this.gameWidth);let o=.15*this.gameHeight;o<85&&(o=85),n.mwidth=a,n.mheight=o,n.beginFill(16711422,1),n.drawRoundedRect(0,0,n.mwidth,n.mheight,5),n.endFill(),n.x=10;let s=this.createSprite(i.skin.ao,i.skin.quan,i.skin.dau);s.x=.05*n.mwidth,s.y=.05*n.mheight,n.addChild(s),e+=s.height+s.y;let d,l=this.html('<font color="532905" style="align:right;">'+i.name+"</font>");l.x=n.mwidth-l.width-.05*n.mwidth,l.y=.05*n.mheight,n.addChild(l),e+=l.height,d=2==i.right?this.html('<font color="red">Bang chủ</font>'):1==i.right?this.html('<font color="green">Phó bang</font>'):this.html('<font color="black">Thành viên</font>'),d.x=n.mwidth-d.width-.05*n.mwidth,d.y=l.y+l.height,n.addChild(d),e+=d.height;let r=this.html('<font color="637dfe">Sức mạnh: '+this.intToM(i.sucmanh)+"</font>");r.x=n.mwidth-r.width-.05*n.mwidth,r.y=d.y+d.height,n.addChild(r),e+=r.height;let g=new PIXI.Graphics;g.beginFill(0,.5),g.drawRect(0,0,.8*n.mwidth,1),g.endFill(),g.y=s.height+.1*s.height,g.x=n.mwidth/2-g.width/2,n.addChild(g),e+=g.height;let c=this.html('<font color="83c629">Cho đậu: '+i.chodau+"</font>");c.x=n.mwidth/2-c.width/2,c.y=g.y+g.height+10,n.addChild(c),e+=c.height+10;let m=this.html('<font color="83c629">Nhận đậu: '+i.nhandau+"</font>");m.x=n.mwidth/2-m.width/2,m.y=c.y+c.height,n.addChild(m);let u=this.html('<font color="black">Ngày gia nhập: '+this.coverTime(i.time)+"</font>");u.x=n.mwidth/2-u.width/2,u.y=m.y+m.height,n.addChild(u),n.mwidth=n.mwidth<a?a:n.mwidth,e=e<o?o:e,n.clear(),n.lineStyle(1,0,1),n.beginFill(16777215,1),n.drawRoundedRect(0,0,n.mwidth,e,10),n.endFill();let y=new PIXI.Container;this.boxPreviewItem.addChild(y);let w=0,f=this.banghoi.menber.find((t=>t.id==this.my.id));f=f?f.right:0;let p=this;[{name:"Phong phó",function:"banghoiphongphoAction",right:1,rightLow:0},{name:"Hạ chức",function:"PT_Ha_Chuc_Action",right:2,rightLow:1},{name:"Đuổi",function:"PT_Kick_action",right:1,rightLow:1},{name:"Nhường",function:"PT_Nhuong_Bang",right:2,rightLow:1},{name:"Đóng",right:0,rightLow:3}].forEach(((t,e)=>{if(f>=t.right&&i.right<=t.rightLow&&(this.my.id!=i.id||"Đóng"==t.name)){let e=new PIXI.Graphics;e.name="since04",e.lineStyle(1,0,1),e.beginFill(14061362,1),e.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),e.endFill(),e.interactive=!0;let h=this.html('<font color="532905">'+t.name+"</font>");h.x=(e.getBounds().width-h.width)/2,h.y=(e.getBounds().height-h.height)/2,e.addChild(h),e.x=w,w+=e.getBounds().width+3,y.addChild(e),console.log("have"),e.on("pointerdown",(()=>{t.function&&this[t.function](i),this.boxPreviewItem.removeChildren()})),e.on("pointerover",(()=>{e.clear(),e.lineStyle(1,0,1),e.beginFill(4832866,1),e.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),e.endFill()})),e.on("pointerout",(()=>{e.clear(),e.lineStyle(1,0,1),e.beginFill(14061362,1),e.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),e.endFill()}))}})),n.y=h.y-n.getBounds().height+h.height,n.y+n.getBounds().height+y.getBounds().height>this.gameHeight&&(n.y=this.gameHeight-n.getBounds().height-10-y.getBounds().height),n.y<0&&(n.y=10),y.x=(n.getBounds().width-y.getBounds().width)/2,y.y=n.getBounds().height+n.getBounds().y;let x=0;"Enter"==this.pcKey&&(this.pcKey="1");let b=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(b),!1;let t=y.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(x-=1,x<0&&(x=t.length-1)):"ArrowRight"===i&&(x+=1,x>=t.length&&(x=0)),("ArrowUp"===i||"ArrowDown"===i)&&p.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[x],e=p.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[x]&&p.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[x].width,e=t[x].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[x].addChild(h);let n=t[x],a=p.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class et extends it{constructor(){super()}boxPTMenber=()=>{let t=this.my;if(t.skin.bangID<=0)return this.indexNoJoinPT();this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText(this.banghoi.name,18,"Arial",16777215,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText("Thành tích: "+this.intToM(this.banghoi.info.sucmanh),15,"Arial",16711168,!1,e.width,e.height);o.y=a.height,n.addChild(o);let s=this.snowlyText("Cấp độ: "+this.banghoi.info.level,15,"Arial",16711168,!1,e.width,e.height);s.y=a.height+o.height,n.addChild(s);let d=this.snowlyText("Thành viên: "+this.banghoi.menber.length+"/"+this.banghoi.info.max,15,"Arial",16711168,!1,e.width,e.height);d.y=a.height+o.height+s.height,n.addChild(d),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2,e.addChild(n);let l=this.boxBaseMenu(e,"banghoi",this.profileMenu),r=this.boxBaseBody(i,e,l);i.addChild(r);let g=this.boxBaseMask(r,i),c=r.width,m=.15*e.width;m=m>50?50:m;let u=[{name:"Chat\nBang",function:"boxNewBangHoi"},{name:"Thành\nviên",function:"boxPTMenber"},{name:"Xin vào"+(this.banghoi.xinvao.length>=1?"("+this.banghoi.xinvao.length+")":""),function:"boxPTMenberXin",right:"1",type:">="},{name:"Rời",function:"outBangHoi",right:1,type:"<"},{name:"Biểu tượng",function:"boxPTShopBieuTuong",right:2,type:">="}],y=this.banghoi.menber.find((i=>i.id==t.id)).right,w=new PIXI.Container;g.addChild(w);let f=0;u.forEach(((t,i)=>{if(">="==t.type&&y<t.right)return;if("<"==t.type&&y>t.right)return;let e=new PIXI.Container;e.name="since04KEY";let h=.25*c,n=new PIXI.Graphics;n.beginFill(15657958,1),n.drawRect(0,0,h,m),n.endFill(),e.addChild(n),n.x=h*f+1*f;let a=this.html('<font color="555555">'+t.name+"</font>");a.x=n.width/2-a.width/2,a.y=m/2-a.height/2,n.addChild(a),w.addChild(e),e.interactive=!0,e.on("pointerdown",(()=>{this[t.function]()})),f++})),w.x=c/2-w.width/2;let p=new PIXI.Graphics;p.beginFill(0,.3),p.drawRect(0,0,c,1),p.endFill(),p.y=m+.1*m,g.addChild(p);let x=new PIXI.Graphics;x.beginFill(15130321,1),x.drawRect(0,0,c,m),x.endFill(),x.y=p.y+p.height+.1*m,g.addChild(x);let b=this.html('<font color="532905">Danh sách thành viên</font>');b.x=x.width/2-b.width/2,b.y=m/2-b.height/2,x.addChild(b);let I=this.banghoi;this.banghoi.menber.sort(((t,i)=>i.sucmanh-t.sucmanh)),I.menber.forEach(((t,i)=>{let e=new PIXI.Graphics;e.beginFill(15657958,1),e.drawRect(0,0,c,m),e.endFill(),e.y=x.y+x.height+m*i+.1*m*i;let h=new PIXI.Graphics;if(h.beginFill(9927509,1),h.drawRect(0,0,.15*c,.99*e.height),h.endFill(),e.addChild(h),t.avatar){let i=this.snowlyImg(t.avatar);i.width=.9*h.width,i.height=i.width,i.x=h.width/2-i.width/2,i.y=h.height/2-i.height/2,h.addChild(i)}let n=this.html('<font color="'+(2==t.right?"red":1==t.right?"blue":"black")+'">'+t.name+"</font>");n.x=h.x+h.width+.05*h.width,n.y=.2*e.height,e.addChild(n);let a=this.html('<font color="0080fe">Sức mạnh: '+this.intToM(t.sucmanh)+"</font>");a.x=h.x+h.width+.05*h.width,a.y=e.height-a.height-.1*e.height,e.addChild(a),e.interactive=!0;let o=0;e.on("pointerdown",(()=>{o=Date.now()})),e.on("pointerup",(()=>{if(Date.now()-o<200)return this.previewMenberOffcial(e,t)})),e.name="since04KEY",g.addChild(e)})),this.snowlySroll(r,g);let C=this.boxBaseFoot(e,i);i.addChild(e,l,C)}}class ht extends et{constructor(){super()}previewPTChat=(t,i)=>{let e=0,h=t.getBounds();this.boxPreviewItem.removeChildren(),this.boxPreviewItem.visible=!0;let n=new PIXI.Graphics;this.boxPreviewItem.addChild(n);let a=.4*this.gameWidth;a<350&&(a=350),a>this.gameWidth&&(a=1*this.gameWidth);let o=.15*this.gameHeight;o<85&&(o=85),n.mwidth=a,n.mheight=o,n.beginFill(16711422,1),n.drawRoundedRect(0,0,n.mwidth,n.mheight,5),n.endFill(),n.x=10;let s=this.createSprite(i.skin.ao,i.skin.quan,i.skin.dau);s.x=.05*n.mwidth,s.y=.05*n.mheight,n.addChild(s),e+=s.height+s.y;let d,l=this.html('<font color="532905" style="align:right;">'+i.name+"</font>");l.x=n.mwidth-l.width-.05*n.mwidth,l.y=.05*n.mheight,n.addChild(l),e+=l.height;let r=this.banghoi.menber.find((t=>t.id==i.uid));d=this.html('<font color="black">Thành viên</font>'),r&&(d=2==r.right?this.html('<font color="red">Bang chủ</font>'):1==r.right?this.html('<font color="green">Phó bang</font>'):this.html('<font color="black">Thành viên</font>')),d.x=n.mwidth-d.width-.05*n.mwidth,d.y=l.y+l.height,n.addChild(d),e+=d.height;let g=this.html('<font color="637dfe">Sức mạnh: '+this.intToM(i.sucmanh)+"</font>");g.x=n.mwidth-g.width-.05*n.mwidth,g.y=d.y+d.height,n.addChild(g),e+=g.height;let c=new PIXI.Graphics;c.beginFill(0,.5),c.drawRect(0,0,.8*n.mwidth,1),c.endFill(),c.y=s.height+.1*s.height,c.x=n.mwidth/2-c.width/2,n.addChild(c),e+=c.height;let m=new PIXI.Text(i.text,{fontFamily:"Arial",fontSize:14,fill:0,fontWrap:!0,WrapWidth:.8*c.width});m.style.fontWeight="bold",m.resolution=2,m.style.fontWrap=!0,m.style.wordWrap=!0,m.style.wordWrapWidth=.8*c.width,m.style.wordWrapHeight=.8*c.height,m.x=c.x+c.width/2-m.width/2,m.y=c.y+c.height+10,n.addChild(m),e+=m.height,n.mwidth=n.mwidth<a?a:n.mwidth,e=e<o?o:e,n.clear(),n.lineStyle(1,0,1),n.beginFill(16777215,1),n.drawRoundedRect(0,0,n.mwidth,e,10),n.endFill();let u=new PIXI.Container;this.boxPreviewItem.addChild(u);let y=new PIXI.Graphics;y.name="since04",y.lineStyle(1,0,1),y.beginFill(14061362,1),y.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),y.endFill(),y.interactive=!0,y.buttonMode=!0;let w=this;y.on("pointerdown",(()=>{})),y.on("pointerover",(()=>{y.clear(),y.lineStyle(1,0,1),y.beginFill(4832866,1),y.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),y.endFill()})),y.on("pointerout",(()=>{y.clear(),y.lineStyle(1,0,1),y.beginFill(14061362,1),y.drawRoundedRect(0,0,.2*n.mwidth,.2*n.mwidth,10),y.endFill()}));let f=new PIXI.Text("Đóng",{fontFamily:"Arial",fontSize:16,fill:5449989,fontWrap:!0,align:"center",WrapWidth:y.getBounds().width,WrapHeight:y.getBounds().height});f.style.fontWeight="bold",f.style.fontSize=.25*h.height,f.resolution=2,f.x=(y.getBounds().width-f.getBounds().width)/2,f.y=(y.getBounds().height-f.getBounds().height)/2,y.addChild(f),u.addChild(y),n.y=h.y-n.getBounds().height+h.height,n.y+n.getBounds().height+u.getBounds().height>this.gameHeight&&(n.y=this.gameHeight-n.getBounds().height-10-u.getBounds().height),n.y<0&&(n.y=10),u.x=(n.getBounds().width-u.getBounds().width)/2,u.y=n.getBounds().height+n.getBounds().y;let p=0;"Enter"==this.pcKey&&(this.pcKey="1");let x=setInterval((()=>{if(this.boxPreviewItem.children.length<=0)return clearInterval(x),!1;let t=u.children.filter((t=>"since04"==t.name)),i=this.pcKey;if("ArrowLeft"===i?(p-=1,p<0&&(p=t.length-1)):"ArrowRight"===i&&(p+=1,p>=t.length&&(p=0)),("ArrowUp"===i||"ArrowDown"===i)&&w.boxPreviewItem.removeChildren(),"Enter"===i){let i=t[p],e=w.getAllInteractiveChildren(i);e.length>0&&(e[0].emit("pointerdown"),e[0].emit("pointerup"),this.boxPreviewItem.removeChildren())}if(t[p]&&w.pcKey.length>=1){for(let i=0;i<t.length;i++)t[i].removeChild(t[i].getChildByName("xanhle"));let i=t[p].width,e=t[p].height,h=new PIXI.Graphics;h.lineStyle(0,0,1),h.beginFill(16318026,.5),h.drawRoundedRect(0,0,i,e,0),h.endFill(),h.name="xanhle",t[p].addChild(h);let n=t[p],a=w.getAllInteractiveChildren(n);a.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{a[0].emit("pointerdown"),this.boxPreviewItem.removeChildren()})),h.on("pointerup",(()=>{a[0].emit("pointerup"),this.boxPreviewItem.removeChildren()})))}this.pcKey=""}),this.app.ticker.deltaMS)}}class nt extends ht{constructor(){super()}viewMenberGuest=t=>{this.closeBox();let i=this.boxBaseBackground();this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText("Chưa vào bang",18,"Arial",16777215,!1,e.width,e.height);n.addChild(a),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2,e.addChild(n);let o=this.boxBaseMenu(e,"banghoi",this.profileMenu),s=this.boxBaseBody(i,e,o);i.addChild(s);let d=this.boxBaseMask(s,i),l=s.width,r=.15*e.width;r=r>50?50:r,this.my;let g=new PIXI.Container;d.addChild(g),[{name:"Tìm bang",function:"boxFindPT"},{name:"Tạo bang",function:"createPTViewBox"}].forEach(((t,i)=>{let e=new PIXI.Container;e.name="since04KEY";let h=.25*l,n=new PIXI.Graphics;n.beginFill(15657958,1),n.drawRect(0,0,h,r),n.endFill(),e.addChild(n),n.x=h*i+10*i;let a=this.html('<font color="555555">'+t.name+"</font>");a.x=n.width/2-a.width/2,a.y=r/2-a.height/2,n.addChild(a),g.addChild(e),e.interactive=!0,e.on("pointerdown",(()=>{this[t.function]()}))})),g.x=l/2-g.width/2;let c=new PIXI.Graphics;c.beginFill(0,.3),c.drawRect(0,0,l,1),c.endFill(),c.y=r+.1*r,d.addChild(c);let m=new PIXI.Graphics;m.beginFill(15130321,1),m.drawRect(0,0,l,r),m.endFill(),m.y=c.y+c.height+.1*r,d.addChild(m);let u=this.html('<font color="532905">Thành viên: '+t.name+"</font>");u.x=m.width/2-u.width/2,u.y=r/2-u.height/2,m.addChild(u),m.interactive=!0,m.on("pointerdown",(()=>{this.to(-33,{type:"random",name:""})})),t.menber.forEach(((t,i)=>{let e=new PIXI.Graphics;e.beginFill(15657958,1),e.drawRect(0,0,l,r),e.endFill(),e.y=m.y+m.height+r*i+.1*r*i;let h=new PIXI.Graphics;if(h.beginFill(9927509,1),h.drawRect(0,0,.15*l,.99*e.height),h.endFill(),e.addChild(h),t.avatar){let i=this.snowlyImg(t.avatar);i.width=.9*h.width,i.height=i.width,i.x=h.width/2-i.width/2,i.y=h.height/2-i.height/2,h.addChild(i)}let n=this.html('<font color="'+(2==t.right?"red":1==t.right?"blue":"black")+'">'+t.name+"</font>");n.x=h.x+h.width+.05*h.width,n.y=.2*e.height,e.addChild(n);let a=this.html('<font color="0080fe">Sức mạnh: '+this.intToM(t.sucmanh)+"</font>");a.x=h.x+h.width+.05*h.width,a.y=e.height-a.height-.1*e.height,e.addChild(a),e.interactive=!0;let o=0;e.on("pointerdown",(()=>{o=Date.now()})),e.on("pointerup",(()=>{if(Date.now()-o<200)return this.previewMenberPTGuest(e,t)})),e.name="since04KEY",d.addChild(e)})),this.snowlySroll(s,d);let y=this.boxBaseFoot(e,i);i.addChild(e,o,y)}}class at extends nt{constructor(){super()}indexNoJoinPT=()=>{this.banghoi.random.length<=0&&this.to(-33,{type:"random",name:""}),this.closeBox();let t=this.boxBaseBackground();this.box.addChild(t);let i=this.boxBaseHead(t),e=this.snowlyImg(this.my.info.coban.avatar);e.width=.25*i.width,e.height=.99*i.height>e.width?e.width:.99*i.height,e.x=.01*i.width,e.y=.99*i.height-e.height,i.addChild(e);let h=new PIXI.Container,n=this.snowlyText("Chưa vào bang",18,"Arial",16777215,!1,i.width,i.height);h.addChild(n),h.x=e.x+e.width+.05*e.width,h.y=i.height/2-h.height/2,i.addChild(h);let a=this.boxBaseMenu(i,"banghoi",this.profileMenu),o=this.boxBaseBody(t,i,a);t.addChild(o);let s=this.boxBaseMask(o,t),d=o.width,l=.15*i.width;l=l>50?50:l,this.my;let r=new PIXI.Container;s.addChild(r),[{name:"Tìm bang",function:"boxFindPT"},{name:"Tạo bang",function:"createPTViewBox"}].forEach(((t,i)=>{let e=new PIXI.Container;e.name="since04KEY";let h=.25*d,n=new PIXI.Graphics;n.beginFill(15657958,1),n.drawRect(0,0,h,l),n.endFill(),e.addChild(n),n.x=h*i+10*i;let a=this.html('<font color="555555">'+t.name+"</font>");a.x=n.width/2-a.width/2,a.y=l/2-a.height/2,n.addChild(a),r.addChild(e),e.interactive=!0,e.on("pointerdown",(()=>{this[t.function]()}))})),r.x=d/2-r.width/2;let g=new PIXI.Graphics;g.beginFill(0,.3),g.drawRect(0,0,d,1),g.endFill(),g.y=l+.1*l,s.addChild(g);let c=new PIXI.Graphics;c.beginFill(15130321,1),c.drawRect(0,0,d,l),c.endFill(),c.y=g.y+g.height+.1*l,s.addChild(c);let m=this.html('<font color="532905">Danh sách bang</font>');m.x=c.width/2-m.width/2,m.y=l/2-m.height/2,c.addChild(m),c.interactive=!0,c.on("pointerdown",(()=>{this.to(-33,{type:"random",name:""})})),this.banghoi.random.forEach(((t,i)=>{let e=new PIXI.Graphics;e.beginFill(15657958,1),e.drawRect(0,0,d,l),e.endFill(),e.y=c.y+c.height+l*i+.1*l*i;let h=new PIXI.Graphics;h.beginFill(9927509,1),h.drawRect(0,0,.15*d,.99*e.height),h.endFill(),e.addChild(h);let n=this.base_co.find((i=>i.id==t.info.icon));if(n){let t=this.snowlyImg(n.src[0]);t.width=.9*h.width,t.height=t.width,t.x=h.width/2-t.width/2,t.y=h.height/2-t.height/2,h.addChild(t)}let a=this.html('<font color="005325">'+t.name+"</font>");a.x=h.x+h.width+.05*h.width,a.y=.2*e.height,e.addChild(a);let o=this.html('<font color="0080fe">'+t.info.desc+"</font>");o.x=h.x+h.width+.05*h.width,o.y=e.height-o.height-.2*e.height,e.addChild(o),e.interactive=!0;let r=0;e.on("pointerdown",(()=>{r=Date.now()})),e.on("pointerup",(()=>{if(Date.now()-r<200)return this.previewPT(e,t.id)})),e.name="since04KEY",s.addChild(e)})),this.snowlySroll(o,s);let u=this.boxBaseFoot(i,t);t.addChild(i,a,u)}}class ot extends at{constructor(){super()}sendChatPT(t,i){this.bodyChat.visible=!1,this.bodyChat.removeChildren(),t&&t.length>=1&&this.to(-33,{type:"chat",value:t})}oepnChatPTView(){this.bodyChat.children.length>0||this.my.id<=0||this.my.skin.bangID<=0||this.chatCreatePT()}chatCreatePT(){this.bodyChat.visible=!0,this.bodyChat.removeChildren();let t=.9*this.gameWidth,i=.5*this.gameHeight;t=t>500?500:t,i=i>150?150:i;let e=new PIXI.Graphics;e.beginFill(16704710,1),e.lineStyle(3,7096832,1),e.drawRoundedRect(0,0,t,i,10),e.endFill(),e.x=0,e.y=0,this.bodyChat.addChild(e);let h=new PIXI.Text("Chat bang:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});h.x=10,h.y=.3*e.height-h.height,e.addChild(h);let n=new PIXI.TextInput({input:{fontSize:"9px",padding:"12px",color:"#7a1125"},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});n.width=.9*t,n.height=.4*i,n.x=(t-.9*t)/2,n.y=.7*e.height-n.height/2,e.addChild(n),setTimeout((()=>{n.focus()}),100);let a=new PIXI.Container,o=new PIXI.Graphics;o.beginFill(15040059,1),o.lineStyle(3,6953766,1),o.drawRoundedRect(0,0,.2*t,.3*i,10),o.endFill(),o.x=0,o.y=0,a.addChild(o);let s=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});s.x=o.width/2-s.width/2,s.y=o.height/2-s.height/2,o.addChild(s),o.interactive=!0,o.buttonMode=!0,o.on("pointerdown",(()=>{this.sendChatPT(n.text),n.blur(),n.text=""})),n.on("keydown",(t=>{13==t&&(this.sendChatPT(n.text),n.blur(),n.text="")}));let d=new PIXI.Graphics;d.beginFill(15040059,1),d.lineStyle(3,6953766,1),d.drawRoundedRect(0,0,.2*t,.3*i,10),d.endFill(),d.x=s.x+s.width+d.width/2,d.y=0,a.addChild(d);let l=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),e.addChild(a),a.x=t/2-a.width/2,a.y=.95*e.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=.9*this.gameHeight-this.bodyChat.height}}class st extends ot{constructor(){super(),this.banghoi={name:"",info:{},menber:[],random:[],tinnhan:0}}timeAgo=t=>{let i=Date.now()-t,e=Math.floor(i/1e3);if(e<60)return e+" giây trước";let h=Math.floor(e/60);if(h<60)return h+" phút trước";let n=Math.floor(h/60);if(n<24)return n+" giờ trước";let a=Math.floor(n/24);if(a<30)return a+" ngày trước";let o=Math.floor(a/30);return o<12?o+" tháng trước":Math.floor(o/12)+" năm trước"};boxNewBangHoi=()=>{let t=this.my;if(this.banghoi.tinnhan=0,t.skin.bangID<=0)return this.indexNoJoinPT();this.closeBox();let i=this.boxBaseBackground();i.name="banghoi_open",this.box.addChild(i);let e=this.boxBaseHead(i),h=this.snowlyImg(this.my.info.coban.avatar);h.width=.25*e.width,h.height=.99*e.height>h.width?h.width:.99*e.height,h.x=.01*e.width,h.y=.99*e.height-h.height,e.addChild(h);let n=new PIXI.Container,a=this.snowlyText(this.banghoi.name,18,"Arial",16777215,!1,e.width,e.height);n.addChild(a);let o=this.snowlyText("Thành tích: "+this.intToM(this.banghoi.info.sucmanh),15,"Arial",16711168,!1,e.width,e.height);o.y=a.height,n.addChild(o);let s=this.snowlyText("Cấp độ: "+this.banghoi.info.level,15,"Arial",16711168,!1,e.width,e.height);s.y=a.height+o.height,n.addChild(s);let d=this.snowlyText("Thành viên: "+this.banghoi.menber.length+"/"+this.banghoi.info.max,15,"Arial",16711168,!1,e.width,e.height);d.y=a.height+o.height+s.height,n.addChild(d),n.x=h.x+h.width+.05*h.width,n.y=e.height/2-n.height/2,e.addChild(n);let l=this.boxBaseMenu(e,"banghoi",this.profileMenu),r=this.boxBaseBody(i,e,l);i.addChild(r);let g=this.boxBaseMask(r,i),c=r.width,m=.15*e.width;m=m>50?50:m;let u=[{name:"Chat\nBang",function:"oepnChatPTView"},{name:"Thành\nviên"+(this.banghoi.xinvao.length>=1?"("+this.banghoi.xinvao.length+")":""),function:"boxPTMenber"}],y=new PIXI.Container;g.addChild(y),u.forEach(((t,i)=>{let e=new PIXI.Container;e.name="since04KEY";let h=.25*c,n=new PIXI.Graphics;n.beginFill(15657958,1),n.drawRect(0,0,h,m),n.endFill(),e.addChild(n),n.x=h*i+1*i;let a=this.html('<font color="555555">'+t.name+"</font>");a.x=n.width/2-a.width/2,a.y=m/2-a.height/2,n.addChild(a),y.addChild(e),e.interactive=!0,e.on("pointerdown",(()=>{this[t.function]()}))})),y.x=c/2-y.width/2;let w=new PIXI.Graphics;w.beginFill(0,.3),w.drawRect(0,0,c,1),w.endFill(),w.y=m+.1*m,g.addChild(w);let f=new PIXI.Graphics;f.beginFill(15130321,1),f.drawRect(0,0,c,m),f.endFill(),f.y=w.y+w.height+.1*m,g.addChild(f);let p=this.html('<font color="532905">Tin nhắn</font>');p.x=f.width/2-p.width/2,p.y=m/2-p.height/2,f.addChild(p),this.banghoi.chat.sort(((t,i)=>i.time-t.time)),this.banghoi.chat.forEach(((t,i)=>{let e=new PIXI.Graphics;e.beginFill(15657958,1),e.drawRect(0,0,.98*c,m),e.endFill(),e.y=f.y+f.height+m*i+.1*m*i;let h="black",n=this.banghoi.menber.find((i=>i.id==t.uid));n&&(2==n.right&&(h="red"),1==n.right&&(h="green"));let a=this.html('<font color="'+h+'" style="font-size:16px">'+t.name+"</font>");a.x=.01*e.width,a.y=.1*m,e.addChild(a);let o=this.html('<font color="black" style="font-size:14px">'+this.timeAgo(t.time)+"</font>");o.x=e.width-o.width-.01*e.width,o.y=.1*m,e.addChild(o);let s=t.text.replace(/(<([^>]+)>)/gi,""),d=this.html('<font color="black" style="font-size:14px">'+s+"</font>");d.x=.01*e.width,d.y=a.y+a.height+.1*m,e.addChild(d),e.interactive=!0;let l=0;e.on("pointerdown",(()=>{l=Date.now()})),e.on("pointerup",(()=>{if(Date.now()-l<200)return this.previewPTChat(e,t)})),e.name="since04KEY",e.x=c/2-e.width/2,g.addChild(e)})),this.snowlySroll(r,g);let x=this.boxBaseFoot(e,i);i.addChild(e,l,x)}}class dt extends st{constructor(){super()}html=t=>new PIXI.HTMLText(t,{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"});outInput=t=>{t.blur()};await=(t="Xin chờ...")=>this.notice(this._(t),!1);input=()=>new PIXI.TextInput({input:{fontSize:"16px",padding:"12px",color:"#7a1125"},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});sendCreatePT=(t,i)=>{if(t.length<=3||t.length>=20)return void this.notice("Tên bang phải từ 3 đến 20 ký tự");if(-1==i)return void this.notice("Bạn chưa chọn biểu tượng");let e=this.my,h=this.base_co.find((t=>t.id==i));e.tien[1==h.type?"vang":"zeni"]<h.cost?this.notice("Bạn không đủ "+(1==h.type?"vàng":"ngọc xanh")+" để tạo bang"):(this.await(),this.to(-33,{type:"create",name:t,iconID:i}))};createPTViewBox=(t="",i=-1)=>{this.closeBox();let e=this.boxBaseBackground();this.box.addChild(e);let h=this.boxBaseHead(e),n=this.snowlyImg(this.my.info.coban.avatar);n.width=.25*h.width,n.height=.99*h.height>n.width?n.width:.99*h.height,n.x=.01*h.width,n.y=.99*h.height-n.height,h.addChild(n);let a=new PIXI.Container,o=this.snowlyText(this.gameInfo.gameName+" "+this.gameInfo.version,18,"fontchinh",16777215,!1,h.width,h.height);a.addChild(o);let s=this.snowlyText("Nhân vật: "+this.my.name,16,"fontchinh",16776960,!1,h.width,h.height);s.y=o.height,a.addChild(s);let d=this.snowlyText("Tài khoản máy chủ: "+this.my.server+" sao",16,"fontchinh",16776960,!1,h.width,h.height);d.y=o.height+s.height,a.addChild(d);let l=this.snowlyText(""+this.my.username,16,"fontchinh",16776960,!1,h.width,h.height);l.y=o.height+s.height+d.height,a.addChild(l),h.addChild(a),a.x=n.x+n.width+.05*n.width,a.y=h.height/2-a.height/2;let r=this.boxBaseMenuTXT(h,"Tạo bang hội"),g=this.boxBaseBody(e,h,r);e.addChild(g);let c=this.boxBaseMask(g,e),m=g.width,u=.15*h.width;u=u>50?50:u,this.my;let y=this.html('\n            <center><font color="005325"><b>Tên bang hội:</b></font></center>\n        ');c.addChild(y);let w=this.input();w.text=t,w.x=g.width/2-w.width/2,w.y=y.y+y.height+5,w.width=.5*e.width,w.height=u,c.addChild(w),w.name="since04KEY",w.on("keydown",(i=>{t=w.text}));let f=this.html('\n\n            <center><font color="005325"><b>Biểu tượng:</b></font></center>\n        ');f.x=y.x,f.y=w.y+w.height+5,c.addChild(f),this.base_co.forEach(((e,h)=>{let n=new PIXI.Container;n.name="since04KEY";let a=new PIXI.Graphics;a.beginFill(e.id==i?7019816:0,.5),a.lineStyle(1,0,.5),a.drawRoundedRect(0,0,m,u,0),a.endFill(),n.addChild(a);let o=new PIXI.Graphics;o.beginFill(0,.5),o.lineStyle(1,0,.5),o.drawRoundedRect(0,0,u,u,0),o.endFill();let s=this.snowlyImg(e.src[0]);s.width=.9*u,s.height=.9*u,s.x=.05*u,s.y=.05*u,o.addChild(s),n.addChild(o);let d=this.html(`\n                <center><font color="blue"><b>${e.name}</b></font></center>\n            `);d.x=o.x+o.width+5,d.y=.2*u,n.addChild(d);let l=this.html(`\n                <center><font color="eec385"><b>${this.number_format(e.cost)}</b></font> ${1==e.type?'<font color="yellow">Vàng</font>':'<font color="005325">Ngọc xanh</font>'} </center>\n            `);l.x=d.x,l.y=u-l.height,n.addChild(l),n.y=f.y+f.height+5+u*h,n.interactive=!0;let r=0;n.on("pointerdown",(()=>{r=Date.now()})),n.on("pointerup",(()=>{Date.now()-r>200||(this.chipi("Đã chọn biểu tượng "+e.name),this.createPTViewBox(t,e.id))})),c.addChild(n)}));let p=new PIXI.Graphics;p.beginFill(7019816,1),p.lineStyle(1,0,1),p.drawRoundedRect(0,0,.4*m,u,10),p.endFill(),p.x=g.width/2-p.width/2,p.y=f.y+f.height+5+u*this.base_co.length+5,c.addChild(p);let x=this.html('\n            <center><font color="ffffff"><b>Tạo bang</b></font></center>\n        ');x.x=p.x+p.width/2-x.width/2,x.y=p.y+p.height/2-x.height/2,c.addChild(x),p.interactive=!0,p.on("pointerdown",(()=>{this.outInput(w),this.sendCreatePT(t,i)})),this.snowlySroll(g,c);let b=this.boxBaseFoot(h,e);e.addChild(h,r,b)}}const lt=class extends dt{constructor(){super()}chatSubmit(t){for(let t=0;t<this.logChat.length;t++)this.logChat[t].uid==this.my.id&&(this.logChat[t].type="delete");this.logChat.push({id:Date.now(),uid:this.my.id,text:t,type:"chat"})}sendChat(t,i){this.bodyChat.visible=!1,this.bodyChat.removeChildren(),t&&t.length>=1&&(this.send(-8,t),this.chatSubmit(t))}openChat(){if(!(this.bodyChat.children.length>0||this.my.id<=0))return 1!=this.checkKey()&&void this.chatCreate()}chatCreate(){this.bodyChat.visible=!0,this.bodyChat.removeChildren();let t=.9*this.gameWidth,i=.5*this.gameHeight;t=t>500?500:t,i=i>150?150:i;let e=new PIXI.Graphics;e.beginFill(16704710,1),e.lineStyle(3,7096832,1),e.drawRoundedRect(0,0,t,i,10),e.endFill(),e.x=0,e.y=0,this.bodyChat.addChild(e);let h=new PIXI.Text("Chat:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});h.x=10,h.y=.3*e.height-h.height,e.addChild(h);let n=new PIXI.TextInput({input:{fontSize:"16px",padding:"12px",color:"#7a1125",width:.9*t,height:.3*e.height},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});n.x=(t-.9*t)/2,n.y=.7*e.height-n.height/2,e.addChild(n),setTimeout((()=>{n.focus()}),100);let a=new PIXI.Container,o=new PIXI.Graphics;o.beginFill(15040059,1),o.lineStyle(3,6953766,1),o.drawRoundedRect(0,0,.2*t,.3*i,10),o.endFill(),o.x=0,o.y=0,a.addChild(o);let s=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});s.x=o.width/2-s.width/2,s.y=o.height/2-s.height/2,o.addChild(s),o.interactive=!0,o.buttonMode=!0,o.on("pointerdown",(()=>{this.sendChat(n.text),n.blur(),n.text=""})),n.on("keydown",(t=>{13==t&&(this.sendChat(n.text),n.blur(),n.text="")}));let d=new PIXI.Graphics;d.beginFill(15040059,1),d.lineStyle(3,6953766,1),d.drawRoundedRect(0,0,.2*t,.3*i,10),d.endFill(),d.x=s.x+s.width+d.width/2,d.y=0,a.addChild(d);let l=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});l.x=d.width/2-l.width/2,l.y=d.height/2-l.height/2,d.addChild(l),d.interactive=!0,d.buttonMode=!0,d.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),e.addChild(a),a.x=t/2-a.width/2,a.y=.95*e.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=.9*this.gameHeight-this.bodyChat.height}},rt=class extends lt{constructor(){super()}useDauThan(){if(this.my.id<=0)return;let t=this.my;t.used.dauthan<=Date.now()&&(this.bg_dauthan_circle.height=0,t.used.dauthan=Date.now()+t.used.dauthan_time)}},gt=class extends rt{constructor(){super(),this.timeDeTuAttack=0,this.mucTieuDeTu=null}khoangCach=(t,i)=>{let e=t==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t),h=i==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(i);if(!e)return!1;if(!h)return!1;let n=Math.abs(e.x-h.x^e.y-h.y+2^2);return this.thapPhan(n/48,2)};khoangCach2=(t,i)=>{let e=t==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t),h=i==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(i);if(!e)return!1;if(!h)return!1;let n=Math.abs(Math.abs(e.x)-Math.abs(h.x)^Math.abs(e.y)-Math.abs(h.y)+2^2);return this.thapPhan(n/48,2)};TimKiemMucTieu(t){let i=-1,e=this.nguoichoi.getChildByName(t.id);if(!e)return!1;this.khungThongTinDoiThu.visible=!1,this.Charset.forEach((t=>{let h=Math.abs(e.x-t.pos.x^e.y-t.pos.y+2^2);h<400&&(-1==i||h<i)&&"mob"==t.type&&(i=h,this.mucTieuDeTu=t.id)}))}AttackDeTu=()=>{let t=this.my;if(t.id<=0)return!1;if(!t.detu.id)return!1;if(t.detu.hp<=0)return!1;if(this.timeDeTuAttack>Date.now())return!1;this.timeDeTuAttack=Date.now()+500;let i=t.detu;if("venha"==i.info.trangthai)return!1;if("ditheo"==i.info.trangthai)return!1;if(i.info.chiso.hp<=0)return this.ioInsertChat({_1:i.id,_2:this._("Sư phụ ơi cho con đậu thần với.")}),this.timeDeTuAttack=Date.now()+5e3;if(i.info.uutien=i.info.uutien||[],null==this.mucTieuDeTu&&i.info.uutien.length<=0)return this.TimKiemMucTieu(i);let e=i,h=this.Charset;if(this.mucTieuDeTu){let t=i.skill.filter((t=>t.time<Date.now()));if("baove"==i.info.trangthai){const i=[];for(let h=0;h<t.length;h++){let n=t[h],a=this.skill_active.find((t=>t.id==n.id));a&&a.dx&&1*this.khoangCach(e.id,this.mucTieuDeTu)>1*a.dx&&i.push(h)}for(let e=i.length-1;e>=0;e--)t.splice(i[e],1)}if(t.length<=0)return!1;let n=Math.floor(Math.random()*t.length),a=this.mucTieuDeTu,o=null;if(0!=this.mucTieuDeTu&&this.mucTieuDeTu!=e.id&&null!=this.mucTieuDeTu&&null!=this.mucTieuDeTu&&-1!=this.mucTieuDeTu&&(o=h.find((t=>t.id==this.mucTieuDeTu)),!o))return this.mucTieuDeTu=null;let s=e.skill.find((i=>i.id==t[n].id));if(!s)return this.bug("không tìm thấy kĩ năng");if(s.time>Date.now())return this.bug("Chưa hồi xong");let d=s.id,l=s.level,r=this.usedSkill(d);if(r){if(!this.mucTieuDeTu&&"attack"==r.type)return this.bug("tấn công ko có mục"),this.mucTieuDeTu=null;if(r.need&&1==r.need&&"buff"==r.type){if(!o)return this.danger("Chưa có mục tiêu.");if(r.to&&"player"==r.to&&"mob"==o.type)return this.danger("Mục tiêu không hợp lệ.")}let t=0;if(1==r.kit&&(t=r.ki[l]),2==r.kit&&(t=e.info.chiso.kiFull/100*r.ki[l]),e.info.chiso.ki<t)return this.danger("Không đủ KI để thực hiện");r.script,r.delay[l],r.eff[l],r.effdelay[l],s.time=Date.now()+r.time[l]/2*1e3,s.lasttime=Date.now();let i=1;return i=o&&"mob"==o.type?1:i,i=o&&"player"==o.type?2:i,"attack"==r.type?this.to(-5,{_1:d,_2:a,_3:i,_4:e.id}):this.to(-7,{_1:d,_2:a,_3:i,_4:e.id}),!1}}}},ct=class extends gt{constructor(){super()}reposiveSkillEff(t){if(!t.type)return!1;switch(t.type){case"masenko":this.addEff({type:"hoakhi_kame",keyid:t.keyid,by:t.from,aim:t.to});break;case"thhs":this.addEff({type:"nhapnhay",keyid:t.keyid,from:t.from}),this.addEff({type:"tdhseff",keyid:t.keyid,from:t.from});break;case"dicuu":this.addEff({type:"dicuu",keyid:t.keyid,from:t.from});break;case"duoccuu":this.addEff({type:"chung",keyid:t.keyid,aim:t.from,src:this.createArray(1,28),folder:"other/buff",width:250,height:250});break;default:this.addEff({type:t.type,keyid:t.keyid,from:t.from})}}reposiveAttack(t){let i,e=t.from,h=t.victim,n=t.id,a=t.level,o=this.usedSkill(n),s=o.script,d=o.delay[a],l=o.eff[a],r=o.effdelay[a],g=t.detu,c=this.my;if(this.Charset,this.NhanVat,5==t.id)return this.addEff({type:"qckknew",level:1,from:e,to:h,name:"quacauKenhKi",keyid:t.keyid,detu:g}),!1;if(4==t.id)return setTimeout((()=>{l.forEach((i=>{this.addEff({name:i,level:1,aim:h,keyid:t.keyid,type:o.ob,by:e,detu:g})}))}),d),!1;if(1==t.id||15==t.id||16==t.id){if(i=e==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(e),!i)return!1;let n=this.getMy(e);return n.eff&&n.eff.hoakhi&&1==n.eff.hoakhi.active?this.addEff({type:"hoakhi_dondam",keyid:t.keyid,by:e,aim:h}):this.addEff({level:a,startX:i.x,startY:i.y,aim:h,type:o.ob,by:e,keyid:t.keyid,detu:g}),!1}if(2==t.id||6==t.id||7==t.id){let n=this.getMy(e);if(n.eff&&n.eff.hoakhi&&1==n.eff.hoakhi.active)return this.addEff({type:"hoakhi_kame",keyid:t.keyid,by:e,aim:h}),!1;if(i=e==c.id?this.NhanVat:this.nguoichoi.getChildByName(e),!i)return!1;s.forEach((t=>{this.addAction({id:e,action:t})})),r.forEach((t=>{this.addEff({name:t,level:1,type:t,aim:e})})),setTimeout((()=>{l.forEach((n=>{this.addEff({name:n,level:1,startX:i.x,startY:i.y,aim:h,type:o.ob,by:e,action:"keepKame",keyid:t.keyid,detu:g})}))}),d)}}numberAttack(t){if(this.checkKey())return!1;if(this.my.id<=0)return!1;let i=this.SkillDataOnScreen,e=-1;if(49==t&&(e=0),50==t&&(e=1),51==t&&(e=2),52==t&&(e=3),53==t&&(e=4),97==t&&(e=0),98==t&&(e=1),99==t&&(e=2),100==t&&(e=3),101==t&&(e=4),this.setting.oskill==e)return this.interAttack();-1!=this.setting.oskill&&(i.background[this.setting.oskill].tint=16777215),i.background[e].tint=2937176,this.setting.oskill=e}distance(t,i,e,h){let n=t-e,a=i-h;return Math.sqrt(n*n+a*a)}interAttack(){if(this.checkKey())return!1;if(this.my.id<=0)return!1;if(this.choang())return!1;if(this.my.info.chiso.hp<=0)return this.boxMenuHoiSinh();let t=this.my,i=this.Charset,e=this.setting,h=this.keysPressed,n=e.mouse,a=null;if(0!=e.mouse&&e.mouse!=t.id&&null!=e.mouse&&null!=e.mouse&&-1!=e.mouse&&(a=i.find((t=>t.id==e.mouse))),a&&"item"==a.type)return this.ItemNhat(a.id);if(a&&"zone"==a.type)return this.joinChuyenMap(a.id);if(a&&"npc"==a.type)return this.talkWith(a.id);if(e.oskill<=-1)return this.bug("lỗi");if(t.oskill[e.oskill]<=0)return this.bug("không có lựa chọn");let o=t.skill.find((i=>i.id==t.oskill[e.oskill]));if(!o)return this.bug("không tìm thấy kĩ năng");if(o.time>Date.now())return this.bug("Chưa hồi xong");let s=o.id,d=o.level,l=this.usedSkill(s);if(l){if(l.dx&&l.dx>0&&a){let t=this.NhanVat,i=this.getNhanVat(a.id),e=this.calculateDistanceXandWidth(t,i);if(e>2*l.dx)return console.log("Quá xa",e),this.goto=!0,this.gotoDX=l.dx,!1}if(!e.mouse&&"attack"==l.type)return this.bug("tấn công ko có mục");if("attack"==l.type&&a&&a.info&&a.info.chiso&&a.info.chiso.hp<=0)return this.bug("mục tiêu đã chết");if(l.need&&1==l.need&&"buff"==l.type){if(!a)return this.danger("Chưa có mục tiêu.");if(l.to&&"player"==l.to&&"mob"==a.type)return this.danger("Mục tiêu không hợp lệ.")}let i=0;if(1==l.kit&&(i=l.ki[d]),2==l.kit&&(i=t.info.chiso.kiFull/100*l.ki[d]),t.info.chiso.ki<i)return this.danger("Không đủ KI để thực hiện");l.script,l.delay[d],l.eff[d],l.effdelay[d];let o=1;return o=a&&"mob"==a.type?1:o,o=a&&"player"==a.type?2:o,o=a&&"boss"==a.type?3:o,"attack"==l.type?this.to(-5,{_1:s,_2:n,_3:o}):this.to(-7,{_1:s,_2:n,_3:o}),h[13]=!1,!1}}reposiveAttackInfo(t){let i=t.fromID,e=t.toID,h=this.my,n=this.Charset;if(i!=h.id&&e!=h.id||(i==h.id&&(h.info.chiso.hp=t.from.hp,h.info.chiso.hpFull=t.from.hpFull,h.info.chiso.ki=t.from.ki,h.info.chiso.kiFull=t.from.kiFull,t.from.sucmanh&&(t.from.sucmanh-h.info.coban.sucmanh>0&&this.addEff({type:"congexp",to:h.id,value:Math.round(t.from.sucmanh-h.info.coban.sucmanh)}),h.info.coban.tiemnang=t.from.tiemnang,h.info.coban.sucmanh=t.from.sucmanh)),e==h.id&&(h.info.chiso.hp=t.to.hp,h.info.chiso.hpFull=t.to.hpFull,h.info.chiso.ki=t.to.ki,h.info.chiso.kiFull=t.to.kiFull,t.to.sucmanh&&(t.to.sucmanh-h.info.coban.sucmanh>0&&this.addEff({type:"congexp",to:h.id,value:Math.round(t.to.sucmanh-h.info.coban.sucmanh)}),h.info.coban.tiemnang=t.to.tiemnang))),i!=h.id||e!=h.id){let h=n.find((t=>t.id==i)),a=n.find((t=>t.id==e));this.my.detu&&this.my.detu.id&&(this.my.detu.id==i&&(this.my.detu.info.chiso.hp=t.from.hp,this.my.detu.info.chiso.hpFull=t.from.hpFull,this.my.detu.info.chiso.ki=t.from.ki,this.my.detu.info.chiso.kiFull=t.from.kiFull,t.from.sucmanh&&(this.my.detu.info.coban.sucmanh=t.from.sucmanh,this.my.detu.info.coban.tiemnang=t.from.tiemnang)),this.my.detu.id==e&&(this.my.detu.info.chiso.hp=t.to.hp,this.my.detu.info.chiso.hpFull=t.to.hpFull,this.my.detu.info.chiso.ki=t.to.ki,this.my.detu.info.chiso.kiFull=t.to.kiFull,t.to.sucmanh&&(this.my.detu.info.coban.sucmanh=t.to.sucmanh,this.my.detu.info.coban.tiemnang=t.to.tiemnang))),h&&(h.info.chiso.hp=t.from.hp,h.info.chiso.hpFull=t.from.hpFull,h.info.chiso.ki=t.from.ki,h.info.chiso.kiFull=t.from.kiFull,t.from.sucmanh&&(h.info.coban.sucmanh=t.from.sucmanh,h.info.coban.tiemnang=t.from.tiemnang)),a&&(a.info.chiso.hp=t.to.hp,a.info.chiso.hpFull=t.to.hpFull,a.info.chiso.ki=t.to.ki,a.info.chiso.kiFull=t.to.kiFull,t.to.sucmanh&&(a.info.coban.sucmanh=t.to.sucmanh,a.info.coban.tiemnang=t.to.tiemnang))}this.addEff({type:t.type,to:e,value:t.value})}},mt=class extends ct{constructor(){super()}clickPlayer(t){this.setting.mouse=t.id}randomAZ=function(t){let i="";for(let e=0;e<t;e++)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(26*Math.random()));return i};deleteEff=function(t){let i=this.dataSkill.findIndex((i=>i.id===t));-1!=i&&this.dataSkill.splice(i,1)};addEff=function(t){return t.id=null==t.id?this.randomAZ(10):t.id,t.type=null==t.type?"skill":t.type,this.dataSkill.find((i=>i.id===t.id))?void 0:(this.dataSkill.push(t),t.id)};bug(t){console.log(t)}addSkill=function(t,i,e,h,n,a="skill",o=null,s=0){return null==o&&(o=this.randomAZ(10)),this.dataSkill.find((t=>t.id===o))?void 0:(this.dataSkill.push({id:o,type:a,name:t,level:i,startX:e,startY:h,aim:n}),o)};tangHP(t,i){i=i||20;let e=0,h=0;for(;i!=h;)h+=20,e+=t/20+t;return Math.round(e)}tangSucDanh(t,i){i=i||1;let e=0,h=0;for(;i!=h;)h+=1,e+=t<1e3?t/10+t:100*(t/10+t);return Math.round(e)}tangchiMang(t){return 1e6*[50,5e3,25e3,5e4,125e3,3e5,4e5][t]||0}tangGiap(t,i){i=i||1;let e=0,h=0;for(;i!=h;)h+=1,e+=t<100?5e5*t/50+5e5:t<3e3?10*(5e5*t/50+5e5):100*(5e5*t/50+5e5);return e}intToM=t=>{if((t=(t=t||0).toString().replace(/[^0-9.]/g,""))<1e3)return t;let i,e=[{v:1e3,s:"K"},{v:1e6,s:"Tr"},{v:1e9,s:"Tỷ"},{v:1e12,s:"T"},{v:1e15,s:"P"},{v:1e18,s:"E"}];for(i=e.length-1;i>0&&!(t>=e[i].v);i--);return(t/e[i].v).toFixed(2).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+e[i].s};fontSize=(t,i)=>{let e=0;return e=i/(t.width/t.height),t.style.fontSize=e,t}},ut=class extends mt{constructor(){super()}hitTestRectangle2(t,i,e=0,h=0,n=!1){const a=t;if(!a)return!1;const o=i;return!!o&&(0!=e&&("right"==e&&(a.x+=h),"left"==e&&(a.x-=h),"up"==e&&(a.y-=h),"down"==e&&(a.y+=h)),a.x<o.x+o.width&&a.x+a.width>o.x&&a.y<o.y+o.height&&a.y+a.height>o.y)}hitTestRectangleDown(t,i,e=0,h=0,n=!1){const a=t.getBounds();if(!a)return!1;const o=i.getBounds();return o.x=o.x+o.width,!!o&&(0!=e&&("right"==e&&(a.x+=h),"left"==e&&(a.x-=h),"up"==e&&(a.y-=h),"down"==e&&(a.y+=h)),a.x<o.x+o.width&&a.x+a.width>o.x&&a.y<o.y+o.height&&a.y+a.height>o.y)}hitTestRectangle(t,i,e=0,h=0,n=!1){const a=t.getBounds();if(!a)return!1;const o=i.getBounds();return!!o&&(0!=e&&("right"==e&&(a.x+=h),"left"==e&&(a.x-=h),"up"==e&&(a.y-=h),"down"==e&&(a.y+=h)),a.x<o.x+o.width&&a.x+a.width>o.x&&a.y<o.y+o.height&&a.y+a.height>o.y)}calculateDistanceXandWidth(t,i){const e=t,h=i;let n=e.x,a=e.x+e.width,o=h.x,s=h.x+h.width,d=e.y,l=e.y+e.height,r=h.y,g=h.y+h.height,c=Math.max(n,o)-Math.min(a,s),m=Math.max(d,r)-Math.min(l,g);return Math.sqrt(c*c+m*m)}calculateDistance(t,i,e=0,h=0){const n=t,a=i;0!=e&&("right"==e&&(n.x+=h),"left"==e&&(n.x-=h),"up"==e&&(n.y-=h),"down"==e&&(n.y+=h));const o=a.x-n.x,s=a.y-n.y;return Math.sqrt(o*o+s*s)}checkCollisionX(t,i,e=0,h=0){const n=t.getBounds(),a=i.getBounds();return 0!=e&&("right"==e&&(n.x+=h),"left"==e&&(n.x-=h),"up"==e&&(n.y-=h),"down"==e&&(n.y+=h)),n.x<a.x+a.width&&n.x+n.width>a.x}calculateDistanceX(t,i,e=0,h=0){const n=t.getBounds(),a=i.getBounds();return 0!=e&&("right"==e&&(n.x+=h),"left"==e&&(n.x-=h),"up"==e&&(n.y-=h),"down"==e&&(n.y+=h)),Math.abs(a.x-n.x)}calculateDistanceY(t,i,e="",h=""){const n=t.getBounds(),a=i.getBounds();return 0!=e&&("right"==e&&(n.x+=h),"left"==e&&(n.x-=h),"up"==e&&(n.y-=h),"down"==e&&(n.y+=h)),Math.abs(a.y-n.y)}checkCollisionY(t,i,e="",h=""){const n=t.getBounds(),a=i.getBounds();return 0!=e&&("right"==e&&(n.x+=h),"left"==e&&(n.x-=h),"up"==e&&(n.y-=h),"down"==e&&(n.y+=h)),n.y<a.y+a.height&&n.y+n.height>a.y}},yt=class extends ut{constructor(){super(),this.SkillInSrcreen=new PIXI.Container,this.SkillInSrcreen.name="Lớp chứa skill trong game",this.inGame.addChild(this.SkillInSrcreen),this.createScientMsgDanger()}deleteNotice(){this.boxError.visible=!1,this.boxError.removeChildren()}notice(t,i=!0){this.boxError.visible=!0,this.boxError.removeChildren(),this.boxError.interactive=!0;let e=.9*this.gameWidth,h=.3*this.gameHeight;e=e>600?600:e;let n=new PIXI.Graphics;n.beginFill(15721922,1),n.lineStyle(3,9274459,1),n.drawRoundedRect(0,0,e,h,10),n.endFill(),n.x=0,n.y=0,this.boxError.addChild(n);let a=new PIXI.Text(t,{fontSize:16,fill:5449989,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:e-20});if(a.x=e/2-a.width/2,a.y=h/2-a.height/2,this.boxError.addChild(a),i){let t=new PIXI.Graphics;t.beginFill(14842938,1),t.lineStyle(3,7019816,1),t.drawRoundedRect(0,0,100,30,10),t.endFill(),t.x=e/2-t.width/2,t.y=h-t.height/2,this.boxError.addChild(t);let i=new PIXI.Text("OK",{fontSize:16,fill:5449989,fontFamily:"fontchinh",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:e-20});i.x=t.width/2-i.width/2,i.y=t.height/2-i.height/2,t.addChild(i),t.interactive=!0,t.buttonMode=!0,t.on("pointerdown",(()=>{this.boxError.removeChildren()}))}this.boxError.x=this.gameWidth/2-e/2,this.boxError.y=.5*this.gameHeight}createScientMsgDanger(){let t=new PIXI.Container;t.name="Box cảnh báo";let i=new PIXI.Graphics,e=.25*this.gameWidth,h=.08*this.gameHeight;i.beginFill(9927509,.8),i.lineStyle(1,11771523,1),i.drawRoundedRect(0,0,e,h,5),i.endFill(),t.addChild(i);let n=new PIXI.Container,a=new PIXI.Text("Đây là cảnh báo đặc biệt dành cho người anh em thiện lành nhé",{fontFamily:"fontchinh",fontSize:15,fill:"white",stroke:"#ff3300",strokeThickness:1,align:"center"}),o=new PIXI.Graphics;o.beginFill(0,1),o.drawRect(0,0,.8*e,.8*h),o.endFill(),o.x=.1*e,a.mask=o,a.x=o.x+10,n.addChild(a,o),n.x=0,n.y=h/2-a.height/2,i.addChild(n),t.x=.5*this.gameWidth-e/2,t.y=.7*this.gameHeight-h/2,t.time=0,t.visible=!1,this.dangerUser=t,this.noiDungDanger=a,this.maskNoiDungDanger=o,this.screen.addChild(t)}},wt=class extends yt{constructor(){super(),this.checkSpriteCreate=0}TaoSprite2=()=>{0==this.checkSpriteCreate&&(this.TaoSprite(),this.createDisplayOnPlayerInfo(),this.checkSpriteCreate=1),this.NhanVatGoc.removeChildren();let t=this.my,i=this.NhanVat;this.NhanVatGoc;for(let e=0;e<1;e++){let e=this.my;if(e.skin.theobo&&e.skin.theobo.length>=1){let t=this.images.find((t=>t.id==e.skin.theobo&&"ao"==t.type));t&&(e.skin.ao=t.name);let i=this.images.find((t=>t.id==e.skin.theobo&&"quan"==t.type));i&&(e.skin.quan=i.name);let h=this.images.find((t=>t.id==e.skin.theobo&&"dau"==t.type));h&&(e.skin.dau=h.name)}let h=this.getSkin(this.my.skin.quan),n=this.getSkin(this.my.skin.ao),a=this.getSkin(this.my.skin.dau),o=new PIXI.Sprite(this.coverImg(h.farm[0].dungyen.farme[0]));o.scale.set(h.farm[0].dungyen.width,h.farm[0].dungyen.height),o.sprite=0,o.name="quan222";let s=new PIXI.Sprite(this.coverImg(n.farm[0].dungyen.farme[0]));s.sprite=0,s.name="ao222",s.scale.set(n.farm[0].dungyen.width,n.farm[0].dungyen.height);let d=new PIXI.Sprite(this.coverImg(a.farm[0].dungyen.farme[0]));d.scale.set(a.farm[0].dungyen.width,a.farm[0].dungyen.height),d.sprite=0,d.name="dau222",d.x=a.farm[0].dungyen.x,o.x=h.farm[0].dungyen.x,s.x=n.farm[0].dungyen.x,s.load=0,d.y=Math.abs(this.getImg(t.skin.quan).farm[0].dungyen.y),s.y=Math.abs(this.getImg(t.skin.dau).farm[0].dungyen.y)-Math.abs(this.getImg(t.skin.ao).farm[0].dungyen.y),o.y=Math.abs(this.getImg(t.skin.dau).farm[0].dungyen.y),this.NhanVatGoc.x=this.my.pos.x,this.NhanVatGoc.y=this.my.pos.y,this.NhanVat&&(this.NhanVatGoc.x=this.NhanVat.x,this.NhanVatGoc.y=this.NhanVat.y),this.NhanVatGoc.move="right",this.NhanVatGoc.addChild(o,d,s),this.NhanVatGoc.scale.set(1.1,1.1),this.NhanVatGoc.x=i.x,this.NhanVatGoc.y=i.y,this.NhanVatGoc.visible=!1}this.NhanVat_phukien.children.filter((t=>"co"==t.name)).forEach((t=>{t.destroy()}))};TaoSprite=()=>{for(let t=0;t<1;t++){let t=this.my;if(t.skin.theobo&&t.skin.theobo.length>=1){let i=this.images.find((i=>i.id==t.skin.theobo&&"ao"==i.type));i&&(t.skin.ao=i.name);let e=this.images.find((i=>i.id==t.skin.theobo&&"quan"==i.type));e&&(t.skin.quan=e.name);let h=this.images.find((i=>i.id==t.skin.theobo&&"dau"==i.type));h&&(t.skin.dau=h.name)}let i=this.getSkin(this.my.skin.quan),e=this.getSkin(this.my.skin.ao),h=this.getSkin(this.my.skin.dau),n=new PIXI.Sprite(this.coverImg(i.farm[0].move.farme[0]));n.scale.set(i.farm[0].move.width,i.farm[0].move.height),n.sprite=0,n.name="quan";let a=new PIXI.Sprite(this.coverImg(e.farm[0].move.farme[0]));a.sprite=0,a.name="ao",a.scale.set(e.farm[0].move.width,e.farm[0].move.height);let o=new PIXI.Sprite(this.coverImg(h.farm[0].move.farme[0]));o.scale.set(h.farm[0].move.width,h.farm[0].move.height),o.sprite=0,o.name="dau",o.x=h.farm[0].move.x,o.y=h.farm[0].move.y,n.x=i.farm[0].move.x,n.y=i.farm[0].move.y,a.x=e.farm[0].move.x,a.y=e.farm[0].move.y,a.load=0,o.sety=0,o.setx=0,n.sety=0,n.setx=0,a.sety=0,a.setx=0,this.NhanVat.x=this.my.pos.x,this.NhanVat.y=this.my.pos.y,this.NhanVat.move="right",this.NhanVat.addChild(n,o,a),this.NhanVat.name="Nhân vật bản thân",this.NhanVat.scale.x=1,this.NhanVat.pivot.x=this.NhanVat.width,this.NhanVat.visible=!0,this.NhanVat.scale.x=-1,this.NhanVat.pivot.x=0,this.NhanVat.scale.x*=1.1,this.NhanVat.scale.y*=1.1}}};class ft extends wt{constructor(){super()}successLoadGame=()=>{this.inGame.visible=!0,this.loadGame.visible=!1,this.vaomap=1,this.snowlyKeoMap(),this.xulynamdat(this.my.id,!0)};checkCreateObjectOnMap=()=>this.xulyAssetOnMap();xulyAssetOnMap=()=>{let t=[];this.Charset.forEach((i=>{if(i.skin)for(let e in i.skin){let h=i.skin[e];if(!h)continue;let n=t.findIndex((t=>t==h));-1==n&&t.push(h)}}));let i=[];t.forEach((t=>{let e=this.getImg(t);if(e){let t=e.farm[0];if(t)for(let e in t){let h=t[e].farme;h&&h.forEach((t=>{let e=i.findIndex((i=>i==t));-1==e&&i.push(t)}))}}}));let e=0,h=this.loadGame.getChildByName("txtLoadgame"),n=t=>new Promise(((n,a)=>{if(h.visible=!0,PIXI.utils.TextureCache[t])return e++,n();this.load(t).then((t=>{let a=t.length/1024;a=Math.round(100*a)/100,e+=1,h.text="Đã tải "+e+"/"+(i.length-1)+" gói tài nguyên nhân vật... ",h.x=this.gameWidth/2-h.width/2,n()}))})),a=[];i.forEach((t=>{let i=this.getUrlImg(t);a.push(n(i))}));let o=Date.now();Promise.all(a).then((t=>(console.log("load Sprite ("+i.length+"): "+(Date.now()-o)+"ms"),h.visible=!1,this.successLoadGame())))}}const pt=class extends ft{constructor(){super(),this.spritePool={dat:[],hoa:[],cay:[],nuida:[],nuixa:[],nuixanua:[],bautroi:[],longdat:[],che:[]},this.srcDaLoad=[],this.objectMap={dat:[]}}returnSprite(t){this.spritePool[t.type].push(t),t.visible=!1}taoKhung(t){return t}spri(t){let i=this.taoKhung;if("lacay2"==t.name||"lacay3"==t.name||"lacay4"==t.name||"lacay5"==t.name||"lacay6"==t.name){let e=new PIXI.Sprite(PIXI.utils.TextureCache[t.name]),h=4,n=0,a=e.height/h,o=[];for(let t=0;t<h;t++)o.push(new PIXI.Texture(e.texture,new PIXI.Rectangle(0,n,e.width,a))),n+=a;let s=new PIXI.AnimatedSprite(o);return s.animationSpeed=.1,s.play(),s.x=t.x,s.src=t.name,s.y=t.y,s.ygoc=t.y,s.xgoc=t.x,s.name=t.name,s.autofollow=!0,s.width=e.width,s.height=e.height/h,s.type=t.type,s.coppy=0,s.time=0,s.css=1,s=i(s),s}if("ImgEffect_6"==t.name){let e=new PIXI.Sprite(PIXI.utils.TextureCache[t.name]);arrayFrame=[new PIXI.Texture(e.texture,new PIXI.Rectangle(0,0,88,82)),new PIXI.Texture(e.texture,new PIXI.Rectangle(96,0,85,82)),new PIXI.Texture(e.texture,new PIXI.Rectangle(180,0,82,82)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,80,83,79)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,80,83,79)),new PIXI.Texture(e.texture,new PIXI.Rectangle(86,81,85,77)),new PIXI.Texture(e.texture,new PIXI.Rectangle(174,80,86,79))];let h=new PIXI.AnimatedSprite(arrayFrame);return h.animationSpeed=.15,h.play(),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.src=t.name,h.name=t.name,h.width=h.width,h.height=h.height,h.type=t.type,h.coppy=0,h.css=1,h.scal=!0,h=i(h),h}if("ImgEffect_8"==t.name){let e=new PIXI.Sprite(PIXI.utils.TextureCache[t.name]),h=new PIXI.Container,n=new PIXI.Sprite(new PIXI.Texture(e.texture,new PIXI.Rectangle(190,0,93,57)));h.addChild(n),h.x=app.screen.width-h.width,h.y=app.screen.height/2;let a=new PIXI.AnimatedSprite([new PIXI.Texture(e.texture,new PIXI.Rectangle(1,43,53,56)),new PIXI.Texture(e.texture,new PIXI.Rectangle(56,44,58,53))]);return a.x=n.x+a.width/2-2,a.y=n.y-n.height/2-a.height/2+5,a.animationSpeed=.15,a.play(),h.addChild(a),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.name=t.name,h.src=t.name,h.width=h.width,h.height=h.height,h.type=t.type,h.coppy=0,h.css=1,h.scal=!0,h=i(h),h}if("ImgEffect_1"==t.name){let e=new PIXI.Sprite(PIXI.utils.TextureCache[t.name]),h=new PIXI.Container,n=new PIXI.AnimatedSprite([new PIXI.Texture(e.texture,new PIXI.Rectangle(0,93,73,55)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,40,64,53)),new PIXI.Texture(e.texture,new PIXI.Rectangle(1,0,71,40))]);return n.animationSpeed=.15,n.play(),h.addChild(n),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.name=t.name,h.src=t.name,h.width=h.width,h.height=h.height,h.type=t.type,h.coppy=0,h.css=1,h.scal=!0,h=i(h),h}if("ImgEffect_10"==t.name){let e=new PIXI.Sprite(PIXI.utils.TextureCache[t.name]),h=new PIXI.Container,n=new PIXI.AnimatedSprite([new PIXI.Texture(e.texture,new PIXI.Rectangle(28,0,44,44)),new PIXI.Texture(e.texture,new PIXI.Rectangle(72,0,40,43)),new PIXI.Texture(e.texture,new PIXI.Rectangle(112,1,39,43)),new PIXI.Texture(e.texture,new PIXI.Rectangle(151,1,42,42)),new PIXI.Texture(e.texture,new PIXI.Rectangle(193,0,42,43)),new PIXI.Texture(e.texture,new PIXI.Rectangle(235,0,40,44)),new PIXI.Texture(e.texture,new PIXI.Rectangle(276,0,40,44)),new PIXI.Texture(e.texture,new PIXI.Rectangle(315,0,41,42)),new PIXI.Texture(e.texture,new PIXI.Rectangle(356,0,44,43)),new PIXI.Texture(e.texture,new PIXI.Rectangle(399,0,42,44))]);return n.animationSpeed=.15,n.play(),h.addChild(n),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.name=t.name,h.src=t.name,h.width=h.width,h.height=h.height,h.type=t.type,h.coppy=0,h.css=1,h.scal=!0,h=i(h),h}if("x2wtf"==t.name||"x2twtf"==t.name){let e=new PIXI.Sprite(this.coverImgMap(t.name)),h=new PIXI.Container,n=new PIXI.AnimatedSprite([new PIXI.Texture(e.texture,new PIXI.Rectangle(0,0,96,96)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,48,96,96)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,96,96,96)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,144,96,96))]);return n.animationSpeed=.15,n.play(),h.addChild(n),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.name=t.name,h.src=t.name,h.width=48,h.height=48,h.type=t.type,h.coppy=0,h.css=1,h=i(h),h}if("x2wts"==t.name||"x2wtsN"==t.name||"x2wtsN2"==t.name){let e=new PIXI.Sprite(this.coverImgMap(t.name)),h=new PIXI.Container,n=new PIXI.AnimatedSprite([new PIXI.Texture(e.texture,new PIXI.Rectangle(0,0,96,98)),new PIXI.Texture(e.texture,new PIXI.Rectangle(0,98,96,98))]);return n.animationSpeed=.1,n.play(),h.addChild(n),h.x=t.x,h.y=t.y,h.ygoc=t.y,h.xgoc=t.x,h.name=t.name,h.src=t.name,h.width=48,h.height=48,h.type=t.type,h.coppy=0,h.css=1,h=i(h),h}return t}releaseSprite(t){this.spritePool[t.type].push(t),t.visible=!1}getSprite(t,i){let e;return this.spritePool[t].length>0?(e=this.spritePool[t].pop(),e.texture=i,e.visible=!0):(e=new PIXI.Sprite(i),e.resolution=2,e.type=t),e.release=function(){releaseSprite(this)},e}DeleteMap(){this.bando.removeChildren(),this.bando_nuida.removeChildren(),this.bando_nuixa.removeChildren(),this.bando_nuixanua.removeChildren(),this.bando_bautroi.removeChildren(),this.bando_che.removeChildren(),this.bando_hieuung.removeChildren(),this.bando_suongmu.removeChildren(),this.spritePool.dat=[],this.spritePool.hoa=[],this.spritePool.cay=[],this.spritePool.nuida=[],this.spritePool.nuixa=[],this.spritePool.nuixanua=[],this.spritePool.bautroi=[],this.spritePool.longdat=[],this.spritePool.che=[];for(let t in this.objectMap)this.objectMap[t]=[]}loadMap=function(t=!1){this.DeleteMap();let i=this.cacheMap,e=this.my,h=this.gameMap,n=this.NhanVat,a=this.NhanVatGoc,o=i.split("!");for(let t=0;t<o.length;t++){let i=o[t];if(i.length>=1){let t={},e=i.split("^");t.name=e[0],t.type=e[1];let n=e[2].split(",");t.x=+n[0],t.y=+n[1],t.width=+n[2],t.height=+n[3];let a=this.getSprite(t.type,this.coverImgMap(t.name));a.x=t.x,a.y=t.y,a.width=t.width,a.height=t.height,a.name=t.name,h.setting.maxY<t.y&&(h.setting.maxY=t.y,h.size.idMaxY=t.height),h.setting.minY>t.y&&("nuida"==a.type||"nuixa"==a.type||"nuixanua"==a.type||"bautroi"==a.type||(h.setting.minY=t.y-t.height,h.size.idMinY=t.height)),h.setting.maxX<t.x&&("dat"==a.type||"che"==a.type)&&(h.setting.maxX=t.x,h.size.idMaxX=t.width),h.setting.minX>t.x&&(h.setting.minX=t.x,h.size.idMinX=t.width),a=this.spri(a),-1==n[4]&&(a.scale.x=-1),a.src=t.name,a.scal&&(a.pivot.x=a.width),"nuida"==a.type?this.bando_nuida.addChild(a):"nuixa"==a.type?this.bando_nuixa.addChild(a):"nuixanua"==a.type?(this.nen.y=a.y,this.bando_nuixanua.addChild(a)):"bautroi"==a.type?this.bando_bautroi.addChild(a):"che"==a.type?this.bando_che.addChild(a):(a.type,this.bando.addChild(a))}t==o.length-1&&this.checkCreateObjectOnMap()}try{h.setting.maxY+=h.size.idMaxY/2,h.setting.minX-=h.size.idMinX,h.setting.maxX+=h.size.idMaxX}catch(t){console.log(t)}h.setting.minX=0,e.id>=1&&(n.x=e.pos.x,n.y=e.pos.y,a.x=e.pos.x,a.y=e.pos.y),this.nen.width=this.container.width,this.nen.height=this.container.height,this.bando_nuida.children.forEach((t=>{t.y=0})),this.bando_nuixa.children.forEach((t=>{t.y=0})),this.bando_nuixanua.children.forEach((t=>{t.y=0})),this.bando_bautroi.children.forEach((t=>{t.y=0}));let s=h.setting.minX,d=h.setting.maxX,l=this.bando_che.children.find((t=>"suongmu"==t.name));if(l){let t=l.getBounds().width,i=l.getBounds().height,e=Math.ceil((d-s)/t)+3,h=l.name;for(let n=0;n<e;n++){let e=this.getSprite("che",this.coverImgMap(h));e.x=s+t*n,e.y=l.y,e.width=t,e.height=i,e.name=h,this.bando_suongmu.addChild(e),this.bando_suongmu.minx=-1*e.width}this.bando_che.children.forEach((t=>{"suongmu"==t.name&&t.destroy()}))}let r=0,g=0;if(this.gameHeight,this.bando_nuida.children.length>=1){let t=this.bando_nuida.children[0].getBounds().width,i=this.bando_nuida.children[0].getBounds().height;h.setting.minY-=i/2;let e=Math.ceil((d-s)/t),n=this.bando_nuida.children[0].name;this.bando_nuida.removeChildren();for(let h=0;h<e;h++){let e=this.getSprite("nuida",this.coverImgMap(n));e.x=s+t*h,e.y=0,e.width=t,e.height=i,e.name=n,e=this.spri(e),this.bando_nuida.addChild(e),r=e.height,g=e.width}let a=0,o=0;if(this.bando_nuixa.children.length>=1){let t=this.bando_nuixa.children[0].getBounds().width,i=this.bando_nuixa.children[0].getBounds().height;i=i>r?.6*r:i,t=t>g?.6*g:t,h.setting.minY-=i/2;let e=Math.ceil((d-s)/t),n=this.bando_nuixa.children[0].name;this.bando_nuixa.removeChildren();for(let h=0;h<e;h++){let e=this.getSprite("nuixa",this.coverImgMap(n));e.x=s+t*h,e.y=0,e.width=t,e.height=i,e.name=n,e=this.spri(e),this.bando_nuixa.addChild(e),a=e.height,o=e.width}}let l=0,c=0;if(this.bando_nuixanua.children.length>=1){let t=this.bando_nuixanua.children[0].getBounds().width,i=this.bando_nuixanua.children[0].getBounds().height;i=i>r?.8*r:i,t=t>g?.8*g:t,h.setting.minY-=i/2;let e=Math.ceil((d-s)/t),n=this.bando_nuixanua.children[0].name;this.bando_nuixanua.removeChildren();for(let h=0;h<e;h++){let e=this.getSprite("nuixanua",this.coverImgMap(n));e.x=s+t*h,e.y=0,e.width=t,e.height=i,e.name=n,e=this.spri(e),this.bando_nuixanua.addChild(e),l=e.width,c=e.height}}if(this.bando_bautroi.children.length>=1){let t=this.bando_bautroi.children[0].getBounds().width,i=this.bando_bautroi.children[0].getBounds().height;t=t>l?1*l:t,i=i>c?1*c:i,h.setting.minY-=i/2;let e=Math.ceil((d-s)/t),n=this.bando_bautroi.children[0].name;this.bando_bautroi.removeChildren();for(let h=0;h<e;h++){let e=this.getSprite("bautroi",this.coverImgMap(n));e.x=s+t*h,e.y=0,e.width=t,e.height=i,e.name=n,e=this.spri(e),this.bando_bautroi.addChild(e)}}}};LoadAssetPlayer(){let t=Object.create(this.my);[t.skin.ao,t.skin.quan,t.skin.dau].forEach((async t=>{let i=this.images.find((i=>i.name==t));if(null!=i){let t=i.farm[0];if(t)for(let i in t)t[i].farme.forEach((async t=>{await PIXI.Sprite.from(this.coverImg(t))})),this.createSkillOnDisplay(),this.TaoSprite2()}})),this.joinMap(t.pos.map)}joinMap=t=>{this.inGame.visible=!1,this.loadGame.visible=!0,this.to(-17,t)};joinChuyenMap=t=>{this.notice(this._("Xin chờ..."),!1),this.to(-18,t)};LoadAssetMap=async function(){this.inGame.visible=!1,this.loadGame.visible=!0,this.gameMap={setting:{maxY:0,minY:0,maxX:0,minX:0},size:{idMaxX:0,idMaxY:0,idMinX:0,idMinY:0}};let t=this.cacheMap.split("!"),i=[];for(let e=0;e<t.length;e++){let h=t[e];if(h.length>=1){let t={},e=h.split("^");t.name=e[0],t.type=e[1];let n=e[2].split(",");t.x=+n[0],t.y=+n[1],t.width=+n[2],t.height=+n[3];let a=this.assets.find((i=>i.name==t.name));if(!a)return!1;if(i.find((i=>i==t.name)))continue;let o=this.srcDaLoad.find((i=>i==t.name));if(o)continue;this.srcDaLoad.push(t.name),i.push(t.name)}}let e=0,h=this.loadGame.getChildByName("txtLoadgame"),n=t=>new Promise(((n,a)=>{if(PIXI.utils.TextureCache[t])return e+=1,n();h.visible=!0,PIXI.Assets.load(t).then((t=>{e+=1,h.text="Đã tải "+e+"/"+(i.length-1)+" gói tài nguyên bản đồ... ",h.x=this.gameWidth/2-h.width/2,n()}))})),a=[];for(let t=0;t<i.length;t++){let e=this.assets.find((e=>e.name==i[t])),h=e.url;a.push(n(h))}let o=Date.now();Promise.all(a).then((t=>(console.log("loadMap ("+i.length+") packages: "+(Date.now()-o)+"ms"),h.visible=!1,this.loadMap())))}};class xt extends pt{constructor(){super()}loadSuccessAll=()=>{this.CreateMainGuestGame();let t=this.loadGame.getChildByName("txt2"),i=this.loadGame.getChildByName("txtLoadgame");t&&i&&(t.visible=!1,i.visible=!1)};loadAssetMapPreview=()=>{let t=0,i=[],e=this.loadGame.getChildByName("txt2"),h=this.loadGame.getChildByName("txtLoadgame"),n=0,a=setInterval((()=>{0==n&&(e.text="Loading."),1==n&&(e.text="Loading.."),2==n&&(e.text="Loading..."),n++,3==n&&(n=0),e.x=this.gameWidth/2-e.width/2,e.visible=!0}),500),o=()=>{if(t>=i.length)return clearInterval(a),this.loadSuccessAll();let e=i[t].url,n=PIXI.Assets.load(e);h.visible=!0,n.then((e=>{t+=1,h.text="Đã tải "+t+"/"+(i.length-1)+" gói tài nguyên bản đồ... ",h.x=this.gameWidth/2-h.width/2,o()}))};h.visible=!0,h.text="Đang tải gói tài nguyên bản đồ...",h.x=this.gameWidth/2-h.width/2,o()};runPromiseAsset=(t,i,e=0)=>{if(this.srcSheetPixi.length==e)return i.visible=!1,this.loadAssetMapPreview(),!1;let h=this.srcSheetPixi[e],n=PIXI.Assets.load("./assets/sheet/"+h+".json");i.visible=!0,i.text="Đang tải gói "+h+" "+Math.floor(e/t*100)+"%",i.x=this.gameWidth/2-i.width/2;let a,o=0;i.hello=i.hello||0,0==i.hello?(i.hello=1,a=new PIXI.Text("Loading...",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"}),a.x=this.gameWidth/2-a.width/2,a.y=i.y+i.height+20,a.name="txt2",this.loadGame.addChild(a)):a=this.loadGame.getChildByName("txt2");let s=setInterval((()=>{0==o&&(a.text="Loading."),1==o&&(a.text="Loading.."),2==o&&(a.text="Loading..."),o++,3==o&&(o=0),a.x=this.gameWidth/2-a.width/2}),500);n.then((n=>{this.assetPixi++,i.text="Tải "+h+" thành công. "+Math.floor(e/(t-1)*100)+"%,... loading...",i.x=this.gameWidth/2-i.width/2,e+=1,clearInterval(s),this.runPromiseAsset(t,i,e)}))}}class bt extends xt{constructor(){super()}packageCombo=(t,i)=>{let e=["combo","baseCombo","npc","baseSkill","mob","quan","dau","ao","caitrang","map/caycoi","map/eff","map/khac","map/dat","map/nhacua","map/trangtri","map/khac2","map/khac3"],h=i=>new Promise(((h,n)=>{let a=i;i="./assets/package/"+i+".json?v="+this.gameInfo.version,t.text="Đang tải gói cơ bản: "+a,t.x=this.gameWidth/2-t.width/2;let o=new XMLHttpRequest;o.open("GET",i,!0),o.onload=()=>{if(4==o.readyState&&200==o.status){let t=JSON.parse(o.responseText);"combo"==a?this.spriteComBo=t:"baseSkill"==a?this.skill=t:"baseCombo"==a?this.base_combo=t:"map/caycoi"==a||"map/eff"==a||"map/khac"==a||"map/dat"==a||"map/nhacua"==a||"map/trangtri"==a||"map/khac2"==a||"map/khac3"==a?t.forEach((t=>{this.assets.push({name:t,url:"./assets/"+a+"/"+t+".png"})})):this.images=this.images.concat(t),h()}else n(),alert("Can not load package:"+e[0]+". Please reload page or contact admin in forum.")},o.send()})),n=[];for(let t=0;t<e.length;t++)n.push(h(e[t]));let a=Date.now();Promise.all(n).then((()=>{console.log("loading package ("+e.length+") time: "+(Date.now()-a)+"ms"),this.CreateFontLogin(),clearInterval(i)}))}}class It extends bt{constructor(){super()}WarningViewController=()=>{this.loadGame.removeChildren();let t=new PIXI.Graphics;this.loadGame.addChild(t),t.beginFill(0,1),t.lineStyle(0,5704481,1),t.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),t.endFill(),t.interactive=!0;let i=new PIXI.HTMLText('<big><center><font color="red">WARNING !!!:</font></center></big>  <br>\n            Trò chơi được viết hoàn toàn độc lập, không sử dụng bất kì client/server của tổ chức hay cá nhân nào ! <br>\n            Trò chơi là dự án của sinh viên ngành CNTT, không có mục đích thương mại.<br>\n            Trò chơi là mã nguồn mở, được chia sẻ tới mọi người với mục đích học tập, tìm hiểu cấu trúc trò chơi. <br>\n            Nạp thẻ có chức năng duy trì máy chủ, dự án. <Br>\n        <br>',{fontSize:16,fill:16777215,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:this.gameWidth-20,fontWeight:"bold",align:"center"});i.x=(this.gameWidth-i.width)/2,i.y=(this.gameHeight-i.height)/2,t.addChild(i),console.log("");let e=new PIXI.Text(this._("Click để tiếp tục"),{fontSize:20,fill:16777215,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:this.gameWidth-20,fontWeight:"bold",align:"center"});e.x=(this.gameWidth-e.width)/2,e.y=i.y+i.height+20,t.addChild(e),TweenMax.to(e,1,{alpha:0,repeat:-1,yoyo:!0,ease:Power0.easeNone,speed:10,delay:.1}),t.interactive=!0,t.on("pointerdown",(()=>{this.ObjectCreatePageLoading()}))}}const Ct=class extends It{constructor(){super()}openURL=(t=!1)=>{if(!t)return this.notice("Chưa có địa chỉ nhấn");window.cordova?window.open(t,"_system","location=yes"):window.open(t,"_blank")};LoadFont=t=>{let i=new PIXI.Text("",{fontFamily:t,fontSize:40,fill:16777215,fontWeight:"bold",align:"center"});return i.x=0,i.y=this.gameHeight/2-i.height/2,i};createGameConfig=()=>{this.loadGame.removeChildren();let t=new PIXI.Graphics;this.loadGame.addChild(t),t.beginFill(0,1),t.lineStyle(0,5704481,1),t.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),t.endFill(),t.interactive=!0;let i=new PIXI.Text("Đang tải cấu hình cơ bản...",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold",align:"center"});i.x=this.gameWidth/2-i.width/2,i.y=this.gameHeight/2-i.height/2;let e=new PIXI.Text(".",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold",align:"center"});e.x=this.gameWidth/2-e.width/2,e.y=i.y+i.height,e.name="txt2",this.loadGame.addChild(i,e);let h=0,n=setInterval((()=>{0==h&&(e.text="."),1==h&&(e.text=".."),2==h&&(e.text="..."),h++,3==h&&(h=0)}),300),a=new XMLHttpRequest;a.open("GET","./config.json?date="+Date.now(),!0),a.send(),a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status){let t=JSON.parse(a.response);for(let i in t)console.log(i+" : "+t[i]);this.gameInfo.version=t.version,this.gameInfo.timeloadWelcome=t.time,this.gameInfo.server=t.server,this.gameInfo.gameName=t.name,this.gameInfo.name=t.nameDEV,this.gameInfo.debug=t.debug,1==this.gameInfo.debug?this.postionChar.visible=!0:this.postionChar.visible=!1,this.CallWebsocket(),this.handleData(),this.createObjectIO(),this.ioStart();let e=[];this.gameInfo.font=[];for(let i in t.font){let h="./assets/font/"+(t.font[i].length>=1?t.font[i]:i)+".ttf";this.gameInfo.font.push(i),e.push({name:i,url:h})}let h=()=>{let t=(t,i)=>new Promise(((e,h)=>{new FontFace(t,"url("+i+")").load().then((t=>{document.fonts.add(t),e()}))})),h=[],n=Date.now();for(let i in e)h.push(t(e[i].name,e[i].url));Promise.all(h).then((t=>{this.packageCombo(i,n),console.log("LoadFont ("+e.length+") packge : "+(Date.now()-n)+"ms")}))};h()}4==a.readyState&&200!=a.status&&(clearInterval(n),alert("Không thể đọc file dữ liệu của trò chơi"))}};CreateFontLogin=()=>{this.loadGame.removeChildren();let t=new PIXI.Graphics;this.loadGame.addChild(t),t.beginFill(0,1),t.lineStyle(0,5704481,1),t.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),t.endFill(),t.interactive=!0;let i=new PIXI.Container;this.loadGame.addChild(i),this.gameInfo.font,i.visible=!1;let e=new PIXI.Text(this.gameInfo.name,{fontFamily:"Itim-Regular",fontSize:50,fill:16777215,fontWeight:"bold",align:"center"}),h=.7*this.gameWidth;h=h>350?350:h,e=this.fontSize(e,h),e.x=0,e.y=this.gameHeight/2-e.height,this.loadGame.addChild(e);let n=this;1==this.gameInfo.debug?n.ObjectCreatePageLoading():TweenMax.fromTo(e.position,.5,{x:e.x},{x:this.gameWidth/2-e.width/2,repeat:0}).then((()=>{let t=new PIXI.Text("For everyone, for all platforms",{fontFamily:"Itim-Regular",fontSize:15,fill:16777215,fontWeight:"bold",align:"center"});t.x=e.x,t.y=e.y+e.height,t=this.fontSize(t,.5*e.width),this.loadGame.addChild(t);let i=new PIXI.HTMLText('<font color="white">Made with</font> <a href="https://pixijs.com/"><font color="e72264"><b>PixiJS</b></font></a> ',{fontFamily:"Arial",fontSize:16,fontWeight:"bold",align:"center"});i.y=e.height+e.y,i.x=e.width+e.x-i.width+10,this.loadGame.addChild(i),i.alpha=0,TweenMax.to(i,1,{alpha:1,onComplete:()=>{n.WarningViewController()}})}));let a=new PIXI.Text("Client v. "+this.gameInfo.version,{fontFamily:"Arial",fontSize:14,fill:16777215,fontWeight:"bold",align:"center"});a.y=this.gameHeight-a.height-10,a.x=10,this.loadGame.addChild(a);let o=new PIXI.Text("Since04",{fontFamily:"Arial",fontSize:9,fill:16777215,fontWeight:"bold",align:"center"});o.y=this.gameHeight-o.height-5,o.x=this.gameWidth-o.width-30,this.loadGame.addChild(o);let s=new PIXI.Text("PixiJS v. "+PIXI.VERSION,{fontFamily:"Arial",fontSize:14,fill:16777215,fontWeight:"bold",align:"center"});s.y=a.y-s.height,s.x=10,this.loadGame.addChild(s)};ObjectCreatePageLoading=()=>{this.loadGame.removeChildren();let t=new PIXI.Graphics;t.beginFill(0),t.drawRect(0,0,this.gameWidth,this.gameHeight),t.endFill(),t.x=0,t.y=0,t.alpha=1,t.visible=!0;let i=new PIXI.Sprite(this.coverImg("loadgame")),e=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,0,16,16))),h=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,16,16,16))),n=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,32,16,16))),a=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,48,16,16))),o=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,64,16,16))),s=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,80,16,16))),d=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,96,16,16))),l=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,112,16,16))),r=new PIXI.Sprite(new PIXI.Texture(i.texture,new PIXI.Rectangle(0,128,16,16))),g=new PIXI.AnimatedSprite([e.texture,h.texture,n.texture,a.texture,o.texture,s.texture,d.texture,l.texture,r.texture]);g.animationSpeed=2,g.play(),g.x=this.gameWidth/100*50-g.width/100*50,g.y=this.gameHeight/100*50-g.height/100*50;let c=this.CreateLogo(t.width);c.x=t.width/2-c.width/2,c.y=g.y-c.height-10,t.addChild(c);let m=new PIXI.Text("Xin chờ",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"});m.x=this.gameWidth/100*50-m.width/100*50,m.y=this.gameHeight/100*50-m.height/100*50+g.height/100*50+20;let u=["Trái đất có khả năng choáng","ăn đậu để nhanh hơn"],y=new PIXI.Text(u[Math.floor(Math.random()*u.length)],{fontFamily:"Arial",fontSize:16,fill:15132329,fontWeight:"bold"});y.x=this.gameWidth/100*50-y.width/100*50,y.y=this.gameHeight/100*50-y.height/100*50+g.height/100*50+20+m.height/100*50+20,this.loadGame.addChild(t,g,m,y),this.loadGame.visible=!0,this.assetPixi=this.assetPixi||0;let w=new PIXI.Text("Đang tải 0%",{fontFamily:"Arial",fontSize:16,fill:16711680,fontWeight:"bold"});w.x=this.gameWidth/2-w.width/2,w.y=y.y+y.height+20,w.name="txtLoadgame",this.loadGame.addChild(w),w.visible=!1,this.runPromiseAsset(this.srcSheetPixi.length,w)}},vt=class extends Ct{constructor(){super(),this.playSound("music2",!0,null,"musicwelcome")}createMapNui=(t,i,e,h=!1,n=!1)=>{let a=new PIXI.Sprite(this.coverImg(e,"map/khac"));return a.x=t,a.y=i,h&&(a.width=h),n&&(a.height=n),a};set=t=>{this.to(-27,t)};updateMapGuest=()=>{let t=this.guestContainer.getChildByName("map");if(!t)return clearInterval(this.InputSetInverti);let i=t.getChildByName("load1");i.x-=1,i.x<=-336&&(i.x=0);let e=t.getChildByName("load2");e.x-=.5,e.x<=-336&&(e.x=0)};createBackgroundMap=()=>{let t=new PIXI.Graphics;t.name="map",t.beginFill(1400349,1),t.lineStyle(0,5704481),t.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),t.endFill();let i=new PIXI.Graphics;i.beginFill(1683704,1),i.lineStyle(0,5704481,1),i.drawRoundedRect(0,0,this.gameWidth,.3*this.gameHeight,0),i.endFill(),t.addChild(i);let e=new PIXI.Container;t.addChild(e);for(let t=0;t<2*Math.round(this.gameWidth/258);t++){let i=this.createMapNui(258*t,0,"x2b03",258,.15*this.gameHeight);e.addChild(i)}e.y=i.height/2+30;let h=new PIXI.Container;t.addChild(h);for(let t=0;t<2*Math.round(this.gameWidth/510)+6;t++){let i=this.createMapNui(300*t,0,"x2b02",300,.3*this.gameHeight);h.addChild(i)}h.y=e.height+20;let n=new PIXI.Container;n.name="load2",t.addChild(n);for(let t=0;t<2*Math.round(this.gameWidth/336)+3;t++){let i=this.createMapNui(336*t,0,"x2b01",336,.3*this.gameHeight);n.addChild(i)}n.y=h.y+h.height/2+30;let a=new PIXI.Container;a.name="load1";let o=2*Math.round(this.gameWidth/336)+6,s=(this.gameHeight,this.gameHeight,.3*this.gameHeight);for(let t=0;t<o;t++){let i=this.createMapNui(336*t,0,"x2b00",336,s);a.addChild(i)}return t.addChild(a),a.x=0,a.y=h.y+n.y+30,t};CreateLogo=t=>{let i=new PIXI.Container,e=new PIXI.Text("Dragon Ball",new PIXI.TextStyle({fontFamily:"Itim-Regular",fontSize:40,fill:16489827,fontWeight:"bold"}));e.resolution=2,e.style.stroke="#591327",e.style.strokeThickness=10;e.width=1*this.gameWidth,e.width=e.width>300?300:e.width,e.width=e.width>.5*this.gameWidth?.5*this.gameWidth:e.width;let h=new PIXI.Text("Online H5",new PIXI.TextStyle({fontFamily:"PottaOne-Regular",fontSize:20,fill:5882473,fontWeight:"bold"}));h.resolution=2,h.style.stroke="#3c4b24",h.style.strokeThickness=6,h.style.dropShadow=!0,h.style.dropShadowColor="#3c4b24",h.style.dropShadowBlur=2,h.style.dropShadowAngle=Math.PI/10,h.style.dropShadowDistance=3,h.y=e.height,h.x=e.width/2-h.width/2;return h.width=1*this.gameWidth,h.width=h.width>100?100:h.width,h.width=h.width>.5*this.gameWidth?.5*this.gameWidth:h.width,i.addChild(h),i.addChild(e),i};CreateMainGuestGame=()=>{this.deleteNotice(),this.chipiBox.removeChildren(),this.loadGame.visible=!1,clearInterval(this.InputSetInverti),this.guestContainer.visible=!0,this.guestContainer.removeChildren(),this.guestContainer.addChild(this.createBackgroundMap()),this.InputSetInverti=setInterval(this.updateMapGuest,1e3/60);let t=new PIXI.Graphics;this.guestContainer.addChild(t),t.beginFill(16704710,0),t.lineStyle(1e-4,7096832,1);let i=1*this.gameWidth;i=i>500?500:i,i=i>.8*this.gameWidth?.8*this.gameWidth:i;let e=1*this.gameHeight;e=e>600?600:e,e=e>.5*this.gameHeight?.5*this.gameHeight:e,t.drawRoundedRect(0,0,i,e,10),t.endFill();let h=new PIXI.Text("SourceCode",{fontSize:14,fill:16711680,fontFamily:"Arial",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t.width-20});h.x=this.gameWidth-h.width-10,h.y=0,h.style.stroke=16777215,h.style.strokeThickness=2,h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{this.openURL()}));let n=new PIXI.Text("Made with PixiJS",{fontSize:16,fill:15147620,fontFamily:"Arial",align:"center",wordWrap:!0,fontWeight:"bold",wordWrapWidth:t.width-20});n.x=0,n.y=this.gameHeight-n.height,n.style.stroke=16777215,n.style.strokeThickness=2,n.interactive=!0,n.cursor="pointer",n.on("pointerdown",(()=>{this.openURL("https://pixijs.com/")})),n.visible=!1,this.guestContainer.addChild(h,n);let a=new PIXI.Container;t.addChild(a);let o=[{name:"Chơi TK."+this.username,action:"ingame"},{name:"Chơi mới",action:"newgame"},{name:"Đổi tài khoản",action:"login"},{name:"Máy chủ 1 sao",action:"server"}];for(let i=0;i<o.length;i++){let e=new PIXI.Graphics;e.beginFill(14908730,1),e.lineStyle(3,7019816,1);let h={x:.7*t.width,y:.2*t.height},n=1*t.width;n=n>h.x?h.x:n,n=n>.8*t.width?.8*t.width:n;let s=1*t.height;s=s>h.y?h.y:s,s=s>.5*t.height?.5*t.height:s,e.drawRoundedRect(0,0,n,s,10),e.endFill(),e.x=t.width/2-e.width/2,e.y=i*(e.height+10),e.name=o[i].action,e.interactive=!0,e.cursor="pointer",e.on("pointerdown",(()=>{this.playSound("click"),"ingame"==o[i].action&&this.logInGame(),"newgame"==o[i].action&&this.MenuCreateNewPlayer(),"login"==o[i].action&&this.pageLogin(),"server"==o[i].action&&this.send(-4)})),"ingame"!=o[i].action||""!=this.username&&""!=this.password||(e.visible=!1),a.addChild(e);let d=new PIXI.Text(o[i].name,{fontSize:18,fill:5449989,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:e.width-20});d.x=e.width/2-d.width/2,d.y=e.height/2-d.height/2,e.addChild(d)}t.x=this.gameWidth/2-t.width/2,t.y=(this.gameHeight-.3*this.gameHeight)/2,t.y+t.height>this.gameHeight&&(t.y=this.gameHeight-t.height-10);let s=this.CreateLogo(t.width);s.x=t.width/2-s.width/2,s.y=a.y-s.height,t.addChild(s);let d=new PIXI.Text("*:Trò chơi là đồ án của sinh viên Công nghệ thông tin. Trò chơi là dạng mã nguồn mở (được chia sẻ cho mọi người cùng học, tham gia đóng góp). Chức năng nạp tiền sử dụng để duy trì cho dự án, không mục đích kinh doanh.",{fontFamily:"Arial",fontSize:15,fill:16777215,fontWeight:"bold",Wrap:!0});d.visible=!1,d.style.wordWrap=!0,d.style.wordWrapWidth=this.gameWidth-n.width-20,d.style.align="right",d.style.stroke="#000000",d.style.strokeThickness=5,d.y=this.gameHeight-d.height,d.x=this.gameWidth-d.width-10,this.guestContainer.addChild(d);let l=new PIXI.Text('© "Client" - không thuộc bản quyền của bất kì tổ chức hay cá nhân nào ! - "Trò chơi" được viết trên mã nguồn do cộng đồng đóng góp, sử dụng hình ảnh từ nhiều nguồn trên Internet.',{fontFamily:"Arial",fontSize:16,fill:0,fontWeight:"bold",Wrap:!0});l.visible=!1,l.style.wordWrap=!0,l.style.wordWrapWidth=this.gameWidth-h.width-20,l.style.align="left",l.style.stroke=16777215,l.style.strokeThickness=2,l.y=0,l.x=0,this.guestContainer.addChild(l),setTimeout((()=>{setTimeout((()=>{}),200)}),500)}},Pt=class extends vt{constructor(){super(),this.InputTenNhanVat="",this.inPutHanhTinh=1,this.inPutAvatarNhanVat=1,this.InputSetInverti}outPutCreateNhanVat=()=>this.InputTenNhanVat?this.inPutHanhTinh<=0||this.inPutHanhTinh>3?this.notice(this._("Vui lòng chọn hành tinh.")):this.inPutAvatarNhanVat<=0||this.inPutAvatarNhanVat>3?this.notice(this._("Vui lòng chọn nhân vật.")):this.InputTenNhanVat.length<4||this.InputTenNhanVat.length>12?this.notice(this._("Tên nhân vật phải từ 4 đến 10 ký tự.")):(this.to(-15,{_1:this.InputTenNhanVat,_2:this.inPutHanhTinh,_3:this.inPutAvatarNhanVat}),this.notice(this._("Đang tạo nhân vật..."),!1)):this.notice(this._("Vui lòng nhập tên nhân vật."));MenuCreateNewPlayer=()=>{this.guestContainer.removeChildren(),clearInterval(this.InputSetInverti),this.inGame.visible=!1,this.guestContainer.visible=!0,this.guestContainer.addChild(this.createBackgroundMap());let t=new PIXI.Graphics;this.guestContainer.addChild(t),t.beginFill(15721922,.85),t.lineStyle(3,5704481,1);let i=.9*this.gameWidth;i>500&&(i=500),t.drawRoundedRect(0,0,i,.7*this.gameHeight,10),t.endFill(),t.x=this.gameWidth/2-t.width/2,t.y=this.gameHeight/2-t.height/2;let e=new PIXI.Text("Tạo nhân vật",{fontSize:20,fill:16750592,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:t.width-20});e.resolution=2,e.style.stroke="#000000",e.style.strokeThickness=4,e.style.dropShadow=!0,e.style.dropShadowColor="#000000",e.style.dropShadowBlur=4,e.style.dropShadowAngle=Math.PI/6,e.style.dropShadowDistance=6,e.x=t.width/2-e.width/2,e.y=0-e.height,t.addChild(e);let h=["","OjXcgiisYH","twvYYRSWUt","edetJJtBbw"],n=["","atVGRKpeAf","jmTItjaORo","BiZPigMSyQ"],a=[[],["","fghjfghjttttt","sLeNYzwVYi","sdfgsdfgrty55"],["","XnPloWDTdg","gNiPLfNjlC","LivLKpGKlE"],["","gBPszFjQfJ","DZJzuIdkku","XZzRFLjcjA"]],o=new PIXI.Graphics;o.beginFill(15721922,0),o.lineStyle(.3,15721922,.1),o.drawRoundedRect(0,0,.8*t.width,.9*t.height,10),o.endFill(),o.x=t.width/2-o.width/2,o.y=0,t.addChild(o);let s=new PIXI.Container;o.addChild(s);let d=this.getSkin(h[this.inPutHanhTinh]),l=this.getSkin(n[this.inPutHanhTinh]),r=this.getSkin(a[this.inPutHanhTinh][this.inPutAvatarNhanVat]),g=new PIXI.Sprite(this.coverImg(d.farm[0].dungyen.farme[0]));g.scale.set(d.farm[0].dungyen.width,d.farm[0].dungyen.height),g.sprite=0,g.name="quan222";let c=new PIXI.Sprite(this.coverImg(l.farm[0].dungyen.farme[0]));c.sprite=0,c.name="ao222",c.scale.set(l.farm[0].dungyen.width,l.farm[0].dungyen.height);let m=new PIXI.Sprite(this.coverImg(r.farm[0].dungyen.farme[0]));m.scale.set(r.farm[0].dungyen.width,r.farm[0].dungyen.height),m.sprite=0,m.name="dau222",m.x=r.farm[0].dungyen.x,g.x=d.farm[0].dungyen.x,c.x=l.farm[0].dungyen.x,c.load=0,m.y=Math.abs(this.getImg(h[this.inPutHanhTinh]).farm[0].dungyen.y),c.y=Math.abs(this.getImg(a[this.inPutHanhTinh][this.inPutAvatarNhanVat]).farm[0].dungyen.y)-Math.abs(this.getImg(n[this.inPutHanhTinh]).farm[0].dungyen.y),g.y=Math.abs(this.getImg(a[this.inPutHanhTinh][this.inPutAvatarNhanVat]).farm[0].dungyen.y),s.addChild(g,m,c),s.y=10,s.x=o.width/2-s.width/2,this.InputSetInverti=setInterval((()=>{1==c.load&&(m.y+=1,c.y+=1),2==c.load&&(m.y-=1,c.y-=1),c.load++,3==c.load&&(c.load=0),this.updateMapGuest()}),50);let u=new PIXI.TextInput({input:{fontSize:"16px",padding:"10px",color:"#7a1125"},box:{default:{fill:15647621,rounded:12,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:12,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});u.width=.5*o.width,u.height=.1*o.height,u.y=s.height+u.height,u.x=o.width/2-u.width/2,u.placeholder="Tên nhân vật",u.text=this.InputTenNhanVat,o.addChild(u),u.on("input",(()=>{this.InputTenNhanVat=u.text}));let y=new PIXI.Graphics;t.addChild(y),y.beginFill(15129997,0),y.lineStyle(.3,15721922,.1),y.drawRoundedRect(0,0,1*t.width,.45*t.height,10),y.endFill(),y.x=t.width/2-y.width/2,y.y=u.y+u.height+10;let w=["","Tr.Đất","Saiyan","Namek"],f=[[],["","Yamacha","Kirin","Gohan"],["","Vegeta","Calic","Kakarot"],["","Picolo","Kemi","Octiiu"]],p=new PIXI.Container;p.name="list hành tinh",y.addChild(p);for(let t=1;t<=3;t++){let i=new PIXI.Graphics;i.beginFill(t==this.inPutHanhTinh?6806153:15040059,1),i.lineStyle(2,6030616,1),i.drawRoundedRect(0,0,.25*y.width,.25*y.height,10),i.endFill(),i.x=(t-1)*(i.width+10),i.y=0,p.addChild(i);let e=new PIXI.Text(w[t],{fontSize:16,fill:5704738,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:i.width-20});if(e.x=i.width/2-e.width/2,e.y=i.height/2-e.height/2,i.addChild(e),i.interactive=!0,i.cursor="pointer",i.on("pointerdown",(()=>{this.inPutHanhTinh=t,this.MenuCreateNewPlayer(),this.playSound("click")})),t==this.inPutHanhTinh)for(let i=1;i<=3;i++){let e=new PIXI.Graphics;e.beginFill(i==this.inPutAvatarNhanVat?6806153:15040059,1),e.lineStyle(2,6030616,1),e.drawRoundedRect(0,0,.25*y.width,.25*y.height,10),e.endFill(),e.x=(i-1)*(e.width+10),e.y=e.height+10,p.addChild(e);let h=new PIXI.Text(f[t][i],{fontSize:16,fill:5704738,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:e.width-20});h.x=e.width/2-h.width/2,h.y=e.height/2-h.height/2,e.addChild(h),e.interactive=!0,e.cursor="pointer",e.on("pointerdown",(()=>{this.inPutHanhTinh=t,this.inPutAvatarNhanVat=i,this.MenuCreateNewPlayer(),this.playSound("click")}))}}p.x=y.width/2-p.width/2;let x=new PIXI.Text("Admin: Tạo nhân vật xong khi vào game sẽ có nút liên kết tài khoản tại Chức năng.",{fontSize:16,fill:5704738,fontFamily:"fontchinh",wordWrap:!0,wordWrapWidth:t.width-20});y.addChild(x),x.x=y.width/2-x.width/2,x.y=y.height-x.height;let b=new PIXI.Graphics;b.beginFill(15040059,1),b.lineStyle(1,6030616,1),b.drawRoundedRect(0,0,.15*t.width,.08*t.height,10),b.endFill(),b.x=0,b.y=0,t.addChild(b);let I=new PIXI.Text(this._("X"),{fontSize:16,fill:5704738,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:b.width-20});I.x=b.width/2-I.width/2,I.y=b.height/2-I.height/2,b.addChild(I),b.interactive=!0,b.cursor="pointer",b.on("pointerdown",(()=>{this.CreateMainGuestGame(),this.playSound("click")}));let C=new PIXI.Graphics;C.beginFill(15040059,1),C.lineStyle(1,6030616,1),C.drawRoundedRect(0,0,.2*t.width,.08*t.height,10),C.endFill(),C.x=t.width-C.width-0*t.width,C.y=0,t.addChild(C);let v=new PIXI.Text(this._("Chơi"),{fontSize:16,fill:5704738,fontFamily:"fontchinh",align:"center",wordWrap:!0,wordWrapWidth:C.width-20});v.x=C.width/2-v.width/2,v.y=C.height/2-v.height/2,C.addChild(v),C.interactive=!0,C.cursor="pointer",C.on("pointerdown",(()=>{this.outPutCreateNhanVat(),this.playSound("click")}))}};class kt extends Pt{constructor(){super()}sendInPutActive=(t,i)=>{let e=t,h=i;if(e.length<3||e.length>=20)return this.notice("Tên tài khoản phải từ 3- 20 kí tự");if(h.length<3||h.length>=20)return this.notice("Mật khẩu phải từ 3- 20 kí tự");let n=/^[a-zA-Z0-9]+$/.test(e);return n?(n=/^[a-zA-Z0-9]+$/.test(h),n?1==this.my.veri?this.notice("Tài khoản đã xác thực"):(this.to(-35,{_1:e,_2:h}),void this.await()):this.notice("Mật khẩu không được chứa kí tự đặc biệt")):this.notice("Tên tài khoản không được chứa kí tự đặc biệt")};pageActiveAccount(){if(this.my.id<=0)return this.pageLogin();this.closeBox(),this.bodyChat.visible=!0,this.bodyChat.removeChildren();let t=.9*this.gameWidth,i=.5*this.gameHeight;t=t>500?500:t,i=i>400?400:i;let e=new PIXI.Graphics;e.beginFill(16704710,1),e.lineStyle(3,7096832,1),e.drawRoundedRect(0,0,t,i,10),e.endFill(),e.x=0,e.y=0,this.bodyChat.addChild(e);let h=new PIXI.HTMLText("Tài khoản của bạn chưa xác thực, vui lòng xác thực để đảm bảo cho tài khoản an toàn.",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});h.x=10,h.y=10,e.addChild(h);let n=new PIXI.Container,a=t;a=a>250?250:a;let o=new PIXI.Text("Tên tài khoản:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});o.y=0,e.addChild(o);let s=new PIXI.TextInput({input:{fontSize:"20px",padding:"12px",width:a+"px",color:"#26272E"},box:{default:{fill:15264243,rounded:12},focused:{fill:14803950,rounded:12},disabled:{fill:14408667,rounded:12}}});s.x=0,s.y=o.y+o.height,n.addChild(o,s),e.addChild(n);let d=new PIXI.Text("Mật khẩu:",{fontSize:20,fill:21285,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});d.y=s.y+s.height+10,e.addChild(d);let l=new PIXI.TextInput({input:{fontSize:"20px",padding:"12px",width:a+"px",color:"#26272E"},box:{default:{fill:15264243,rounded:12},focused:{fill:14803950,rounded:12},disabled:{fill:14408667,rounded:12}}});l.x=0,l.y=d.y+d.height,n.addChild(d,l),n.x=t/2-n.width/2,n.y=h.y+h.height+10;let r=new PIXI.Container,g=new PIXI.Graphics;g.beginFill(15040059,1),g.lineStyle(3,6953766,1),g.drawRoundedRect(0,0,70,50,10),g.endFill(),g.x=0,g.y=0,r.addChild(g);let c=new PIXI.Text("OK",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});c.x=g.width/2-c.width/2,c.y=g.height/2-c.height/2,g.addChild(c),g.interactive=!0,g.buttonMode=!0,g.on("pointerdown",(()=>{l.blur(),s.blur(),this.sendInPutActive(s.text,l.text)}));let m=new PIXI.Graphics;m.beginFill(15040059,1),m.lineStyle(3,6953766,1),m.drawRoundedRect(0,0,70,50,10),m.endFill(),m.x=c.x+c.width+m.width/2,m.y=0,r.addChild(m);let u=new PIXI.Text("Đóng",{fontSize:20,fill:5449989,fontFamily:"chelthm",fontWeight:"bold",align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:t-20});u.x=m.width/2-u.width/2,u.y=m.height/2-u.height/2,m.addChild(u),m.interactive=!0,m.buttonMode=!0,m.on("pointerdown",(()=>{this.bodyChat.visible=!1,this.bodyChat.removeChildren()})),e.addChild(r),r.x=t/2-r.width/2,r.y=.95*e.height,this.bodyChat.x=this.gameWidth/2-this.bodyChat.width/2,this.bodyChat.y=this.gameHeight/2-this.bodyChat.height/2}}const St=class extends kt{constructor(){super(),this.guestWelcome=new PIXI.Container,this.guestMenu=new PIXI.Container}pageLogin(){this.guestContainer.removeChildren(),clearInterval(this.InputSetInverti),this.loadGame.visible=!1,this.guestContainer.visible=!0,this.guestContainer.addChild(this.createBackgroundMap());let t=new PIXI.Graphics;this.guestContainer.addChild(t),t.beginFill(16704710,1),t.lineStyle(2,7096832,1);let i=1*this.gameWidth;i=i>=.8*this.gameWidth?.8*this.gameWidth:i,i=i>500?500:i,i=i<.5*this.gameWidth?.5*this.gameWidth:i;let e=.5*this.gameHeight;e=e>200?200:e,t.drawRoundedRect(0,0,i,e,10),t.endFill(),t.x=this.gameWidth/2-t.width/2,t.y=this.gameHeight/2-t.height/2;let h=new PIXI.Container;t.addChild(h);let n=new PIXI.TextInput({input:{fontSize:"16px",padding:"10px",color:"#7a1125",width:.7*t.width,height:.2*t.height},box:{default:{fill:15647621,rounded:12,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:12,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:12}}});n.placeholder="Tên tài khoản",h.addChild(n),n.text=this.username;let a=new PIXI.TextInput({input:{fontSize:"16px",padding:"10px",color:"#26272E",type:"password",width:.7*t.width,height:.2*t.height},box:{default:{fill:15647621,rounded:10,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:10,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:10}}});a.placeholder="Mật khẩu",a.y=n.height+.1*t.height,a.htmlInput.setAttribute("type","password"),a.text=this.password,h.addChild(a),h.x=(t.width-.7*t.width)/2,h.y=.3*t.height;let o=new PIXI.Container;t.addChild(o);let s=()=>(a.blur(),n.blur(),this.setCookie("username",n.text,30),this.setCookie("password",a.text,30),this.CreatedCookie(),this.playSound("click"),this.CreateMainGuestGame()),d=new PIXI.Graphics;d.lineStyle(2,7096832,1),d.beginFill(15040315,1),d.drawRoundedRect(0,0,.4*t.width,.2*t.height,20),d.endFill(),d.x=0,d.y=0,d.interactive=!0,d.cursor="pointer",d.zIndex=100;let l=new PIXI.Text("OK",{fontFamily:"fontchinh",fontSize:17,fill:5449989,align:"center",fontWeight:"bold"});l.x=d.x+(d.width-l.width)/2,l.y=d.y+(d.height-l.height)/2,d.addChild(l),d.on("pointerdown",(()=>{s()}));let r=new PIXI.Graphics;r.lineStyle(2,7096832,1),r.beginFill(15040315,1),r.drawRoundedRect(0,0,.4*t.width,.2*t.height,20),r.endFill(),r.x=d.width+.1*t.width,r.y=0,r.interactive=!0,r.buttonMode=!0,r.on("pointerdown",(()=>{console.log("register"),this.playSound("click"),this.notice("Vui lòng vào trang chủ của trò chơi để quên mật khẩu.")}));let g=new PIXI.Text("Forget Pass?",{fontFamily:"fontchinh",fontSize:14,fill:5449989,align:"center"});g.x=(r.width-g.width)/2,g.y=r.y+(r.height-g.height)/2,r.addChild(g),o.addChild(d,r),o.x=(t.width-(d.width+r.width+.1*t.width))/2,o.y=t.height+.1*t.height;let c=this.CreateLogo(t.width);c.x=t.width/2-c.width/2,c.y=0-c.height+c.height/2,t.addChild(c)}},Bt=class extends St{constructor(){super()}CreateDisplayOnScreen(){this.NutOnScreen.removeChildren(),this.NutOnScreenAction.removeChildren();let t=new PIXI.Sprite(this.coverImg("bg_attack")),i=this.gameWidth>this.gameHeight?this.gameWidth:this.gameHeight;t.width=.13*i,t.height=.13*i,t.x=this.gameWidth-t.width,t.y=this.SkillInSrcreen.y-this.SkillInSrcreen.height-t.height/2,this.gameWidth>this.gameHeight&&(t.y=this.gameHeight-t.height);let e=e=>{t.width=i*(1==e?.11:.13),t.height=i*(1==e?.11:.13),t.texture=1==e?this.coverImg("bg_attack_click"):this.coverImg("bg_attack")};t.alpha=1,t.visible=!0,t.interactive=!0,t.buttonMode=!0,t.on("pointerdown",(()=>{this.interAttack(),e(!0)})),t.on("pointerup",(()=>{e(!1)})),t.on("pointerover",(()=>{e(!0)})),t.on("pointerout",(()=>{e(!1)}));let h=new PIXI.Sprite(this.coverImg("change")),n=this.gameWidth>this.gameHeight?this.gameWidth:this.gameHeight;h.width=.08*n,h.height=.08*n,h.x=this.gameWidth-h.width,h.y=t.y-h.height,h.alpha=1,h.visible=!0,h.interactive=!0,h.buttonMode=!0,h.on("pointerdown",(()=>{h.texture=this.coverImg("change_click"),this.changeClickAuto()})),h.on("pointerup",(()=>{h.texture=this.coverImg("change")})),h.on("pointerover",(()=>{h.texture=this.coverImg("change_click")})),h.on("pointerout",(()=>{h.texture=this.coverImg("change")}));let a=new PIXI.Sprite(this.coverImg("myTexture2dPea0-resources.assets-813"));a.width=.08*n,a.height=.08*n,this.gameWidth>this.gameHeight?(a.x=t.x-a.width-a.width/100*10,a.y=this.gameHeight-a.height-.05*this.gameHeight):(a.x=this.gameWidth-a.width,a.y=h.y-a.height-a.height/100*10),a.alpha=1,a.visible=!0,a.interactive=!0,a.course="pointer",a.on("pointerdown",(()=>{this.useDauThan()})),a.on("pointerover",(()=>{a.texture=this.coverImg("myTexture2dPea1-resources.assets-859")})),a.on("pointerout",(()=>{a.texture=this.coverImg("myTexture2dPea0-resources.assets-813")})),this.bg_dauthan=a;let o=new PIXI.Graphics;o.beginFill(16777215),o.drawCircle(0,0,a.width/100*33,a.height/100*30),o.endFill(),o.x=a.x+o.width/2+a.width/100*20,o.y=a.y+o.height/2+a.height/100*20,o.alpha=1,o.heightMAX=o.height;let s=new PIXI.Text("99",{fontFamily:"fontchinh",fontSize:13,fill:0});s.x=o.x-s.width/2,s.y=o.y-s.height/2,this.text_dauthan=s,this.bg_dauthan_circle=o;let d=new PIXI.Graphics;d.beginFill(0),d.drawRect(0,0,this.gameWidth,.05*this.gameHeight),d.endFill(),d.x=0,d.y=0,d.alpha=.5,d.visible=!0,d.interactive=!0,d.buttonMode=!0,d.y=this.gameHeight-.05*this.gameHeight;let l=new PIXI.Text("Chúc mừng bạn ABC vừa nhận thành công vũ trụ số 6 cả thế giới đều ngường mộ chúng ta lắm luôn ai cũng mừng cho bạn Chúc mừng bạn ABC vừa nhận thành công vũ trụ số 6 cả thế giới đều ngường mộ chúng ta lắm luôn ai cũng mừng cho bạn",{fontFamily:"fontchinh",fontSize:16,fill:16777215});l.x=0,l.y=this.gameHeight-.05*this.gameHeight+.05*this.gameHeight/100*50-l.height/100*50,l.visible=!1,d.visible=!1,this.text_notice=l,this.bg_notice=d;let r=new PIXI.Graphics;r.beginFill(8411700),this.gameHeight>this.gameWidth?this.gameWidth:this.gameHeight;let g=this.gameHeight<this.gameWidth?this.gameHeight:this.gameWidth;r.drawCircle(0,0,.13*g),r.endFill(),r.x=0+r.width/2,r.y=this.SkillInSrcreen.y-this.SkillInSrcreen.height,this.gameWidth>this.gameHeight&&(r.y=this.gameHeight-r.height),r.alpha=.5;let c=new PIXI.Graphics;c.beginFill(14567943),c.drawCircle(0,0,.11*g),c.endFill(),c.x=r.x,c.y=r.y,c.interactive=!0,c.course="pointer",c.buttonMode=!0,c.move=!1,c.on("pointerdown",(()=>{c.move=!0}));let m=this,u=()=>{delete m.keysPressed[40],delete m.keysPressed[38],delete m.keysPressed[37],delete m.keysPressed[39]},y=function(t){if(m.checkKey())u();else if(1==c.move){u();let i=t.data.global.x-r.x,e=t.data.global.y-r.y;c.x=t.data.global.x,c.y=t.data.global.y,c.x>r.x+r.width/2&&(c.x=r.x+r.width/2),c.x<r.x-r.width/2&&(c.x=r.x-r.width/2),c.y>r.y+r.height/2&&(c.y=r.y+r.height/2),c.y<r.y-r.height/2&&(c.y=r.y-r.height/2);let h=Math.sqrt(Math.pow(i,2)+Math.pow(e,2));h>r.width/2&&(c.x=i*r.width/2/h+r.x,c.y=e*r.height/2/h+r.y);let n=c.x-r.x,a=c.y-r.y,o=180*Math.atan2(a,n)/Math.PI,s="";o>-45&&o<45&&(s=39),o>45&&o<135&&(s=40),(o>135||o<-135)&&(s=37),o>-135&&o<-45&&(s=38),m.pressNut(s)}};this.screen.on("pointermove",(t=>{y(t)})),this.screen.on("pointerup",(t=>{c.x=r.x,c.y=r.y,c.move=!1,m.timeRoiTuDo=Date.now()+500,u(),"move"==m.my.info.act&&(m.my.info.act="dungyen",m.addAction())})),c.on("pointermove",(t=>{y(t)}));let w="myTexture2dchat-resources.assets-101";this.PC&&(w="chat-resources.assets-749");let f="myTexture2dchat2-resources.assets-430";this.PC&&(f="chat2-resources.assets-1613");let p=new PIXI.Sprite(this.coverImg(w));p.width=.06*(this.gameHeight>this.gameWidth?this.gameHeight:this.gameWidth),p.height=.06*(this.gameHeight>this.gameWidth?this.gameHeight:this.gameWidth),this.gameWidth>this.gameHeight?(p.x=1*this.gameWidth-p.width-p.width/100*20,p.y=0+p.height/100*10):(p.height=a.height,p.width=a.width,p.x=this.gameWidth-p.width,p.y=a.y-p.height-p.height/100*10),p.alpha=1,p.visible=!0,p.interactive=!0,p.buttonMode=!0,p.on("pointerdown",(()=>{this.openChat()})),p.on("pointerover",(()=>{p.texture=this.coverImg(f)})),p.on("pointerout",(()=>{p.texture=this.coverImg(w)})),p.visible=!0;let x=new PIXI.Sprite(this.coverImg("micof"));x.width=.06*(this.gameHeight>this.gameWidth?this.gameHeight:this.gameWidth),x.height=.06*(this.gameHeight>this.gameWidth?this.gameHeight:this.gameWidth),this.gameWidth>this.gameHeight?(x.x=p.x-x.width-x.width/100*20,x.y=0+x.height/100*10):(x.height=p.height,x.width=p.width,x.x=this.gameWidth-x.width,x.y=p.y-x.height-x.height/100*10),x.interactive=!0,x.course="pointer",x.on("pointerdown",(()=>{this.autoVoice?(x.texture=this.coverImg("micof"),this.voiceOff()):(x.texture=this.coverImg("micon"),this.voiceOn())})),this.NutOnScreenAction.addChild(r,c,h,t,o,a,s),this.NutOnScreen.addChild(p,x,d,l)}createDisplayOnPlayerInfo(){let t=this.my,i=new PIXI.Container;i.interactive=!0,i.course="pointer",i.on("pointerdown",(()=>{this.openLastMenu()}));let e=new PIXI.Graphics;i.addChild(e);i.mwidth=.7*this.gameWidth,i.mheight=.35*this.gameHeight,i.mwidth=i.mwidth>300?300:i.mwidth,i.mheight=i.mheight>120?120:i.mheight,i.width=i.mwidth,i.height=i.mheight;let h=new PIXI.Graphics;this.hp_BGKhung=new PIXI.Graphics,this.hp_BGKhung.lineStyle(.9,0,1),this.hp_BGKhung.beginFill(15241762,.7),this.hp_BGKhung.drawRoundedRect(0,0,.7*i.mwidth,.7*i.mheight,5),this.hp_BGKhung.endFill(),h.addChild(this.hp_BGKhung),this.hpProgress_BGKhung=new PIXI.Graphics,this.hpProgress_BGKhung.beginFill(0,.7),this.hpProgress_BGKhung.drawRoundedRect(0,0,.8*this.hp_BGKhung.getBounds().width,.3*this.hp_BGKhung.getBounds().height,5),this.hpProgress_BGKhung.endFill(),this.hpProgress_BGKhung.x=.1*this.hp_BGKhung.getBounds().width,this.hpProgress_BGKhung.y=.1*this.hp_BGKhung.getBounds().height,this.hp_BGKhung.addChild(this.hpProgress_BGKhung),this.hpProgress=new PIXI.Graphics,this.hpProgress.beginFill(14362628,.7),this.hpProgress.drawRoundedRect(0,0,.5*this.hpProgress_BGKhung.getBounds().width,this.hpProgress_BGKhung.getBounds().height,5),this.hpProgress.maxWidth=1*this.hpProgress_BGKhung.getBounds().width,this.hpProgress.endFill(),this.hpProgress.x=this.hpProgress_BGKhung.getBounds().width-this.hpProgress_BGKhung.getBounds().width,this.hpProgress.y=0,this.hpProgress_BGKhung.addChild(this.hpProgress),this.kiProgress_BGKhung=new PIXI.Graphics,this.kiProgress_BGKhung.beginFill(0,.7),this.kiProgress_BGKhung.drawRoundedRect(0,0,.8*this.hp_BGKhung.getBounds().width,.3*this.hp_BGKhung.getBounds().height,5),this.kiProgress_BGKhung.endFill(),this.kiProgress_BGKhung.x=.1*this.hp_BGKhung.getBounds().width,this.kiProgress_BGKhung.y=.6*this.hp_BGKhung.getBounds().height,this.hp_BGKhung.addChild(this.kiProgress_BGKhung),this.kiProgress=new PIXI.Graphics,this.kiProgress.beginFill(39374,.7),this.kiProgress.drawRoundedRect(0,0,.5*this.kiProgress_BGKhung.getBounds().width,this.kiProgress_BGKhung.getBounds().height,5),this.kiProgress.maxWidth=1*this.kiProgress_BGKhung.getBounds().width,this.kiProgress.endFill(),this.kiProgress.x=this.kiProgress_BGKhung.getBounds().width-this.kiProgress_BGKhung.getBounds().width,this.kiProgress.y=0,this.kiProgress_BGKhung.addChild(this.kiProgress),this.hpText=new PIXI.Text(t.info.chiso.hp,{fontFamily:"fontchinh",fontSize:11,fill:"white"}),this.hpText.x=this.hpProgress_BGKhung.getBounds().width/2-this.hpText.getBounds().width/2,this.hpText.y=this.hpProgress_BGKhung.getBounds().height/2-this.hpText.getBounds().height/2,this.hpProgress_BGKhung.addChild(this.hpText),this.kiText=new PIXI.Text(t.info.chiso.ki,{fontFamily:"fontchinh",fontSize:11,fill:"white"}),this.kiText.x=this.kiProgress_BGKhung.getBounds().width-this.kiText.getBounds().width,this.kiText.y=this.kiProgress_BGKhung.getBounds().height/2-this.kiText.getBounds().height/2,this.kiProgress_BGKhung.addChild(this.kiText),i.addChild(h),i.x=0,i.y=0,this.khungThongTinDoiThu=new PIXI.Container,this.backGoundInfoMMO=new PIXI.Graphics,this.backGoundInfoMMO.beginFill(15241762,.7),this.backGoundInfoMMO.lineStyle(1,0,11);let n=.3*i.width;i.width+n<this.gameWidth&&(n=.5*i.width),this.backGoundInfoMMO.drawRoundedRect(0,0,n,.5*i.mheight,5),this.backGoundInfoMMO.endFill(),this.contaiNerNameInHpMMO=new PIXI.Container,this.myNameText=new PIXI.Text(t.name,{fontFamily:"fontchinh",fontSize:14,fill:16775885}),this.myNameText.width=this.myNameText.width>this.backGoundInfoMMO.getBounds().width?this.backGoundInfoMMO.getBounds().width:this.myNameText.width,this.myNameText.height=this.myNameText.height>this.backGoundInfoMMO.getBounds().height?this.backGoundInfoMMO.getBounds().height:this.myNameText.height,this.myNameText.x=this.backGoundInfoMMO.getBounds().width/2-this.myNameText.getBounds().width/2,this.myNameText.y=0,this.myHPText=new PIXI.Text(t.info.chiso.hp,{fontFamily:"fontchinh",fontSize:11,fill:16257040}),this.myHPText.x=this.backGoundInfoMMO.getBounds().width/2-this.myHPText.getBounds().width/2,this.myHPText.y=this.myNameText.getBounds().height,this.contaiNerNameInHpMMO.addChild(this.myNameText,this.myHPText),this.contaiNerNameInHpMMO.y=this.backGoundInfoMMO.getBounds().height/2-this.contaiNerNameInHpMMO.getBounds().height/2,this.backGoundInfoMMO.addChild(this.contaiNerNameInHpMMO),this.khungThongTinDoiThu.addChild(this.backGoundInfoMMO),this.khungThongTinDoiThu.x=i.width+i.x,this.inGame.addChild(i,this.khungThongTinDoiThu),this.inGameMSG=new PIXI.Container,this.inGameMSG.x=0,this.inGameMSG.y=i.y+i.height,this.inGameMSG.name="Lớp chứa các lớp thông báo kĩ năng",this.inGame.addChild(this.inGameMSG)}createNutDaChet(){this.NutDaChet.removeChildren();let t=new PIXI.Graphics;t.lineStyle(3,6030616,1),t.beginFill(15639356,1);let i=this.gameWidth;i=i>150?150:i,t.drawRoundedRect(0,0,i,50,5),t.endFill(),t.x=this.gameWidth/2-t.width/2,t.y=this.gameHeight-t.height,t.interactive=!0,t.cursor="pointer",t.on("pointerdown",(()=>{this.boxMenuHoiSinh()}));let e=new PIXI.Text(this._("Kiệt sức"),{fontSize:20,fontFamily:"fontchinh",fill:0});e.x=t.width/2-e.width/2,e.y=t.height/2-e.height/2,t.addChild(e),this.NutDaChet.addChild(t)}createSkillOnDisplay(){let t=this.SkillInSrcreen,i=this.SkillDataOnScreen,e=this.my,h=this.setting;t.removeChildren(),i.background=[],i.skill=[],i.time=[],i.texture=[];for(let n=0;n<5;n++){let a={width:.15*this.gameWidth,height:.15*this.gameWidth};a.width>50&&(a.width=40,a.height=40),a.width>100&&(a.width=48,a.height=48);{let o=this.usedSkill(e.oskill[n]);if(o){let e=new PIXI.Sprite(this.coverImg(o.avatar));e.avatar=o.avatar,i.texture.push(e),e.width=a.width,e.height=a.height,e.x=n*a.width*1.2,e.y=0,t.addChild(e),e.interactive=!0,e.cursor="pointer",e.on("pointerdown",(()=>{-1!=h.oskill&&(i.background[h.oskill].tint=16777215),i.background[n].tint=2937176,h.oskill=n}));let s=new PIXI.Graphics;s.beginFill(5153159,.7),s.lineStyle(1,0,1),s.drawRect(0,0,a.width,a.height),s.endFill(),s.x=n*a.width*1.2,s.y=0,s.max=s.height,t.addChild(s),i.time.push(s);let d=new PIXI.Graphics;d.lineStyle(5,15420434,1),d.drawRoundedRect(0,0,a.width,a.height,5),d.x=n*a.width*1.2,d.y=0,t.addChild(d),i.background.push(d)}}}t.x=this.gameWidth/2-t.width/2,t.y=this.gameHeight-t.height-.05*this.gameHeight,this.CreateDisplayOnScreen(),this.createNutDaChet()}};class _t extends Bt{constructor(){super(),this.cumDau=0}choang=()=>{let t=this.data_choang,i=0;return t.forEach((t=>{this.my.eff[t]&&1==this.my.eff[t].active&&(i=1)})),1==i};pressNut=t=>{if((this.my.info.chiso.hp<=0||this.choang())&&(this.keysPressed[37]=!1,this.keysPressed[38]=!1,this.keysPressed[39]=!1,this.keysPressed[40]=!1),37==t||38==t||39==t||40==t){if(1==this.loadGame.visible)return!1;if(0==this.NhanVat.visible)return!1;if(this.my.info.chiso.hp<=0)return!1;if(this.choang())return!1;if(1==this.keysPressed[t])return!1;this.keysPressed[t]=!0}};sinceRunAction=t=>{if(0==this.my.id)return!1;this.my.info.chiso.hp<=0?(this.NutOnScreenAction.visible=!1,this.SkillInSrcreen.visible=!1,this.NutDaChet.visible=!0):this.NutOnScreenAction&&0==this.NutOnScreenAction.visible&&(this.NutOnScreenAction.visible=!0,this.SkillInSrcreen.visible=!0,this.NutDaChet.visible=!1),this.moveTimeout++,this.moveTimeout>100&&(this.moveTimeout=0);let i=0;i+=this.my.info.speed,i-=this.app.ticker.FPS/60,"fly"==this.my.info.act&&(i+=.5);let e=this.bando.children.filter((t=>"dat"===t.type)),h=this.bando.children.filter((t=>"longdat"===t.type));if(this.NhanVat.x,this.NhanVat.y,this.lanDauBay&&this.keysPressed[38]&&this.checkOnDat22(this.my.id)&&(this.lanDauBay=!1,i+=80,this.addEff({id:"fly_first_eff_khoi_"+this.my.id,type:"flyKI_first",by:this.my.id})),this.keysPressed[37]||this.keysPressed[38]||this.keysPressed[39]||this.keysPressed[40]){if(this.keysPressed[38]&&0==this.cumDau)this.timeRoiTuDo=0,this.NhanVat.y-i<=this.gameMap.setting.minY&&(i=Math.max(0,this.NhanVat.y-this.gameMap.setting.minY));else if(this.keysPressed[40]){if(this.timeRoiTuDo<=Date.now()&&0!=this.timeRoiTuDo){this.CreateRoi=this.CreateRoi||1,1==this.CreateRoi&&(this.thoigianroitudo=0,this.timeSetRoiTuDo=0,this.speedOld=2.5,this.CreateRoi=2);let i=t/1e3;this.thoigianroitudo+=i;let e=9.8*this.thoigianroitudo;e+=2.5,this.timeSetRoiTuDo=0,this.speedOld=e}this.keysPressed[40]&&(i=this.speedOld+2*t),this.NhanVat.y+i>=this.gameMap.setting.maxY&&(i=Math.max(0,this.gameMap.setting.maxY-this.NhanVat.y))}else this.keysPressed[37]?(this.timeRoiTuDo=0,this.NhanVat.x-i<=this.gameMap.setting.minX&&(i=0,this.NhanVat.x=this.gameMap.setting.minX+this.NhanVat.width,this.NhanVatGoc.x=this.gameMap.setting.minX+this.NhanVat.width)):this.keysPressed[39]&&(this.timeRoiTuDo=0,this.NhanVat.x+i>=this.gameMap.setting.maxX&&(i=0,this.NhanVat.x=this.gameMap.setting.maxX-this.NhanVat.width/2,this.NhanVatGoc.x=this.gameMap.setting.maxX-this.NhanVat.width/2,this.chipi("Ô ! hình như va phải bức tường rồi")));if((this.keysPressed[39]||this.keysPressed[37]||this.keysPressed[38]||this.keysPressed[40])&&Math.abs(this.NhanVat.y-this.yFirst),this.keysPressed[40]){let t=!1,h=0;for(let n=0;n<e.length;n++){let a=e[n];if(this.hitTestRectangleDown(this.NhanVatGoc,a,"down",i,1)){t=!0,h=n;break}}t&&(this.my.info.act="dungyen",this.addAction(),this.cumDau=!1,this.NhanVat.y=Math.round(e[h].y-this.NhanVatGoc.height+24),this.NhanVatGoc.y=Math.round(e[h].y-this.NhanVatGoc.height+24),this.NhanVat.y=Math.round(this.NhanVat.y),this.yFirst=this.NhanVat.y,this.CreateRoi=1,this.lanDauBay=!0,this.timeRoiTuDo=0,delete this.keysPressed[40],i=0,this.actionMap.nuida=0,this.actionMap.nuixa=0)}if(this.keysPressed[38])for(let t=0;t<h.length;t++){let e=h[t];if(this.hitTestRectangle(this.NhanVat,e,"up",i)&&this.calculateDistanceX(this.NhanVat,e,"up",2*i)+1<=this.NhanVat.height){-1!=["x219$28"].indexOf(e.name)&&(this.cumDau=!0,this.NhanVat.y=Math.round(e.y+e.height+24),this.NhanVatGoc.y=Math.round(e.y+e.height+24),this.keysPressed[38]=!1),i=0;break}}if(this.keysPressed[37]){let t=0,e=0;for(let n=0;n<h.length;n++){let a=h[n];if(!(h[n].x+h[n].width>this.NhanVat.x-i)&&this.hitTestRectangle(this.NhanVat,a,"left",i)){t=1,e=n;break}}t&&(delete this.keysPressed[37],i=0)}if(this.keysPressed[39]){let t=0,e=0;for(let n=0;n<h.length;n++){if(h[n].x+h[n].width<this.NhanVat.x+i)continue;let a=h[n];if(this.hitTestRectangle(this.NhanVat,a,"right",i)){t=1,e=n;break}}t&&(delete this.keysPressed[39],i=0)}if(this.keysPressed[37]||this.keysPressed[39]){if("move"==this.my.info.act){let t=0;for(let h=0;h<e.length;h++){let n=e[h];if(this.hitTestRectangle(this.NhanVat,n,"down",i)){t++;break}}t<=0&&(this.my.info.act="baylen",this.addAction())}"fly"==this.my.info.act&&(this.NhanVat.biendo=this.NhanVat.biendo||0,this.NhanVat.biendo,this.NhanVat.biendo,this.NhanVat.biendo++,this.NhanVat.biendo>50&&(this.NhanVat.biendo=1))}}if(this.keysPressed[38]||this.keysPressed[40]&&i>=1){if(this.keysPressed[38]&&1==this.cumDau)return!1;this.NhanVat.y+=this.keysPressed[38]?-i:i,this.NhanVatGoc.y+=this.keysPressed[38]?-i:i,this.NhanVat_phukien.y+=this.keysPressed[38]?-i:i,this.my.info.move=this.keysPressed[38]?"up":"down",this.my.info.act="baylen",this.addAction();let t=this.bando_nuida.toGlobal(new PIXI.Point(0,0)),e=this.NhanVat.toGlobal(new PIXI.Point(0,0));e.width=this.NhanVat.width,e.height=this.NhanVat.height,t.width=this.bando_nuida.width,t.height=this.bando_nuida.height;let h=this.bando_nuixa.toGlobal(new PIXI.Point(0,0));h.width=this.bando_nuixa.width,h.height=this.bando_nuixa.height,this.keysPressed[38]&&(Math.abs(this.actionMap.nuida)<this.bando_nuida.height&&this.hitTestRectangle2(e,t)&&(this.actionMap.nuida+=.5),Math.abs(Math.round(this.actionMap.nuida))>=1&&!this.hitTestRectangle2(e,t,"up",this.NhanVat.height)&&Math.abs(this.actionMap.nuixa)<.2*this.bando_nuixa.height&&this.hitTestRectangle2(e,h)&&(this.actionMap.nuixa+=.5)),this.keysPressed[40]&&(this.actionMap.nuida>0&&this.hitTestRectangle2(e,t)&&this.actionMap.nuixa<0&&(this.actionMap.nuida-=1),this.actionMap.nuixa>0&&this.hitTestRectangle2(e,h)&&(this.actionMap.nuixa-=.5))}if(this.keysPressed[39]||this.keysPressed[37]){let t=0;this.keysPressed[39]?(this.NhanVat.x+=i,this.NhanVatGoc.x+=i,this.NhanVat_phukien.x+=i,this.my.info.move="right",t=-.1,this.NhanVat.huong="right",1!=this.NhanVat.scale.x&&(this.NhanVat.scale.x=1,this.NhanVat.pivot.x=this.NhanVat.width)):(this.my.info.move="left",this.NhanVat.x-=i,this.NhanVatGoc.x-=i,this.NhanVat_phukien.x-=i,-1!=this.NhanVat.scale.x&&(this.NhanVat.scale.x=-1,this.NhanVat.pivot.x=0),this.NhanVat.huong="left",t=.1),this.NhanVat.move=this.my.info.move,this.keysPressed[37]||this.keysPressed[39],"baylen"==this.my.info.act||this.my.info.act,"baylen"==this.my.info.act||"fly"==this.my.info.act?this.my.info.act="fly":this.my.info.act="move",this.addAction()}this.keysPressed[16],(this.keysPressed[37]||this.keysPressed[38]||this.keysPressed[39]||this.keysPressed[40])&&("fly"==this.my.info.act&&this.keysPressed[38]&&(this.keysPressed[37]||this.keysPressed[39])&&(this.my.info.act,this.addAction({action:"baylen",id:this.my.id})),this.cumDau&&(this.action(this.my.id,"dotay"),this.keysPressed[40]=!0),i>=1&&1==this.sendToServer&&(this.keysPressed[37]&&(this.my.info.move="left"),this.keysPressed[38]&&(this.my.info.move="up"),this.NhanVat.move=this.my.info.move,this.sendMyMove(),this.sendToServer=!1,setTimeout((()=>{this.sendToServer=!0}),500)))}}const Tt=class extends _t{constructor(){super(),this.moveTimeout=0,this.sinceKeyDown(),this.sinceKeyUp(),this.sinceKeyOne(),this.sendToServer=!0,this.logChange=[],this.timeSetRoiTuDo=0,this.thoigianroitudo=0,this.speedOld=1,this.lanDauBay=!0,this.yFirst=0,this.docao=0,this.actionMap={nuida:0,nuixa:0},this.goto=!1}coppy(t){let i=document.createElement("input");i.value=t,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}checkOnDat22=(t,i="down")=>{let e=this.my.id==t?this.NhanVat:this.nguoichoi.children.find((i=>i.id==t)),h=this.my.id==t?this.my:this.Charset.find((i=>i.id==t));if(!e)return!0;if(!h)return!0;let n=this.bando.children.filter((t=>"dat"===t.type)),a=!1,o=0;for(let t=0;t<n.length;t++){let h=n[t];if(this.hitTestRectangle(e,h,i,10)){a=!0,o=t;break}}return a||h.id==this.my.id&&(this.timeRoiTuDo=Date.now()+150),!!a&&(h.id==this.my.id&&(this.timeRoiTuDo=Date.now()+150,this.addEff({id:"fly_first_eff_khoi2_"+this.my.id,type:"flyKI_first2",by:this.my.id})),!0)};xulynamdat=(t,i=!1)=>{if(t!=this.my.id)return!1;console.log("Vài lần"),this.cacheAction.find((i=>i.id==t))||this.cacheAction.push({id:t,action:"dungyen"});let e=this.bando.children.filter((t=>"dat"===t.type)),h=this.my.id==t?this.my:this.Charset.find((i=>i.id==t));if(!h)return!1;let n=this.my.id==t?this.NhanVat:this.nguoichoi.children.find((i=>i.id==t));if(!n)return!1;n.visible=!1;let a=null,o=null;for(let t=0;t<e.length;t++){let i=e[t],h=this.calculateDistance(n,i);(null==a||a>h)&&(a=h,o=t)}null!=o&&(n.y=Math.round(e[o].y-n.height+24),n.y=Math.round(n.y),this.NhanVatGoc.y=n.y,this.NhanVatGoc.x=n.x,h.pos.y=n.y,this.lanDauBay=!0),console.log("k",o),n.namdat=1,this.sendMyMove(),n.visible=!0};xulynamdat2=(t,i=!1)=>{if(t!=this.my.id)return!1;console.log("Vài lần"),this.cacheAction.find((i=>i.id==t))||this.cacheAction.push({id:t,action:"dungyen"});let e=this.bando.children.filter((t=>"dat"===t.type)),h=this.my.id==t?this.my:this.Charset.find((i=>i.id==t));if(!h)return!1;let n=this.my.id==t?this.NhanVat:this.nguoichoi.children.find((i=>i.id==t));if(!n)return!1;n.visible=!1;let a=null,o=null;for(let t=0;t<e.length;t++){let i=e[t],h=this.calculateDistance(n,i);(null==a||a>h)&&(a=h,o=t)}null!=o&&(n.y=Math.round(e[o].y-3*n.height),n.y=Math.round(n.y),this.NhanVatGoc.y=n.y,this.NhanVatGoc.x=n.x,h.pos.y=n.y,this.lanDauBay=!0),console.log("k",o),n.namdat=1,this.sendMyMove(),n.visible=!0};checkKey=()=>(this.box.children.length<=0&&(this.box.visible=!1),this.boxError.children.length<=0&&(this.boxError.visible=!1),this.khungGiaoTiep.children.length<=0&&(this.khungGiaoTiep.visible=!1),this.bodyChat.children.length<=0&&(this.bodyChat.visible=!1),1==this.box.visible||1==this.boxError.visible||1==this.khungGiaoTiep.visible||1==this.bodyChat.visible);sendMyMove=()=>{let t=this.NhanVat.huong?this.NhanVat.huong:"right";this.to("-3",{_1:this.NhanVat.x,_2:this.NhanVat.y,_3:"right"==t?1:2,_4:this.my.info.act})};changeClickAuto(){0==this.setting.mouse&&1==this.setting.mouse||null!=this.logChange.find((t=>t==this.setting.mouse))||this.logChange.push(this.setting.mouse);let t=0;for(let i=0;i<this.Charset.length;i++){let e=this.getNhanVat(this.Charset[i].id);if(e&&0!=e.visible&&Math.abs(this.NhanVat.x-this.Charset[i].pos.x^this.NhanVat.y-this.Charset[i].pos.y+2^2)<200&&null==this.logChange.find((t=>t==this.Charset[i].id))){this.setting.mouse=this.Charset[i].id,t=1,this.logChange.push(this.Charset[i].id);break}}0==t&&(this.logChange=[])}sinceKeyUp=()=>{document.addEventListener("keyup",(t=>{"fly"==this.my.info.act||"baylen"==this.my.info.act||this.my.info.act,this.timeRoiTuDo=Date.now()+150,"move"==this.my.info.act&&(this.my.info.act="dungyen",this.addAction()),"fly"==this.my.info.act&&(this.my.info.act="baylen",this.addAction()),(this.keysPressed[40]||this.keysPressed[38]||this.keysPressed[37]||this.keysPressed[39])&&this.my.id>0&&setTimeout((()=>{this.sendMyMove()}),1),this.goto&&(this.keysPressed[37]=!1,this.keysPressed[38]=!1,this.keysPressed[39]=!1,this.keysPressed[40]=!1),delete this.keysPressed[t.keyCode]}))};sinceKeyDown=()=>{document.addEventListener("keydown",(t=>{if(40!=t.keyCode&&38!=t.keyCode&&37!=t.keyCode&&39!=t.keyCode||this.goto&&(this.keysPressed[37]=!1,this.keysPressed[38]=!1,this.keysPressed[39]=!1,this.keysPressed[40]=!1,this.goto=!1),116==t.keyCode&&(t.preventDefault(),this.coppy(Math.round(this.NhanVat.x)+", "+Math.round(this.NhanVat.y)+",")),this.timeRoiTuDo=0,delete this.keysPressed[40],(40==t.keyCode||38==t.keyCode||37==t.keyCode||39==t.keyCode)&&this.my&&this.my.id>=1&&this.my.info.chiso.hp<=0)return!1;112==t.keyCode&&t.preventDefault(),37==t.keyCode||38==t.keyCode||39==t.keyCode||40==t.keyCode?this.pressNut(t.keyCode):this.keysPressed[t.keyCode]=!0,((this.keysPressed[40]||this.keysPressed[38]||this.keysPressed[37]||this.keysPressed[39]||this.keysPressed[13])&&0==this.my.id||1==this.checkKey())&&(this.keysPressed[40]=!1,this.keysPressed[38]=!1,this.keysPressed[37]=!1,this.keysPressed[39]=!1,this.keysPressed[13]=!1)}))};sinceKeyOne=()=>{document.addEventListener("keydown",(t=>t.keyCode>=49&&t.keyCode<=53||t.keyCode>=97&&t.keyCode<=101?this.numberAttack(t.keyCode):13==t.keyCode?this.interAttack():(82==t.keyCode&&this.openChat(),112==t.keyCode&&this.openLastMenu(),void(113==t.keyCode&&this.changeClickAuto()))),{capture:!0,passive:!1})}},Xt=class extends Tt{constructor(){super(),this.updateUserTimeRender=0,this.updateCreatePlayerOnMap(),this.debut=["thaiduonghasan","rungu"]}updateCreatePlayerOnMap=()=>{clearTimeout(this.updateUserTimeRender),requestAnimationFrame(this.ProcessLoadPlayer)};XuLyItem=t=>{let i=this;if(t.data)if(null==i.nguoichoi.getChildByName(t.id)){let e=i.item.find((i=>i.id==t.data.item));if(e){let h=new PIXI.Container;h.id=t.id,h.name=t.id,t.name=e.name,t.info.chiso.hp=t.data.soluong,h.Ten=t.name,h.type=t.type;let n=new PIXI.Sprite(this.coverImg(e.avatar));n.name="hienthi",h.addChild(n),i.nguoichoi.addChild(h),h.interactive=!0,h.cursor="pointer",h.width=25,h.height=25,h.x=t.pos.x,h.y=t.pos.y,h.on("pointerdown",(t=>{i.clickPlayer({id:h.id})}));let a=new PIXI.Container;a.name=h.id,a.id=h.id,a.type=h.type,a.interactive=!0,a.cursor="pointer",a.on("pointerdown",(t=>{i.clickPlayer({id:h.id})})),i.nguoichoi_phukien.addChild(a)}}else{let e=i.nguoichoi.getChildByName(t.id),h=e.getChildByName("hienthi");if(e.width=25,e.height=25,e.x=t.pos.x,e.y=t.pos.y,h.texture=h.texture,e.roi=e.roi||-1,-1==e.roi){let h=i.bando.children.filter((t=>"dat"===t.type)),n=!1,a=0,o=10;for(let t=0;t<h.length;t++){let i=h[t],s=e.y-o;if(e.x+e.width>i.x&&e.x<i.x+i.width&&s+e.height>i.y&&s<i.y+i.height){n=!0,a=t;break}}n&&(e.roi=1,e.y=Math.round(h[a].y-e.height+24),t.pos.y=e.y,o=0),o>0&&h.length>=1&&(e.y+=o,t.pos.y=e.y,i.Charset[i.Charset.findIndex((i=>i.id==t.id))].pos.y=t.pos.y)}let n=i.nguoichoi_phukien.getChildByName(t.id);n&&(n.x=e.x,n.y=e.y,n.scale.x=e.scale.x,n.scale.y=e.scale.y,n.pivot.x=e.pivot.x,n.pivot.y=e.pivot.y,n.resolution=2,n.rotation=e.rotation);let a=n.getChildByName("itemBG");if(null==a){let t=new PIXI.Graphics;t.lineStyle(0),t.beginFill(16777011,1),t.drawCircle(e.width/2+17.5,e.height/2+7,35),t.endFill(),t.start=0,t.name="itemBG",t.visible=!1,t.interactive=!0,t.cursor="pointer",t.on("pointerdown",(t=>{i.clickPlayer({id:e.id})})),n.addChild(t)}else a.visible=!0,a.start%2?(a.clear(),a.lineStyle(0),a.beginFill(16764006,1),a.drawCircle(e.width/2+17.5,e.height/2+7,35),a.endFill()):(a.clear(),a.lineStyle(0),a.beginFill(16777011,1),a.drawCircle(e.width/2+17.5,e.height/2+7,35),a.endFill()),a.start++,a.start=a.start>20?0:a.start;let o=n.getChildByName("playerisClick");null==o?(o=new PIXI.Sprite(this.coverImg("PreviewClick")),o.name="playerisClick",n.addChild(o),o.load=1):(o.width=20,o.height=20,o.x=Math.abs(e.width)-Math.abs(e.width)/2+Math.abs(o.width)/2,o.y=0-o.height-10,2==o.load&&(o.y-=1),4==o.load&&(o.y+=1,o.load=0),o.load++),-1!=i.setting.mouse&&i.setting.mouse==t.id?o.visible=!0:o.visible=!1}};XuLyMob=t=>{let i=this.debut,e=this;if(null==e.nguoichoi.getChildByName(t.id)){let i=new PIXI.Container;i.id=t.id,i.name=t.id,i.Ten=t.name,i.type=t.type;let h=t,n=(e.getImg(h.skin.quan),e.getImg(h.skin.ao)),a=(e.getImg(h.skin.dau),new PIXI.Sprite(this.coverImg(this.getFarm(h.skin.ao,0,"move"))));a.sprite=0,n.farm[0].move.width<=10||n.farm[0].move.height<=10?a.scale.set(n.farm[0].move.width,n.farm[0].move.height):(a.width=n.farm[0].move.width,a.height=n.farm[0].move.height),a.x=0,a.y=0,a.load=0,a.name="playerAo",i.move=h.info.move,i.x=h.pos.x,i.y=h.pos.y,i.addChild(a),i.interactive=!0,i.cursor="pointer",i.on("pointerdown",(t=>{e.clickPlayer({id:i.id})})),i.scale.x=1,i.pivot.x=i.width,e.nguoichoi.addChild(i);let o=new PIXI.Container;o.name=i.id,o.id=i.id,o.type=i.type,e.nguoichoi_phukien.addChild(o),i.checkSieuQuai=0}else{let h=e.nguoichoi.getChildByName(t.id),n=e.nguoichoi_phukien.getChildByName(t.id);if(0==h.checkSieuQuai&&h.getBounds().width>=12){if(t.info.coban&&t.info.coban.sieuquai&&-1!=t.info.coban.sieuquai&&t.info.chiso.hp>0){let i={saiyan:[964,965,966,967,982,983,984],traidat:[971,972,973,974],namek:[977,978,986]};this.addEff({type:"loop",aim:t.id,id:"sieuquai"+t.id,src:i[t.info.coban.super],width:90,height:90})}h.checkSieuQuai=1}t.info.chiso.hp<=0?h.visible=!1:0==h.visible&&t.info.chiso.hp>0&&(h.visible=!0),n&&(n.x=h.x,n.y=h.y,n.width=h.width,n.height=h.height,n.scale.x=h.scale.x,n.scale.y=h.scale.y,n.pivot.x=h.pivot.x,n.pivot.y=h.pivot.y,n.resolution=2,n.rotation=h.rotation);let a=t.pos.x,o=t.pos.y,s=h.x,d=h.y,l=t;h.move=l.info.move,"right"==h.move?(h.huong="right",1!=h.scale.x&&(h.scale.x=1,h.pivot.x=h.width),h.checkLeft=1):"left"==h.move&&(h.huong="left",-1!=h.scale.x&&(h.scale.x=-1,h.pivot.x=0));let r=0;if(i.forEach((i=>{t.eff[i]&&1==t.eff[i].active&&(r=1)})),1==t.namdat&&this.xulyMobOnMap(h,t),t.info&&"bidanh"==t.info.act);else if(t.info&&"choang"==t.info.act);else if(t.info&&"attack"==t.info.act);else if(1==r);else if(a!=s||o!=d){t.info.act="move",e.addAction({id:t.id,action:t.info.act});let i=Math.abs(a-s),n=Math.abs(o-d),l=t.info.speed,r=t.info.speed;n<300&&n>0&&(o>d?(r=d+r>=o?o-d:r,h.y+=r):(r=d-r<=o?d-o:r,h.y-=r)),i<300&&i>0?a==s&&a==s||(a>s?(l=s+l>a?a-s:l,h.x+=l):(l=s-l<=a?s-a:l,h.x-=l)):(h.visible=!1,h.x=a,h.y=o,e.addSkill("dichchuyen",1,h.x,h.y,h.id,"dichchuyen","dichchuyen_"+h.id))}else a==s&&o==d&&"move"==t.info.act&&(t.info.act="dungyen");h.act!=t.info.act&&(h.act=t.info.act,e.addAction({id:t.id,action:t.info.act})),t.delete&&1==t.delete&&(e.nguoichoi.removeChild(h),e.nguoichoi_phukien.removeChild(n),e.Charset.splice(e.Charset.findIndex((i=>i.id==t.id)),1))}};XuLyPlayer=t=>{let i=this.debut,e=this;if(null==e.nguoichoi.getChildByName(t.id)){let i=new PIXI.Container;i.id=t.id,i.name=t.id,i.Ten=t.name,i.type=t.type;let h=t;if(h.skin.theobo&&h.skin.theobo.length>=1){if(""==h.skin.ao||!h.skin.ao){let t=e.images.find((t=>t.id==h.skin.theobo&&"ao"==t.type));t&&(h.skin.ao=t.name)}if(""==h.skin.quan||!h.skin.quan){let t=e.images.find((t=>t.id==h.skin.theobo&&"quan"==t.type));t&&(h.skin.quan=t.name)}if(""==h.skin.dau||!h.skin.dau){let t=e.images.find((t=>t.id==h.skin.theobo&&"dau"==t.type));t&&(h.skin.dau=t.name)}}let n=e.getImg(h.skin.quan),a=e.getImg(h.skin.ao),o=e.getImg(h.skin.dau),s=new PIXI.Sprite(this.coverImg("9208"));i.act=t.info.act,"npc"!=t.type&&(i.act="dungyen",this.action(t.id,"dungyen"));let d=new PIXI.Container;d.name=i.id,d.id=i.id,d.type=i.type,e.nguoichoi_phukien.addChild(d),s.scale.set(.47,.49),s.x+=5,s.y+=13;let l=new PIXI.Sprite(this.coverImg("596"));l.scale.set(.4,.32),l.x+=4,l.y+=45;let r=new PIXI.Sprite(this.coverImg("581"));r.scale.set(.4,.38),r.x+=3,r.y+=39,r.visible=!1,l.visible=!1,s.visible=!1,i.addChild(s,l,r);let g=new PIXI.Sprite(this.coverImg(this.getFarm(h.skin.quan,0,"dungyen")));g.scale.set(n.farm[0].dungyen.width,n.farm[0].dungyen.height),g.sprite=0;let c=new PIXI.Sprite(this.coverImg(this.getFarm(h.skin.ao,0,"dungyen")));c.sprite=0,c.scale.set(a.farm[0].dungyen.width,a.farm[0].dungyen.height);let m=new PIXI.Sprite(this.coverImg(this.getFarm(h.skin.dau,0,"dungyen")));m.scale.set(o.farm[0].dungyen.width,o.farm[0].dungyen.height),m.sprite=0,m.x=s.x+o.farm[0].dungyen.x,m.y=s.y+o.farm[0].dungyen.y,g.x=l.x+n.farm[0].dungyen.x,g.y=l.y+n.farm[0].dungyen.y,c.x=r.x+a.farm[0].dungyen.x,c.y=r.y+a.farm[0].dungyen.y,c.load=0,c.name="playerAo",g.name="playerQuan",m.name="playerDau",s.name="head",l.name="foot",r.name="body",i.move=h.info.move,i.x=h.pos.x,i.y=h.pos.y,i.addChild(m,g,c),i.interactive=!0,i.cursor="pointer",i.on("pointerdown",(t=>{e.clickPlayer({id:i.id})})),i.scale.x=1,i.pivot.x=i.width,e.nguoichoi.addChild(i),i.scale.x*=1.1,i.scale.y*=1.1}else{let h=e.nguoichoi.getChildByName(t.id),n=e.nguoichoi_phukien.getChildByName(t.id);null!=n&&(n.x=h.x,n.y=h.y,n.width=h.width,n.height=h.height,n.scale.x=h.scale.x,n.scale.y=h.scale.y,n.pivot.x=h.pivot.x,n.pivot.y=h.pivot.y,n.resolution=2,n.rotation=h.rotation);let a=t.pos.x,o=t.pos.y,s=h.x,d=h.y,l=t;h.move=l.info.move,"dungyen"==t.info.act&&("right"==h.move?(h.huong="right",1!=h.scale.x&&(h.scale.x=1,h.pivot.x=h.width),h.checkLeft=1):"left"==h.move&&(h.huong="left",-1!=h.scale.x&&(h.scale.x=-1,h.pivot.x=0))),"boss"==h.type&&("dungyen"!=t.info.act&&(t.info.namdat=1),1==t.info.namdat&&"baylen"==t.info.act&&(this.checkOnDat22(t.id,"up")?this.action(t.id,"dungyen"):t.info.namdat=0),1!=t.info.namdat||"dungyen"!=t.info.act&&"dotay"!=t.info.act||(t.info.act="dungyen",this.xulyBOSS(h,t)),Math.abs(o-d)<=50&&(o=d));let r=0;if(i.forEach((i=>{t.eff[i]&&1==t.eff[i].active&&(r=1)})),t.info.chiso.hp<=0&&(r=1),"npc"==h.type)e.xulyNPCOnMap(h,t);else if(1==r);else if("npc"!=h.type||a==s&&o==d){if(a!=s||o!=d){let i=Math.abs(a-s),l=Math.abs(o-d),r=t.info.speed+(h.type,0),g=t.info.speed+(h.type,0);if(l<300&&l>0&&(o==d||(o<d?t.info.act="baylen":"fly"!=t.info.act&&(t.info.act="dotay"))),l<300&&l>0)o>d?(g=d+g>=o?o-d:g,h.y+=g):(g=d-g<=o?d-o:g,h.y-=g);else if(i<300&&i>0&&(a!=s||a!=s)){if("dotay"!=t.info.act&&"baylen"!=t.info.act&&"fly"!=t.info.act||(t.info.act="fly"),"fly"!=t.info.act&&(t.info.act="move"),"detu"==h.type){let i=t.of==e.my.id?e.my:e.Charset.find((i=>i.id==t.of));i&&"fly"==i.info.act&&(t.info.act="fly")}a>s?(h.move="right",r=s+r>a?a-s:r,h.x+=r,n.x+=r):(r=s-r<=a?s-a:r,h.x-=r,n.x-=r,h.move="left")}(i>300||l>300)&&(h.visible=!1,h.x=a,h.y=o,e.addSkill("dichchuyen",1,h.x,h.y,h.id,"dichchuyen","dichchuyen_"+h.id))}}else h.x=a,h.y=o;if(a==s&&o==d&&("fly"!=t.info.act||e.checkOnDat22(t.id)||(t.info.act="baylen"),"fly"==t.info.act&&e.checkOnDat22(t.id)&&(t.info.act="dungyen"),"dotay"==t.info.act&&e.checkOnDat22(t.id)&&(t.info.act="dungyen")),a==s&&o==d&&"move"==t.info.act&&(t.info.act="dungyen"),"detu"==h.type){let i=t.of==e.my.id?e.my:e.Charset.find((i=>i.id==t.of));i&&("fly"==i.info.act&&(t.info.act="fly"),"baylen"==i.info.act&&(t.info.act="baylen"))}h.act!=t.info.act&&(h.act=t.info.act,e.addAction({id:t.id,action:t.info.act})),t.delete&&1==t.delete&&(e.nguoichoi.removeChild(h),e.nguoichoi_phukien.removeChild(n),e.Charset.splice(e.Charset.findIndex((i=>i.id==t.id)),1))}};XuLyZone=t=>{if(this.my.id<=0)return!1;let i=this.nguoichoi.getChildByName(t.id);if(null==i){let i=new PIXI.Graphics;i.name=t.id,i.id=t.id,i.type=t.type,i.beginFill(0,.5),i.drawRect(0,0,200,50),i.endFill(),i.x=t.pos.x,i.y=t.pos.y,i.interactive=!0,i.cursor="pointer",i.on("pointerdown",(t=>{this.clickPlayer({id:i.id})}));let e=new PIXI.Text(t.name,{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center",fontWeight:"bold"});e.x=i.width/2-e.width/2,e.y=i.height/2-e.height/2,i.addChild(e),this.nguoichoi.addChild(i)}else{if(this.gameMap.setting.maxX<=0)return!1;let e=this.calculateDistanceXandWidth(this.NhanVat,i);i.visible=e<100,1==i.visible&&(this.setting.mouse=i.id);let h=0;if(i.x+i.width>this.gameMap.setting.maxX&&(i.x=this.gameMap.setting.maxX-i.width,h=1),t.auto)if(null==this.nguoichoi.getChildByName(t.id+"_auto")){let i=new PIXI.Graphics,e=200;1==t.all&&(e=this.gameMap.setting.maxX),200!=e&&(t.pos.x=this.gameMap.setting.minX),i.name=t.id+"_auto",i.id=i.name,i.type=t.type,i.beginFill(0,.5),i.drawRect(0,0,e,50),i.endFill(),i.x=t.pos.x,i.y=t.pos.y,t.scale||(i.rotation=Math.PI/2),this.nguoichoi.addChild(i),i.visible=!1}else{let e=this.nguoichoi.getChildByName(t.id+"_auto");e.y=i.y,1==h&&(e.x+=e.width),this.hitTestRectangle(this.NhanVat,e)&&("left"==this.NhanVat.huong&&(this.NhanVat.x+=Math.abs(this.NhanVat.width),this.NhanVatGoc.x+=Math.abs(this.NhanVatGoc.width)),"right"==this.NhanVat.huong&&(this.NhanVat.x-=Math.abs(this.NhanVat.width),this.NhanVatGoc.x-=Math.abs(this.NhanVatGoc.width)),this.joinChuyenMap(t.id))}}};ProcessLoadPlayer=()=>{if(1!=this.loadGame.visible&&(this.updateUserTimeRender++,this.updateUserTimeRender>100&&(this.updateUserTimeRender=0),!(this.updateUserTimeRender%this.fps())))for(let t=0;t<this.Charset.length;t++){let i=this.Charset[t];"zone"==i.type?this.XuLyZone(i):"item"==i.type?this.XuLyItem(i):"mob"==i.type?this.XuLyMob(i):this.XuLyPlayer(i)}};xulyNPCOnMap(t,i){if(t.npcChat=t.npcChat||0,this.my.id>=1&&i.info.right&&(this.NhanVat.x>i.pos.x?i.info.move="right":i.info.move="left"),t.npcChat<Date.now()&&this.my.nhiemvu.data.id!=i.id&&-1==this.Chat.children.findIndex((i=>i.uid==t.id))&&i.source.chat.length>=1){let e,h=i.source.chat;if(t.lamtho>=0){if(e=h[t.lamthoID],e=e[t.lamtho],t.lamtho+=1,t.npcChat=Date.now()+1e3,null==e)return t.lamtho=-1,t.lamthoID=-1,t.npcChat=Date.now()+1*i.source.delaychat,!1}else{let n=this.rand(0,h.length-1);e=h[n],"object"==typeof e&&(e=e[0],t.lamtho=1,t.lamthoID=n),t.npcChat=Date.now()+1*i.source.delaychat}this.ioInsertChat({_1:i.id,_2:e})}if(t.checked=t.checked||0,t.checked>=1)return!1;if(t.getBounds().height<=0||t.getBounds().width<=0)return console.log("Chưa định hình cấu");let e=this.bando.children.filter((t=>"dat"===t.type));if(e.length<=0)return!1;let h=t;if(!h)return!1;let n=null,a=null,o=this;Promise.all(e.map(((t,i)=>new Promise(((e,o)=>{(h.getBounds().height<=0||h.getBounds().width<=0)&&e(!1),(t.getBounds().height<=0||t.getBounds().width<=0)&&e(!1),0==t.renderable&&e(!1);let s=this.calculateDistance(h,t);(null==n||n>s)&&(n=s,a=i),e(!0)}))))).then((n=>{n.forEach((t=>{if(0==t)return!1})),null!=a&&(i.pos.y=Math.round(e[a].y-h.getBounds().height+10),i.pos.y=Math.round(i.pos.y),t.y=i.pos.y,t.checked+=1),o.checkOnDat22(i.id,"up")||(t.checked=0,o.action(i.id,"dungyen"))}))}xulyMobOnMap(t,i){if(t.checked=t.checked||0,t.checked>=1)return!1;let e=this.bando.children.filter((t=>"dat"===t.type));if(e.length<=0)return!1;let h=t;if(!h)return!1;if(t.checked>=1)return!1;if(t.getBounds().height<=10||t.getBounds().width<=10)return console.log("Chưa định hình cấu");let n=null,a=null,o=this;Promise.all(e.map(((t,i)=>new Promise(((e,o)=>{(h.getBounds().height<=10||h.getBounds().width<=10)&&e(!1),(t.getBounds().height<=10||t.getBounds().width<=10)&&e(!1),0==t.renderable&&e(!1);let s=this.calculateDistance(h,t);(null==n||n>s)&&(n=s,a=i),e(!0)}))))).then((n=>{n.forEach((t=>{if(0==t)return!1})),null!=a&&(i.pos.y,i.pos.y=Math.round(1*e[a].y-Math.abs(h.height)+24),i.pos.y=Math.round(i.pos.y),t.y=i.pos.y,t.checked+=1),o.checkOnDat22(i.id,"up")||(t.checked=0,o.action(i.id,"dungyen"))}))}xulyBOSS(t,i){let e=this.bando.children.filter((t=>"dat"===t.type));if(e.length<=0)return console.log("Lỗi dất");let h=t;if(!h)return console.log("Lỗ iowr đây");if(t.getBounds().height<=10||t.getBounds().width<=10)return console.log("Chưa định hình cấu");let n=null,a=null,o=this;Promise.all(e.map(((t,i)=>new Promise(((e,o)=>{(h.getBounds().height<=10||h.getBounds().width<=10)&&e(!1),(t.getBounds().height<=10||t.getBounds().width<=10)&&e(!1),0==t.renderable&&e(!1);let s=this.calculateDistance(h,t);(null==n||n>s)&&(n=s,a=i),e(!0)}))))).then((n=>{n.forEach((t=>{if(0==t)return!1})),null!=a&&(i.pos.y,i.pos.y=Math.round(1*e[a].y-Math.abs(h.height)+24),i.pos.y=Math.round(i.pos.y),t.y=i.pos.y,t.checked+=1,i.info.namdat=0),o.checkOnDat22(i.id,"up")||(t.checked=0,o.action(i.id,"dungyen"))}))}};class Ft extends Xt{constructor(){super(),this.attackTimeout=0,requestAnimationFrame(this.updateSprite)}updateSprite=()=>{if(this.attackTimeout++,this.attackTimeout%this.fps())return;if(this.attackTimeout>100&&(this.attackTimeout=0),1==this.loadGame.visible)return;let t=this;Promise.all([this.cacheAction.map((i=>new Promise(((e,h)=>{if(t.my.id<=0)return e(0);let n,a,o,s,d,l,r,g,c,m,u,y,w,f,p,x,b,I=null,C=null,v=null,P=t.Charset.find((t=>t.id==i.id));if(b=i.id==t.my.id?t.my:P,b||t.delAction(i),P&&"mob"==P.type)I=t.nguoichoi.getChildByName(i.id),v=t.nguoichoi_phukien.getChildByName(i.id),I?(C=t.Charset.find((t=>t.id==i.id)),C?(n=I.getChildByName("playerAo"),g=C.skin.ao):I=null):I=null,null!=I&&("move"!=i.action&&(I.skew.x=0),"fly"==i.action&&(I.reset=1),I.actionReset="move",i.action="bidanh"==i.action?"choang":i.action,"move"==i.action?("left"==I.move&&(I.skew.x=.1),"right"==I.move&&(I.skew.x=-.1),[n].forEach((i=>{i===n&&(g=C.skin.ao,c=n.sprite,m=t.getImg(g).farm[0].move,u=m.farme,y=u.length,c=n.sprite>=y-1?0:n.sprite,n.sprite=c,n.x=0,n.y=0,m.width<10&&m.height<10?n.scale.set(m.width,m.height):(n.width=m.width,n.height=m.height),n.texture=this.coverImg(this.getFarm(g,c,"move")),n.sprite==y&&(n.sprite=0),n.time=n.time||0,n.time=n.time>100?0:n.time,n.time+=1,n.time%2==0&&n.sprite++)}))):"choang"==i.action?[n].forEach((i=>{if(i===n){let i=C.skin.ao,e=0,h=t.getImg(i).farm[0].choang;h.farme.length,n.x=0,n.y=0,h.width<10&&h.height<10?n.scale.set(h.width,h.height):(n.width=h.width,n.height=h.height),n.texture=this.coverImg(this.getFarm(i,e,"choang"))}})):"attack"==i.action?[n].forEach((e=>{e===n&&(g=C.skin.ao,c=n.sprite,m=t.getImg(g).farm[0].attack,u=m.farme,y=u.length,c=n.sprite>=y-1?0:n.sprite,n.sprite=c,n.x=0,n.y=0,m.width<10&&m.height<10?n.scale.set(m.width,m.height):(n.width=m.width,n.height=m.height),n.texture=this.coverImg(this.getFarm(g,c,"attack")),n.sprite==y&&(n.sprite=0),n.time=n.time||0,n.sprite++,setTimeout((()=>{this.addAction({id:i.id,action:"move"})}),400))})):"dungyen"==i.action&&([n].forEach((i=>{if(i===n){let i=C.skin.ao,e=t.getImg(i).farm[0].move,h=e.farme.length,a=n.sprite>h-1?0:n.sprite;n.x=0,n.y=0,e.width<10&&e.height<10?n.scale.set(e.width,e.height):(n.width=e.width,n.height=e.height),n.texture=this.coverImg(this.getFarm(i,a,"move"))}})),0==n.load&&(n.y-=1),5==n.load&&(n.y+=1,n.load=0),n.load+=1));else if(i.id==t.my.id?(C=t.my,I=t.NhanVat,n=I.getChildByName("ao"),a=I.getChildByName("quan"),o=I.getChildByName("dau"),s=I.getChildByName("head"),d=I.getChildByName("foot"),l=I.getChildByName("body"),r=t.my.skin.dau,g=t.my.skin.ao,x=t.my.skin.quan,v=t.NhanVat_phukien):(I=t.nguoichoi.getChildByName(i.id),v=t.nguoichoi_phukien.getChildByName(i.id),I?(C=t.Charset.find((t=>t.id==i.id)),C?(n=I.getChildByName("playerAo"),a=I.getChildByName("playerQuan"),o=I.getChildByName("playerDau"),s=I.getChildByName("head"),d=I.getChildByName("foot"),l=I.getChildByName("body"),r=C.skin.dau,g=C.skin.ao,x=C.skin.quan):I=null):I=null),null!=I){if(C.skin.theobo&&C.skin.theobo.length>=1){if(""==C.skin.ao||!C.skin.ao){let i=t.images.find((t=>t.id==C.skin.theobo&&"ao"==t.type));i&&(C.skin.ao=i.name)}if(""==C.skin.quan||!C.skin.quan){let i=t.images.find((t=>t.id==C.skin.theobo&&"quan"==t.type));i&&(C.skin.quan=i.name)}if(""==C.skin.dau||!C.skin.dau){let i=t.images.find((t=>t.id==C.skin.theobo&&"dau"==t.type));i&&(C.skin.dau=i.name)}}if("move"!=i.action&&(I.skew.x=0),"move"==i.action?("left"==I.huong?I.skew.x=.08:"right"==I.huong&&(I.skew.x=-.08),this.playSound("chay",!0,I.x,I.id+"_chay")):this.deleteSound(I.id+"_chay"),"fly"==i.action&&(I.reset=1),"fly"!=i.action&&1==I.reset&&(n.pivot.set(0,0),n.rotation=0,I.reset=0,t.deleteSkill("fly_"+C.id),v.visible=!0),i.action,I.khongtrung=I.khongtrung||0,"fly"!=i.action&&"baylen"!=i.action||(I.khongtrung=1),"fly"!=i.action){I.actionReset="dungyen";let e=i.action;e="keepkame"==e?"dam2":e,"dungyen"==e&&(I.id,t.my.id),1==I.khongtrung&&"dungyen"==e&&(t.checkOnDat22(C.id)?I.khongtrung=0:e="baylen"),I.id==t.my.id&&"dotay"!=e&&t.keysPressed[40]&&!t.checkOnDat22(C.id)&&(e="dotay"),[n,a,o].forEach((i=>{if(i===a&&(g=C.skin.quan,c=a.sprite,m=t.getImg(g).farm[0][e],m)){if(u=m.farme,y=u.length,a.x=m.x,m.width<1&&m.height<1){let t=m.width,i=m.height;t+=m.width_m>0?m.width_m:0,i+=m.height_m>0?m.height_m:0,a.scale.set(t,i)}else a.width=m.width,a.height=m.height;a.y=Math.abs(t.getImg(C.skin.dau).farm[0][e].y),a.texture=this.coverImg(this.getFarm(g,c,e)),a.sprite+1>y&&(a.sprite=0),a.time=a.time||0,y>1&&(a.time+=1,a.time%2==0&&a.sprite++)}if(i===n&&(g=C.skin.ao,c=n.sprite,m=t.getImg(g).farm[0][e],m)){if(u=m.farme,y=u.length,n.x=m.x+(m.xx<0||m.xx>0?m.xx:0),n.y=Math.abs(t.getImg(C.skin.dau).farm[0][e].y)-Math.abs(t.getImg(C.skin.ao).farm[0][e].y),m.width<1&&m.height<1){let t=m.width,i=m.height;t+=m.width_m>0?m.width_m:0,i+=m.height_m>0?m.height_m:0,n.scale.set(t,i)}else n.width=m.width,n.height=m.height;n.time=n.time||0,n.texture=this.coverImg(this.getFarm(g,c,e)),n.sprite+1>y?n.sprite=0:y>1&&(n.time+=1,n.time%2==0&&n.sprite++)}if(i===o&&(g=C.skin.dau,c=o.sprite,m=t.getImg(g).farm[0][e],m)){if(u=m.farme,y=u.length,o.x=m.x+(m.xx<0||m.xx>0?m.xx:0),o.y=Math.abs(t.getImg(C.skin.quan).farm[0][e].y),m.width<1&&m.height<1){let t=m.width,i=m.height;t+=m.width_m>0?m.width_m:0,i+=m.height_m>0?m.height_m:0,o.scale.set(t,i)}else o.width=m.width,o.height=m.height;o.texture=this.coverImg(this.getFarm(g,c,e)),o.sprite+1>y&&(o.sprite=0),y>1&&o.sprite++}}))}else if("fly"==i.action){if(I.actionReset="baylen",I.oldACT="fly",w=t.getImg(C.skin.quan),f=t.getImg(C.skin.ao),p=t.getImg(C.skin.dau),!p.farm[0].flymove)return;if(!f.farm[0].flymove)return;if(!w.farm[0].flymove)return;if(a.sprite=0,g=C.skin.quan,c=a.sprite,m=t.getImg(g).farm[0].flymove,u=m.farme,y=u.length,a.x=m.x,a.y=m.y,a.texture=this.coverImg(this.getFarm(g,c,"flymove")),m.width>0&&m.height>=0){let t=m.width,i=m.height;t+=m.width_m>0?m.width_m:0,i+=m.height_m>0?m.height_m:0,a.scale.set(t,i)}if(n.texture=this.coverImg(this.getFarm(C.skin.ao,0,"flymove")),n.sprite=0,n.x=f.farm[0].flymove.x,n.y=f.farm[0].flymove.y,f.farm[0].flymove.width>0&&f.farm[0].flymove.height>=0){let t=f.farm[0].flymove.width,i=f.farm[0].flymove.height;t+=f.farm[0].flymove.width_m>0?f.farm[0].flymove.width_m:0,i+=f.farm[0].flymove.height_m>0?f.farm[0].flymove.height_m:0,n.scale.set(t,i)}if(o.texture=this.coverImg(this.getFarm(C.skin.dau,0,"flymove")),o.sprite=0,o.x=p.farm[0].flymove.x,o.y=p.farm[0].flymove.y,p.farm[0].flymove.width>0&&p.farm[0].flymove.height>=0){let t=p.farm[0].flymove.width,i=p.farm[0].flymove.height;t+=p.farm[0].flymove.width_m>0?p.farm[0].flymove.width_m:0,i+=p.farm[0].flymove.height_m>0?p.farm[0].flymove.height_m:0,o.scale.set(t,i)}let i=1;0==n.load&&(n.y-=i,o.y-=i,a.y-=i),n.load>=3&&(n.y+=i,o.y+=i,a.y+=i,n.load=0),n.load+=1,this.addEff({id:"fly_"+C.id,type:"flyKI",name:"kiBay",by:C.id})}"baylen"==i.action||i.action,0==n.load?(n.y-=1,o.y-=1,n.load+=1):10==n.load?(n.y+=1,o.y+=1,n.load=0):n.load+=1,I.giatoc=I.giatoc||0,I.giatoc+=1}if(v&&I){if("player"==C.type&&C.detu){let i=C.detu;if(i.id&&i.info&&i.info.trangthai&&"venha"==i.info.trangthai){I.detu=0;let e=t.Charset.find((t=>t.id==i.id));e&&t.deleteNguoiChoi(i.id)}}v.x=I.x,v.y=I.y,v.width=I.width,v.height=I.height,v.scale.x=I.scale.x,v.scale.y=I.scale.y,v.pivot.x=I.pivot.x,v.pivot.y=I.pivot.y,v.resolution=2,v.rotation=I.rotation,v.visible=I.visible,I.id=C.id,I.name=C.id,I.namdat=I.namdat||0,"dungyen"!=C.info.act&&(I.namdat=0),I.dungyen=I.dungyen||0,"dungyen"==C.info.act&&0==I.dungyen&&"player"==C.type?(I.dungyen=1,t.addEff({type:"dungyen",by:C.id,id:"haoquang"+C.id})):"dungyen"!=C.info.act&&(I.dungyen=0),"dungyen"==C.info.act&&0==I.namdat&&C.type,"flymove"!=C.info.act&&("left"==I.huong&&-1!=I.scale.x&&(I.scale.x=-1,I.pivot.x=0),"right"==I.huong&&1!=I.scale.x&&(I.scale.x=1,I.pivot.x=I.width));let i,e=v.getChildByName("playerDrawGraphic");if(null==e){e=new PIXI.Graphics,e.name="playerDrawGraphic",v.addChild(e);let i=t.Text("x,y:"+Math.round(I.x)+", "+Math.round(I.y)+" #"+I.id).size(11).vien(0,4).dam();i.name="playerDrawGraphicText",e.addChild(i),i.y=0-i.height,"npc"!=C.type&&(i.visible=!1)}else"npc"!=C.type&&(e.getChildByName("playerDrawGraphicText").text="x,y:"+Math.round(I.x)+", "+Math.round(I.y)+" "),e.clear(),e.lineStyle(1,0,1),e.beginFill(0,.1),e.drawRect(0,0,Math.abs(I.width),I.height),e.endFill(),e.visible=!1;if(I.getBounds().width>=1&&(I.maxWidth=I.maxWidth||I.getBounds().width),I.maxWidth>=10){if("mob"==C.type&&-1!=t.setting.mouse&&t.setting.mouse!=C.id&&1==I.selectedBarHp){I.selectedBarHp=0;let t=v.getChildByName("playerisHP");i=v.getChildByName("playerisHP2"),t&&t.destroy(),i&&i.destroy()}if("mob"==C.type&&-1!=t.setting.mouse&&t.setting.mouse==C.id){I.selectedBarHp=1;let t=v.getChildByName("playerisHP");null==t&&(t=new PIXI.Graphics,t.name="playerisHP",v.addChild(t)),t.clear(),t.lineStyle(1,0,1),t.beginFill(7234670,1),t.drawRoundedRect(0,0,Math.abs(I.maxWidth),5,20),t.endFill(),i=v.getChildByName("playerisHP2"),null==i&&(i=new PIXI.Graphics,i.name="playerisHP2",v.addChild(i)),i.clear(),i.lineStyle(1,0,1);let e=6349083;C.info.chiso.hp<C.info.chiso.hpFull/2&&(e=16381957),C.info.chiso.hp<C.info.chiso.hpFull/4&&(e=16711680),i.beginFill(e,1),i.drawRoundedRect(0,0,Math.abs(I.maxWidth)*(C.info.chiso.hp/C.info.chiso.hpFull),5,20),i.endFill(),i.x=0,i.width=Math.abs(I.maxWidth)*(C.info.chiso.hp/C.info.chiso.hpFull),i.height=5,i.y=-i.height-10,t.y=-i.height-10,"right"==I.huong?(i.scale.set(1,1),i.pivot.x=0):"left"==I.huong&&(i.scale.set(-1,1),i.pivot.x=-i.width)}}let h=v.getChildByName("playerisName");if(null==h){let i=16777215;"npc"==C.type&&(i=16381957),"mob"==C.type&&(i=16711680),"boss"==C.type&&(i=16711680),C.of>=1&&(i=65278),t.my.skin.bangID>=1&&C.skin.bangID>=1&&t.my.skin.bangID==C.skin.bangID&&(i=7778618),h=new PIXI.Text(C.name+(1==t.gameInfo.debug?"["+C.id+"]":""),{fontFamily:"Arial",fontSize:14,fill:i,fontWeight:"bold",align:"center"}),h.name="playerisName",v.addChild(h),h.scale.set(1,1),h.pivot.x=h.width/2,"npc"!=C.type&&"boss"!=C.type||(h.resolution=2,h.style.stroke="#000000",h.style.strokeThickness=4),"mob"==C.type&&(h.resolution=2,h.style.stroke="#000000",h.style.strokeThickness=4,h.style.dropShadow=!0,h.style.dropShadowColor="#000000",h.style.dropShadowBlur=4,h.style.dropShadowAngle=Math.PI/6,h.style.dropShadowDistance=6),C.id==t.my.id&&(h.visible=!1),h.pivot.x=h.width/2}else h.x=Math.abs(I.width)/2-Math.abs(h.width)/2,h.y=-h.height-10,I.sound?h.text=C.name+" 🎙️":h.text=C.name,h.text=C.name+(1==t.gameInfo.debug?"["+C.id+"]":""),"right"==I.move?(h.scale.set(1,1),h.pivot.x=0,I.huong="right"):"left"==I.move&&(h.scale.set(-1,1),h.pivot.x=h.width,I.huong="left");"mob"==C.type&&(h.visible=!1);let a=v.getChildByName("playerisClick");if(null==a?(a=new PIXI.Sprite(t.coverImg("PreviewClick")),a.name="playerisClick",v.addChild(a),a.load=1):(a.width=20,a.height=20,h&&(a.x=Math.abs(I.width)/2-Math.abs(a.width)/2,a.y=h.y-a.height,2==a.load&&(a.y-=1),4==a.load&&(a.y+=1,a.load=0),a.load++)),"npc"==C.type){let i=v.getChildByName("iconnhiemvu");if(i){i.x=Math.abs(I.width)/2-Math.abs(i.width)/2,i.y=h.y-i.height;let e=["q_nhiemvu_1","q_nhiemvu_2","q_nhiemvu_3"];i.load++,i.load>=1e4&&(i.load=0),i.load%t.fps()==0&&(i.texture=this.coverImg(e[i.start]),i.start++,i.start>=e.length&&(i.start=0))}else i=new PIXI.Sprite(t.coverImg("q_nhiemvu_1")),i.name="iconnhiemvu",v.addChild(i),i.width=30,i.height=30,i.load=1,i.start=0;i.visible=!1,t.my.nhiemvu.data.id==C.id&&(i.visible=!0)}if("player"==C.type&&!C.of){let i=v.getChildByName("iconTuongTac");null==i?(i=new PIXI.Sprite(t.coverImg("myTexture2dchat-resources.assets-101")),i.name="iconTuongTac",v.addChild(i),i.width=40,i.height=40,i.interactive=!0,i.cursor="pointer",i.on("mouseover",(function(){i.texture=t.coverImg("myTexture2dchat2-resources.assets-430")})),i.on("mouseout",(function(){i.texture=t.coverImg("myTexture2dchat-resources.assets-101")})),i.on("pointerdown",(function(){t.viewInfoPlayer(C.id)}))):(i.x=Math.abs(I.width)/2-Math.abs(i.width)/2,i.y=h.y-a.height-i.height),-1!=t.setting.mouse&&t.setting.mouse==C.id?i.visible=!0:i.visible=!1}-1!=t.setting.mouse&&t.setting.mouse==C.id?a.visible=!0:a.visible=!1;let s=v.getChildByName("playisChoang");null==s?(s=new PIXI.Sprite,s.name="playisChoang",v.addChild(s),s.src=["968","969","970"],s.start=0,s.time=0):(s.time++,s.time>=1e4&&(s.time=0),s.time%2==0&&(s.texture=this.coverImg(s.src[s.start]),s.start++,s.start>=s.src.length&&(s.start=0)),s.width=70,s.height=40,s.x=Math.abs(I.width)/2-Math.abs(s.width)/2,s.y=h.y-s.height);let d=v.getChildByName("rungu");if(null==d)d=new PIXI.Sprite(t.coverImg("rungu")),d.name="rungu",v.addChild(d);else{let t=["rungu1","rungu2","rungu3","rungu4"];d.time=d.time?d.time:0,d.start=d.start?d.start:0,d.time++,d.time>=1e4&&(d.time=0),d.time%2==0&&(d.texture=this.coverImg(t[d.start]),d.start++,d.start>=t.length&&(d.start=0)),d.width=24,d.height=27,d.x=Math.abs(I.width)/2+Math.abs(d.width)/2,d.y=0}if(C.eff&&(C.eff.thaiduonghasan&&1==C.eff.thaiduonghasan.active?(s.visible=!0,I.action=C.info.act,I.tdhs=1,C.info.act="choang",t.addAction({id:C.id,action:C.info.act}),C.id==t.my.id&&(t.GrapSCwhite.visible=!0)):(s.visible=!1,"choang"==C.info.act&&I.tdhs&&1==I.tdhs&&(C.info.act=I.action?I.action:"dungyen",t.addAction({id:C.id,action:C.info.act}),I.tdhs=0),C.id==t.my.id&&(t.GrapSCwhite.visible=!1)),C.eff.taitaonangluong&&1==C.eff.taitaonangluong.active&&("gong"!=C.info.act&&(I.action=C.info.act,C.info.act="gong",t.addAction({id:C.id,action:C.info.act})),t.addEff({type:"taitaonangluong",aim:C.id,id:"taitaonangluong_"+C.id,name:"taitaonangluong",level:1})),C.eff&&C.eff.hoakhi&&1==C.eff.hoakhi.status&&t.addEff({type:"hoakhi",uid:C.id,id:"hoakhi_"+C.id,name:"hoakhi",level:1}),C.eff.khieng&&1==C.eff.khieng.active&&t.addEff({type:"khieng",uid:C.id,id:"khieng_"+C.id,name:"khieng",level:1}),C.eff.rungu&&1==C.eff.rungu.active?d.visible=!0:d.visible=!1),"mob"!=C.type||C.id==t.my.id){let t=v.getChildByName("playerIsDie");if(null==t){t=new PIXI.Sprite(this.coverImg("834")),t.name="playerIsDie",v.addChild(t),t.visible=!1;const i=new PIXI.filters.BlurFilter;i.blur=0,t.filters=[i],t.width=50,t.height=50,t.x=Math.abs(I.width)/2-Math.abs(t.width)/2,t.y=h.y-t.height}if(b.info.chiso.hp<=0){let t=new PIXI.filters.ColorMatrixFilter;t.blackAndWhite(!0),I.filters=[t]}else I.filters=[];let i=v.getChildByName("co");if(i)b.skin.bang>=1?(i.time=i.time?i.time:0,i.start=i.start?i.start:0,0==i.time&&(i.src=this.base_co.find((t=>t.id==b.skin.bang)).src,i.width=this.base_co.find((t=>t.id==b.skin.bang)).width,i.height=this.base_co.find((t=>t.id==b.skin.bang)).height),i.visible=!0,i.setY=i.setY||n.height,i.setY<=10&&(i.setY=n.height),i.y=n.y+i.setY-i.height,i.x=o.x-i.width/2+o.width/4,i.time++,i.time>=1e3&&(i.time=0),i.time%5==0&&i.src.length>=1?(i.texture=this.coverImg(i.src[i.start]),i.start++,i.start>=i.src.length&&(i.start=0)):i.time%10==0&&(0==i.start?(i.y-=1,i.start=1):1==i.start&&(i.y+=1,i.start=0))):i.visible=!1;else{let t=new PIXI.Sprite;t.name="co",t.visible=!1,v.addChild(t)}let e=v.getChildByName("coPK");if(e)if(C.skin.coPK>0){e.visible=!0;let t=[0,2323,2324,2325,2326,2327,2328,2329,2330,2331];e.texture=this.coverImg(t[C.skin.coPK]),e.width=20,e.height=20,e.x=Math.abs(I.width)/2-Math.abs(e.width)/2,e.y=h.y-a.height,1==a.visible&&(e.x+=a.width),2==e.load&&(e.y-=1),4==e.load&&(e.y+=1,e.load=0),e.load++}else e.visible=!1;else e=new PIXI.Sprite,e.name="coPK",e.load=0,e.visible=!1,v.addChild(e)}}e("success")}))))]).then((t=>{}))}}class Wt extends Ft{constructor(){super(),this.nextMap={id:0,zone:-1,x:0,y:0}}veNha=()=>{let t=this.my,i={traidat:{map:1,x:730,y:-40},saiyan:{map:52,x:904,y:-43},namek:{map:24,x:1245,y:-43}};this.to(-32,{type:"checked",map:i[t.info.coban.type].map,zone:-1,x:i[t.info.coban.type].x,y:i[t.info.coban.type].y})};baynhanh=(t,i)=>{let e=t[0],h=t[1],n=t[2];this.to(-32,{type:"checked",map:n,zone:-1,x:this.rand(e,h),y:i})};ketNoiPhiThuyen=()=>{this.inGame.visible=!1,this.loadGame.visible=!0,this.to(-32,{type:"join",map:this.nextMap.map,zone:this.nextMap.zone,x:this.nextMap.x,y:this.nextMap.y}),this.deleteNotice(),this.Charset=[],this.resetNone(),this.my.pos.x=this.nextMap.x,this.my.pos.y=this.nextMap.y,this.NhanVat.x=this.nextMap.x,this.NhanVat.y=this.nextMap.y,this.my.pos.map=this.nextMap.id,this.NhanVatGoc.x=this.NhanVat.x,this.NhanVatGoc.y=this.NhanVat.y};phithuyen_Handle=t=>{let i=["phiThuyenTraiDat","myTexture2dmaybay2-resources.assets-1251","myTexture2dmaybay3-resources.assets-233"],e=["phiThuyenTraiDat","myTexture2dmaybay2-resources.assets-1251","myTexture2dmaybay3-resources.assets-233"],h=0,n=this.getNhanVat(t.uid);if(!n)return t.type="delete";let a=this.getMy(n.id);if(!a)return t.type="delete";h={traidat:0,namek:1,saiyan:2}[a.info.coban.type];let o=this.getEff(t.id),s=this.imgEff(o,t.id);if(s.run=s.run||1,s.time=s.time||0,s.time++,1==s.run){this.playSound("bay",!1,n.x,"bay"+t.id),s.run="1_0",s.y=this.gameMap.setting.minY,s.x=n.x-Math.abs(n.width)-s.width,s.to=n.y;let a=n.y;n.y=this.gameMap.setting.minY>>0,n.visible=!1,s.texture=this.coverImg(i[h]),s.width=100,s.height=100,new TWEEN.Tween(s).to({y:a},2e3).onUpdate((()=>{n.y=s.y,n.visible=!1,this.my.id==t.uid&&(this.NhanVatGoc.y=s.y)})).onComplete((()=>{s.action=30,s.run=2,s.texture=this.coverImg(e[h])})).start()}2==s.run&&s.time%this.fps()==0&&(this.action(t.uid,"dungyen"),n.visible=!0,s.run=3,this.my.id==t.uid&&this.xulynamdat(t.uid)),3==s.run&&(s.run=4,new TWEEN.Tween(s).to({y:this.gameMap.setting.minY},1e3).onComplete((()=>{t.type="delete"})).start())};phithuyenHandle=t=>{let i=["phiThuyenTraiDat","myTexture2dmaybay2-resources.assets-1251","myTexture2dmaybay3-resources.assets-233"],e=["phiThuyenTraiDat","myTexture2dmaybay2-resources.assets-1251","myTexture2dmaybay3-resources.assets-233"],h=0,n=this.getNhanVat(t.uid);if(!n)return t.type="delete";let a=this.getMy(n.id);if(!a)return t.type="delete";h={traidat:0,namek:1,saiyan:2}[a.info.coban.type];let o=this.getEff(t.id),s=this.imgEff(o,t.id);s.run=s.run||1,s.time=s.time||0,s.time++,1==s.run&&(this.playSound("bay",!1,n.x,"bay"+t.id),s.run=2,s.y=n.y-this.gameHeight,s.x=n.x-Math.abs(n.width)-s.width,s.texture=this.coverImg(i[h]),s.width=100,s.height=100,new TWEEN.Tween(s).to({y:n.y},1e3).onComplete((()=>{s.action=30,s.texture=this.coverImg(e[h])})).start()),2==s.run&&s.time%this.fps()==0&&s.action>=1&&(s.action--,n.y-=2,this.action(t.uid,"baylen"),s.action<=0&&(s.run=3,n.visible=!1,this.my.id==t.uid&&(this.NhanVatGoc.y=n.y))),3==s.run&&(s.run=4,new TWEEN.Tween(s).to({y:this.gameMap.setting.minY},1e3).onUpdate((()=>{n.y=s.y,n.visible=!1,this.my.id==t.uid&&(this.NhanVatGoc.y=s.y)})).onComplete((()=>{n.visible=!0,t.type="delete",this.my.id==t.uid&&this.ketNoiPhiThuyen()})).start())}}class Mt extends Wt{constructor(){super()}baylenEFF2=t=>{let i=this.getEff(t.id),e=this.imgEff(i,t.id),h=this.getNhanVat(t.by);if(!h)return t.type="delete";let n=[2155,2156,2157];if(e.run=e.run||1,1==e.run){e.run=2;let a=new PIXI.AnimatedSprite(n.map((t=>this.coverImg(t))));a.animationSpeed=.2,a.loop=!1,a.x=h.x-Math.abs(h.width)-50,a.y=h.y+a.height/2,a.scale.set(.5),a.play(),i.addChild(a),a.onComplete=()=>{t.type="delete"}}};baylenEFF=t=>{let i=this.getEff(t.id),e=this.imgEff(i,t.id),h=this.getNhanVat(t.by);if(!h)return t.type="delete";let n=[2155,2156,2157];if(e.run=e.run||1,1==e.run){e.run=2;let a=new PIXI.AnimatedSprite(n.map((t=>this.coverImg(t))));a.animationSpeed=.2,a.loop=!1,a.x=h.x-Math.abs(h.width)-50,a.y=h.y+80+a.height/2,a.scale.set(.5),a.play(),i.addChild(a),a.onComplete=()=>{t.type="delete"}}};moveEFF=t=>{let i=this.getEff(t.id),e=this.imgEff(i,t.id),h=this.getNhanVat(t.by);if(!h)return t.type="delete";let n=["now_chay_3","now_chay_2","now_chay_1"];if(e.run=e.run||1,1==e.run){e.run=2;let a=new PIXI.AnimatedSprite(n.map((t=>this.coverImg(t))));a.animationSpeed=.5,a.loop=!1,a.x=h.x-Math.abs(h.width)-50,a.y=h.y+h.height-a.height/2,a.play(),i.addChild(a),a.onComplete=()=>{t.type="delete"}}}}class Nt extends Mt{constructor(){super()}hanleKhieng=t=>{let i=this.getEff(t.id),e=this.imgEff(i,t.id),h=["k1","k1","k2","k2"],n=this.getNhanVat(t.uid);if(!n)return t.type="delete";let a=this.getMy(t.uid);if(!a)return t.type="delete";e.time=e.time||0,e.time+=1,e.width=150,e.height=150,e.x=n.x-Math.abs(n.width)/2-e.width/2,e.y=n.y+n.height/2-e.height/2,e.start=e.start||0,e.time%this.fps()&&(e.start+=1,e.start>=h.length&&(e.start=0)),e.texture=this.coverImg(h[e.start]),0==a.eff.khieng.active&&(t.type="delete")}}class Gt extends Nt{constructor(){super()}handleQCKK=t=>{let i=this.getSpriteMap(t.from);if(!i)return t.type="delete";let e=this.getSpriteMap(t.to);if(!e)return t.type="delete";let h=this.getInfoMap(t.from);if(!h)return t.type="delete";if(!this.getInfoMap(t.to))return t.type="delete";let n=this.getEff(t.id),a=this.imgEff(n,t.id);if(a.time=a.time||0,a.time+=1,a.bay=a.bay||2,a.setY=a.setY||null,2==a.bay&&(a.bay=3,this.checkOnDat22(h.id)?a.setY=i.y-150:a.bay=4),null!=a.setY&&a.time%this.fps()==0&&(i.y-=h.info.speed,i.y<=a.setY&&(a.setY=null,a.bay=4),h.pos.y=i.y,this.action(h.id,"baylen"),h.id==this.my.id&&(this.NhanVatGoc.y=i.y,this.timeRoiTuDo=0,this.sendMyMove())),4==a.bay){let t=[2175,2176,2177];if(a.start=a.start||0,a.width=150,a.height=150,a.x=i.x+Math.abs(i.width)/2-a.width/2,a.y=i.y-a.height,a.pivot.x=a.width/2,a.time%this.fps()&&(a.start+=1,a.start>=t.length&&(a.start=0)),a.texture=this.coverImg(t[a.start]),this.action(h.id,"dotay"),h.id==this.my.id&&(this.timeRoiTuDo=0),a.run=a.run||0,a.eff=a.eff||50,0==a.run&&a.eff>=1){a.run=1;for(let t=0;t<=10;t++){a.eff-=1;let t,i,e=new PIXI.Sprite(this.coverImg(1==this.rand(1,5)?64:438));t=this.rand(1,10)<=5?this.rand(this.gameMap.setting.minX-10,this.gameMap.setting.minX):this.rand(this.gameMap.setting.maxX,this.gameMap.setting.maxX+10),i=this.rand(1,10)<=5?this.rand(this.gameMap.setting.minY-10,this.gameMap.setting.minY):this.rand(this.gameMap.setting.maxY,this.gameMap.setting.maxY+10),e.x=t,e.y=i,e.width=48,e.height=48,n.addChild(e),e.pivot.x=e.width/2,new TWEEN.Tween(e).to({x:a.x,y:a.y+a.height/2},500).onComplete((()=>{n.removeChild(e),a.eff<=0?(h.id==this.my.id&&(this.timeRoiTuDo=Date.now()+200),this.action(h.id,"baylen"),a.bay=5):a.run=0})).start()}}}if(5==a.bay){let i=[2175,2176,2177];a.time%this.fps()&&(a.start+=1,a.start>=i.length&&(a.start=0)),a.texture=this.coverImg(i[a.start]);let h=100,n=a.x,o=a.y,s=(e.x+Math.abs(e.width)/2-a.width/2-n)/h,d=(e.y+e.height/2-a.height/2-o)/h;a.x+=s,a.y+=d,this.vaCham(a,e)&&(a.visible=!1,this.addEff({type:"nhapnhay"}),this.addEff({name:"bumbumbumQCKK",type:"bum",aim:t.to,level:1}),(t.from==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==t.from)&&this.msgAttack(t),t.type="delete")}}}class Rt extends Gt{constructor(){super()}EffPlayer=async(t,i=null)=>{t.them&&(i=t.them);let e=this.getEff(t.id),h=this.imgEff(e,t.id),n=this.getNhanVat(t.by);if(!n)return t.type="delete";h.run=h.run||1;let a=this.getMy(n.id),o=[],s=(a.info.coban.sucmanh,a.info.coban.type,[{src:[984,964,965,966,967,982,983],width:100,height:130,speed:.5},{src:[971,972,973,974],width:80,height:50,speed:.4},{src:[986,975,977,978],width:100,height:120,speed:.5},{src:[984,964,965,966,967,982,983],width:100,height:130,speed:.5,them:1},{src:[971,972,973,974],width:80,height:50,speed:.4,them:2},{src:[986,975,977,978],width:100,height:120,speed:.5,them:"0"},{sheet:"aura_13_0",length:4,width:150,height:200,w:400,h:1600,speed:.5}]),d=6;null!=i&&(d=i),o=s[d].src;let l=s[d].width,r=s[d].height,g=s[d].speed,c=s[d].sheet;if(1==h.run){if(null==i&&s[d].them&&this.addEff({type:"dungyen",by:n.id,id:"haoquang_2_"+n.id+"_"+Date.now(),them:s[d].them}),h.run=2,o&&(o=o.map((t=>this.coverImg(t)))),c){o=[];let t=await new PIXI.Sprite(this.coverImg(c)),i=s[d].w,e=s[d].h,h=s[d].length;for(let n=0;n<h;n++){let a=new PIXI.Texture(t.texture,new PIXI.Rectangle(0,e/h*n,i,e/h));o.push(a)}}let t=new PIXI.AnimatedSprite(o);t.animationSpeed=g,t.loop=!0,t.x=n.x-Math.abs(n.width)-50,t.y=n.y+t.height/2,t.width=l,t.height=r,t.play(),t.name="eff",t.visible=!1,t.time=Date.now()+300,e.addChild(t),e.zIndex=n.zIndex-1}let m=e.getChildByName("eff");m&&(m.time<Date.now()&&(m.visible=!0),m.y=n.y-m.height+n.height,m.x=n.x-m.width/2-Math.abs(n.width)/2,m.pivot.x=n.width/2),t.timeOfSkill=Date.now()+1e4,a&&("dungyen"!=a.info.act||a.info.chiso.hp<=0)&&(t.type="delete")}}class Dt extends Rt{constructor(){super()}action=(t,i)=>this.addAction({id:t,action:i});vaCham=(t,i)=>{const e=t.getBounds();if(!e)return!1;const h=i.getBounds();if(!h)return!1;const n=e.x+e.width/2,a=e.y+e.height/2;return n>=h.x&&n<=h.x+h.width&&a>=h.y&&a<=h.y+h.height};getNhanVat=t=>this.getSpriteMap(t);getMy=t=>this.getInfoMap(t);hanlehoaKhi=t=>{let i=this.getEff(t.id),e=this.imgEff(i,t.id),h=[2175,2175,2176,2176,2177,2177],n=this.getNhanVat(t.uid);if(!n)return t.type="delete";let a=this.getMy(t.uid);if(!a)return t.type="delete";e.time=e.time||0,e.time+=1,e.width=150,e.height=150,e.x=n.x+Math.abs(n.width)/2-e.width/2,e.y=n.y+n.height/2-e.height/2,e.pivot.x=e.width/2,e.start=e.start||0,e.time%this.fps()&&(e.start+=1,e.start>=h.length&&(e.start=0)),e.texture=this.coverImg(h[e.start]),"gong"!=a.info.act&&this.action(a.id,"gong"),0==a.eff.hoakhi.status&&(t.type="delete",this.action(a.id,"dungyen"))};handeHoaKhiDamChuong=t=>{let i=this.getNhanVat(t.by);if(!i)return t.type="delete";let e=this.getMy(t.by),h=this.getNhanVat(t.aim);if(!h)return t.type="delete";let n=this.getEff(t.id),a=this.imgEff(n,t.id),o=[5723,5724];if(a.time=a.time||0,a.time+=1,a.width=150,a.height=150,a.start=a.start||0,a.run=a.run||0,a.texture=this.coverImg(o[a.start]),a.time%this.fps()&&(a.start+=1,a.start>=o.length&&(a.start=0)),a.pivot.x=a.width/2,0==a.run&&(a.x=i.x+Math.abs(i.width)/2-a.width/2,a.y=i.y+i.height/2-a.height/2,a.run=1,this.action(t.by,"dotay")),1==a.run){let i=50,n=a.x,o=a.y,s=(h.x+Math.abs(h.width)/2-a.width/2-n)/i,d=(h.y+h.height/2-a.height/2-o)/i;a.x+=s,a.y+=d,this.vaCham(h,a)&&(a.visible=!1,this.addEff({name:"Kamejoko",aim:t.aim,level:1,type:"bum"}),t.type="delete",(e.id==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==e.id)&&this.msgAttack(t))}setTimeout((()=>{this.resetAction(t.by)}),200)};handeHoaKhiDam=t=>{let i=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by);if(!i)return t.type="delete";if(!t.keyid)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,"backGround");h.start=h.start||0,h.time=h.time+1||0,h.src=[2146,2147],h.texture=h.time%this.fps()==0?this.coverImg(h.src[h.start]):h.texture,h.start=h.time%this.fps()==0?h.start+1:h.start,h.start=h.start>=h.src.length?0:h.start,h.width=i.width>h.texture.width?i.width:h.texture.width,h.height=i.height>h.texture.height?i.height:h.texture.height,h.x=i.x-Math.abs(h.width)/2-Math.abs(i.width)/2,h.y=i.y-h.height/2+i.height/2,h.visible=!1;let n=this.imgEff(e,"playerNew");if(n.alpha=.8,n.start=n.start||0,n.time=n.time+1||0,n.src=[2169,2170,2171,2172],n.texture=n.time%this.fps()==0?this.coverImg(n.src[n.start]):n.texture,n.start=n.time%this.fps()==0?n.start+1:n.start,n.start=n.start>=n.src.length?n.src.length:n.start,n.width=Math.abs(i.width)/100*150,n.height=Math.abs(i.height)/100*150,n.height=n.height>n.texture.height?n.texture.height:n.height,n.width=n.width>n.texture.width?n.texture.width:n.width,n.x=i.x-n.width/2,n.y=i.y-n.height+i.height,n.pivot.x=n.width/2,n.load=n.load||0,n.combo=n.combo||[],n.delay=n.delay||0,n.done=n.done||0,1==n.done)return t.type="delete";if(1!=n.load){for(let t=1;t<=this.rand(2,4);t++)n.combo.push(this.base_combo[this.rand(0,this.base_combo.length-1)]);n.load=1}let a=[[2148,2195],[2149,2198],[2162,2163],[2194,2197],[2193,2196]],o=this.imgEff(e,"donDam");if(o.scale.x="right"==i.huong?1:-1,o.start=o.start||0,o.time=o.time+1||0,o.id_base=o.id_base||this.rand(0,a.length-1),o.src=a[o.id_base],o.texture=o.time%this.fps()==0?this.coverImg(o.src[o.start]):o.texture,o.start=o.time%this.fps()==0?o.start+1:o.start,o.start=o.start>=o.src.length?o.src.length:o.start,o.width=100,o.height=100,o.x=i.x-o.width/2,o.y=i.y-o.height+i.height,o.start>=o.src.length&&n.start>=n.src.length&&n.delay<Date.now()){if(o.start=0,o.id_base=null,n.start=0,n.combo.length<=0)return this.resetAction(i.id),(i.id==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==i.id)&&this.msgAttack(t),n.done=1;if(this.addEff({type:"hieuungTrungDon",aim:t.aim}),n.combo.length>=1){let i=t.by==this.my.id?this.my:this.Charset.find((i=>i.id==t.by));if(!i)return t.type="delete";if(!i.info)return t.type="delete";if(!i.info.act)return t.type="delete";i.info.act!=n.combo[0]&&(i.info.act,n.combo[0],this.addAction({id:i.id,action:n.combo[0]})),n.combo.shift()}}}}class Et extends Dt{constructor(){super()}getSpriteMap=t=>{let i=!1;return i=t==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t),i||!1};getInfoMap=t=>{let i=!1;return i=t==this.my.id?this.my:this.Charset.find((i=>i.id==t)),i||!1};handleKamejoko=t=>{let i=t.from,e=t.to,h=this.getSpriteMap(i),n=this.getSpriteMap(e);if(!h||!n)return t.type="delete";let a=this.getEff(t.id),o=this.imgEff(a,t.id);if(o.start=o.start||0,0==o.start){o.start=1;let t=h.y-50,i=h.x,e=n.x,s=n.y,d=new PIXI.Sprite(this.coverImg("64"));d.name="goc",a.addChild(d),d.x=i,d.y=t;let l=3;for(let t=0;t<l;t++){let i=new PIXI.Sprite(this.coverImg("64"));i.x=d.x-i.width*t,i.y=d.y,i.name="kame",d=i,a.addChild(i)}const r=.9;let g=Math.sqrt(Math.pow(e-i,2)+Math.pow(s-t,2))/r;new TWEEN.Tween(d).to({x:e,y:s},g).easing(TWEEN.Easing.Linear.None).onComplete((function(){})).start()}let s=this.imgEff(a,"goc"),d=a.children.filter((t=>"kame"==t.name));d.length>0&&d.forEach(((t,i)=>{t.x=s.x-t.width*i}))}}class Ht extends Et{constructor(){super()}tickerUpdateMouseClickPlayer=()=>{this.isClickPlayer(),this.isNotClickPlayer()};isNotClickPlayer=()=>{if(this.my.id<=0)return!1;if(0==this.setting.mouse||-1==this.setting.mouse&&this.dem%10==0){let t=-1;this.khungThongTinDoiThu.visible=!1,this.Charset.forEach((i=>{let e=this.getNhanVat(i.id);if(!e)return!1;let h=this.calculateDistanceXandWidth(this.NhanVat,e),n=100;"mob"!=i.type&&"player"!=i.type&&"boss"!=i.type||(n=400);let a=this.getNhanVat(i.id);h<n&&(-1==t||h<t)&&1==a.visible&&(t=h,this.setting.mouse=i.id)}))}};isClickPlayer=()=>{if(1==this.autoAttack)return!1;if(this.my.id<=0)return!1;if(0!=this.setting.mouse){let t=this.Charset.find((t=>t.id==this.setting.mouse));if(t){let i=this.nguoichoi.children.find((i=>i.id==t.id));if(!i)return this.setting.mouse=0;if(0==i.visible)return this.setting.mouse=0;let e=this.calculateDistanceXandWidth(this.NhanVat,i);e=Math.round(e);let h=100;"mob"!=i.type&&"player"!=i.type&&"boss"!=t.type||(h=400),e>h&&(this.setting.mouse=-1,this.khungThongTinDoiThu.visible=!1),this.khungThongTinDoiThu.visible=!0,this.myHPText.text=this.number_format(t.info.chiso.hp)+"("+e+"cm)",this.myNameText.text=t.name,this.myHPText.x=this.backGoundInfoMMO.getBounds().width/2-this.myHPText.getBounds().width/2,this.myNameText.x=this.backGoundInfoMMO.getBounds().width/2-this.myNameText.getBounds().width/2}else this.setting.mouse=0,this.khungThongTinDoiThu.visible=!1}}}const At=class extends Ht{constructor(){super(),requestAnimationFrame(this.init)}getEff(t){let i=this.kiNang;if(null==i.getChildByName(t)){let e=new PIXI.Container;return e.id=t,e.name=t,i.addChild(e),e}return i.getChildByName(t)}imgEff(t,i){if(null==t.getChildByName(i)){let e=new PIXI.Sprite;return e.name=i,e.x=null,e.y=null,t.addChild(e),e}return t.getChildByName(i)}textEff(t,i){if(null==t.getChildByName(i)){let e=new PIXI.Text;return e.name=i,e.x=null,e.y=null,t.addChild(e),e}return t.getChildByName(i)}msgAttack=function(t){this.to(-6,t.keyid)};resetAction=function(t){let i=this.my,e=this.NhanVat,h=this.nguoichoi,n=t==i.id?e:h.getChildByName(t);n&&(n.actionReset=n.actionReset||"dungyen",this.addAction({id:t,action:n.actionReset}))};checkAction=function(t,i){let e=this.my,h=(this.NhanVat,this.nguoichoi,this.Charset,t==e.id?e:this.Charset.find((i=>i.id==t)));h&&h.info&&h.info.act&&h.info.act!=i&&(h.info.act=i,this.addAction({id:t,action:i}))};createArray(t,i){return Array.from({length:i-t+1},((i,e)=>e+t))}init=()=>{let t=this.dataSkill;this.logChat,t.forEach((t=>{if(t.timeOfSkill?t.timeOfSkill<Date.now()&&(t.type="delete"):t.timeOfSkill=Date.now()+12e4,t.dame>=1&&(t.aim,t.by==this.my.id&&this.my.info.chiso.hp<=0))return t.type="delete";if("delete"==t.type&&(t.sound&&this.deleteSound(t.sound),null!=this.kiNang.getChildByName(t.id)&&this.kiNang.removeChild(this.kiNang.getChildByName(t.id)),this.dataSkill=this.dataSkill.filter((function(i){return i.id!==t.id}))),"kamejoko"==t.type)return this.handleKamejoko(t);if("hoakhi"==t.type)return this.hanlehoaKhi(t);if("dungyen"==t.type)return this.EffPlayer(t);if("hoakhi"==t.type)return this.hanlehoaKhi(t);if("nangcap"==t.type){let i=this.screen.getChildByName("nangcap");if(!i){i=new PIXI.Container,i.name="nangcap",this.screen.addChild(i);let t=this.snowlyGraphics(this.gameWidth,this.gameHeight,0,0,.5,0,.5);t.name="manden",i.addChild(t)}let e=i.getChildByName("manden"),h=.9*e.width,n=.5*e.height;h>700&&(h=700);let a=e.getChildByName("nen2");if(!a){a=this.snowlyGraphics(h,n,16777215,0,1e-4,0,0),a.name="nen2",a.x=e.width/2-a.width/2,a.y=e.height/2-a.height/2,e.addChild(a);let i=new PIXI.Sprite(this.coverImg(t.idvp));i.width=48,i.x=a.width/2-i.width/2,i.y=a.y,i.name="img",a.addChild(i),i.time=0,i.eff=this.rand(10,20),i.run=0}let o=a.getChildByName("img");if(0==o.run&&o.eff>=1)for(let e=0;e<=this.rand(1,10);e++){o.run=1,o.eff-=1;let e,h,n=new PIXI.Sprite(this.coverImg(t.da));e=this.rand(1,10)<=5?this.rand(-10,0):this.rand(this.gameWidth,this.gameWidth+10),h=this.rand(1,10)<=5?this.rand(-10,0):this.rand(this.gameHeight,this.gameHeight+10),n.x=e,n.y=h,n.width,n.height,n.width=48,n.height=48,this.screen.addChild(n);let a=o.toGlobal(new PIXI.Point(0,0));new TWEEN.Tween(n).to({x:a.x,y:a.y},300).onComplete((()=>{o.timeCham=Date.now()+300,this.screen.removeChild(n);let e=this.createArray(1,21),h=[],s="success";s=1==t.up?s:"fail";let d="success"==s?"other/sao":"other/fai";e="success"==s?e:this.createArray(1,16);for(let t=0;t<e.length;t++)h.push(this.coverImg(e[t],d));if(o.eff<=0){this.ioInsertChat({_1:t.npc,_2:"success"==s?"Chúc mừng con nhé !":"Xin lỗi ta đã cố hết sức."});let e=h,n=new PIXI.AnimatedSprite(e);n.x=a.x+o.width/2-n.width/2,n.y=a.y+o.height/2-n.height/2,n.animationSpeed=.5,n.loop=!1,n.play(),n.name="eff",this.screen.addChild(n),n.onComplete=()=>{this.screen.removeChild(n),this.boxNangCapLv(t.npc),t.type="delete",this.screen.removeChild(i)}}else o.run=0})).start()}o.time++,o.timeCham>=Date.now()&&(o.time%2==0?o.x+=1:o.x-=1)}if("boom"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);e.src=[2175,2176,2177],e.time=e.time+1||0,e.start=e.start||0,e.width=150,e.height=150;let h=t.from==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.from);if(!h)return t.type="delete";if(e.x=h.x-e.width/2-Math.abs(h.width)/2,e.y=h.y-e.height/2+h.height/2,e.texture=e.time%this.fps()==0?this.coverImg(e.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start>=e.src.length&&(e.start=0),this.checkAction(t.from,"gong"),e.run=e.run||0,e.eff=e.eff||this.rand(40,60),0==e.run&&e.eff>=1){e.run=1;for(let h=0;h<=this.rand(10,30);h++){e.eff-=1;let h,n,a=new PIXI.Sprite(this.coverImg(1==this.rand(1,5)?64:438));h=this.rand(1,10)<=5?this.rand(this.gameMap.setting.minX-10,this.gameMap.setting.minX):this.rand(this.gameMap.setting.maxX,this.gameMap.setting.maxX+10),n=this.rand(1,10)<=5?this.rand(this.gameMap.setting.minY-10,this.gameMap.setting.minY):this.rand(this.gameMap.setting.maxY,this.gameMap.setting.maxY+10),a.x=h,a.y=n,a.width=48,a.height=48,i.addChild(a),new TWEEN.Tween(a).to({x:e.x+e.width/2,y:e.y+e.height/2},500).onComplete((()=>{i.removeChild(a),e.eff<=0?(this.resetAction(t.from),this.addEff({type:"nhapnhay"}),(t.from==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==t.from)&&this.msgAttack(t),t.type="delete"):e.run=0})).start()}}e.time,this.fps()}else if("loop"==t.type){let i=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!i)return t.type="delete";if(!t.src)return t.type="delete";if(0==i.visible)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,t.id);h.src=t.src,h.time=h.time+1||0,h.start=h.start||0,h.width=t.width||100,h.height=t.height||100,h.run=h.run||0,h.x=i.x-h.width/2-Math.abs(i.width)/2,h.y=i.y-h.height+i.height,h.pivot.x=i.width/2,h.time%this.fps()==0&&(h.texture=this.coverImg(h.src[h.start],t.folder||"char"),h.start++),h.start>=h.src.length&&(h.start=0)}else if("chung"==t.type){let i=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!i)return t.type="delete";if(!t.src)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,t.id);h.src=t.src,h.time=h.time+1||0,h.start=h.start||0,h.width=t.width||100,h.height=t.height||100,h.run=h.run||0,h.x=i.x-h.width/2-Math.abs(i.width)/2,h.y=i.y-h.height/2+i.height/2,h.time%this.fps()==0&&(h.texture=this.coverImg(h.src[h.start],t.folder||"char"),h.start++),h.start>=h.src.length&&(t.type="delete")}else if("hieuungSAo"==t.type){let i=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!i)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,t.id);h.src=this.createArray(1,21),h.time=h.time+1||0,h.start=h.start||0,h.width=200,h.height=200,h.run=h.run||0,h.x=i.x-h.width/2-Math.abs(i.width)/2,h.y=i.y-h.height/2+i.height/2,h.time%this.fps()==0&&(h.texture=this.coverImg(h.src[h.start],"other/sao"),h.start++),h.start>=h.src.length&&(t.type="delete")}else if("hieuungTrungDon"==t.type){let i=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!i)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,t.id);h.src=[730,731,732,733],h.time=h.time+1||0,h.start=h.start||0,h.width=70,h.height=70,h.run=h.run||0,h.maxX=h.maxX||i.x,h.minX=h.minX||i.x-h.width,h.maxY=h.maxY||i.y+i.height,h.minY=h.minY||i.y-h.height,10!=h.run&&(h.x=this.rand(h.minX,h.maxX),h.y=this.rand(h.minY,h.maxY),h.run=10),h.time%this.fps()==0&&(h.texture=this.coverImg(h.src[h.start]),h.start++),h.start>=h.src.length&&(t.type="delete")}else if("duoccuu"==t.type){let i=t.from==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.from),e=t.from==this.my.id?this.my:this.Charset.find((i=>i.id==t.from));if(!i)return t.type="delete";if(!e)return t.type="delete";let h=this.getEff(t.id),n=this.imgEff(h,"hieuung1"),a=[744,745,746];n.width=70,n.height=70,n.x=i.x-n.width/2-Math.abs(i.width)/2,n.y=i.y,n.time=n.time||0,n.start=n.start||0,n.time++,n.time%this.fps()==0&&(n.texture=this.coverImg(a[n.start]),n.start++),n.start>=a.length&&(t.type="delete")}else if("dicuu"==t.type){let i=t.from==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.from),e=t.from==this.my.id?this.my:this.Charset.find((i=>i.id==t.from));if(!i)return t.type="delete";if(!e)return t.type="delete";let h=this.getEff(t.id),n=this.imgEff(h,"hieuung1"),a=[693,694,695,706,707,708,709,710];n.width=70,n.height=70,n.x=i.x-n.width/2-Math.abs(i.width)/2,n.y=i.y,n.time=n.time||0,n.start=n.start||0,n.time++,"gong"!=e.info.act&&(i.action=e.info.act,e.info.act="gong",this.addAction({id:e.id,action:"gong"})),n.time%this.fps()==0&&(n.texture=this.coverImg(a[n.start]),n.start++,n.start>=a.length&&(n.start=0));let o=this.imgEff(h,"hieuung2");o.time=o.time+1||0,o.start=o.start||0,o.src=[738,739,740,741,742,743],o.texture=o.time%this.fps()==0?this.coverImg(o.src[o.start]):o.texture,o.start=o.time%this.fps()==0?o.start+1:o.start,o.scale.x="right"==i.huong?1:-1,o.width=70,o.height=70,o.visible=!1,o.x=i.x-Math.abs(i.width)+i.width/2,o.y=i.y-o.height/2+i.height/2,o.pivot.x=o.width/2,o.visible=!0,o.start>=o.src.length&&(t.type="delete","gong"==e.info.act&&this.resetAction(e.id))}else if("tdhseff"==t.type){let i=t.from==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.from),e=t.from==this.my.id?this.my:this.Charset.find((i=>i.id==t.from));if(!i)return t.type="delete";if(!e)return t.type="delete";let h=this.getEff(t.id),n=this.imgEff(h,"hieuung1"),a=[48,49,50,51,53,54,55,979];n.width=70,n.height=70,n.x=i.x-n.width/2-Math.abs(i.width)/2,n.y=i.y,n.time=n.time||0,n.start=n.start||0,n.time++,"gong"!=e.info.act&&(i.action=e.info.act,e.info.act="gong",this.addAction({id:e.id,action:"gong"})),n.time%this.fps()==0&&(n.texture=this.coverImg(a[n.start]),n.start++),n.start>=a.length&&(t.type="delete","gong"==e.info.act&&this.resetAction(e.id))}else if("phithuyenxuong"==t.type)return this.phithuyen_Handle(t);if("phithuyen"==t.type)return this.phithuyenHandle(t);if("moveonDat"==t.type)return this.moveEFF(t);if("flyKI_first2"==t.type)return this.baylenEFF2(t);if("flyKI_first"==t.type)return this.baylenEFF(t);if("flyKI"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by);if(!n)return t.type="delete";let a=h.start;e.start=e.start||0,e.time=e.time+1||0;let o=t.by==this.my.id?this.NhanVat.getChildByName("quan"):n.getChildByName("playerQuan");if(!o)return t.type="delete";e.scale.x=1,e.height=70,e.width=100,t.sound=this.playSound("bayKI",!1,n.x,n.id+"_fly"),e.y=n.y-e.height/2,e.x=n.x-n.width-e.width+o.width/2,"left"==n.huong&&(e.scale.x=-1,e.width=100,e.x=n.x+100-o.width/2),e.time%this.fps()==0&&e.time>=5*this.fps()&&(e.texture=this.coverImg(a.src[e.start]),e.start++,e.start>=a.src.length&&(e.start=0),e.visible=!0)}else if("end"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level),n=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!n)return t.type="delete";if(!h)return t.type="delete";(t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by))||(t.type="delete");let a=h.end;e.width=45,e.height=45,e.time=e.time+1||0,e.start=e.start||0,e.x=n.x-Math.abs(n.width)/2-e.width/2,e.y=n.y+Math.abs(n.height)/2-e.height/2,e.texture=e.time%this.fps()==0?this.coverImg(a.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start>=a.src.length&&(t.type="delete")}else if("donDam"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);if(t.level=1,!(t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim)))return t.type="delete";let h=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by);if(!h)return t.type="delete";e.time=e.time+1||0,e.start=e.start||0,t.volume=t.volume||1,1==t.volume&&(t.volume=2,this.playSound("dam"+this.rand(1,3),!1,h.x,h.id+"_dondam")),e.combo=e.combo||Object.create(this.spriteComBo[this.rand(0,this.spriteComBo.length-1)].data),e.createAction=e.createAction||0,0==e.createAction&&(e.createAction=1,e.combo.forEach((t=>{t.action=this.base_combo[this.rand(0,this.base_combo.length-1)]})));let n=t.by==this.my.id?this.my:this.Charset.find((i=>i.id==t.by));if(!n)return t.type="delete";if(!n.info)return t.type="delete";if(!n.info.act)return t.type="delete";e.oldACT=e.oldACT||n.info.act,e.delay=e.delay||0;let a=e.combo;if(a.length<=0)return t.type="delete";e.delay<Date.now()&&e.time%this.fps()==0&&(e.visible=!0,a=a[0],a.action=a.action,n.info.act!=a.action&&(n.info.act=a.action,this.addAction({id:t.by,action:a.action})),e.scale.x="right"==h.huong?1:-1,e.texture=this.coverImg(a.group[e.start]),e.width=e.texture.baseTexture.width>70?70:e.texture.baseTexture.width,e.height=e.texture.baseTexture.height>70?70:e.texture.baseTexture.height,e.x=h.x-e.width/2,e.y=h.y+h.height/2-e.height/2,e.start=e.start+1,e.start>=a.group.length&&(e.delay=a.delay?Date.now()+a.delay:0,e.start=0,e.combo.shift(),e.combo.length<=0&&(e.done=1))),e.done&&1==e.done&&(this.resetAction(t.by),this.addEff({name:t.name,level:1,startX:t.startX,startY:t.startX,aim:t.aim,type:"end",by:t.by}),(t.by==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==t.by)&&this.msgAttack(t),t.type="delete")}else{if("qckknew"==t.type)return this.handleQCKK(t);if("khieng"==t.type)return this.hanleKhieng(t);if("dongdat"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);t.level=1,e.visible=!1,e.time=e.time+1||0,e.start=e.start||0,e.c=.1,e.goc=inGame.y;const h=10,n=.1;e.c+=.1,inGame.y=Math.sin(e.c*n)*h,e.time>=60*this.fps()&&(t.type="delete")&&(inGame.y=e.goc)}else if("het"==t.type||"het_traidat"==t.type||"het_namek"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=h.end;e.start=e.start||0,e.time=e.time+1||0,n.src.length;let a=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!a)return t.type="delete";let o=Math.abs(a.width);e.width=o+o/100*90,e.height=a.height+a.height/100*90,e.x=a.x-e.width+o/100*50,e.y=a.y-e.height+a.height,e.visible=!0,e.texture=e.time%this.fps()==0?this.coverImg(n.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start=e.start>=n.src.length?0:e.start,e.time>=10*this.fps()&&(t.type="delete")}else if("dichchuyen"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=h.end;e.time=e.time+1||0,e.start=e.start||0;let a=n.src.length,o=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!o)return t.type="delete";Math.abs(o.width),e.x=o.x,e.y=o.y,o.visible=!1,e.texture=e.time%this.fps()==0?this.coverImg(n.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start>a&&(t.type="delete")&&(o.visible=!0)}else if("taitaonangluong"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=h.end;e.start=e.start||0,e.time=e.time+1||0;let a=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!a)return t.type="delete";let o=Math.abs(a.width);e.width=o+o/100*90,e.height=a.height+a.height/100*90,e.x=a.x-e.width+o/100*50,e.y=a.y-e.height+a.height,e.texture=e.time%this.fps()==0?this.coverImg(n.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start=e.start>=n.src.length?0:e.start;let s=t.aim==this.my.id?this.my:this.Charset.find((i=>i.id==t.aim));if(!s)return t.type="delete";s.eff&&s.eff.taitaonangluong&&!s.eff.taitaonangluong.active&&(t.type="delete")&&(s.info.act=a.action)&&this.addAction({id:s.id,action:s.info.act})}else if("nhapnhay"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.time=e.time+1||0,this.GrapSCwhite.visible=e.time%3==0||e%2!=0&&this.GrapSCwhite.visible,e.time<100&&(setTimeout((()=>{t.type="delete",this.GrapSCwhite.visible=!1}),500),e.time=100)}else{if("hoakhi_dondam"==t.type)return this.handeHoaKhiDam(t);if("hoakhi_kame"==t.type)return this.handeHoaKhiDamChuong(t);if("donDamKaioKen"==t.type){let i=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by);if(!i)return t.type="delete";if(!(t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim)))return t.type="delete";if(!t.keyid)return t.type="delete";let e=this.getEff(t.id),h=this.imgEff(e,"backGround");h.start=h.start||0,h.time=h.time+1||0,h.src=[2146,2147],h.texture=h.time%this.fps()==0?this.coverImg(h.src[h.start]):h.texture,h.start=h.time%this.fps()==0?h.start+1:h.start,h.start=h.start>=h.src.length?0:h.start,h.width=i.width>h.texture.width?i.width:h.texture.width,h.height=i.height>h.texture.height?i.height:h.texture.height,h.x=i.x-Math.abs(h.width)/2-Math.abs(i.width)/2,h.y=i.y-h.height/2+i.height/2;let n=this.imgEff(e,"playerNew");if(n.alpha=.8,n.start=n.start||0,n.time=n.time+1||0,n.src=[2190,2190,2191,2192,2192],n.scale.x="right"==i.huong?1:-1,n.texture=n.time%this.fps()==0?this.coverImg(n.src[n.start]):n.texture,n.start=n.time%this.fps()==0?n.start+1:n.start,n.start=n.start>=n.src.length?n.src.length:n.start,n.width=Math.abs(i.width)/100*150,n.height=Math.abs(i.height)/100*150,n.height=n.height>n.texture.height?n.texture.height:n.height,n.width=n.width>n.texture.width?n.texture.width:n.width,n.x=i.x-n.width/2-i.width/2,n.y=i.y-n.height+i.height,n.pivot.x=n.width/2,n.load=n.load||0,n.combo=n.combo||[],n.delay=n.delay||0,n.done=n.done||0,1==n.done)return t.type="delete";if(1!=n.load){for(let t=1;t<=this.rand(2,4);t++)n.combo.push(this.base_combo[this.rand(0,this.base_combo.length-1)]);n.load=1}let a=[[2148,2195],[2149,2198],[2162,2163],[2194,2197],[2193,2196]],o=this.imgEff(e,"donDam");if(o.scale.x="right"==i.huong?1:-1,o.start=o.start||0,o.time=o.time+1||0,o.id_base=o.id_base||this.rand(0,a.length-1),o.src=a[o.id_base],o.texture=o.time%this.fps()==0?this.coverImg(o.src[o.start]):o.texture,o.start=o.time%this.fps()==0?o.start+1:o.start,o.start=o.start>=o.src.length?o.src.length:o.start,o.width=100,o.height=100,o.x=i.x-o.width/2,o.y=i.y-o.height+i.height,o.start>=o.src.length&&n.start>=n.src.length&&n.delay<Date.now()){if(o.start=0,o.id_base=null,n.start=0,n.combo.length<=0)return this.resetAction(i.id),this.addEff({type:"hieuungSAo",aim:t.aim}),(i.id==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==i.id)&&this.msgAttack(t),n.done=1;if(this.addEff({type:"hieuungTrungDon",aim:t.aim}),h.visible=this.rand(1,100)<50,n.visible=this.rand(1,100)<50,n.combo.length>=1){let i=t.by==this.my.id?this.my:this.Charset.find((i=>i.id==t.by));if(!i)return t.type="delete";if(!i.info)return t.type="delete";if(!i.info.act)return t.type="delete";i.info.act!=n.combo[0]&&(i.info.act,n.combo[0],this.addAction({id:i.id,action:n.combo[0]})),n.combo.shift()}}}else if("skill"==t.type)if(null==this.kiNang.getChildByName(t.id)){let i=new PIXI.Container;i.id=t.id,i.name=t.id;let e,h=this.checkSkill(t.name,t.level);e=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);let n=0,a=new PIXI.Container;if(null!=e){let o=h.start,s=new PIXI.Sprite(this.coverImg(o.src[0]));if(o.width<=1&&o.height<=1?s.scale.set(o.width,o.height):-1==o.width&&-1==o.height?(s.width=e.width,s.height=e.height):(s.width=o.width,s.height=o.height),s.hieuung=0,s.y=o.y+t.startY,s.start=0,s.name=t.id,h.follow&&(s.visible=!1),e.x<t.startX?s.x=t.startX-2*Math.abs(s.width):s.x=t.startX+-1*o.x+n,s.hieuung=0,h.follow){let n=h.follow;a.name=t.id;let o,d,l=n.loop;if(l=10,t.by==this.my.id){if(o=this.NhanVat,!o)return t.type="delete";d=o.getChildByName("ao")}else{if(o=this.nguoichoi.getChildByName(t.by),!o)return t.type="delete";if(d=o.getChildByName("playerAo"),!d)return t.type="delete"}let r=new PIXI.Sprite(this.coverImg(n.src[0]));-1==n.width&&-1==n.height?(r.width=e.width,r.height=e.height):r.scale.set(n.width,n.height);let g=Math.abs(e.y-t.startY);e.x>=t.startX?g<r.height?(r.x=t.startX-r.width/2-o.width/2+d.width/2,r.y=t.startY+r.height/2,s.loai=1):g>r.height&&t.startY>e.y?(r.x=t.startX-r.width/2-o.width/2+d.width/2,r.y=t.startY+r.height/2+d.height,s.loai=2):g>r.height&&t.startY<e.y&&(r.x=t.startX-r.width/2-o.width/2+d.width/2,r.y=t.startY+r.height/2-d.height,s.loai=3):g<r.height?(r.x=t.startX-r.width/2+Math.abs(o.width)/2-Math.abs(d.width)/2,r.y=t.startY+r.height+Math.abs(o.height)/2,s.loai=4):g>r.height&&t.startY>e.y?(r.x=t.startX-r.width/2+Math.abs(o.width)/2-Math.abs(d.width)/2,r.y=t.startY+r.height+Math.abs(o.height)/2,s.loai=5):g>r.height&&t.startY<e.y&&(r.x=t.startX-r.width/2-o.width/2-d.width/2,r.y=t.startY+r.height+Math.abs(o.height)/2,s.loai=6),r.scale.set(.7),r.name=t.id+"bullet",r.zIndex=999;let c=Math.atan2(e.y-r.y,e.x-r.x);r.rotation=c,r.visible=!1,i.addChild(r)}s.time=0,i.addChild(s),this.kiNang.addChild(i),e=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim),"Kamejoko"==t.name&&(s.choload=1,s.farm=0,s.vis=0)}}else{let i,e=this.kiNang.getChildByName(t.id),h=e.getChildByName(t.id),n=this.checkSkill(t.name,t.level),a=n.start,o=(a.speed,n.follow),s=o.src.length;if(i=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim),null!=i){let d;if(t.by==this.my.id)d=this.my.info.act;else{if(d=this.Charset.find((i=>i.id==t.by)),!d)return t.type="delete";d=d.info.act}if(h.choload&&1==h.choload){if(h.FPS=Math.round(this.app.ticker.FPS/60)<=0?2:2*Math.round(this.app.ticker.FPS/60),h.vis++,"dam5"!=d&&(d="dam5",this.addAction({id:t.by,action:d})),h.vis%h.FPS==0){let i,e;if(i=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by),!i)return t.type="delete";if(e=t.by==this.my.id?i.getChildByName("ao"):i.getChildByName("playerAo"),!e)return t.type="delete";h.texture=this.coverImg(a.src[h.farm]),i.width<0?h.x=i.x-Math.abs(i.width):h.x=i.x-Math.abs(i.width)-e.width/2,h.width=60,h.height=60,h.y=i.y+e.height/2,h.visible=!0,h.farm++,h.farm>=a.src.length&&(h.choload=0,h.visible=!1)}return!1}let l=e.children.filter((i=>i.name===t.id+"bullet")),r=e.children.filter((i=>i.name===t.id+"bullet_success"));h.time+=1;for(let i=r.length-1;i>=0;i--){let e=r[i];if(h.FPS=Math.round(this.app.ticker.FPS/60)<=0?2:2*Math.round(this.app.ticker.FPS/60),h.FPS-=3,h.FPS=h.FPS<=0?1:h.FPS,h.time%h.FPS==0&&(e.texture=this.coverImg(o.src[e.start]),e.start++,e.start+1>s&&(e.start=0)),t.by&&t.action&&"keepKame"==t.action&&"dam2"!=d&&(d="dam2",this.addAction({id:t.by,action:d})),h.time%h.FPS==0&&0==e.visible&&2!=e.daload){if(e.visible=!0,e.daload=2,0==i)for(let i=0;i<r.length;i++)r[i].visible=!1,i>=r.length-1&&(this.addEff({name:t.name,aim:t.aim,level:1,type:"bum",dame:t.dame}),t.type="delete",t.by&&t.action&&"keepKame"==t.action&&"dam2"==d&&(this.resetAction(t.by),(t.by==this.my.id||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==t.by)&&this.msgAttack(t)));break}}for(let a=0;a<l.length;a++){let o=l[a],s=Math.atan2(i.y-o.y,i.x-o.x);if(o.rotation=s,a+1==l.length&&h.time%1==0&&1!=h.done){let a=n.follow,s=(a.loop,new PIXI.Sprite(this.coverImg(a.src[0])));-1==a.width&&-1==a.height?(s.width=i.width,s.height=i.height):s.scale.set(a.width,a.height),s.scale.set(.7),s.name=t.id+"bullet",s.visible=!1,s.zIndex=o.zIndex-1,1==h.loai?(s.x=o.x+s.width/2,s.y=o.y,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.x>i.x&&(h.done=1,s.rotation=0)):2==h.loai?(s.x=o.x+s.width/2,s.y=o.y-s.height/2,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.y>=i.y?s.x>=i.x&&(s.x=o.x):(s.y=o.y,s.x>i.x&&(h.done=1,s.rotation=0))):3==h.loai?(s.x=o.x+s.width/2,s.y=o.y+s.height/2,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.y<=i.y?s.x>=i.x&&(s.x=o.x):(s.y=o.y,s.x>=i.x&&(h.done=1,s.rotation=0))):4==h.loai?(s.x=o.x-Math.abs(s.width)/2,s.y=o.y,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.x<i.x&&(h.done=1,s.rotation=0)):5==h.loai?(s.x=o.x-Math.abs(s.width)/2,s.y=o.y-s.height/2,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.y>=i.y?s.x<=i.x&&(s.x=o.x):(s.y=o.y,s.x<i.x&&(s.x+=s.width-i.width/2,h.done=1,s.rotation=0))):6==h.loai?(s.x=o.x-s.width/2,s.y=o.y+s.height/2,s.rotation=Math.atan2(i.y-s.y,i.x-s.x),s.y<=i.y?s.x<=i.x&&(s.x=o.x):(s.y=o.y,s.x<=i.x&&(o.x+=o.width-i.width/2,h.done=1,s.rotation=0))):t.type="delete",s.start=0,1==h.done&&(l.sort(((t,i)=>t.zIndex-i.zIndex)),l.forEach((i=>{let h=Object.create(i);h.name=t.id+"bullet_success",e.addChild(h)}))),1!=h.done&&e.addChild(s)}}}else e.removeChild(h),this.kiNang.removeChild(e)}else if("skill_one"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);t.level=1;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!n)return t.type="delete";let a=h.start;e.width=70,e.height=70,e.start=e.start||0,e.time=e.time+1||0;let o=t.by==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.by);if(!o)return t.type="delete";if(e.x=e.x||o.x-e.width/2,e.y=e.y||o.y,e.texture=e.time%this.fps()==0?this.coverImg(a.src[e.start]):e.texture,e.start=e.time%this.fps()==0?e.start+1:e.start,e.start>a.src.length&&(e.start=0),e.time%this.fps()==0){let t=20;e.x<n.x&&(e.x+t>n.x&&(t=n.x-e.x),e.x+=t),e.x>n.x&&(e.x-t<n.x&&(t=e.x-n.x),e.x-=t),e.y<n.y&&(e.y+t>n.y&&(t=n.y-e.y),e.y+=t),e.y>n.y&&(e.y-t<n.y&&(t=e.y-n.y),e.y-=t)}e.x==n.x&&e.y==n.y&&((t.by==this.my.id&&t.keyid||1==t.detu&&this.my.detu&&this.my.detu.id&&this.my.detu.id==t.by)&&this.msgAttack(t),this.addEff({name:t.name,aim:t.aim,level:1,type:"bum",dame:t.dame}),t.type="delete"),this.getInfoMap(t.by)&&(this.addAction({id:t.by,action:"dam2"}),setTimeout((()=>{this.resetAction(t.by)}),200))}else if("bum"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);e.start=e.start||0,e.time=e.time+1||0,e.visible=!0;let h=this.checkSkill(t.name,t.level);if(!h)return t.type="delete";let n=h.end,a=n.src.length,o=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!o)return t.type="delete";e.scale.set(n.width,n.height),e.FPS=this.app.ticker.FPS>240?10:this.app.ticker.FPS>120?6:this.app.ticker.FPS>60?3:2,e.texture=e.time%e.FPS==0?this.coverImg(n.src[e.start]):e.texture,e.start=e.time%e.FPS==0?e.start+1:e.start,e.x=o.x-e.width/2-Math.abs(o.width)/2,e.y=o.y,e.start>=a&&(t.type="delete")&&(e.visible=!1)}else if("vangmau"==t.type){let i=this.getEff(t.id),e=this.imgEff(i,t.id);e.start=e.start||0,e.time=e.time+1||0,e.visible=!0;let h=["vang_1","vang_2","vang_3"],n=t.aim==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.aim);if(!n)return t.type="delete";e.texture=this.coverImg(h[e.start]),e.scale.x="right"==n.huong?-1:1,e.pivot.x="right"==n.huong?-e.width:0,e.height=e.height>n.height?n.height:e.height,e.x=n.x,e.y=n.y,e.FPS=this.fps(),e.texture=e.time%e.FPS==0?this.coverImg(h[e.start]):e.texture,e.start=e.time%e.FPS==0?e.start+1:e.start,e.start>=h.length&&(t.type="delete")&&(e.visible=!1)}else if("truhp"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.text="-"+t.value,e.style={fontFamily:"staccato",fontSize:18,fill:"0xFF0000",align:"center",fontWeight:"bold"},e.start=e.start||0,e.time=e.time+1||0,e.visible=!0;let h=this.my.id==t.to?this.my:this.Charset.find((i=>i.id==t.to));e.time<=3&&(h?(h.info.act="choang",this.addAction({id:h.id,action:"choang"}),setTimeout((()=>{this.resetAction(h.id)}),150)):this.addAction({id:t.to,action:"bidanh"}),this.addEff({name:"vangmau",aim:t.to,level:1,type:"vangmau"}),e.time=5);let n=t.to==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.to);if(!n)return t.type="delete";e.x=e.x||n.x-Math.abs(n.width)/2-e.width/2,e.y=e.y||n.y-e.height,e.FPS=this.fps(),e.y-=e.time%e.FPS==0?3:0,e.run=e.run||1,1==e.run&&(e.run=2,setTimeout((()=>{t.type="delete"}),300))}else if("conghp"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.text="+"+t.value,e.style={fontFamily:"staccato",fontSize:18,fill:"red",align:"center"},e.start=e.start||0,e.time=e.time+1||0;let h=t.to==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.to);if(!h)return t.type="delete";e.x=e.x||h.x-Math.abs(h.width)/2-e.width/2,e.y=e.y||h.y,e.FPS=this.fps(),e.y-=e.time%e.FPS==0?3:0,e.run=e.run||1,1==e.run&&(this.playSound("conghp",!1,h.x,"conghp_"+t.to),e.run=2,setTimeout((()=>{t.type="delete"}),300))}else if("truki"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.text="-"+t.value+" KI",e.style={fontFamily:"staccato",fontSize:18,fill:"blue",align:"center"},e.start=e.start||0,e.time=e.time+1||0,e.visible=!0;let h=t.to==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.to);if(!h)return t.type="delete";e.x=e.x||h.x-Math.abs(h.width)/2-e.width/2,e.y=e.y||h.y-50,e.FPS=this.fps(),e.y-=e.time%e.FPS==0?3:0,e.run=e.run||1,1==e.run&&(e.run=2,setTimeout((()=>{t.type="delete"}),300))}else if("chimang"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.text="CHÍ MẠNG",e.style={fontFamily:"staccato",fontSize:18,fill:16748544,align:"center"},e.style.stroke="#000000",e.style.strokeThickness=4,e.style.dropShadow=!0,e.style.dropShadowColor="#000000",e.style.dropShadowBlur=4,e.style.dropShadowAngle=Math.PI/6,e.style.dropShadowDistance=6,e.start=e.start||0,e.time=e.time||0,e.visible=!0;let h=t.to==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.to);if(!h)return!1;e.time++,e.x=e.x||h.x-Math.abs(h.width)/2-e.width/2,e.y=e.y||h.y-20,e.FPS=this.fps(),e.time%e.FPS==0&&(e.x+=5==e.start?1:1==e.start?-1:0,e.start=6==e.start?0:e.start+1),e.time<20&&(setTimeout((()=>{t.type="delete"}),200),e.time=21)}else if("congexp"==t.type){let i=this.getEff(t.id),e=this.textEff(i,t.id);e.text="+"+t.value,e.style={fontFamily:"staccato",fontSize:18,fill:"0x00FF00",align:"center",fontWeight:"bold"},e.style.stroke="#000000",e.style.strokeThickness=4,e.style.dropShadow=!0,e.style.dropShadowColor="#000000",e.style.dropShadowBlur=4,e.style.dropShadowAngle=Math.PI/6,e.style.dropShadowDistance=6,e.time=e.time+1||0,e.start=e.start||0;let h=t.to==this.my.id?this.NhanVat:this.nguoichoi.getChildByName(t.to);if(!h)return t.type="delete";e.x=e.x||h.x-Math.abs(h.width)/2-e.width/2,e.y=e.y||h.y-20,e.FPS=this.fps(),e.y-=e.time%e.FPS==0?2:0,e.run=e.run||1,1==e.run&&(e.run=2,setTimeout((()=>{t.type="delete"}),300)),e.visible=!0}}}})),this.logChat.forEach((t=>{if(null==this.Chat.getChildByName(t.id)){const i=new PIXI.Graphics;i.name=t.id,i.id=t.id,i.uid=t.uid;const e=new PIXI.Text(t.text,{align:"center",breakWords:!0,fontSize:14,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:110,fontWeight:"bold"});e.wordWrapWidth=180,e.name=t.id,e.id=t.id,e.anchor.set(.5),e.time=0,e.dem=0,i.addChild(e),e.position.set(i.width/2,i.height/2),e.resolution=2,i.lineStyle(1,0,3),i.beginFill(16777215),i.drawRoundedRect(-10,-10,e.width+20<110?110:e.width+20,e.height+20<50?50:e.height+20,10),i.endFill(),i.pivot.set(i.width/2,i.height/2),i.visible=!1;const h=new PIXI.Graphics;h.beginFill(16777215),h.lineStyle(1,0,3),h.moveTo(0,0),h.lineTo(10,10),h.lineTo(20,0),h.endFill(),h.pivot.set(h.width/2,h.height/2),h.position.set(i.width/2-h.width/2,i.height-h.height+4),i.addChild(h),this.Chat.addChild(i)}else{let i,e,h=this.Chat.getChildByName(t.id),n=h.getChildByName(t.id);if("delete"==t.type)return this.Chat.removeChild(h),this.logChat=this.logChat.filter((function(i){return i.id!==t.id})),!1;if(t.uid==this.my.id){if(i=this.NhanVat,e=i.getChildByName("dau"),!e)return t.type="delete";h.position.set(i.x-7,i.y-(n.height+20)/2)}else{if(i=this.nguoichoi.getChildByName(t.uid),!i)return t.type="delete";null!=i&&h.position.set(i.x-7,i.y-(n.height+20)/2-30)}n.dem%1==0&&n.time>=80*this.fps()&&(this.Chat.removeChild(h),this.logChat=this.logChat.filter((function(i){return i.id!==t.id}))),n.dem++,n.time++,h.visible=!0}}))}};class Vt extends At{constructor(){super()}timeEnd=t=>{let i=t-Date.now();if(i<=0)return"0s";let e=Math.floor(i/1e3);if(e<=0)return"0s";let h=Math.floor(e/60);return h<=0?e+"s":h>=1?h+"p"+(e-60*h):void 0};updateInGameMSG=()=>{let t=this.inGameMSG,i=0,e=10,h=t.getChildByName("chatbangNew");this.banghoi.tinnhan>=1?h?(h.time++,h.time=h.time>10?0:h.time,h.text="Có "+this.banghoi.tinnhan+" tin nhắn mới",h.visible=!0,5==h.time&&(h.style.fill=16711680),10==h.time&&(h.style.fill=16777215)):(h=new PIXI.HTMLText("Có "+this.banghoi.tinnhan+" tin nhắn mới",{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:this.gameWidth}),h.name="chatbangNew",h.x=e,h.y=i+10,i+=h.height+h.y,t.addChild(h),h.time=0,h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{this.boxNewBangHoi()}))):h&&(h.visible=!1);let n={khieng:"3784",rungu:"3782",hoakhi:"718",taitaonangluong:"720"},a=0;for(let h in n){let o=h+"_skill_eff",s=h+"_text",d=t.getChildByName(o),l=t.getChildByName(s);if(this.my.eff&&this.my.eff[h]&&this.my.eff[h].active&&1==this.my.eff[h].active)if(d)d.x=d.width*a+4*a,d.visible=!0,l.visible=!0,l.text=this.timeEnd(this.my.eff[h].time),l.x=d.x+d.width/2-l.width/2,a++;else{d=new PIXI.Sprite(this.coverImg(n[h])),d.name=o,d.width=50,d.height=50,d.x=e,d.y=i+5,e+=d.width+4,i+=d.height+d.y,t.addChild(d);let a=new PIXI.HTMLText(this.timeEnd(this.my.eff[h].time),{fontFamily:"Arial",fontSize:20,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:d.width});a.style.stroke=0,a.style.strokeThickness=1,a.style.dropShadow=!0,a.style.dropShadowColor=0,a.style.dropShadowBlur=1,a.style.dropShadowAngle=Math.PI/6,a.style.dropShadowDistance=1,a.name=s,a.x=d.x+d.width/2-a.width/2,a.y=i,t.addChild(a)}else d&&(d.visible=!1),l&&(l.visible=!1)}}}class zt extends Vt{constructor(){super(),this.autoAttack=!1,this.timeAuto=0}autoUpdateAttack=()=>{if(0==this.autoAttack)return;if(this.keysPressed[37]||this.keysPressed[38]||this.keysPressed[39]||this.keysPressed[40])return;if(this.timeAuto>Date.now())return;this.timeAuto=Date.now()+100;let t=this.my;if("dungyen"!=t.info.act&&"baylen"!=t.info.act)return;if(t.info.coban.hp<=0)return;let i,e=this.setting,h=(e.oskill,e.mouse);if(-1==h||!h)return this.autoFindTarget();h&&(i=this.getMy(h));let n=t.oskill,a=[];if(n.forEach(((i,e)=>{let h=t.skill.find((t=>t.id==i&&t.level>0&&t.time<Date.now()));h&&a.push(e)})),a.length<=0)return;let o=a[this.rand(0,a.length-1)];return this.setting.oskill=o,this.dcttTarget(),"item"==i.type?this.interAttack():!i||"mob"!=i.type||i.info.chiso.hp<=0?(this.setting.mouse=-1,this.autoFindTarget()):void this.interAttack()};dcttTarget=()=>{let t=this.setting,i=t.mouse,e=this.my,h=e.skill.find((i=>i.id==e.oskill[t.oskill]));if(h){let t=this.usedSkill(h.id);if(t&&t.dx&&t.dx>0&&i){let e=this.NhanVat,h=this.getNhanVat(i),n=this.calculateDistanceXandWidth(e,h),a=this.getMy(i);n>2*t.dx&&(this.NhanVat.x=h.x,this.NhanVat.y=h.y,this.NhanVatGoc.x=h.x,this.NhanVatGoc.y=h.y,a.namdat&&this.xulynamdat(this.my.id,!0))}}};autoFindTarget=()=>{let t=this.Charset.filter((t=>t.id!=this.my.id&&"mob"==t.type&&t.info.chiso.hp>0||"item"==t.type&&t.uid==this.my.id));if(t.length>=1){let i=t[this.rand(0,t.length-1)].id;this.setting.mouse=i,this.dcttTarget()}}}const Kt=class extends zt{constructor(){super(),this.createHoldMap(),this.mapMore={}}checkDiQuaCau=()=>{let t=this.bando.children.filter((t=>"x22$26"==t.name));t.forEach((t=>{t.yOld=t.yOld||t.y,t.danhun=t.danhun||0;let i=0;this.cacheAction.forEach((e=>{let h=e.id==this.my.id?this.NhanVat:this.nguoichoi.children.find((t=>t.id==e.id));h&&this.hitTestRectangle(h,t)&&h.act&&"fly"!=h.act&&(i=1)})),1==i&&0==t.danhun?(t.danhun=1,t.y=t.yOld+3):0==i&&1==t.danhun&&(t.danhun=0,t.y=t.yOld-3)}))};backgroundMap=()=>{this.HoaRoiCuaPhat(),this.lopCanhNen.x=this.container.x,this.bando_nuixanua.y=.4*this.gameHeight-this.bando_nuixa.height/2,this.bando_bautroi.y=this.bando_nuixanua.y,this.bando_nuixa.y=.4*this.gameHeight+.1*this.bando_nuixa.height+this.actionMap.nuixa,this.bando_nuida.toGlobal(new PIXI.Point(0,0)),this.bando_nuida.y=.7*this.gameHeight-this.bando_nuida.height/2+this.actionMap.nuida,this.bando_chantroi.y=this.bando_nuixanua.y+this.bando_nuixanua.height,this.bando_chantroi.height=this.bando_nuixa.y+this.bando_nuixa.height-this.bando_chantroi.y,this.bando_chantroi.width=this.bando_nuixa.width,this.bando_channuixa.y=this.bando_nuixa.y+this.bando_nuixa.height-10,this.bando_channuixa.width=this.bando_nuixa.width,this.bando_channuixa.height=this.bando_nuida.y+this.bando_nuida.height-this.bando_channuixa.y,this.nen.y=this.bando_nuida.y+this.bando_nuida.height,this.bando_nuida.start=this.bando_nuida.start||0,0==this.bando_nuida.start&&(this.bando_nuida.start=1,this.bando_nuida.yMax=this.bando_nuida.y,this.bando_nuida.yMin=this.bando_nuida.y-.2*this.bando_nuida.height),this.bando_nuida.toGlobal(new PIXI.Point(0,0)),this.bando_nuixa.toGlobal(new PIXI.Point(0,0)),this.bando_nuixanua.toGlobal(new PIXI.Point(0,0)),this.NhanVat.toGlobal(new PIXI.Point(0,0)).y};suongMuCheConTim=()=>{this.updateInGameMSG();let t=this.mapMore;t&&t.suong&&t.suong>=1&&this.bando_suongmu.children.length>=1&&(this.bando_suongmu.x-=1*t.suong,this.bando_suongmu.x<this.bando_suongmu.minx&&(this.bando_suongmu.x=0))};HoaRoiCuaPhat=()=>{let t=this.mapMore;if(!t)return this.mapMore={time:0};if(t.time=t.time||0,t.time+=1,t.time>100&&(t.time=0),t.time%this.fps()==0){this.suongMuCheConTim(),this.themHoaRoi=this.themHoaRoi||0;let i=t.eff;i&&i.length>=1&&i.forEach((t=>{let i=this.bando_hieuung.children.filter((i=>i.namesprite==t)),e=i.length;for(;e<30;){let i=this.NhanVat.x-this.gameWidth/2,h=this.NhanVat.x+this.gameWidth/2,n=this.NhanVat.y-this.gameHeight/2,a=this.rand(i,h),o=this.rand(n,this.NhanVat.y-100),s=new PIXI.Sprite(this.coverImg(t,"map/eff")),d=4,l=s.width,r=s.height/d;if(l<10)break;let g=[];for(let t=0;t<d;t++){let i=new PIXI.Texture(s.texture,new PIXI.Rectangle(0,t*r,l,r));g.push(i)}let c=new PIXI.AnimatedSprite(g);c.animationSpeed=.1,c.loop=!0,c.play(),c.width=24,c.height=24,c.x=a,c.y=o,c.namesprite=t,c.run=0,this.bando_hieuung.addChild(c),e+=1}let h=i.filter((t=>0==t.run));h.length>0&&h.forEach((t=>{let i=this.bando.children.filter((i=>"dat"==i.type&&i.y>t.y&&i.x-this.gameWidth/2<t.x&&i.x+this.gameWidth/2>t.x));if(0==i.length)return;let e=i[this.rand(0,i.length-1)];t.run=1,t.xTo=e.x+e.width/2-t.width/2,t.yTo=e.y-t.height+20+this.rand(1,10);let h=this;new TWEEN.Tween(t).to({x:t.xTo,y:t.yTo},this.rand(2e3,2e4)).onUpdate((t=>{let i=this.NhanVat.x-this.gameWidth/2,e=this.NhanVat.x+this.gameWidth/2;t.x>this.NhanVat.x&&t.x>e&&(t.y=t.yTo,t.x=t.xTo,t.delete=1),t.x<this.NhanVat.x&&t.x<i&&(t.y=t.yTo,t.x=t.xTo,t.delete=1)})).onComplete((function(){t.stop(),t.delete?t.destroy():setTimeout((()=>{t.destroy()}),h.rand(500,2e3))})).start()}))}))}};createHoldMap=()=>{let t=0,i=0,e=e=>{if(this.hold){let h=this.gameMap.setting,n=(h.minX,h.maxX,h.minY,h.maxY,e.data.global.x),a=e.data.global.y,o=this.trussX-n,s=this.trussY-a;this.trussX=n,this.trussY=a,t=n,Math.abs(t-i);let d=this.NhanVat.toGlobal(new PIXI.Point(0,0));this.gameWidth,d.x,this.container.x,this.gameWidth;let l=this.container.x-o,r=this.container.y-s;this.container.x=l,this.container.y=r}},h=()=>{this.hold=!1,this.truss=!1,t=0,i=0},n=t=>{this.hold=!0,this.vaomap=1,this.truss=!0,this.trussX=t.data.global.x,this.trussY=t.data.global.y,i=t.data.global.x};this.container.interactive=!0,this.container.on("pointerdown",(t=>{n(t)})),this.container.on("pointerup",(t=>{h()})),this.container.on("pointermove",(t=>{e(t)})),this.container.on("pointerupoutside",(t=>{h()})),this.container.on("pointerout",(t=>{h()})),this.container.on("pointerover",(t=>{h()})),this.lopCanhNen.interactive=!0,this.lopCanhNen.on("pointerdown",(t=>{n(t)})),this.lopCanhNen.on("pointerup",(t=>{h()})),this.lopCanhNen.on("pointermove",(t=>{e(t)})),this.lopCanhNen.on("pointerupoutside",(t=>{h()})),this.lopCanhNen.on("pointerout",(t=>{h()})),this.lopCanhNen.on("pointerover",(t=>{h()}))}};class Ot extends Kt{constructor(){super()}angle2=(t,i,e,h)=>{let n=180*Math.atan2(h-i,e-t)/Math.PI;return n<0&&(n+=360),n};updateAutoMovegoTo=()=>{if(this.my.id<=0)return!1;if(0==this.goto)return!1;let t=null,i=this.my,e=this.setting;if(0!=e.mouse&&e.mouse!=i.id&&null!=e.mouse&&null!=e.mouse&&-1!=e.mouse&&(t=e.mouse),!t)return this.goto=!1,!1;let h=this.NhanVat,n=this.getNhanVat(t);if(this.distance(h.x,h.y,n.x,n.y)<=(this.gotoDX||10)/2)return console.log("dừng"),this.goto=!1,this.keysPressed[37]=!1,this.keysPressed[38]=!1,this.keysPressed[39]=!1,this.keysPressed[40]=!1,"fly"==this.my.info.act||"baylen"==this.my.info.act||this.my.info.act,this.timeRoiTuDo=Date.now()+150,"move"==this.my.info.act&&(this.my.info.act="dungyen",this.addAction()),"fly"==this.my.info.act&&(this.my.info.act="baylen",this.addAction()),!1;Math.abs(Math.abs(h.y)-Math.abs(n.y))>=h.height?h.y>n.y&&(this.keysPressed[38]=!0):Math.abs(h.x-n.x)>=10&&(h.x>n.x?this.keysPressed[37]=!0:this.keysPressed[39]=!0),this.goto=!0}}class Lt extends Ot{constructor(){super()}chipi=t=>{if(this.deleteNotice(),!this.logChipi.find((i=>i==t))){if(this.chipiBox.children.length>=1&&this.chipiBox.getChildByName("chipi").getChildByName("chipi_msg").getChildByName("chipi_txt").text==t)return;this.logChipi.push(t)}};chipiView=()=>{if(this.logChipi.length>=1&&this.chipiBox.children.length<=0){let t=this.logChipi[0];this.logChipi.shift();let i=new PIXI.Container;i.name="chipi",this.chipiBox.addChild(i);let e=new PIXI.Sprite(this.coverImg("514"));e.name="chipi_img",i.addChild(e),e.width=50,e.height=50,e.x=this.gameWidth/2;const h=10,n=new PIXI.Graphics;n.name="chipi_msg";const a=new PIXI.TextStyle({align:"center",breakWords:!0,fontSize:14,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:110,fontWeight:"bold"}),o=new PIXI.Text(t,a);o.wordWrapWidth=200-2*h,o.resolution=2,o.anchor.set(.5),n.addChild(o),o.name="chipi_txt",o.position.set(n.width/2,n.height/2),n.beginFill(16777215),n.lineStyle(1,0,3),n.drawRoundedRect(-h,-h,o.width+2*h<110?110:o.width+2*h,o.height+2*h<50?50:o.height+2*h,10),n.endFill(),n.pivot.set(n.width/2,n.height/2),n.visible=!1;const s=new PIXI.Graphics;s.beginFill(16777215),s.lineStyle(1,0,3),s.moveTo(0,0),s.lineTo(10,10),s.lineTo(20,0),s.endFill(),s.pivot.set(s.width/2,s.height/2),s.position.set(n.width/2-s.width/2,n.height-s.height+4),n.addChild(s),i.addChild(n)}if(this.chipiBox.children.length>=1){let t=this.chipiBox.getChildByName("chipi"),i=t.getChildByName("chipi_img"),e=t.getChildByName("chipi_msg"),h=e.getChildByName("chipi_txt");t.time=t.time||0,t.time+=1,t.chipi=t.chipi||1,1==this.chipiBox.have&&(this.chipiBox.have=0,t.chipi=2,e.visible=!0);let n=this.NhanVat.getGlobalPosition();t.sprite=t.sprite||0;let a={saiyan:[514,514,515,515],traidat:["chipi_1","chipi_1","chipi_2","chipi_2"],namek:["chipi_1_1","chipi_1_1","chipi_1_2","chipi_1_2"]};if(i.texture=this.coverImg(a[this.my.info.coban.type][t.sprite]),t.time%this.fps()==0&&(t.sprite+=1,t.sprite=t.sprite>=a[this.my.info.coban.type].length?0:t.sprite),i.x=n.x,"right"==this.NhanVat.huong?(i.x=n.x-Math.abs(this.NhanVat.width)-i.width,i.scale.x=1,i.width=50):"left"==this.NhanVat.huong&&(i.scale.x=-1,i.width=50,i.x=n.x+i.width),1==t.chipi){let h=n.y-i.height;new TWEEN.Tween(i).to({y:h},300,createjs.Ease.easeOutQuad).start().onComplete((()=>{e.visible=!0})),t.chipi=2}if(2==t.chipi){let t=n.y-i.height;t-h.height<0&&(t=0+h.height+i.height),i.y=t,e.position.y=i.y-(h.height+20)/2-1,"right"==this.NhanVat.huong?e.x=i.x-Math.abs(i.width)/2+h.width/2+Math.abs(i.width/2):e.x=i.x+Math.abs(i.width)/2-h.width/2-Math.abs(i.width/2)+ +Math.abs(i.width/2)}console.log(),t.time>=(50+h.text.length)*this.fps()&&(this.logChipi[0]?(this.chipiBox.removeChild(t),this.chipiBox.have=1):(e.visible=!1,2==t.chipi&&(t.chipi=3,TweenMax.to(i,.5,{y:-1,onComplete:()=>{this.chipiBox.removeChild(t)}}))))}}}const Yt=class extends Lt{constructor(){super(),this.dem=0,this.timeUpdateMove=0,this.timeKiemTraBiDo=0,this.vitricu=0,this.setKeoSpeed=.6,this.app.ticker.add((t=>{this.reloadTickInGame(t)}))}reloadTickInGame=t=>{this.dem++,this.dem>100&&(this.dem=0);let i=this.NhanVat,e=(this.NhanVatGoc,this.my);e.id>0&&(i.act=e.info.act,this.snowlyupdateSkill(),this.snowlyTextnotice(),this.snowlyDangerNotice(),this.snowlyKeoMap(),this.snowlyRoiTuDo(),this.tickerEFF(),this.tickerUpdateMouseClickPlayer(),this.tickerUpdateMyInfo(),this.tickerUpdateDauThan(),this.updateMoveAuto(),this.AttackDeTu(),this.checkOnDat(),this.checkDiQuaCau(),this.statusGiaoDich(),this.chipiView(),this.backgroundMap(),this.sinceRunAction(t),this.init(),this.ProcessLoadPlayer(),this.updateSprite(),this.updateAutoMovegoTo(),this.isDebug(),this.autoUpdateAttack(),TWEEN.update())};canChinhMap=()=>{};checkOnDat=()=>!1;showDisPlayer=()=>{if(this.my.id<=0)return!1;this.listPlayerInMap.removeChildren(),this.nguoichoi.children.forEach(((t,i)=>{if(t.id!=this.my.id){let e=this.khoangCach(t.id,this.my.id),h=new PIXI.Text(t.Ten+" "+e+"m",{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"});h.y=i*h.height,this.listPlayerInMap.addChild(h)}})),this.listPlayerInMap.x=this.gameWidth-this.listPlayerInMap.width,this.listPlayerInMap.y=this.gameHeight/2-this.listPlayerInMap.height/2};updateMoveAuto=()=>{this.my.id>0&&"dungyen"==this.my.info.act&&this.timeUpdateMove<Date.now()&&(this.sendMyMove(),this.timeUpdateMove=Date.now()+1e3)};tickerUpdateDauThan=()=>{if(this.my.id<=0)return!1;if(null==this.bg_dauthan)return!1;if(this.my.used.dauthan>Date.now()){let t=100*(1-(this.my.used.dauthan-Date.now())/this.my.used.dauthan_time);this.bg_dauthan_circle.height=this.bg_dauthan_circle.heightMAX/100*t,this.bg_dauthan.texture=this.coverImg("myTexture2dPea1-resources.assets-859")}else this.bg_dauthan.texture=this.coverImg("myTexture2dPea0-resources.assets-813")};tickerUpdateMyInfo=()=>(this.my.id<=0||null==this.hpProgress||null==this.kiProgress||(this.hpProgress.width=this.hpProgress.maxWidth/100*(this.my.info.chiso.hp/this.my.info.chiso.hpFull*100),this.kiProgress.width=this.kiProgress.maxWidth/100*(this.my.info.chiso.ki/this.my.info.chiso.kiFull*100),this.hpText.text=this.my.info.chiso.hp,this.hpText.x=0+this.hpProgress_BGKhung.getBounds().width/2-this.hpText.getBounds().width/2,this.hpText.y=this.hpProgress_BGKhung.getBounds().height/2-this.hpText.getBounds().height/2,this.kiText.text=this.my.info.chiso.ki,this.kiText.x=this.kiProgress_BGKhung.getBounds().width/2-this.kiText.getBounds().width/2,this.kiText.y=this.kiProgress_BGKhung.getBounds().height/2-this.kiText.getBounds().height/2),!1);tickerEFF=()=>{};countScenes(t){let i=0;i+=t.children.length;for(const e of t.children)e instanceof PIXI.Container&&(i+=this.countScenes(e));return i}snowlyKeoMap(){if(this.my.id<=0)return!1;let t=this.NhanVat,i=(this.NhanVatGoc,this.my,this.container),e=t.x*i.scale.x,h=t.y*i.scale.y,n=this.gameMap;if(this.hold)return!1;let a=this.gameWidth/2;if(this.gameHeight,1==this.vaomap&&(i.y=0,this.vaomap=0),t.x+a>=n.setting.maxX?i.x=-(n.setting.maxX-2*a):t.x-a<=n.setting.minX?i.x=0:i.x=this.gameWidth/2-e,0==i.y)i.y=this.gameHeight*this.setKeoSpeed-h;else if(t.y-this.gameHeight/2<n.setting.minY)this.setKeoSpeed=.6;else if(t.y+this.gameHeight/2>n.setting.maxY)this.setKeoSpeed=.6;else{i.y=this.gameHeight*this.setKeoSpeed-h;let e=t.toGlobal(new PIXI.Point(0,0)),n=t.height;n=n>70?70:n,e.y+2*n>this.gameHeight&&(this.setKeoSpeed-=.1)}}snowlyDangerNotice(){if(this.my.id<=0)return!1;let t=this.dem,i=this.dangerUser,e=this.noiDungDanger,h=this.maskNoiDungDanger;0==i.visible?this.logDanger.length>=1&&(i.visible=!0,e.text=this.logDanger[0],e.x=h.x+10,this.logDanger.splice(0,1),i.time=Date.now()+500):(this.logDanger.length>=1&&e.width<this.gameWidth&&(e.text=e.text+", "+this.logDanger[0],this.logDanger.splice(0,1)),t%2==0&&i.time<=Date.now()&&(e.x--,e.x<=-(h.width+e.width/2)&&(i.visible=!1)))}snowlyTextnotice(){if(this.my.id<=0)return!1;this.dem;let t=this.text_notice,i=this.bg_notice;t&&1==t.visible&&(t.x--,t.x<=-t.width&&(t.x=0,t.visible=!1,i.visible=!1)),t&&0==t.visible&&this.logNotice.length>0&&(t.x=this.gameWidth,t.text=this.logNotice[0],t.visible=!0,i.visible=!0,this.logNotice.splice(0,1))}snowlyRoiTuDo(){0!=this.timeRoiTuDo&&this.timeRoiTuDo<=Date.now()&&(this.keysPressed[40]=!0)}snowlyupdateSkill(){if(this.my.id<=0)return!1;let t=this.SkillDataOnScreen,i=this.my;for(let e=0;e<i.oskill.length;e++){let h=i.oskill[e],n=this.usedSkill(h);if(n&&t.time[e]){let h=i.skill.find((t=>t.id==n.id));if(h)if(h.time>Date.now()){console.log("have"),h.time,Date.now();let i=(h.time-Date.now())/(h.time-h.lasttime)*100;t.time[e].height=t.time[e].max/100*i}else t.time[e].height=0}}}isDebug=()=>{1==this.loadGame.visible&&(this.keysPressed[37]=!1,this.keysPressed[38]=!1,this.keysPressed[39]=!1,this.keysPressed[40]=!1);let t="";if(this.showFPS.text=`fps:${Math.round(this.app.ticker.FPS)}  `+(1==this.gameInfo.debug?"- Spr: "+this.countScenes(this.container):"")+"  ",this.showFPS.position.set(0,this.gameHeight-this.showFPS.height),1==this.gameInfo.debug){if(this.my.id>=1){let i=this.my.pos.map,e=this.listMap.find((t=>t.id==i));e&&(t="#"+e.id+" "+e.name+" K."+this.my.pos.zone)}this.postionChar.text=`X: ${Math.round(this.NhanVat.x)} Y: ${Math.round(this.NhanVat.y)} (${t}) `,this.postionChar.position.set(0,this.showFPS.y-this.postionChar.height)}this.my.id>=1&&this.NhanVat.y+this.NhanVat.height>=this.gameMap.setting.maxY&&this.xulynamdat2(this.my.id)}};class jt extends Yt{constructor(){super()}ioUpdateDeTu=t=>{t._1;let i=t._2,e=t._1==this.my.id?this.my:this.Charset.find((i=>i.id==t._1));e&&(e.detu=i)};ioUpdateVatPhamRoiDat=t=>{if(t._1.type="item",t._1.info={chiso:{hp:1}},t._2){let i=t._2==this.my.id?this.my:this.Charset.find((i=>i.id==t._2));i&&(this.addAction({id:i.id,action:"dam4"}),setTimeout((()=>{this.addAction({id:i.id,action:"dungyen"})}),200))}this.Charset.push(t._1)};ioGetElementOnMap=()=>{if(this.my.id<=0)return!1;this.to("-4")};checkIdPlayerOnMap=t=>{t._1;let i=t._1==this.my.id?this.my:this.Charset.find((i=>i.id==t._1));i||this.ioGetElementOnMap(),ioUpdateAction=t=>{let i=this.Charset.find((i=>i.id==t._1));i?i.info.act=t._2:this.ioGetElementOnMap()}};ioUpdateInfoSkin=t=>{let i=this.my,e=this.Charset,h=i.id==t._1?i:e.find((i=>i.id==t._1));h?(h.info=t._2,h.skin=t._3,h.id==i.id&&(this.NhanVatGoc.removeChildren(),this.TaoSprite2(),this.checkOnDat22(i.id)||this.xulynamdat(i.id))):this.ioGetElementOnMap()};ioUpdateRuong=t=>{t._1&&(this.my.ruong=t._1),t._2&&(this.my.trangbi=t._2),this.clickButton("hanhtrang"),this.deleteNotice()};ioUpdateRuongDeTu=t=>{t._1&&(this.my.ruong=t._1),t._2&&(this.my.detu.trangbi=t._2),t._3&&(this.my.detu.info=t._3),this.clickButton("detu"),this.deleteNotice()};ioInsertChat=t=>{let i=this.logChat;for(let e=0;e<i.length;e++)i[e].uid==t._1&&(i[e].type="delete");i.push({id:this.randomAZ(10),uid:t._1,text:t._2,type:"chat"})};ioInsertInfoPlayer=t=>{let i=this.my,e=this.Charset;if(t._1.id==i.id)this.my=t._1;else{let i=e.find((i=>i.id==t._1.id));i?Object.assign(i,t._1):e.push(t._1)}};ioInsertAttackInfo=t=>{let i={};return i.fromID=t._1,i.toID=t._2,i.value=t._3,i.type=t._4,i.from=t._5,i.to=t._6,this.reposiveAttackInfo(i)};ioInsertAttackEFF=t=>{let i={};i.from=t._1,i.type=t._2,i.keyid=t._3,i.to=t._4,this.reposiveSkillEff(i)};ioInsertAttack=t=>{let i={};return i.from=t._1,i.type=t._2,i.id=t._3,i.level=t._4,i.victim=t._5,i.keyid=t._6,i.detu=t._7,this.reposiveAttack(i)};ioUpdateMobInmap=t=>{let i=this.Charset,e=this;for(let h=0;h<t._1.length;h++){let n=t._1[h],a=i.find((t=>t.id==n._1));if(!a){e.ioGetElementOnMap();break}a.pos.x=n._2.x>>0,0==a.namdat&&(a.pos.y=n._2.y>>0),a.info.move=n._3,a.info.act="attack"!=a.info.act?n._4:"attack",a.eff=n._5,e.addAction({id:a.id,action:a.info.act})}};ioInsertPlayer=t=>{if(!(this.my.id<=0)){if(this.loadGame.visible,!t)return!1;if(this.Charset,t._5){let i=this.Charset;for(let e=0;e<t._5.length;e++)if(null==i.find((i=>i.id==t._5[e].id))){let h=t._5[e],n="",a="",o="";if(n=h.script.ao,a=h.script.quan,o=h.script.dau,h.script.theobo){let t=this.images.find((t=>t.id==h.script.theobo&&"ao"==t.type));t&&(n=t.name);let i=this.images.find((t=>t.id==h.script.theobo&&"quan"==t.type));i&&(a=i.name);let e=this.images.find((t=>t.id==h.script.theobo&&"dau"==t.type));e&&(o=e.name)}i.push({source:h,type:"npc",id:h.id,name:h.name,eff:{choang:{time:0}},skin:{ao:n,quan:a,dau:o},info:{chiso:{hp:1,hpFull:1},coban:{avatar:"516",sucmanh:100},act:"dungyen",move:h.move||"right",right:h.auto||!1,speed:1},pos:{map:h.map.map,x:h.map.x,y:h.map.y}})}}if(t._2){let i=this.Charset;for(let e=0;e<t._2.length;e++)null==i.find((i=>i.id==t._2[e].id))&&i.push(t._2[e])}if(t._3){let i=this.Charset;for(let e=0;e<t._3.length;e++)null==i.find((i=>i.id==t._3[e].id))&&(t._3[e].type="item",t._3[e].info={chiso:{hp:1}},i.push(t._3[e]))}if(t._4){let i=this.Charset;for(let e=0;e<t._4.length;e++)if(null==i.find((i=>i.id==t._4[e].id))){let h=t._4[e].target.map,n=this.listMap.find((t=>t.id==h));n&&(t._4[e].name=n.name),t._4[e].type="zone",t._4[e].info={chiso:{hp:1}},i.push(t._4[e])}}if(t._1){let i=this.Charset;for(let e=0;e<t._1.length;e++)t._1[e].id!=this.my.id&&null==i.find((i=>i.id==t._1[e].id))&&i.push(t._1[e])}if(t._6){let i=this.Charset;for(let e=0;e<t._6.length;e++)if(null==i.find((i=>i.id==t._6[e].id))){let h=t._6[e],n="",a="",o="";if(n=h.skin.ao,a=h.skin.quan,o=h.skin.dau,h.skin.theobo){let t=this.images.find((t=>t.id==h.skin.theobo&&"ao"==t.type));t&&(n=t.name);let i=this.images.find((t=>t.id==h.skin.theobo&&"quan"==t.type));i&&(a=i.name);let e=this.images.find((t=>t.id==h.skin.theobo&&"dau"==t.type));e&&(o=e.name)}h.skin.ao=n,h.skin.quan=a,h.skin.dau=o,i.push(h)}}this.resetNone()}};IoMovePlayer=t=>{let i=this.Charset.find((i=>i.id==t._1));i?(i.pos.x=t._2>>0,i.pos.y=t._3>>0,i.info.move=1==t._4?"right":"left",i.info.act=t._5):(console.log("ko tim thay player",t._1),this.ioGetElementOnMap())};resetNone=()=>{for(let t=0;t<this.nguoichoi.children.length;t++){let i=this.nguoichoi.children[t];if("detu"==i.type){let t=this.Charset.find((t=>t.id==i.id));if(t){let t=this.Charset.find((t=>t.id==i.of));t||this.deleteNguoiChoi(i.id)}else this.deleteNguoiChoi(i.id)}else{let t=this.Charset.find((t=>t.id==i.id));t||this.deleteNguoiChoi(i.id)}}};logInGame=()=>0==!!this.username||this.username.length<1||0==!!this.password||this.password.length<1?this.pageLogin():(this.loadGame.visible=!0,void this.to("-1",{_1:this.username,_2:this.password}));outGame=()=>{this.Charset=[],this.resetNone(),this.guestContainer.visible=!0,this.my.id=0,this.CreateMainGuestGame(),this.to(-14)};IoMap=t=>{let i=t._1,e=t._2,h=t._3,n=t._6;if(this.mapMore={},this.nen.tint=1400349,this.bando_channuixa.tint=1340437,this.bando_chantroi.tint=4830299,this.app.renderer.background.color=1683704,this.stopMusic(),n){let t=n.color;t&&(this.nen.tint=t.chan||1400349,this.bando_channuixa.tint=t.channui||1340437,this.bando_chantroi.tint=t.chantroi||4830299,this.app.renderer.background.color=t.background||1683704),n.music&&this.playMusic(n.music,!0)}this.mapMore=n;let a=this.my;a.id>=1&&(a.pos.map=e,a.pos.zone=h,this.sendMyMove()),this.cacheMap=i,this.Charset=[],t._7&&this.ioInsertPlayer(t._7),this.LoadAssetMap()};a=t=>{this.to(-27,t)}}const Ut=class extends jt{constructor(){super()}readData=t=>{if(!(t instanceof ArrayBuffer))return t;return msgpack.decode(new Uint8Array(t))||t};handleData=()=>{this.ws.onAny(((t,...i)=>{if(i[0]){let t=i[0];if("string"==typeof t)return this.IoEvent(i);if("number"==typeof t)return this.IoEvent(i);if("boolean"==typeof t)return this.IoEvent(i);if(void 0===t)return this.IoEvent(i);if("function"==typeof t)return this.IoEvent(i);t=this.readData(i[0]),this.IoEvent(t)}}))};IoMsgNotice=t=>{if(t.notice)return t.notice.load?this.notice(t.notice.text,!1):this.notice(t.notice.text)};IoEvent=t=>{if(!t)return!1;if("object"!=typeof t)return;if(null==t)return;let i=t;if(i.noti&&this.notice(i.noti),i.chipi&&this.chipi(i.chipi),i._a&&this.IoMovePlayer(i),i._b&&this.ioInsertPlayer(i),i._c&&this.ioUpdateMobInmap(i),i._d&&this.ioInsertAttack(i),i._e&&this.ioInsertAttackInfo(i),i._f&&this.ioInsertAttackEFF(i),i._g&&this.ioInsertInfoPlayer(i),i._h&&this.ioInsertChat(i),i._i&&this.ioUpdateRuong(i),i._j&&this.ioUpdateInfoSkin(i),i._k&&this.ioUpdateAction(i),i._l&&this.ioUpdateVatPhamRoiDat(i),i._m&&this.ioUpdateDeTu(i),i._n&&this.checkIdPlayerOnMap(i),i._o&&this.ioUpdateRuongDeTu(i),i._p&&this.IoMap(i),i._q&&this.playAudio(i),i._aa&&this.ioXuListKhu(i),i._ba&&this.changeZoneSucess(i),i.notice&&this.IoMsgNotice(i),i._s&&this.ioBoxShop(i),i._s2&&this.ioBoxShopSuccess(i),i.closeNotice&&this.boxError.removeChildren(),i.login&&i.login.status){this.my=i.login.my,this.NhanVat.x=this.my.pos.x,this.NhanVat.y=this.my.pos.y,this.NhanVat.id=this.my.id;let t=this.my;if(console.log(t.skin),t.skin.theobo&&t.skin.theobo.length>=1){console.log(t.skin.theobo);let i=this.images.find((i=>i.id==t.skin.theobo&&"ao"==i.type));i&&(this.my.skin.ao=i.name);let e=this.images.find((i=>i.id==t.skin.theobo&&"quan"==i.type));e&&(this.my.skin.quan=e.name);let h=this.images.find((i=>i.id==t.skin.theobo&&"dau"==i.type));h&&(this.my.skin.dau=h.name)}this.LoadAssetPlayer(),this.guestContainer.visible=!1,this.loadGame.visible=!0,clearInterval(this.InputSetInverti),this.logNotice.push("Trò chơi dành cho người trên 12 tuổi. Chơi quá 180 phút mỗi ngày sẽ ảnh hưởng đến sức khỏe"),this.deleteSound("musicwelcome")}if(i.eff){let t=this.my,e=this.Charset;for(let h=0;h<i.eff.length;h++){let n=i.eff[h].id==t.id?t:e.find((t=>t.id==i.eff[h].id));n?n.eff=i.eff[h].eff:this.ioGetElementOnMap()}}}},qt=class extends Ut{constructor(){super()}createObjectIO=()=>{this.ws.on("______",(t=>{t=this.readData(t),this.item=t._.__.___.____,this.skill_active=t._.__.___._____,this.listMap=t._.__.___.______,this.logNhiemVu=t._.__.___._______,this.base_co=t._.__.___.________,this.data_choang=t._.__.___._________})),this.ws.on(-100,(()=>{let t=this.Charset;this.Charset.forEach(((t,i)=>{"zone"==t.type&&(this.Charset.splice(i,1),this.deleteNguoiChoi(t.id))}));for(let i=0;i<t.length;i++)"player"!=t[i].type&&"mob"!=t[i].type&&"zone"!=t[i].type||(t[i].delete=!0);this.Charset=t.filter((t=>"zone"!=t.type)),this.Charset=t.filter((t=>"npc"!=t.type)),this.resetNone(),this.deleteNotice()})),this.ws.on(6,(()=>{this.deleteNotice()})),this.ws.on(7,(()=>{this.notice(this._("Bạn chưa đủ sức mạnh để sử dụng"))})),this.ws.on(-999,(()=>{this.notice(this._("Không tìm thấy UID trên server Socket.IO"))})),this.ws.on(-99,(()=>{this.pageLogin(),this.inGame.visible=!1,this.notice(this._("Tên tài khoản hoặc mật khẩu chưa chính xác"))})),this.ws.on("-98",(()=>{this.notice(this._("Tài khoản đã được đăng nhập ở nơi khác. Vui lòng đăng nhập lại."))})),this.ws.on("-97",(()=>{this.notice(this._("Tài khoản chưa tạo nhân vật, vui lòng đăng nhập lại game để tạo."))})),this.ws.on(-96,(()=>{this.notice(this._("Không đọc được dữ liệu..."))})),this.ws.on(-95,(()=>{this.notice(this._("Không tìm thấy vật phẩm"))})),this.ws.on(-94,(()=>{this.notice(this._("Không tìm thấy ID VP ở CSDL"))})),this.ws.on(-93,(()=>{this.notice(this._("Vật phẩm này không thể vứt."))})),this.ws.on(-92,(()=>{this.notice(this._("Vật phẩm này đã bị khóa."))})),this.ws.on(-91,(()=>{this.notice(this._("Vui lòng tháo vật phẩm ra trước."))})),this.ws.on(-90,(()=>{this.danger(this._("Vật phẩm này của người khác."))})),this.ws.on(-89,(()=>{this.danger(this._("Hành trang không đủ chỗ trống."))})),this.ws.on(-86,(t=>{t=this.readData(t),this.deleteNguoiChoi(t)})),this.ws.on("nhatvang",(t=>{this.my.tien.vang+=1*t,this.chipi("Bạn nhận được "+this.number_format(t)+" vàng")})),this.ws.on("nhatngoc",(t=>{this.my.tien.zeni+=1*t})),this.ws.on(-85,(t=>{t=this.readData(t),this.my.ruong=t._1})),this.ws.on(-87,(t=>{t=this.readData(t);let i=this.findItem(t._1);1==t._2?this.chipi(this._("Bạn nhận được "+i.name+" ")):this.chipi(this._("Bạn nhận được "+t._2+" "+i.name+" "))})),this.ws.on(-810,(()=>{this.notice(this._("Tên nhân vật từ 4-12 kí tự. Không được có kí tự đặc biệt"))})),this.ws.on(-850,(()=>{this.notice(this._("Vui lòng chọn hành tinh muốn tham gia."))})),this.ws.on(-840,(()=>{this.notice(this._("Vui lòng chọn nhân vật"))})),this.ws.on(-830,(()=>{this.notice(this._("Tên nhân vật đã tồn tại."))})),this.ws.on(-820,(t=>{t=this.readData(t),this.deleteNotice(),this.setCookie("username",t._1,30),this.setCookie("password",t._2,30),this.CreatedCookie(),this.logInGame()})),this.ws.on("nextMap",(t=>{this.nextMap={map:t.map,zone:t.zone,x:t.x,y:t.y}})),this.ws.on("phithuyenroixuong",(t=>{game.addEff({type:"phithuyen",uid:t})})),this.ws.on("phithuyenhacanh",(t=>{game.addEff({type:"phithuyenxuong",uid:t})})),this.ws.on(-27604,(()=>{this.my.info.chiso.hp=1})),this.ws.on(-443,(t=>{t=this.readData(t),this.deleteNotice(),this.Charset=[],this.resetNone(),this.joinMap(t._1),this.my.pos.x=t._2.x,this.my.pos.y=t._2.y,this.NhanVat.x=t._2.x,this.NhanVat.y=t._2.y,this.NhanVatGoc.x=t._2.x,this.NhanVatGoc.y=t._2.y,this.my.pos.map=t._1})),this.ws.on(-9828,(()=>{this.chipi(this._("Không thể đổi khu tại đây."))})),this.ws.on(-9829,(()=>{this.notice(this._("Khu vực này đã đầy người, vui lòng chọn khu vực khác."))})),this.ws.on(1111,(()=>{this.chipi(this._("Bạn không có đủ tiền để thực hiện"))})),this.ws.on(1211,(()=>{this.chipi(this._("Hành trang phải còn đủ ít nhất một chỗ trống để tháo ra."))})),this.ws.on(1311,(()=>{this.chipi(this._("Hành trang không còn chỗ trống."))})),this.ws.on(1411,(()=>{this.chipi(this._("Số lượng vật phẩm này trong hành trang đã đầy. Không thể mua thêm."))})),this.ws.on(1511,(()=>{this.chipi(this._("Hành trang đã có x99 vật phẩm, không thể mua thêm."))})),this.ws.on(-45320,(()=>{this.chipi(this._("Hành tinh của bạn không thể sử dụng vật phẩm này.."))})),this.ws.on(-4533,(()=>{this.chipi(this._("Bạn chưa đủ sức mạnh để sử dụng"))})),this.ws.on(-4532,(()=>{this.chipi(this._("Bạn đã học cấp độ này rồi, hãy mua sách cấp cao hơn để học."))})),this.ws.on(-4531,(()=>{this.chipi(this._("Cấp độ kĩ năng quá cao, bạn cần học kĩ năng cấp thấp trước."))})),this.ws.on("useskill",(t=>{this.my.ruong=t._1,this.my.skill=t._2,this.deleteNotice(),this.clickButton("hanhtrang"),this.chipi(this._("Học cấp tốc kĩ năng thành công. Xin chúc mừng bạn."))})),this.ws.on("tool",(t=>{this.my.ruong=t})),this.ws.on("cuonghoa",(t=>{this.my.ruong=t.ruong,this.my.tien=t.tien,this.deleteNotice(),this.danhSachItem.forEach(((t,i)=>{let e=this.my.ruong.item.find((i=>i.id==t.id));e?this.danhSachItem[i]=e:this.danhSachItem=this.danhSachItem.filter((i=>i.id!=t.id))})),this.closeBox(),this.ioInsertChat({_1:"ba",_2:"Um ba la xi bum...."}),game.addEff({id:"cangcap",type:"nangcap",up:!!t.success,npc:"ba",idvp:t.idvp,da:t.da})})),this.ws.on("duclo",(t=>{this.my.ruong=t.ruong,this.my.tien=t.tien,this.deleteNotice(),this.danhSachItem.forEach(((t,i)=>{let e=this.my.ruong.item.find((i=>i.id==t.id));e?this.danhSachItem[i]=e:this.danhSachItem=this.danhSachItem.filter((i=>i.id!=t.id))})),this.closeBox(),this.ioInsertChat({_1:"ba",_2:"Um ba la xi bum...."}),game.addEff({id:"cangcap",type:"nangcap",up:!!t.success,npc:"ba",idvp:t.idvp,da:9176})})),this.ws.on("expsao",(t=>{this.my.ruong=t.ruong,this.my.tien=t.tien,this.deleteNotice(),this.danhSachItem.forEach(((t,i)=>{let e=this.my.ruong.item.find((i=>i.id==t.id));e?this.danhSachItem[i]=e:this.danhSachItem=this.danhSachItem.filter((i=>i.id!=t.id))})),this.closeBox(),this.ioInsertChat({_1:"ba",_2:"Um ba la xi bum...."}),game.addEff({id:"cangcap",type:"nangcap",up:1,npc:"ba",idvp:t.idvp,da:t.idphale})})),this.ws.on("moigiaodich",(t=>{this.duocmoiGiaoDich(t)})),this.ws.on("chapnhangiaodich",(t=>{this.giaodich={khoa:0,xong:0,vang:0,doiphuong:{id:t,khoa:0,xong:0,vang:0,data:[]}},this.danhSachItem=[],this.deleteNotice(),this.boxGiaoDichHanhTrang()})),this.ws.on("khoagiaodichthanhcong",(()=>{this.giaodich.khoa=1,this.deleteNotice(),this.boxGiaoDichHanhTrang()})),this.ws.on("nhangiaodichkhoa",(t=>{this.giaodich.doiphuong.khoa=1,this.giaodich.doiphuong.vang=t.vang,this.giaodich.doiphuong.data=t.item,this.boxGiaoDichHanhTrang()})),this.ws.on("daxonggiaodich",(()=>{this.giaodich.xong=1,this.deleteNotice(),this.closeBox(),this.chipi("Xác nhận giao dịch thành công, vui lòng chờ đối phương đồng ý nhé.")})),this.ws.on("doiphuongdakhoa",(()=>{this.giaodich.doiphuong.xong=1,this.boxGiaoDichHanhTrang()})),this.ws.on("doneGiaoDich",(t=>{this.my.ruong=t.ruong,this.my.tien=t.tien,this.chipi(this._("Giao dịch thành công.")),this.closeBox(),this.giaodich.doiphuong={id:0,khoa:0,xong:0,vang:0,data:[]}})),this.ws.on("loigiaodich",(()=>{this.closeBox(),this.giaodich.doiphuong.id=0,this.chipi(this._("Giao dịch bị hủy."))})),this.ws.on("huygiaodichkhongonline",(()=>{this.closeBox(),this.chipi(this._("Đối phương không online.")),this.giaodich.doiphuong.id=0})),this.ws.on("huygiaodichthanhcong",(()=>{this.closeBox(),this.giaodich.doiphuong={id:0,khoa:0,xong:0,vang:0,data:[]}})),this.ws.on("doiphuonghuygiaodich",(()=>{this.closeBox(),this.giaodich.doiphuong={id:0,khoa:0,xong:0,vang:0,data:[]},this.chipi(this._("Đối phương đã hủy giao dịch"))})),this.ws.on("catdothanhcong",(t=>{this.my.ruong=t._1,this.openRuongDo(0),this.deleteNotice()})),this.ws.on("closebox",(()=>{this.closeBox()})),this.ws.on("tancongmob",(t=>{let i=this.Charset.find((i=>i.id==t));i&&(i.info.act="attack")})),this.ws.on("nhiemvusuccess",(t=>{this.closeBox(),this.deleteNotice(),this.my.nhiemvu=t.nhiemvu,this.my.ruong=t.ruong,this.my.tien=t.tien,this.my.info=t.info})),this.ws.on(-98512103,(()=>{this.closeBox(),this.deleteNotice(),this.boxNewKyNang()})),this.ws.on("buff_eff",(t=>{this.addEff({type:"chung",aim:t,src:this.createArray(1,28),folder:"other/buff",width:250,height:250})})),this.ws.on("updateNgocXanh",(t=>{this.my.tien.zeni=t})),this.ws.on("mobHS",(t=>{let i=this.getMy(t.id);if(!i)return this.ioGetElementOnMap();i.info=t.info;let e=this.getNhanVat(t.id);if(!e)return this.ioGetElementOnMap();e.checkSieuQuai=0,this.deleteEff("sieuquai"+t.id)})),this.ws.on("tien",(t=>{this.my.tien=t})),this.ws.on("skin",(t=>{this.my.skin=t,this.NhanVat_phukien.children.filter((t=>"co"==t.name)).forEach((t=>{t.destroy()}))})),this.ws.on("ngaunhienbanghoi",(t=>{this.banghoi.random=t,this.indexNoJoinPT()})),this.ws.on("banghoi",(t=>{this.banghoi.info=t.info,this.banghoi.name=t.name,this.banghoi.menber=t.menber,this.banghoi.chat=t.chat,this.banghoi.xinvao=t.xinvao})),this.ws.on("chatPT",(t=>{this.banghoi.chat.push(t),null!=this.box.getChildByName("banghoi_open")?this.boxNewBangHoi():this.banghoi.tinnhan++})),this.ws.on("lammoibanghoi",(()=>{this.to(-33,{type:"me"})})),this.ws.on("bangxin",(t=>{this.banghoi.xinvao=t})),this.ws.on("openduyetmen",(()=>{this.boxPTMenberXin(),this.deleteNotice()})),this.ws.on("outbanghoi",(()=>{this.boxNewBangHoi(),this.deleteNotice()})),this.ws.on("phongphosuccess",(()=>{this.deleteNotice(),this.boxPTMenber()})),this.ws.on("roisocketbang",(t=>{this.to(-33,{type:"leave",id:t})})),this.ws.on("moi_jo_PT",(t=>{this.PT_Loi_Moi_Vao_bang(t.name,t.bang)})),this.ws.on("gianhapbangsuccess",(()=>{this.chipi("Gia nhập bang hội thành công"),this.deleteNotice()})),this.ws.on("skin_map",(t=>{let i=this.getMy(t.id);i&&(i.id==this.my.id&&this.deleteNotice(),i.skin=t.skin,this.NhanVat_phukien.children.filter((t=>"co"==t.name)).forEach((t=>{t.destroy()})))})),this.ws.on("OPEN_RUONG",(t=>{let i=this.my;return i.ruong=t.ruong,i.tien=t.tien,this.deleteNotice(),this.xulyRuong(t.id,t.i,t.kq)})),this.ws.on("successLK",(t=>{this.my.veri=1,this.deleteNotice(),this.bodyChat.removeChildren(),this.my.username=t._1,this.setCookie("username",t._1,30),this.setCookie("password",t._2,30),this.CreatedCookie()})),this.ws.on("noChar",(()=>{this.guestContainer.visible=!0,this.loadGame.visible=!1,this.MenuCreateNewPlayer(),this.notice("Tài khoản của bạn chưa có nhân vật, vui lòng tạo nhé !")})),this.ws.on("bossMove",(t=>{let i=t.id,e=this.getMy(i);if(!e)return this.ioGetElementOnMap();e.pos.x=t.x,e.pos.y=t.y,e.info.move=t.move})),this.ws.on("bossEffect",(t=>{let i=t.id,e=this.getMy(i);if(!e)return this.ioGetElementOnMap();e.eff[t.d_eff].active=t.active})),this.ws.on("bossUpdate",(t=>{let i=t.id,e=this.getMy(i);if(!e)return this.ioGetElementOnMap();e.info.chiso.hp=t.hp})),this.ws.on("server",(t=>{this.logNotice.push(t)})),this.ws.on("error",(()=>{this.chipi("Có lỗi xẩy ra, vui lòng thử lại.")})),this.ws.on("2b",((t,i)=>{if(this.my.id>=1){let e=this.my.skill.find((i=>i.id==t));e&&(e.time=Date.now()+1e3*i,e.lasttime=Date.now())}})),this.ws.on("moipvp",(t=>{this.PVPView(t.id,t.vang)})),this.ws.on("test",(t=>{console.log("test",t)})),this.ws.on("msg",(t=>{this.addEff({type:t.type,to:t.uid,value:1})})),this.ws.on("dis",(()=>{this.Charset=[],this.resetNone(),this.guestContainer.visible=!0,this.my.id=0,this.CreateMainGuestGame(),this.deleteNotice(),this.notice("Tài khoản của bạn đang được đăng nhập ở nơi khác. Vui lòng thử lại.")})),this.ws.on(-1306,(()=>{this.CreateMainGuestGame(),this.inGame.visible=!1,this.notice(this._("Tài khoản của bạn đang được đăng nhập ở nơi khác. Vui lòng thử lại sau ít phút."))})),this.ws.on("notJoin",(()=>{this.inGame.visible=!0,this.loadGame.visible=!1,this.chipi("bạn không thể vào khu vực này")})),this.ws.on("notQuest",(()=>{this.inGame.visible=!0,this.loadGame.visible=!1,this.chipi("Bạn chưa thể đi tới khu vực này. Hãy hoàn thành nhiệm vụ trước.")})),this.ws.on("updatedQuest",(t=>{this.my.nhiemvu=t}))}};class $t extends qt{constructor(){super(),this.isConnect=!1}ioStart=()=>{this.ws.on("connect",(t=>{this.isConnect=!0,this.send("game"),this.deleteNotice(),this.my.id>0&&(this.to("-2",{_1:this.my.id,_2:this.my.token}),this.notice(this.lang("Đang kết nối lại nhân vật."),!1))})),this.ws.on("a",(t=>{console.log(t)})),this.ws.on("data",(t=>{console.log(t)})),this.ws.on("disconnect",(()=>{this.isConnect=!1,this.Charset=[],this.resetNone(),this.notice(this._("Mất kết nối tới máy chủ... Đang thử kết nối lại"),!1)}))}}class Jt extends $t{constructor(){super(),this.assetStartGame(),this.createGameConfig()}e=(t="Có lỗi xẩy ra, vui lòng thử lại.")=>this.chipi(t);AwaitLoadSheet=async()=>{let t=this.srcSheet;await t.forEach((async t=>{let i=await fetch("./assets/sheet/"+t+".json"),e=await i.json();try{let t=e.frames,i=e.meta.image;PIXI.Texture.from("./assets/sheet/"+i,{resourceOptions:{createBitmap:!0}});for(let e in t){let h=t[e].frame,n=e.replace(".png",""),a=t[e].rotated,o=t[e].trimmed,s=this.listBigSheet.find((t=>t.n==n));if(s)continue;let d={n,t:i,origin:t[e].spriteSourceSize,rotated:a,trimmed:o};d.x=h.x,d.y=h.y,d.w=h.w,d.h=h.h,this.listBigSheet.push(d)}}catch(t){console.log(t)}}))};async assetStartGame(){await this.AwaitLoadSheet(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||(this.PC=!0)}}let Qt=new class extends Jt{constructor(){super(),this.cacheMap=[]}};window.game=Qt})();